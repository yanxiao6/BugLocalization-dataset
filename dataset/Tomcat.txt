id	bug_id	summary	description	report_time	report_timestamp	status	commit	commit_timestamp	files	
1	56012	Bug 56012 wrong import statement generation while using the extends attribute of the page directive		2014-01-15 07:30:17	1389790000	resolved fixed	42056be	1390080000	java/org/apache/jasper/compiler/PageInfo.java java/org/apache/jasper/compiler/Validator.java	1:java/org/apache/jasper/compiler/PageInfo.java 21:java/org/apache/jasper/compiler/Validator.java
2	56029	Bug 56029 Ternary operator doesn't work as expected inside attributes in jspx pages		2014-01-18 12:42:47	1390070000	resolved fixed	b430e29	1390070000	java/org/apache/jasper/compiler/ELParser.java test/org/apache/jasper/compiler/TestELParser.java	301:java/org/apache/jasper/compiler/ELParser.java 1822:test/org/apache/jasper/compiler/TestELParser.java
3	55943	Bug 55943 Provide a way prevent looking at the System classloader before the webapp classloaders		2014-01-01 10:02:46	1388590000	resolved fixed	f28800c	1389970000	java/org/apache/catalina/loader/WebappClassLoader.java	3:java/org/apache/catalina/loader/WebappClassLoader.java
4	56025	Bug 56025 Order of invocation of method of ServerEndpointConfig.Configurator		2014-01-17 08:23:30	1389970000	resolved fixed	11b1e83	1389960000	java/org/apache/tomcat/websocket/server/UpgradeUtil.java	59:java/org/apache/tomcat/websocket/server/UpgradeUtil.java
5	56010	Bug 56010 JspFactory.getPageContext with JspWriter.DEFAULT_BUFFER throws IllegalArgumentException		2014-01-15 03:34:23	1389770000	resolved fixed	48650dd	1389880000	java/org/apache/jasper/runtime/PageContextImpl.java test/org/apache/jasper/runtime/TestPageContextImpl.java	3:java/org/apache/jasper/runtime/PageContextImpl.java 77:test/org/apache/jasper/runtime/TestPageContextImpl.java
6	55996	Bug 55996 Async context does not timeout with HTTP NIO connector		2014-01-13 06:12:37	1389610000	resolved fixed	553ad39	1389720000	java/org/apache/tomcat/util/net/SocketWrapper.java	46:java/org/apache/tomcat/util/net/SocketWrapper.java
7	55995	Bug 55995 java.lang.NullPointerException at org.apache.jasper.servlet.JspCServletContext.getResource(JspCServletContext.java:344)	"Null pointer exception when running JSPC from a Shell Script. JspCServletContext.java:344 /** * Return a URL object of a resource that is mapped to the * specified context-relative path. * * @param path Context-relative path of the desired resource * * @exception MalformedURLException if the resource path is * not properly formed */ @Override public URL getResource(String path) throws MalformedURLException { if (!path.startsWith(""/"")) throw new MalformedURLException(""Path '"" + path + ""' does not start with '/'""); TldCache.java:124 private long[] getLastModified(TldResourcePath tldResourcePath) { long[] result = new long[2]; result[0] = -1; result[1] = -1; try { URL url = servletContext.getResource(tldResourcePath.getWebappPath()); /usr/java/jdk1.7.0_45/bin/java -classpath :/home/tomcat/apache-tomcat-8.0.0-RC10/lib/catalina-storeconfig.jar:/home/tomcat/apache-tomcat-8.0.0-RC10/lib/tomcat-websocket.jar:/home/tomcat/apache-tomcat-8.0.0-RC10/lib/tomcat-i18n-es.jar:/home/tomcat/apache-tomcat-8.0.0-RC10/lib/catalina-tribes.jar:/home/tomcat/apache-tomcat-8.0.0-RC10/lib/catalina-ha.jar:/home/tomcat/apache-tomcat-8.0.0-RC10/lib/tomcat-i18n-ja.jar:/home/tomcat/apache-tomcat-8.0.0-RC10/lib/jsp-api.jar:/home/tomcat/apache-tomcat-8.0.0-RC10/lib/tomcat-util.jar:/home/tomcat/apache-tomcat-8.0.0-RC10/lib/tomcat-jni.jar:/home/tomcat/apache-tomcat-8.0.0-RC10/lib/jasper.jar:/home/tomcat/apache-tomcat-8.0.0-RC10/lib/websocket-api.jar:/home/tomcat/apache-tomcat-8.0.0-RC10/lib/ecj-4.3.1.jar:/home/tomcat/apache-tomcat-8.0.0-RC10/lib/tomcat-i18n-fr.jar:/home/tomcat/apache-tomcat-8.0.0-RC10/lib/tomcat-api.jar:/home/tomcat/apache-tomcat-8.0.0-RC10/lib/tomcat-coyote.jar:/home/tomcat/apache-tomcat-8.0.0-RC10/lib/servlet-api.jar:/home/tomcat/apache-tomcat-8.0.0-RC10/lib/jasper-el.jar:/home/tomcat/apache-tomcat-8.0.0-RC10/lib/catalina.jar:/home/tomcat/apache-tomcat-8.0.0-RC10/lib/tomcat-dbcp.jar:/home/tomcat/apache-tomcat-8.0.0-RC10/lib/tomcat-jdbc.jar:/home/tomcat/apache-tomcat-8.0.0-RC10/lib/annotations-api.jar:/home/tomcat/apache-tomcat-8.0.0-RC10/lib/tomcat-util-scan.jar:/home/tomcat/apache-tomcat-8.0.0-RC10/lib/catalina-ant.jar:/home/tomcat/apache-tomcat-8.0.0-RC10/lib/el-api.jar:/home/tomcat/apache-tomcat-8.0.0-RC10/lib/tomcat-spdy.jar:/home/tomcat/apache-tomcat-8.0.0-RC10/bin/tomcat-juli.jar:/home/tomcat/apache-tomcat-8.0.0-RC10/bin/bootstrap.jar:/home/tomcat/apache-tomcat-8.0.0-RC10/bin/commons-daemon.jar:/home/tomcat/apache-tomcat-8.0.0-RC10/webapps/examples/WEB-INF/lib/jstl.jar:/home/tomcat/apache-tomcat-8.0.0-RC10/webapps/examples/WEB-INF/lib/standard.jar:/home/java/source/HEAD/work/jsp_compile_shared/WEB-INF/lib/ant-1.6.5.jar org.apache.jasper.JspC -d /home/java/source/HEAD/work/tomcat80 -v -l -uriroot /home/java/source/HEAD/work/jsp_compile_shared /home/java/source/HEAD/work/jsp_compile_shared/WEB-INF/jsp/dialog/qbAxesDlg.jsp /home/java/source/HEAD/work/jsp_compile_shared/WEB-INF/jsp/dialog/qbManualGecodingDlg.jsp /home/java/source/HEAD/work/jsp_compile_shared/WEB-INF/jsp/fmtdlg.jsp /home/java/source/HEAD/work/jsp_compile_shared/WEB-INF/jsp/index.jsp /home/java/source/HEAD/work/jsp_compile_shared/WEB-INF/jsp/joindlg.jsp /home/java/source/HEAD/work/jsp_compile_shared/WEB-INF/jsp/producer.jsp /home/java/source/HEAD/work/jsp_compile_shared/WEB-INF/jsp/simplefilter.jsp /home/java/source/HEAD/work/jsp_compile_shared/WEB-INF/jsp/selectvaluedlg.jsp /home/java/source/HEAD/work/jsp_compile_shared/WEB-INF/jsp/binddowsTestView.jsp /home/java/source/HEAD/work/jsp_compile_shared/WEB-INF/jsp/variableeditordlg.jsp /home/java/source/HEAD/work/jsp_compile_shared/WEB-INF/jsp/filterprompteditor.jsp /home/java/source/HEAD/work/jsp_compile_shared/WEB-INF/jsp/ajax_response.jsp /home/java/source/HEAD/work/jsp_compile_shared/WEB-INF/jsp/fontdlg.jsp /home/java/source/HEAD/work/jsp_compile_shared/WEB-INF/jsp/join_fields.jsp /home/java/source/HEAD/work/jsp_compile_shared/WEB-INF/jsp/tree_component.jsp /home/java/source/HEAD/work/jsp_compile_shared/WEB-INF/jsp/waiting_banner.jsp /home/java/source/HEAD/work/jsp_compile_shared/WEB-INF/jsp/bid/folderblock/BID_FolderBlockInit.jsp /home/java/source/HEAD/work/jsp_compile_shared/WEB-INF/jsp/bid/folderblock/BID_FolderBlockBoot.jsp /home/java/source/HEAD/work/jsp_compile_shared/WEB-INF/jsp/bid/BID_EmptyContent.jsp /home/java/source/HEAD/work/jsp_compile_shared/WEB-INF/jsp/bid/xml/BID_UrlProperties.jsp /home/java/source/HEAD/work/jsp_compile_shared/WEB-INF/jsp/bid/xml/BID_IBFSpathToHrefs.jsp /home/java/source/HEAD/work/jsp_compile_shared/WEB-INF/jsp/bid/xml/BID_xmlresponse.jsp /home/java/source/HEAD/work/jsp_compile_shared/WEB-INF/jsp/bid/xml/BID_statusResponse.jsp /home/java/source/HEAD/work/jsp_compile_shared/WEB-INF/jsp/bid/favorites/BID_favorites_tree.jsp /home/java/source/HEAD/work/jsp_compile_shared/WEB-INF/jsp/bid/favorites/BID_FavoritesBlockBoot.jsp /home/java/source/HEAD/work/jsp_compile_shared/WEB-INF/jsp/bid/favorites/BID_FavoritesBlockInit.jsp /home/java/source/HEAD/work/jsp_compile_shared/WEB-INF/jsp/bid/favorites/BID_favorites_tree_boot.jsp /home/java/source/HEAD/work/jsp_compile_shared/WEB-INF/jsp/bid/favorites/BID_listToXML.jsp /home/java/source/HEAD/work/jsp_compile_shared/WEB-INF/jsp/bid/index.jsp /home/java/source/HEAD/work/jsp_compile_shared/WEB-INF/jsp/bid/views/BID_InternalPage.jsp /home/java/source/HEAD/work/jsp_compile_shared/WEB-INF/jsp/bid/views/BID_SearchTree_Boot.jsp /home/java/source/HEAD/work/jsp_compile_shared/WEB-INF/jsp/bid/views/BID_SATree_Boot.jsp /home/java/source/HEAD/work/jsp_compile_shared/WEB-INF/jsp/bid/views/BID_BiFrame.jsp /home/java/source/HEAD/work/jsp_compile_shared/WEB-INF/jsp/bid/views/BID_initView.jsp /home/java/source/HEAD/work/jsp_compile_shared/WEB-INF/jsp/bid/views/BID_ShowToolbar.jsp /home/java/source/HEAD/work/jsp_compile_shared/WEB-INF/jsp/bid/views/BID_ExternalPage.jsp /home/java/source/HEAD/work/jsp_compile_shared/WEB-INF/jsp/bid/views/BID_SATreeBiFrame.jsp /home/java/source/HEAD/work/jsp_compile_shared/WEB-INF/jsp/bid/views/BID_initBindows.jsp /home/java/source/HEAD/work/jsp_compile_shared/WEB-INF/jsp/bid/views/BID_SearchTreeBiFrame.jsp /home/java/source/HEAD/work/jsp_compile_shared/WEB-INF/jsp/bid/recents/BID_recents_tree_boot.jsp /home/java/source/HEAD/work/jsp_compile_shared/WEB-INF/jsp/bid/recents/BID_recents_tree.jsp /home/java/source/HEAD/work/jsp_compile_shared/WEB-INF/jsp/bid/recents/BID_listToXML.jsp /home/java/source/HEAD/work/jsp_compile_shared/WEB-INF/jsp/bid/error.jsp /home/java/source/HEAD/work/jsp_compile_shared/WEB-INF/jsp/bid/groups/BID_listToXML.jsp /home/java/source/HEAD/work/jsp_compile_shared/WEB-INF/jsp/bid/search/BID_searchListToXML.jsp /home/java/source/HEAD/work/jsp_compile_shared/WEB-INF/jsp/bid/search/BID_listToXML.jsp /home/java/source/HEAD/work/jsp_compile_shared/WEB-INF/jsp/bid/tree/BID_MrPropertiesToXML.jsp /home/java/source/HEAD/work/jsp_compile_shared/WEB-INF/jsp/bid/tree/BID_flatListToXML.jsp /home/java/source/HEAD/work/jsp_compile_shared/WEB-INF/jsp/bid/tree/BID_PlainText.jsp /home/java/source/HEAD/work/jsp_compile_shared/WEB-INF/jsp/bid/tree/BID_listToXML.jsp 2>&1 Exception in thread ""main"" java.lang.NullPointerException at org.apache.jasper.servlet.JspCServletContext.getResource(JspCServletContext.java:344) at org.apache.jasper.compiler.TldCache.getLastModified(TldCache.java:124) at org.apache.jasper.compiler.TldCache.<init>(TldCache.java:70) at org.apache.jasper.JspC.initServletContext(JspC.java:1468) at org.apache.jasper.JspC.execute(JspC.java:1321) at org.apache.jasper.JspC.main(JspC.java:269)"	2014-01-13 05:55:30	1389610000	resolved fixed	5e6b884	1389700000	java/org/apache/jasper/compiler/TldCache.java	6:java/org/apache/jasper/compiler/TldCache.java
8	55893	Bug 55893 Split AccessLogValve and extract the formatting logic in an AbstractAccessLogValve		2013-12-16 21:24:37	1387250000	resolved fixed	92ce68a	1389360000	java/org/apache/catalina/valves/AbstractAccessLogValve.java java/org/apache/catalina/valves/AccessLogValve.java	1:java/org/apache/catalina/valves/AccessLogValve.java
9	55978	Bug 55978 Initial call to onWritePossible() not made by container when using HTTP upgrade	"When using a WriteListener and non-blocking IO with the Servlet async API, the container makes the first call to onWritePossible() as per the spec. When using a WriteListener and non-blocking IO with the Servlet HTTP upgrade API the container does not make the initial call to onWritePossible(). When fixing this bug it is worth checking the initial call to onDataAvailable() as well."	2014-01-08 10:37:25	1389200000	resolved fixed	bd24edc	1389350000	java/org/apache/coyote/AbstractProtocol.java java/org/apache/coyote/http11/upgrade/AbstractProcessor.java java/org/apache/coyote/http11/upgrade/AbstractServletOutputStream.java java/org/apache/coyote/http11/upgrade/AprServletOutputStream.java java/org/apache/coyote/http11/upgrade/BioServletOutputStream.java java/org/apache/coyote/http11/upgrade/NioServletOutputStream.java test/org/apache/coyote/http11/upgrade/TestUpgrade.java	7:java/org/apache/coyote/http11/upgrade/AbstractServletOutputStream.java 9:java/org/apache/coyote/http11/upgrade/AbstractProcessor.java 21:test/org/apache/coyote/http11/upgrade/TestUpgrade.java 354:java/org/apache/coyote/AbstractProtocol.java 373:java/org/apache/coyote/http11/upgrade/NioServletOutputStream.java 606:java/org/apache/coyote/http11/upgrade/BioServletOutputStream.java 930:java/org/apache/coyote/http11/upgrade/AprServletOutputStream.java
10	55976	Bug 55976 Broken response from NIO connector in Tomcat 7.0.50		2014-01-08 09:52:04	1389190000	closed fixed	d423ae2	1389300000	java/org/apache/coyote/http11/Http11NioProcessor.java	17:java/org/apache/coyote/http11/Http11NioProcessor.java
11	55974	Bug 55974 Honor the order when reporting XML parsing errors and warnings in XmlErrorHandler class		2014-01-07 22:59:05	1389150000	resolved fixed	328adb1	1389280000	java/org/apache/tomcat/util/descriptor/XmlErrorHandler.java	1:java/org/apache/tomcat/util/descriptor/XmlErrorHandler.java
12	55970	Bug 55970 A reloadable context is reloaded repeatedly if WEB-INF/lib contains non-jar files		2014-01-07 18:13:45	1389140000	resolved fixed	5594699	1389280000	java/org/apache/catalina/loader/WebappClassLoader.java	14:java/org/apache/catalina/loader/WebappClassLoader.java
13	55960	Bug 55960 TestSSOnonLoginAndBasicAuthenticator is flawed and incomplete		2014-01-06 14:47:05	1389040000	resolved fixed	ad129f8	1389280000	test/org/apache/catalina/authenticator/TestSSOnonLoginAndBasicAuthenticator.java test/org/apache/catalina/startup/TesterServletEncodeUrl.java	1:test/org/apache/catalina/authenticator/TestSSOnonLoginAndBasicAuthenticator.java
14	55958	Bug 55958 Tomcat tries to deploy dir as zip archive even when it is a directory if the name ends with .war	Webapp deployment fails if the dirname ends with .war because it is automatically considered as zip archive.	2014-01-06 09:28:12	1389020000	resolved fixed	5964a52	1389280000	java/org/apache/catalina/core/ContainerBase.java java/org/apache/catalina/ha/deploy/FarmWarDeployer.java java/org/apache/catalina/manager/HTMLManagerServlet.java java/org/apache/catalina/mbeans/MBeanUtils.java java/org/apache/catalina/startup/FailedContext.java java/org/apache/catalina/startup/HostConfig.java java/org/apache/catalina/storeconfig/StandardContextSF.java java/org/apache/catalina/util/ContextName.java test/org/apache/catalina/startup/TestHostConfigAutomaticDeployment.java test/org/apache/catalina/util/TestContextName.java	7:java/org/apache/catalina/manager/HTMLManagerServlet.java 8:java/org/apache/catalina/startup/HostConfig.java 9:java/org/apache/catalina/ha/deploy/FarmWarDeployer.java 12:java/org/apache/catalina/util/ContextName.java 22:test/org/apache/catalina/util/TestContextName.java 27:test/org/apache/catalina/startup/TestHostConfigAutomaticDeployment.java 50:java/org/apache/catalina/core/ContainerBase.java 59:java/org/apache/catalina/startup/FailedContext.java 222:java/org/apache/catalina/mbeans/MBeanUtils.java 228:java/org/apache/catalina/storeconfig/StandardContextSF.java
15	55937	Bug 55937 Tomcat auto deployer not working for ROOT applications		2013-12-27 15:41:22	1388180000	resolved fixed	346e264	1389270000	java/org/apache/catalina/util/ContextName.java test/org/apache/catalina/util/TestContextName.java	308:java/org/apache/catalina/util/ContextName.java 372:test/org/apache/catalina/util/TestContextName.java
16	55939	Bug 55939 Seeing issues with non-blocking io when writing lots of data		2013-12-29 19:40:03	1388360000	resolved fixed	411e4cc	1388430000	java/org/apache/coyote/Response.java	5:java/org/apache/coyote/Response.java
17	55905	Bug 55905 Error message unhelpful when web.xml references a tld file that doesn't exist		2013-12-18 14:30:15	1387400000	resolved fixed	bcb9c58	1387390000	java/org/apache/jasper/servlet/TldScanner.java	6:java/org/apache/jasper/servlet/TldScanner.java
18	55884	Bug 55884 JSPs no longer compile in Java 8		2013-12-14 17:03:59	1387060000	verified fixed	8a5179c	1387210000	java/org/apache/jasper/compiler/JspRuntimeContext.java	9:java/org/apache/jasper/compiler/JspRuntimeContext.java
19	55820	Bug 55820 Add 172.16/12 range to default internal proxies		2013-11-27 15:53:07	1385590000	resolved fixed	c1be72f	1386580000	java/org/apache/catalina/filters/RemoteIpFilter.java java/org/apache/catalina/valves/RemoteIpValve.java	3:java/org/apache/catalina/valves/RemoteIpValve.java 4:java/org/apache/catalina/filters/RemoteIpFilter.java
20	55811	Bug 55811 Do not parse web-fragment.xml files when empty absolute-ordering		2013-11-22 14:45:40	1385150000	resolved fixed	f4da7dc	1386450000	java/org/apache/catalina/startup/ContextConfig.java java/org/apache/jasper/servlet/JspCServletContext.java java/org/apache/tomcat/util/descriptor/web/FragmentJarScannerCallback.java	7:java/org/apache/tomcat/util/descriptor/web/FragmentJarScannerCallback.java 9:java/org/apache/catalina/startup/ContextConfig.java 18:java/org/apache/jasper/servlet/JspCServletContext.java
21	55801	Bug 55801 Add ability to provide custom SSLContext for websocket client		2013-11-20 09:57:24	1384960000	resolved fixed	ef3f56e	1386450000	java/org/apache/tomcat/websocket/WsWebSocketContainer.java	34:java/org/apache/tomcat/websocket/WsWebSocketContainer.java
22	55851	Bug 55851 Tomcat SPNEGO authenticator incompatible with IBM JDK: Accept Security Context needs to be wrapped around a Privileged Action in order for server side authentication		2013-12-06 08:56:41	1386340000	resolved fixed	bba9747	1386360000	java/org/apache/catalina/authenticator/SpnegoAuthenticator.java	1:java/org/apache/catalina/authenticator/SpnegoAuthenticator.java
23	55842	Bug 55842 response.setBufferSize() does not seem to work properly	"I found a problem with setting the buffer size for the ServletResponse. If I call 'response.setBufferSize(1,000,000);' and send about 20,000 characters, the response will be chunked even though it should not. The response is sent in several chunks and contains the 'Transfer-Encoding: chunked' response header. In my understanding in this case the response should be fully buffered on the server and then sent as a whole containing the Content-Length-header. This causes a problem in my application because I want to use a larger buffer to be able to redirect to an error page if an error occurs during rendering the response. I was able to reproduce this on Tomcat 7.0.39, 7.0.40, 7.0.42, 7.0.47. Tomcat 7.0.37 works fine and as expected. This is easily reproducable by using a JSP as follows: <% response.setBufferSize(1000*1000); for (int i = 0; i < 100; i++) { for (int j = 0; j < 100; j++) { response.getWriter().write(""X""); } response.getWriter().write(""<br />""); } %>"	2013-12-04 15:56:09	1386190000	resolved fixed	f4970a7	1386330000	java/org/apache/catalina/connector/OutputBuffer.java java/org/apache/tomcat/util/buf/ByteChunk.java	13:java/org/apache/catalina/connector/OutputBuffer.java 49:java/org/apache/tomcat/util/buf/ByteChunk.java
24	55837	Bug 55837 ServletContext.getRealPath() returns null	"[code] String path = servletContext.getRealPath('/test'); if no file or folder named '/test' exist in webroot then path return null but int tomcat 5\6\7, it will return the correct value , ex /data/oschina/webapp/test"	2013-12-03 08:03:13	1386080000	resolved fixed	a63bf3a	1386180000	java/org/apache/catalina/webresources/DirResourceSet.java java/org/apache/catalina/webresources/EmptyResource.java java/org/apache/catalina/webresources/StandardRoot.java test/org/apache/catalina/webresources/AbstractTestResourceSet.java	23:java/org/apache/catalina/webresources/StandardRoot.java 114:java/org/apache/catalina/webresources/EmptyResource.java 383:java/org/apache/catalina/webresources/DirResourceSet.java 431:test/org/apache/catalina/webresources/AbstractTestResourceSet.java
25	55804	Bug 55804 SPNEGOAUTHENTICATOR - GSSCredential does not get renewed after RemainingLifeTime is less than zero	"In SpnegoAuthenticator, we check for request.getUserPrincipal() if it returns a prinicpal we do not do a fresh authentication. This happens even when the GSSCredential returned by GenericPrincipal has remainingLife time less than zero. This causes issues in delegating the credential as the credential is not valid any more. Can we add additional check to reauthenticate when the credental has expired and put GSSCredential in the same session?"	2013-11-20 19:23:11	1384990000	resolved fixed	8f67335	1385750000	java/org/apache/catalina/connector/Request.java	9:java/org/apache/catalina/connector/Request.java
26	55798	Bug 55798 Enabling Manager App - process and description is inadequate		2013-11-19 23:03:23	1384920000	resolved fixed	13c6551	1384940000	java/org/apache/catalina/users/MemoryUserDatabase.java	256:java/org/apache/catalina/users/MemoryUserDatabase.java
27	55778	Bug 55778 JNDIRealm: Authentication with GSSAPI to LDAP with SSL connection causes an exception	"Whenever i try to authenticate with GSSAPI to a LDAP server with a SSL connection (ldaps), the following exception is thrown: javax.naming.ServiceUnavailableException: myserver.at:636; socket closed; remaining name 'dc=example,dc=org' at com.sun.jndi.ldap.Connection.readReply(Connection.java:452) at com.sun.jndi.ldap.LdapClient.getSearchReply(LdapClient.java:631) at com.sun.jndi.ldap.LdapClient.search(LdapClient.java:554) at com.sun.jndi.ldap.LdapCtx.doSearch(LdapCtx.java:1985) at com.sun.jndi.ldap.LdapCtx.searchAux(LdapCtx.java:1847) at com.sun.jndi.ldap.LdapCtx.c_search(LdapCtx.java:1772) ... Steps to reproduce: 1. Configure the valve org.apache.catalina.authenticator.SpnegoAuthenticator in the server.xml with storeDelegatedCredential=""true"". 2. Configure the realm org.apache.catalina.realm.JNDIRealm in the server.xml with an SSL connection url (e.g. ldaps://myserver.at:636) 3. Configure an auth-method with SPNEGO, security-constraints and security-roles in the web.xml 4. Add required keystores to the jdk for the ldaps connection. 5. Try to authenticate I debugged into the JNDIRealm and figured out, that changing line 2082 from ""context.addToEnvironment(""javax.security.sasl.qop"", ""auth-conf"");"" to ""context.addToEnvironment(""javax.security.sasl.qop"", ""auth"");"" would solve the problem. I also tested the fix with a new written JNDIRealm. But i'm not sure, if this fix causes other security issues."	2013-11-14 14:51:16	1384460000	resolved fixed	27806aa	1384540000	java/org/apache/catalina/realm/JNDIRealm.java	1:java/org/apache/catalina/realm/JNDIRealm.java
28	55776	"Bug 55776 if path include relative char, eg: ../, classloader will not find zhe file"	"I use ibatis in my project, config file path include '..', tomcat can not find the file, command line show: Could not find resource ../ibatis/code/sendType.xml"	2013-11-14 06:14:50	1384430000	resolved fixed	a1ad6ce	1384530000	java/org/apache/catalina/webresources/StandardRoot.java	123:java/org/apache/catalina/webresources/StandardRoot.java
29	55772	Bug 55772 Flushing AsyncContext response writer after ClientAbortException (BrokenPipe) causes request state to leak		2013-11-13 04:45:21	1384340000	resolved fixed	cb62f86	1384520000	java/org/apache/catalina/connector/CoyoteAdapter.java java/org/apache/coyote/ActionCode.java java/org/apache/coyote/ajp/AbstractAjpProcessor.java java/org/apache/coyote/http11/AbstractHttp11Processor.java java/org/apache/coyote/spdy/SpdyProcessor.java test/org/apache/coyote/http11/TestAbstractHttp11Processor.java	13:java/org/apache/coyote/http11/AbstractHttp11Processor.java 16:java/org/apache/coyote/ajp/AbstractAjpProcessor.java 29:java/org/apache/coyote/spdy/SpdyProcessor.java 161:java/org/apache/catalina/connector/CoyoteAdapter.java 304:test/org/apache/coyote/http11/TestAbstractHttp11Processor.java
30	55760	Bug 55760 Tomcat SPNEGO authenticator incompatible with IBM JDK in case of Keytab based initiate and accept authentication		2013-11-08 11:48:18	1383930000	resolved fixed	0a4e847	1384160000	java/org/apache/catalina/authenticator/SpnegoAuthenticator.java	1:java/org/apache/catalina/authenticator/SpnegoAuthenticator.java
31	55749	Bug 55749 Disabling SSLEngine in AprLifecycleListener leads to misleading error message at startup when SSL Connector is delcared	"Put a <Listener className=""org.apache.catalina.core.AprLifecycleListener"" SSLEngine=""off"" /> in you server.xml. Put the APR connector some weeks later in your server.xml: <Connector protocol=""org.apache.coyote.http11.Http11AprProtocol"" port=""@HTTPS_PORT@"" connectionTimeout=""20000"" maxHttpHeaderSize=""24576"" maxThreads=""250"" URIEncoding=""UTF-8"" bufferSize=""4096"" scheme=""https"" secure=""true"" SSLEnabled=""true"" SSLProtocol=""TLSv1"" SSLCipherSuite=""HIGH:!ADH"" SSLCertificateFile=""@SSL_CERT_FILE@"" SSLCertificateKeyFile=""@SSL_CERT_KEY_FILE@"" SSLPassword=""@SSL_PASSWORD@"" /> Start your Tomcat and receive following confusing message: Nov 06, 2013 1:30:39 PM org.apache.coyote.http11.Http11AprProtocol start SEVERE: Error starting endpoint java.lang.Exception: Socket bind failed: [226] Adresse bereits im Zugriff at org.apache.tomcat.util.net.AprEndpoint.init(AprEndpoint.java:671) at org.apache.tomcat.util.net.AprEndpoint.start(AprEndpoint.java:851) at org.apache.coyote.http11.Http11AprProtocol.start(Http11AprProtocol.java:139) at org.apache.catalina.connector.Connector.start(Connector.java:1196) at org.apache.catalina.core.StandardService.start(StandardService.java:540) at org.apache.catalina.core.StandardServer.start(StandardServer.java:754) at org.apache.catalina.startup.Catalina.start(Catalina.java:595) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at java.lang.reflect.Method.invoke(Method.java:606) at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:289) at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:414) Nov 06, 2013 1:30:39 PM org.apache.catalina.core.StandardService start SEVERE: Failed to start connector [Connector[HTTP/1.1-8444]] LifecycleException: service.getName(): ""Catalina""; Protocol handler start failed: java.lang.Exception: Socket bind failed: [226] Adresse bereits im Zugriff at org.apache.catalina.connector.Connector.start(Connector.java:1203) at org.apache.catalina.core.StandardService.start(StandardService.java:540) at org.apache.catalina.core.StandardServer.start(StandardServer.java:754) at org.apache.catalina.startup.Catalina.start(Catalina.java:595) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at java.lang.reflect.Method.invoke(Method.java:606) at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:289) at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:414) This is of course not correct. The port IS availble but the SSL engine has been turned off. There should be a check at stratup which says that this is an illegal state."	2013-11-06 12:32:17	1383760000	resolved fixed	014cf1c	1384110000	java/org/apache/tomcat/util/net/AprEndpoint.java	2:java/org/apache/tomcat/util/net/AprEndpoint.java
32	55735	Bug 55735 Additional quote entity in html element attribute evaluated in tagx if attribute contains EL expression		2013-11-02 06:14:56	1383390000	resolved fixed	7ee1275	1383690000	java/org/apache/jasper/compiler/Validator.java java/org/apache/jasper/runtime/PageContextImpl.java test/org/apache/jasper/compiler/TestParser.java test/org/apache/jasper/compiler/TesterValidator.java test/org/apache/jasper/runtime/TesterPageContextImpl.java	22:java/org/apache/jasper/runtime/PageContextImpl.java 78:test/org/apache/jasper/compiler/TestParser.java 84:java/org/apache/jasper/compiler/Validator.java 214:test/org/apache/jasper/runtime/TesterPageContextImpl.java
33	55715	"Bug 55715 RemoteEndpoint.Async#sendText(String, SendHandler) can cause StackOverflowErrors and contradicts Oracle's JavaDoc"		2013-10-28 15:34:56	1382990000	resolved fixed	3f316f1	1383130000	java/org/apache/tomcat/websocket/server/Constants.java java/org/apache/tomcat/websocket/server/WsContextListener.java java/org/apache/tomcat/websocket/server/WsHttpUpgradeHandler.java java/org/apache/tomcat/websocket/server/WsRemoteEndpointImplServer.java java/org/apache/tomcat/websocket/server/WsServerContainer.java java/org/apache/tomcat/websocket/server/WsWriteTimeout.java	3:java/org/apache/tomcat/websocket/server/WsRemoteEndpointImplServer.java 40:java/org/apache/tomcat/websocket/server/WsServerContainer.java 137:java/org/apache/tomcat/websocket/server/WsHttpUpgradeHandler.java 169:java/org/apache/tomcat/websocket/server/WsWriteTimeout.java 926:java/org/apache/tomcat/websocket/server/Constants.java 1458:java/org/apache/tomcat/websocket/server/WsContextListener.java
34	55702	Bug 55702 TLD cannot be loaded if CATALINA_HOME contains spaces	"A web application containing an own TLD within its WEB-INF directory fails to render a JSP page referencing that TLD if Tomcat it installed into a directory with spaces in the path, such as ""C:\Program Files\..."". After moving the entire Tomcat installation directory to a path without spaces (such as ""C:\1\Tomcat8""), the application can render that same JSP page. Following stacktrace is printed. Note the %20 in the file path org.apache.jasper.JasperException: /jsp/layouts/standard.jsp (line: 7, column: 69) File ""file:/C:/Program%20Files/Apache/Tomcat-8.0.0-RC5/webapps/mywebapp/WEB-INF/tlds/mywebapp-tags.tld"" not found org.apache.jasper.compiler.DefaultErrorHandler.jspError(DefaultErrorHandler.java:42) org.apache.jasper.compiler.ErrorDispatcher.dispatch(ErrorDispatcher.java:276) org.apache.jasper.compiler.ErrorDispatcher.jspError(ErrorDispatcher.java:92) org.apache.jasper.compiler.TagLibraryInfoImpl.<init>(TagLibraryInfoImpl.java:166) org.apache.jasper.compiler.Parser.parseTaglibDirective(Parser.java:410) org.apache.jasper.compiler.Parser.parseDirective(Parser.java:476) org.apache.jasper.compiler.Parser.parseElements(Parser.java:1451) org.apache.jasper.compiler.Parser.parse(Parser.java:138) org.apache.jasper.compiler.ParserController.doParse(ParserController.java:242) org.apache.jasper.compiler.ParserController.parse(ParserController.java:102) org.apache.jasper.compiler.Compiler.generateJava(Compiler.java:198) org.apache.jasper.compiler.Compiler.compile(Compiler.java:373) org.apache.jasper.compiler.Compiler.compile(Compiler.java:353) org.apache.jasper.compiler.Compiler.compile(Compiler.java:340) org.apache.jasper.JspCompilationContext.compile(JspCompilationContext.java:606) org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:357) org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:403) org.apache.jasper.servlet.JspServlet.service(JspServlet.java:347) javax.servlet.http.HttpServlet.service(HttpServlet.java:728) Java version used: Oracle JDK 7 Update 45 (64 Bit) Active Tomcat connector: [""http-nio-8080""]"	2013-10-25 10:03:35	1382710000	resolved fixed	ad50e54	1383050000	java/org/apache/jasper/compiler/TagLibraryInfoImpl.java	8:java/org/apache/jasper/compiler/TagLibraryInfoImpl.java
35	55684	Bug 55684 WebappClassLoader.getThread want an access to root ThreadGroup	Tomcat may not have all permissions granted. The method WebappClassLoader.getThread try to access the root ThreadGroup in order to list all threads. You should either manage SecurityException or avoid to access the parent ThreadGroup of the thread which start Tomcat.	2013-10-21 16:30:04	1382390000	resolved fixed	d244284	1383040000	java/org/apache/catalina/loader/WebappClassLoader.java	1:java/org/apache/catalina/loader/WebappClassLoader.java
36	55691	Bug 55691 javax.el.ArrayELResolver.setValue not supporting arrays of primitives	was working in tomcat 6.0.20 ERROR javax.faces.context.ExceptionHandlerWrapper - javax.faces.component.UpdateModelException: java.lang.ClassCastException: Unable to add an object of type [java.lang.Integer] to an array of objects of type [int] java.lang.ClassCastException: Unable to add an object of type [java.lang.Integer] to an array of objects of type [int] at javax.el.ArrayELResolver.setValue(ArrayELResolver.java:94) at com.sun.faces.el.DemuxCompositeELResolver._setValue(DemuxCompositeELResolver.java:255) at com.sun.faces.el.DemuxCompositeELResolver.setValue(DemuxCompositeELResolver.java:281) at org.apache.el.parser.AstValue.setValue(AstValue.java:158) at org.apache.el.ValueExpressionImpl.setValue(ValueExpressionImpl.java:249) at com.sun.faces.facelets.el.TagValueExpression.setValue(TagValueExpression.java:131) at javax.faces.component.UIInput.updateModel(UIInput.java:818) at javax.faces.component.UIInput.processUpdates(UIInput.java:735) at javax.faces.component.UIData.iterate(UIData.java:2001) at javax.faces.component.UIData.processUpdates(UIData.java:1253) at javax.faces.component.UIComponentBase.processUpdates(UIComponentBase.java:1242) at javax.faces.component.UIForm.processUpdates(UIForm.java:281) at javax.faces.component.UIComponentBase.processUpdates(UIComponentBase.java:1242) at javax.faces.component.UIComponentBase.processUpdates(UIComponentBase.java:1242) at javax.faces.component.UIViewRoot.processUpdates(UIViewRoot.java:1231) at com.sun.faces.lifecycle.UpdateModelValuesPhase.execute(UpdateModelValuesPhase.java:78) at com.sun.faces.lifecycle.Phase.doPhase(Phase.java:101) at com.sun.faces.lifecycle.LifecycleImpl.execute(LifecycleImpl.java:118) at javax.faces.webapp.FacesServlet.service(FacesServlet.java:593) at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:290) at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)	2013-10-22 23:05:42	1382500000	resolved fixed	b82c0c6	1382990000	java/javax/el/ArrayELResolver.java java/javax/el/Util.java test/javax/el/TestArrayELResolver.java	6:java/javax/el/ArrayELResolver.java 9:test/javax/el/TestArrayELResolver.java 916:java/javax/el/Util.java
37	55681	Bug 55681 JSR-356 message handling: NULL pointer being thrown when DecodeException is caught in PojoMessageHandlerWholeBase<T>.onMessage	"I am testing what happens when Encode/Decode Exceptions occur during JSR-356 communication. In our case, we do NOT use annotation, but we ""extend Endpoint"" and ""implement Whole<ThingworxMessage>"". I was forcing a DecodeException to occur - expecting to my onError to be called with the actual DecodeException. Instead, I got a Null. Stepping the following code in Tomcat: in onMessage, the ((WsSession)session) is NULL. As a result, the actual DecodeException (cause) is lost. // Can this message be decoded? Object payload; try { payload = decode(message); } catch (DecodeException de) { ((WsSession) session).getLocal().onError(session, de); return; } Tracing this further up the stack, I found that Util.getMessageHandlers is initializing it and passing NULL in for the session: if (decoderMatch.getTextDecoders().size() > 0) { MessageHandlerResult result = new MessageHandlerResult( new PojoMessageHandlerWholeText(listener, m, null, endpointConfig, decoderMatch.getTextDecoders(), new Object[1], 0, false, -1, -1), MessageHandlerResultType.TEXT); results.add(result); } Please let me know if I can provide any more details. -bob"	2013-10-20 17:37:21	1382310000	resolved fixed	514cefb	1382300000	java/org/apache/tomcat/websocket/Util.java java/org/apache/tomcat/websocket/WsSession.java	1:java/org/apache/tomcat/websocket/Util.java 9:java/org/apache/tomcat/websocket/WsSession.java
38	55664	Bug 55664 [websocket] NPE in Util$DecoderMatch during application start		2013-10-17 19:01:26	1382050000	resolved fixed	4e4a24a	1382080000	java/org/apache/tomcat/websocket/Util.java test/org/apache/tomcat/websocket/TestUtil.java test/org/apache/tomcat/websocket/pojo/TestEncodingDecoding.java	1:java/org/apache/tomcat/websocket/Util.java 20:test/org/apache/tomcat/websocket/TestUtil.java 24:test/org/apache/tomcat/websocket/pojo/TestEncodingDecoding.java
39	55656	Bug 55656 Server ClassLoader not used for Server creation		2013-10-16 09:56:54	1381930000	resolved fixed	86ec1f4	1382020000	java/org/apache/catalina/startup/Catalina.java	8:java/org/apache/catalina/startup/Catalina.java
40	54095	Bug 54095 [patch] support gzipped versions of static resources by DefaultServlet		2012-11-03 20:49:45	1351990000	resolved fixed	f0101d0	1381440000	java/org/apache/catalina/servlets/DefaultServlet.java test/org/apache/catalina/servlets/TestDefaultServlet.java	1:java/org/apache/catalina/servlets/DefaultServlet.java 18:test/org/apache/catalina/servlets/TestDefaultServlet.java
41	55251	Bug 55251 JspC fails silently if directory for generated web.xml does not exist	"If the file specified for webXml (via call to setWebXml) cannot be created (for example if the directory does not exist), then JspC fails silently."	2013-07-12 03:50:46	1373620000	resolved fixed	06d8338	1381410000	java/org/apache/jasper/JspC.java	1:java/org/apache/jasper/JspC.java
42	55642	Bug 55642 TagPluginManager isConstantAttribute broken	"Function isConstantAttribute in TagPluginManager seems to be be broken. For value ""order.status"" it returns false. And for value ""${order.state.name}"" it returns true. According to javadoc it should be exact opposite. Problem seems to be in Node.isLiteral function. ""el!= null"" should probably be ""el== null"" But this function is being used elsewhere. /** * @return true if the attribute is specified and its value is a * translation-time constant. */ public boolean TagPluginManager.isConstantAttribute(String attribute){ Node.JspAttribute attr = getNodeAttribute(attribute); if (attr == null) return false; return attr.isLiteral(); } /** * @return true if the value is a string literal known at translation * time. */ public boolean isLiteral() { return !expression && (el != null) && !namedAttribute; }"	2013-10-09 13:02:21	1381340000	resolved fixed	af49b44	1381330000	java/org/apache/jasper/compiler/Node.java test/org/apache/jasper/compiler/TestNode.java	7:java/org/apache/jasper/compiler/Node.java
43	55630	Bug 55630 clean way to avoid setURLStreamHandlerFactory call	A current method is to set WebappLoader.first via reflection (because private). I think the setURLStreamHandlerFactory should be move to Catalina.start ('first' static field can be move in Catalina). So we could have a static method in Catalina to prevent setURLStreamHandlerFactory call while first starting.	2013-10-05 16:51:34	1381010000	resolved fixed	bd56eea	1381170000	java/org/apache/catalina/webresources/TomcatURLStreamHandlerFactory.java	1:java/org/apache/catalina/webresources/TomcatURLStreamHandlerFactory.java
44	55629	Bug 55629 StatusManagerServlet does not remove JMX notification listener	StatusManagerServlet.destroy should call mBeanServer.removeNotificationListener because init method call mBeanServer.addNotificationListener.	2013-10-05 16:38:36	1381010000	resolved fixed	95faaec	1381130000	java/org/apache/catalina/manager/StatusManagerServlet.java	1:java/org/apache/catalina/manager/StatusManagerServlet.java
45	55317	Bug 55317 Facilitate weaving by allowing ClassFileTransformer to be added to WebppClassLoader		2013-07-28 07:17:28	1375010000	resolved fixed	dd0cba7	1380240000	java/org/apache/catalina/loader/WebappClassLoader.java java/org/apache/tomcat/InstrumentableClassLoader.java test/org/apache/catalina/loader/TestWebappClassLoaderWeaving.java test/org/apache/catalina/loader/TesterNeverWeavedClass.java test/org/apache/catalina/loader/TesterUnweavedClass.java	14:java/org/apache/catalina/loader/WebappClassLoader.java
46	55576	Bug 55576 Order of ServletRequest parameters is not preserved	"The ServletRequest interface provides two methods to iterate through request parameters: Enumeration<String> getParameterNames(), and Map<String, String[]> getParameterMap() Unfortunately, the underlying implementation in Tomcat is a HashMap, which fails to preserve the order of parameters as they are specified in the request. An alternate implementation should be used to preserve request order. LinkedHashMap, for example, is capable of preserving insertion order. The Servlet Specification (v3.0) speaks only to the relative ordering of query string data and post body data. However, section 17.13.3 of the HTML specification (v4.01) titled ""Processing form data"", clearly states that ""control names/values are listed in the order they appear in the document."" Therefore, I do not see a valid interpretation of either specification to rationalize Tomcat's implementation. To receive a request with an ordered list of parameters and represent them in an implementation that is guaranteed not to preserve this order is difficult to rationalize."	2013-09-20 21:14:32	1379730000	resolved fixed	90556a9	1379970000	java/org/apache/catalina/util/ParameterMap.java java/org/apache/tomcat/util/http/Parameters.java	12:java/org/apache/tomcat/util/http/Parameters.java 377:java/org/apache/catalina/util/ParameterMap.java
47	55582	Bug 55582 Concurrent issue of TagFileProcessor		2013-09-22 10:00:36	1379860000	resolved fixed	f627cc8	1379940000	java/org/apache/jasper/compiler/TagFileProcessor.java	1:java/org/apache/jasper/compiler/TagFileProcessor.java
48	55570	Bug 55570 SpnegoAuthenticator: Resource file is missing placeholders for exceptions.	"In java/org/apache/catalina/authenticator/SpnegoAuthenticator.java problems are logged with an exception. The exception does not show up in the logging. The exception only shows up if I hack java/org/apache/catalina/authenticator/LocalStrings.properties in catalina.jar, and add a placeholder. REPRODUCE: - Configure SP-NEGO with Kerberos. - Mess up your principal in com.sun.security.jgss.krb5.accept in jaas.config. - Try to login. - See that you get something like: FINE [org.apache.catalina.authenticator.SpnegoAuthenticator authenticate] Failed to validate client supplied ticket FIX: In java/org/apache/catalina/authenticator/LocalStrings.properties please add [{0}] to the following lines: spnegoAuthenticator.ticketValidateFail=Failed to validate client supplied ticket spnegoAuthenticator.serviceLoginFail=Unable to login as the service principal In SpnegoAuthenticator.java you can verify that exceptions are indeed passed to the log. VALIDATE: - Reproduce again - See that you now get Failed to validate client supplied ticket [GSSException: Failure unspecified at GSS-API level (Mechanism level: Invalid argument (400) - Cannot find key of appropriate type to decrypt AP REP - RC4 with HMAC)] The exception is not super-helpful, but at least it's something."	2013-09-19 12:48:43	1379610000	resolved fixed	910d4d9	1379600000	java/org/apache/catalina/authenticator/SpnegoAuthenticator.java	1:java/org/apache/catalina/authenticator/SpnegoAuthenticator.java
49	46727	Bug 46727 DefaultServlet - serving multiple encodings		2009-02-17 15:01:26	1234900000	resolved fixed	f74257e	1379510000	java/org/apache/catalina/servlets/DefaultServlet.java	1:java/org/apache/catalina/servlets/DefaultServlet.java
50	52558	Bug 52558 CometConnectionManagerValve is adding non-serializable Request[] to Session	CometConnectionManagerValve is adding HttpServletRequest[] to HttpSession which is preventing the Session being serialized in a Clustered setup. We're resolving this locally using a serializable ConnectionList class with a transient Request[] i.e. public class ConnectionList implements Serializable { transient Request[] connectionList = null; ConnectionList(Request[] connectionList){ this.connectionList = connectionList; } public Request[] get(){ return connectionList; } }	2012-01-30 10:46:47	1327940000	resolved fixed	b284611	1378980000	java/org/apache/catalina/valves/CometConnectionManagerValve.java	1:java/org/apache/catalina/valves/CometConnectionManagerValve.java
51	55552	Bug 55552 Potential NullPointerException in compiled JSPs if expected EL result is of primitive type		2013-09-12 06:19:31	1378980000	resolved fixed	66932c4	1378980000	java/org/apache/jasper/compiler/JspUtil.java	13:java/org/apache/jasper/compiler/JspUtil.java
52	54693	Bug 54693 Add a validationQueryTimeout property		2013-03-13 20:04:20	1363220000	resolved fixed	b022c57	1378720000	modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/ConnectionPool.java modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/DataSourceFactory.java modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/DataSourceProxy.java modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/PoolConfiguration.java modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/PoolProperties.java modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/PooledConnection.java modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/jmx/ConnectionPool.java modules/jdbc-pool/src/test/java/org/apache/tomcat/jdbc/test/TestValidationQueryTimeout.java	1:modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/jmx/ConnectionPool.java 2:modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/PoolProperties.java 3:modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/DataSourceProxy.java 4:modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/PoolConfiguration.java 12:modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/PooledConnection.java 48:modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/DataSourceFactory.java 49:modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/ConnectionPool.java
53	55521	Bug 55521 Race Condition in HttpSession#invalidate() / HttpServletRequest#getSession(boolean)		2013-09-04 10:24:05	1378300000	resolved fixed	262c069	1378400000	java/org/apache/catalina/ha/session/DeltaSession.java java/org/apache/catalina/session/StandardSession.java	23:java/org/apache/catalina/session/StandardSession.java 60:java/org/apache/catalina/ha/session/DeltaSession.java
54	55527	Bug 55527 JSSESocketFactory conditionally converts alias to lower case; condition is unwise	"JSSESocketFactory conditionally converts the alias to lower case. The condition is coded as follows: private static final String defaultKeystoreType = ""JKS""; ... if (JSSESocketFactory.defaultKeystoreType.equals(keystoreType)) { alias = alias.toLowerCase(Locale.ENGLISH); } If the intention is to downcase only JKS store aliases, then the comparison should be made with ""JKS"", not a constant that happens to contain ""JKS"" at present. Using a specific comparator would both clarify the code and protect against a possible change to the default (albeit very unlikely)."	2013-09-05 09:05:01	1378390000	resolved fixed	f126b5a	1378380000	java/org/apache/tomcat/util/net/jsse/JSSESocketFactory.java	1:java/org/apache/tomcat/util/net/jsse/JSSESocketFactory.java
55	55343	Bug 55343 Add flag to ignore exceptions while creating initial pool	I want my initial pool to be of some size i.e. not empty AND start even if it fails to create all or some of connections. If pool fails to create initial connections for some reason it just throws exceptions. To workaround that I have to set initial pool size to 0. It can be handy to add a flag to ignore (just log them) exceptions that occur while creating initial connections.	2013-08-02 06:05:03	1375440000	resolved fixed	4aa42d7	1378280000	modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/ConnectionPool.java modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/DataSourceFactory.java modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/DataSourceProxy.java modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/PoolConfiguration.java modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/PoolProperties.java modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/jmx/ConnectionPool.java	1:modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/ConnectionPool.java 3:modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/jmx/ConnectionPool.java 4:modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/PoolConfiguration.java 6:modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/DataSourceProxy.java 10:modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/PoolProperties.java 167:modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/DataSourceFactory.java
56	55342	Bug 55342 Lost interruption	org.apache.tomcat.jdbc.pool.ConnectionPool#close should not call Thread.interrupted() because interrupt was already reset by code that thrown InterruptedException. } catch (InterruptedException ex) { if (getPoolProperties().getPropagateInterruptState()) { Thread.currentThread().interrupt(); - } else { - Thread.interrupted(); } }	2013-08-02 05:54:35	1375440000	resolved fixed	41225cd	1378260000	modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/ConnectionPool.java	5:modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/ConnectionPool.java
57	55500	Bug 55500 AsyncListener.onTimeout is not called via AJP AjpNioProtocol connector	"The AsyncListener.onTimeout is not called, when timeout occurs, when traffic routed via AJP connector configured with AjpNioProtocol protocol."	2013-08-29 12:21:17	1377790000	resolved fixed	cf1e104	1378200000	java/org/apache/coyote/ajp/AbstractAjpProcessor.java java/org/apache/coyote/ajp/AjpAprProcessor.java java/org/apache/coyote/ajp/AjpNioProcessor.java java/org/apache/coyote/ajp/AjpProcessor.java	5:java/org/apache/coyote/ajp/AbstractAjpProcessor.java 7:java/org/apache/coyote/ajp/AjpNioProcessor.java 20:java/org/apache/coyote/ajp/AjpProcessor.java 25:java/org/apache/coyote/ajp/AjpAprProcessor.java
58	55494	Bug 55494 JNDIRealm throws exception after timeout / Connection reset		2013-08-28 12:54:09	1377710000	resolved fixed	7e74aee	1377700000	java/org/apache/catalina/realm/JNDIRealm.java	1:java/org/apache/catalina/realm/JNDIRealm.java
59	55453	Bug 55453 AJP send Body with Status 304		2013-08-20 04:48:03	1376990000	resolved fixed	6d99103	1377690000	java/org/apache/coyote/ajp/AbstractAjpProcessor.java test/org/apache/coyote/ajp/TestAbstractAjpProcessor.java	2:java/org/apache/coyote/ajp/AbstractAjpProcessor.java 16:test/org/apache/coyote/ajp/TestAbstractAjpProcessor.java
60	51526	Bug 51526 Process web application context config with embedded Tomcat.addWebApp(...)	"It would be nice if org.apache.catalina.startup.Tomcat.addWebApp(...) would process the web application's META-INF/context.xml if found. The current implementation skips META-INF/context.xml loading, and does not appear to offer any hook to enable it--the StandardContext is instantiated and initialized with a null configFile in the single call to addWebApp(...)."	2011-07-18 23:08:06	1311040000	resolved fixed	058f044	1377630000	java/org/apache/catalina/startup/Tomcat.java test/org/apache/catalina/startup/TestTomcat.java	5:java/org/apache/catalina/startup/Tomcat.java 15:test/org/apache/catalina/startup/TestTomcat.java
61	55469	Bug 55469 Missing HTML closing tags in Manager application		2013-08-22 20:05:22	1377220000	resolved fixed	9a22360	1377240000	java/org/apache/catalina/manager/HTMLManagerServlet.java	36:java/org/apache/catalina/manager/HTMLManagerServlet.java
62	55454	"Bug 55454 NullPointerException caused by invalid contentType, e.g. trailing semicolon"	"possible related to 53353 When having an invalid contenttype like: <jsp:directive.page language=""java"" contentType=""text/html;""/> (note the trailing "";"") Tomcat throws a NullPointerException like this: java.lang.NullPointerException org.apache.tomcat.util.http.parser.HttpParser.parseMediaType(HttpParser.java:217) org.apache.tomcat.util.http.parser.MediaTypeCache.parse(MediaTypeCache.java:54) org.apache.catalina.connector.Response.setContentType(Response.java:805) org.apache.catalina.connector.ResponseFacade.setContentType(ResponseFacade.java:245) javax.servlet.ServletResponseWrapper.setContentType(ServletResponseWrapper.java:123) After removing the extra "";"" or entering a charset like this: <jsp:directive.page language=""java"" contentType=""text/html; charset=UTF-8""/> it works as expected. My desired behaviour would be: Don't crash with a NPE. Other Tomcat versions seem to handly this different."	2013-08-20 09:30:09	1377010000	resolved fixed	8b03dcf	1377010000	java/org/apache/tomcat/util/http/parser/HttpParser.java test/org/apache/tomcat/util/http/parser/TestMediaType.java	1:test/org/apache/tomcat/util/http/parser/TestMediaType.java 12:java/org/apache/tomcat/util/http/parser/HttpParser.java
63	55442	Bug 55442 EL Constructor throws exception	"In the EL 3.0 Spec, section 1.22.3 ""Constructor Reference"" states ""A class name reference, followed by arguments in parenthesis, such as ""Boolean(true)"" denotes the invocation of the constructor of the class with the supplied arguments."" This leads me to believe that the following test should work: @Test public void testImport03() { ELProcessor processor = new ELProcessor(); Object result = processor.getValue(""Integer('1000')"", Integer.class); Assert.assertEquals(Integer.valueOf(1000), result); } Unfortunately, this fails with the following error. javax.el.ELException: Function ':Integer' not found at org.apache.el.parser.AstFunction.getValue(AstFunction.java:136) at org.apache.el.ValueExpressionImpl.getValue(ValueExpressionImpl.java:188) at javax.el.ELProcessor.getValue(ELProcessor.java:45) at org.apache.el.parser.TestAstIdentifier.testImport03(TestAstIdentifier.java:53) ... Thanks"	2013-08-17 13:39:06	1376760000	resolved fixed	ab70f07	1376990000	java/org/apache/el/parser/AstFunction.java test/org/apache/el/parser/TestAstFunction.java	2:java/org/apache/el/parser/AstFunction.java
64	55438	Bug 55438 Non Blocking API's onAllDataRead being called twice		2013-08-16 18:51:10	1376690000	resolved fixed	7f6ea48	1376920000	java/org/apache/catalina/connector/InputBuffer.java java/org/apache/catalina/connector/Request.java java/org/apache/coyote/Request.java test/org/apache/catalina/nonblocking/TestNonBlockingAPI.java	21:java/org/apache/coyote/Request.java 24:java/org/apache/catalina/connector/InputBuffer.java 29:java/org/apache/catalina/connector/Request.java 65:test/org/apache/catalina/nonblocking/TestNonBlockingAPI.java
65	55434	Bug 55434 The path /foo/a/a/bar causes IllegalArgumentException when WsServerContainer creates UriTemplate	"WsFilter calls WsServerContainer.findMapping(""/foo/a/a/bar""), which in turn calls new UriTemplate(path). If the path contains repeated segments, it causes the following code in the UriTemplate constructor to throw an exception: Segment old = this.segments.put(segment, new Segment(index, segment)); if (old != null) { throw new IllegalArgumentException( sm.getString(""uriTemplate.duplicateName"", segment)); } This would be valid if the duplicates were URI variable names but not when their plain path segments."	2013-08-16 17:31:48	1376690000	resolved fixed	98ee5b4	1376850000	java/org/apache/tomcat/websocket/server/UriTemplate.java test/org/apache/tomcat/websocket/server/TestUriTemplate.java	1:java/org/apache/tomcat/websocket/server/UriTemplate.java 3:test/org/apache/tomcat/websocket/server/TestUriTemplate.java
66	55354	"Bug 55354 JNDIRealm.getPrincipal(context,username,gssCredential) corrupts realm context"	"The getPrincipal(context,username,gssCredential) method in JNDIRealm is designed to allow delegated credentials to be applied to the directory server connection as part of SPNEGO authentication. This is done by manipulation of a number of the directory context's environment parameters. However, as currently implemented, these environment parameters are forcibly cleared after the getUser() call regardless of whether the values were even changed (i.e. if isUseDelegatedCredential() returned false). If the container realm is defined to use GSSAPI authentication, only the first SPNEGO authentication request will succeed. All subsequent requests will fail with this exception: javax.naming.NamingException: [LDAP: error code 1 - 000004DC: LdapErr: DSID-0C0906DC, comment: In order to perform this operation a successful bind must be completed on the connection., data 0, v1db0 The exception is due to the Context.SECURITY_AUTHENTICATION being cleared by getPrincipal() - resulting in a attempted ""simple"" bind with no username/password (i.e. anonymous). A workaround is to ensure that the connectionName and connectionPassword parameters are specified in the realm definition - however, if one is using GSSAPI - this shouldn't be necessary and certainly defeats the purpose of using GSSAPI in the first place. The code should preserve pre-existing environment parameters in the context before changing them, then restore those values afterwards - rather than just clearing the settings completely."	2013-08-05 02:53:29	1375690000	resolved fixed	135e2c4	1376600000	java/org/apache/catalina/realm/JNDIRealm.java	1:java/org/apache/catalina/realm/JNDIRealm.java
67	55357	Bug 55357 Cannot deserialize session when it contains Externalizable objects (using PersistentManager)	"I'm using PersistentManager with JDBCStore to store sessions in my database. But in my webapplication, there is an object in my session which is an instance of org.apache.el.MethodExpressionImpl. This class implements the Externalizable interface but in this readExternal method it uses org.apache.el.util.ReflectionUtil.forName(String) which use Thread.currentThread().getContextClassLoader() as its ClassLoader. It seems to be incorrect because this method return a StandardClassLoader which cannot find my classes in WEB-INF/lib directory of my webapp. Is it the problem of the MethodExpressionImpl class which use this method or the JDBCStore which does not set the thread contextClassLoader as the WebappClassLoader ? Here is the stacktrace : SEVERE: Error processing request java.lang.IllegalStateException: Erreur lors de la deserialisation de la session 1634C328D27A31CB9FC4D52392FDB05F: {1} at org.apache.catalina.session.PersistentManagerBase.swapIn(PersistentManagerBase.java:713) at org.apache.catalina.session.PersistentManagerBase.findSession(PersistentManagerBase.java:503) at org.apache.catalina.connector.Request.isRequestedSessionIdValid(Request.java:2391) at org.apache.catalina.connector.CoyoteAdapter.parseSessionCookiesId(CoyoteAdapter.java:954) at org.apache.catalina.connector.CoyoteAdapter.postParseRequest(CoyoteAdapter.java:688) at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:402) at org.apache.coyote.http11.AbstractHttp11Processor.process(AbstractHttp11Processor.java:1002) at org.apache.coyote.AbstractProtocol$AbstractConnectionHandler.process(AbstractProtocol.java:585) at org.apache.tomcat.util.net.JIoEndpoint$SocketProcessor.run(JIoEndpoint.java:312) at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615) at java.lang.Thread.run(Thread.java:722) Caused by: java.lang.ClassNotFoundException: javax.faces.event.ActionEvent at java.net.URLClassLoader$1.run(URLClassLoader.java:366) at java.net.URLClassLoader$1.run(URLClassLoader.java:355) at java.security.AccessController.doPrivileged(Native Method) at java.net.URLClassLoader.findClass(URLClassLoader.java:354) at java.lang.ClassLoader.loadClass(ClassLoader.java:423) at java.lang.ClassLoader.loadClass(ClassLoader.java:356) at java.lang.Class.forName0(Native Method) at java.lang.Class.forName(Class.java:266) at org.apache.el.util.ReflectionUtil.forName(ReflectionUtil.java:62) at org.apache.el.util.ReflectionUtil.toTypeArray(ReflectionUtil.java:88) at org.apache.el.MethodExpressionImpl.readExternal(MethodExpressionImpl.java:290) at java.io.ObjectInputStream.readExternalData(ObjectInputStream.java:1835) at java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1794) at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1348) at java.io.ObjectInputStream.readObject(ObjectInputStream.java:370) at com.sun.facelets.el.TagMethodExpression.readExternal(TagMethodExpression.java:101) at java.io.ObjectInputStream.readExternalData(ObjectInputStream.java:1835) at java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1794) at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1348) at java.io.ObjectInputStream.readArray(ObjectInputStream.java:1704) at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1342) at java.io.ObjectInputStream.defaultReadFields(ObjectInputStream.java:1989) at java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:1913) at java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1796) at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1348) at java.io.ObjectInputStream.readObject(ObjectInputStream.java:370) at java.util.ArrayList.readObject(ArrayList.java:733) at sun.reflect.GeneratedMethodAccessor90.invoke(Unknown Source) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at java.lang.reflect.Method.invoke(Method.java:601) at java.io.ObjectStreamClass.invokeReadObject(ObjectStreamClass.java:1004) at java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:1891) at java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1796) at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1348) at java.io.ObjectInputStream.readArray(ObjectInputStream.java:1704) at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1342) at java.io.ObjectInputStream.readArray(ObjectInputStream.java:1704) at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1342) at java.io.ObjectInputStream.readArray(ObjectInputStream.java:1704) at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1342) at java.io.ObjectInputStream.readArray(ObjectInputStream.java:1704) at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1342) at java.io.ObjectInputStream.readArray(ObjectInputStream.java:1704) at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1342) at java.io.ObjectInputStream.readArray(ObjectInputStream.java:1704) at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1342) at java.io.ObjectInputStream.readArray(ObjectInputStream.java:1704) at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1342) at java.io.ObjectInputStream.readArray(ObjectInputStream.java:1704) at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1342) at java.io.ObjectInputStream.readArray(ObjectInputStream.java:1704) at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1342) at java.io.ObjectInputStream.readArray(ObjectInputStream.java:1704) at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1342) at java.io.ObjectInputStream.readArray(ObjectInputStream.java:1704) at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1342) at java.io.ObjectInputStream.readArray(ObjectInputStream.java:1704) at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1342) at java.io.ObjectInputStream.readArray(ObjectInputStream.java:1704) at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1342) at java.io.ObjectInputStream.defaultReadFields(ObjectInputStream.java:1989) at java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:1913) at java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1796) at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1348) at java.io.ObjectInputStream.readObject(ObjectInputStream.java:370) at java.util.HashMap.readObject(HashMap.java:1155) at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at java.lang.reflect.Method.invoke(Method.java:601) at java.io.ObjectStreamClass.invokeReadObject(ObjectStreamClass.java:1004) at java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:1891) at java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1796) at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1348) at java.io.ObjectInputStream.readObject(ObjectInputStream.java:370) at java.util.HashMap.readObject(HashMap.java:1155) at sun.reflect.GeneratedMethodAccessor89.invoke(Unknown Source) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at java.lang.reflect.Method.invoke(Method.java:601) at java.io.ObjectStreamClass.invokeReadObject(ObjectStreamClass.java:1004) at java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:1891) at java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1796) at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1348) at java.io.ObjectInputStream.defaultReadFields(ObjectInputStream.java:1989) at java.io.ObjectInputStream.defaultReadObject(ObjectInputStream.java:499) at org.ajax4jsf.application.AjaxStateHolder.readObject(AjaxStateHolder.java:204) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at java.lang.reflect.Method.invoke(Method.java:601) at java.io.ObjectStreamClass.invokeReadObject(ObjectStreamClass.java:1004) at java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:1891) at java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1796) at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1348) at java.io.ObjectInputStream.readObject(ObjectInputStream.java:370) at org.apache.catalina.session.StandardSession.readObject(StandardSession.java:1595) at org.apache.catalina.session.StandardSession.readObjectData(StandardSession.java:1060) at org.apache.catalina.session.JDBCStore.load(JDBCStore.java:657) at org.apache.catalina.session.PersistentManagerBase.swapIn(PersistentManagerBase.java:707) ... 11 more"	2013-08-05 15:15:18	1375730000	resolved fixed	e19e794	1376580000	java/org/apache/catalina/session/FileStore.java java/org/apache/catalina/session/JDBCStore.java	8:java/org/apache/catalina/session/FileStore.java 30:java/org/apache/catalina/session/JDBCStore.java
68	55400	Bug 55400 WsFilter not compatible with async sample applications		2013-08-10 20:20:50	1376180000	resolved fixed	3490f73	1376480000	java/org/apache/tomcat/websocket/server/WsServerContainer.java	2:java/org/apache/tomcat/websocket/server/WsServerContainer.java
69	55404	Bug 55404 ContextConfig#validateSecurityRoles emits three info log messages which contain a warning		2013-08-12 13:09:52	1376330000	resolved fixed	df02b95	1376320000	java/org/apache/catalina/startup/ContextConfig.java	1:java/org/apache/catalina/startup/ContextConfig.java
70	52092	Bug 52092 Please make AsyncFileHandler and OneLineFormatter the default for logging.properties	"Apache Tomcat 7 has created some very important enhancements to logging, and we should exploit them. Please make the org.apache.juli.AsyncFileHandler and org.apache.juli.OneLineFormatter the defaults for shipped conf/logging.properties. These enhancements have been vetted with over 20 releases of Apache Tomcat, let's give them some first class status."	2011-10-26 11:49:26	1319640000	resolved fixed	7d0408e	1375910000	java/org/apache/juli/FileHandler.java	3:java/org/apache/juli/FileHandler.java
71	55345	"Bug 55345 Webresources class AbstractResourceSet throws exception upon callong ServletContext.getRealPath("""")"	"As described on user list: Tomcat 8, unlike Tomcat 7.0.42, throws IllegalArgumentException upon calling ServletContext.getRealPath(""""). It seems that TC8 expects that argument provided to getRealPath is non-empty string. I believe that ServletContext.getRealPath should allow empty string as argument. -Ognjen Stack trace: [ERROR] java.lang.IllegalArgumentException java.lang.IllegalArgumentException at org.apache.catalina.webresources.AbstractResourceSet.checkPath(AbstractResourceSet.java:39) at org.apache.catalina.webresources.DirResourceSet.getResource(DirResourceSet.java:91) at org.apache.catalina.webresources.StandardRoot.getResourceInternal(StandardRoot.java:176) at org.apache.catalina.webresources.CachedResource.validate(CachedResource.java:62) at org.apache.catalina.webresources.Cache.getResource(Cache.java:78) at org.apache.catalina.webresources.StandardRoot.getResource(StandardRoot.java:163) at org.apache.catalina.core.StandardContext.getRealPath(StandardContext.java:4528) at org.apache.catalina.core.ApplicationContext.getRealPath(ApplicationContext.java:398) at org.apache.catalina.core.ApplicationContextFacade.getRealPath(ApplicationContextFacade.java:335) at org.apache.axis2.deployment.WarBasedAxisConfigurator.<init>(WarBasedAxisConfigurator.java:103) at org.apache.axis2.transport.http.AxisServlet.initConfigContext(AxisServlet.java:584) at org.apache.axis2.transport.http.AxisServlet.init(AxisServlet.java:454) at org.apache.catalina.core.StandardWrapper.initServlet(StandardWrapper.java:1235) at org.apache.catalina.core.StandardWrapper.loadServlet(StandardWrapper.java:1148) at org.apache.catalina.core.StandardWrapper.load(StandardWrapper.java:1044) at org.apache.catalina.core.StandardContext.loadOnStartup(StandardContext.java:5025) at org.apache.catalina.core.StandardContext.startInternal(StandardContext.java:5322) at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:150) at org.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:726) at org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:702) at org.apache.catalina.core.StandardHost.addChild(StandardHost.java:698) at org.apache.catalina.startup.HostConfig.deployWAR(HostConfig.java:968) at org.apache.catalina.startup.HostConfig$DeployWar.run(HostConfig.java:1742) at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471) at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:334) at java.util.concurrent.FutureTask.run(FutureTask.java:166) at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615) at java.lang.Thread.run(Thread.java:724)"	2013-08-02 11:52:04	1375460000	closed fixed	aa15bac	1375470000	java/org/apache/catalina/core/StandardContext.java	1:java/org/apache/catalina/core/StandardContext.java
72	55333	Bug 55333 JDBCRealm Digest authentication Flow is not working throws Function sequence error	"Issue: Digest authentication flow is not working Error Thrown : Function sequence error PackageName: org.apache.catalina.realm ClassName : JDBCRealm MethodName: String getPassword(String username) Snapshot from above mentioned method =================================== stmt = credentials(dbConnection, username); rs = stmt.executeQuery(); // Due to this connection commit, resultset is nullified dbConnection.commit(); // While executing this statement it throws Function sequence error if (rs.next()) { dbCredentials = rs.getString(1); } =================================== Above explanation has been validate by placing 7.0.41 catalina.jar where the above changes are not there due to fix of 55071 bug Below snapshot is the error observed while trying for Digest authentication ========================================================================== Jul 31, 2013 3:43:40 PM org.apache.catalina.realm.JDBCRealm getPassword SEVERE: Exception performing authentication java.sql.SQLException: [TimesTen][TimesTen 11.2.2.5.0 ODBC Driver]Function sequence error at com.timesten.jdbc.JdbcOdbc.createSQLException(JdbcOdbc.java:3238) at com.timesten.jdbc.JdbcOdbc.standardError(JdbcOdbc.java:3387) at com.timesten.jdbc.JdbcOdbc.SQLFetch(JdbcOdbc.java:921) at com.timesten.jdbc.JdbcOdbcResultSet.next(JdbcOdbcResultSet.java:409) at org.apache.catalina.realm.JDBCRealm.getPassword(JDBCRealm.java:558) at org.apache.catalina.realm.RealmBase.getDigest(RealmBase.java:1189) at org.apache.catalina.realm.RealmBase.authenticate(RealmBase.java:409) at com.kodiak.digest.authentication.KnDigestAuthenticator$KnDigestInfo.authenticate(KnDigestAuthenticator.java:733) at com.kodiak.digest.authentication.KnDigestAuthenticator.authenticate(KnDigestAuthenticator.java:275) at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:574) at org.apache.catalina.valves.AccessLogValve.invoke(AccessLogValve.java:953) at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:171) at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:99) at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:118) at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:408) at org.apache.coyote.http11.AbstractHttp11Processor.process(AbstractHttp11Processor.java:1023) at org.apache.coyote.AbstractProtocol$AbstractConnectionHandler.process(AbstractProtocol.java:589) at org.apache.tomcat.util.net.JIoEndpoint$SocketProcessor.run(JIoEndpoint.java:312) at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615) at java.lang.Thread.run(Thread.java:724) Jul 31, 2013 3:43:40 PM org.apache.catalina.realm.JDBCRealm getPassword SEVERE: Exception performing authentication java.sql.SQLException: [TimesTen][TimesTen 11.2.2.5.0 ODBC Driver]Function sequence error at com.timesten.jdbc.JdbcOdbc.createSQLException(JdbcOdbc.java:3238) at com.timesten.jdbc.JdbcOdbc.standardError(JdbcOdbc.java:3387) at com.timesten.jdbc.JdbcOdbc.SQLFetch(JdbcOdbc.java:921) at com.timesten.jdbc.JdbcOdbcResultSet.next(JdbcOdbcResultSet.java:409) at org.apache.catalina.realm.JDBCRealm.getPassword(JDBCRealm.java:558) at org.apache.catalina.realm.RealmBase.getDigest(RealmBase.java:1189) at org.apache.catalina.realm.RealmBase.authenticate(RealmBase.java:409) ""localhost.2013-07-31.log"" 50L, 3800C Cheers, Mahaaboob"	2013-07-31 17:44:41	1375310000	resolved fixed	6cd42af	1375350000	java/org/apache/catalina/realm/JDBCRealm.java	1:java/org/apache/catalina/realm/JDBCRealm.java
73	55316	Bug 55316 Ugly error log when WS client disconnects unexpectedly	"When a WS browser client disconnects unexpectedly (e.g. in the SNake sample if the user just closes the browser or loads another page) you get ugle ERROR logs in the Tomcat server. E.g. 2013-07-27 12:04:34.424 ERROR 31847 --- [nio-8080-exec-7] org.apache.tomcat.websocket.WsSession : Failed to send close message to remote endpoint java.io.IOException: java.util.concurrent.ExecutionException: java.io.EOFException at org.apache.tomcat.websocket.WsRemoteEndpointImplBase.startMessageBlock(WsRemoteEndpointImplBase.java:221) at org.apache.tomcat.websocket.WsSession.sendCloseMessage(WsSession.java:466) at org.apache.tomcat.websocket.WsSession.onClose(WsSession.java:430) at org.apache.tomcat.websocket.server.WsHttpUpgradeHandler.close(WsHttpUpgradeHandler.java:172) at org.apache.tomcat.websocket.server.WsHttpUpgradeHandler.access$200(WsHttpUpgradeHandler.java:45) at org.apache.tomcat.websocket.server.WsHttpUpgradeHandler$WsReadListener.onDataAvailable(WsHttpUpgradeHandler.java:198) at org.apache.coyote.http11.upgrade.AbstractServletInputStream.onDataAvailable(AbstractServletInputStream.java:169) at org.apache.coyote.http11.upgrade.AbstractProcessor.upgradeDispatch(AbstractProcessor.java:95) at org.apache.coyote.AbstractProtocol$AbstractConnectionHandler.process(AbstractProtocol.java:630) at org.apache.coyote.http11.Http11NioProtocol$Http11ConnectionHandler.process(Http11NioProtocol.java:223) at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1585) at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.run(NioEndpoint.java:1543) at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615) at java.lang.Thread.run(Thread.java:724) Caused by: java.util.concurrent.ExecutionException: java.io.EOFException at org.apache.tomcat.websocket.WsRemoteEndpointImplBase$FutureToSendHandler.get(WsRemoteEndpointImplBase.java:779) at org.apache.tomcat.websocket.WsRemoteEndpointImplBase.startMessageBlock(WsRemoteEndpointImplBase.java:217) ... 14 common frames omitted Caused by: java.io.EOFException: null at org.apache.tomcat.websocket.server.WsRemoteEndpointImplServer.doClose(WsRemoteEndpointImplServer.java:126) at org.apache.tomcat.websocket.WsRemoteEndpointImplBase.close(WsRemoteEndpointImplBase.java:531) at org.apache.tomcat.websocket.server.WsRemoteEndpointImplServer.onWritePossible(WsRemoteEndpointImplServer.java:107) at org.apache.tomcat.websocket.server.WsRemoteEndpointImplServer.doWrite(WsRemoteEndpointImplServer.java:71) at org.apache.tomcat.websocket.WsRemoteEndpointImplBase.writeMessagePart(WsRemoteEndpointImplBase.java:353) at org.apache.tomcat.websocket.WsRemoteEndpointImplBase.startMessage(WsRemoteEndpointImplBase.java:254) at org.apache.tomcat.websocket.WsRemoteEndpointImplBase.startMessageBlock(WsRemoteEndpointImplBase.java:211) ... 14 common frames omitted Presumably this is expected to be relatively normal, so I'd expect a lot less noise (and no ERROR) in the log?"	2013-07-27 11:07:08	1374940000	resolved fixed	d370084	1375280000	java/org/apache/tomcat/websocket/WsSession.java	10:java/org/apache/tomcat/websocket/WsSession.java
74	55312	Bug 55312 No SCI scan in embedded Tomcat	"I like the fact that SCI scanning is off by default in a Tomcat embedded instance, but I'd lik eto be able to switch it on. It might even be possible already, but the API is non-obvious. Maybe a method in Tomcat or associated friendly helper? Would also be nice in Tomcat 7."	2013-07-26 15:37:46	1374870000	resolved fixed	7540e90	1375280000	java/org/apache/tomcat/util/scan/StandardJarScanner.java	4:java/org/apache/tomcat/util/scan/StandardJarScanner.java
75	55309	Bug 55309 Concurrent issue of TagPluginManager		2013-07-26 04:38:23	1374830000	resolved fixed	11c05b7	1375130000	java/org/apache/jasper/compiler/TagPluginManager.java	1:java/org/apache/jasper/compiler/TagPluginManager.java
76	55287	Bug 55287 ServletContainerInitializer in parent classloader may not be found	"To include the JasperInitializer in the test environment I added an entry in testclasses/META-INF/services. This is not picked up when the parent classloader is searched because this path is a directory not a JAR file. It would be picked up if the ""scanAllDirectories"" extension was enabled but that should not be necessary if the search is to be semantically equivalent to j.u.ServiceLoader (which does locate it)."	2013-07-21 20:44:47	1374450000	resolved fixed	6e514c0	1375050000	java/org/apache/catalina/startup/ContextConfig.java java/org/apache/catalina/startup/WebappServiceLoader.java test/org/apache/catalina/startup/TestWebappServiceLoader.java	2:java/org/apache/catalina/startup/ContextConfig.java
77	55267	Bug 55267 NIO thread locked	"Did some load test and thread got stuck, see dump. Basically I just simulate 100 users that connect and disconnect."	2013-07-15 11:38:25	1373900000	resolved fixed	11bf498	1374590000	java/org/apache/coyote/ajp/AjpNioProcessor.java java/org/apache/coyote/http11/InternalNioOutputBuffer.java java/org/apache/coyote/http11/upgrade/NioServletOutputStream.java java/org/apache/tomcat/util/net/NioEndpoint.java	3:java/org/apache/tomcat/util/net/NioEndpoint.java 47:java/org/apache/coyote/http11/InternalNioOutputBuffer.java 57:java/org/apache/coyote/ajp/AjpNioProcessor.java 109:java/org/apache/coyote/http11/upgrade/NioServletOutputStream.java
78	55291	Bug 55291 Bug in WsServerContainer leading to NPE		2013-07-22 13:33:53	1374510000	resolved fixed	ab6f21d	1374500000	java/org/apache/tomcat/websocket/server/WsServerContainer.java	1:java/org/apache/tomcat/websocket/server/WsServerContainer.java
79	55262	Bug 55262 Duplicate preludes and codas in same <jsp-property-group> are ignored	"If a <jsp-property-group> contains multiple <include-prelude> elements that happen to refer to the same file only one include is performed. The same applies to codas. This happens because WebXml stores these in a LinkedHashSet rather than a List. When multiple <jsp-property-group>s are combined, JspConfig uses a Vector and so preserves duplicates as required by the JSP spec. I have a test case demonstrating this but before committing a fix I would like confirmation that WebXml's behaviour is incorrect."	2013-07-14 01:44:18	1373780000	resolved fixed	85f611e	1374350000	java/org/apache/tomcat/util/descriptor/web/JspPropertyGroup.java test/org/apache/jasper/compiler/TestCompiler.java test/org/apache/jasper/servlet/TestJspCServletContext.java test/org/apache/tomcat/util/descriptor/web/TestJspPropertyGroup.java	2:java/org/apache/tomcat/util/descriptor/web/JspPropertyGroup.java 36:test/org/apache/jasper/compiler/TestCompiler.java 270:test/org/apache/jasper/servlet/TestJspCServletContext.java
80	55259	Bug 55259 Unnecessary work in JspConfig	JspProperty is the same for all url patterns in a group; the current code creates a new one each iteration	2013-07-13 04:34:34	1373700000	resolved fixed	c6a45a6	1373750000	java/org/apache/jasper/compiler/JspConfig.java	1:java/org/apache/jasper/compiler/JspConfig.java
81	55245	Bug 55245 Add test cases for JspC	The test suite should include tests for the JspC Ant task	2013-07-12 02:05:02	1373610000	resolved fixed	c0c5017	1373620000	test/org/apache/jasper/TestJspC.java	
82	55250	Bug 55250 JspC does not initialize tldLocationsCache resulting in NPE	Change in how ServletContext was created missed initialization of tldLocationsCache	2013-07-12 03:37:02	1373610000	resolved fixed	186a782	1373620000	java/org/apache/jasper/JspC.java	1:java/org/apache/jasper/JspC.java
83	55244	Bug 55244 JspC throws ClassNotFoundException from Digester		2013-07-12 02:01:45	1373610000	resolved fixed	8d6537d	1373620000	java/org/apache/jasper/servlet/JspCServletContext.java java/org/apache/tomcat/util/descriptor/web/WebXmlParser.java	2:java/org/apache/jasper/servlet/JspCServletContext.java 104:java/org/apache/tomcat/util/descriptor/web/WebXmlParser.java
84	55240	Bug 55240 [websocket] SOE in NioEndpoint		2013-07-11 11:54:55	1373560000	resolved fixed	68f6f6f	1373570000	java/org/apache/coyote/http11/upgrade/AbstractProcessor.java java/org/apache/coyote/http11/upgrade/AprProcessor.java java/org/apache/coyote/http11/upgrade/BioProcessor.java java/org/apache/coyote/http11/upgrade/NioProcessor.java java/org/apache/tomcat/util/net/NioEndpoint.java	1:java/org/apache/tomcat/util/net/NioEndpoint.java 76:java/org/apache/coyote/http11/upgrade/NioProcessor.java 147:java/org/apache/coyote/http11/upgrade/AprProcessor.java
85	55238	Bug 55238 [websocket] NPE in clearHandler(WsRemoteEndpointImplServer.java:156)		2013-07-11 08:11:07	1373540000	resolved fixed	4758796	1373560000	java/org/apache/tomcat/websocket/server/WsRemoteEndpointImplServer.java	1:java/org/apache/tomcat/websocket/server/WsRemoteEndpointImplServer.java
86	55228	"Bug 55228 AbstractHttp11Processor overwrites Date header, even when set by application"		2013-07-10 00:35:33	1373430000	resolved fixed	95ee699	1373560000	java/org/apache/coyote/http11/AbstractHttp11Processor.java	1:java/org/apache/coyote/http11/AbstractHttp11Processor.java
87	55207	"Bug 55207 In XML syntax, jsp:text does not error on sub-elements from other namespaces"		2013-07-07 01:11:30	1373170000	resolved fixed	6c54031	1373480000	java/org/apache/jasper/compiler/JspDocumentParser.java	11:java/org/apache/jasper/compiler/JspDocumentParser.java
88	55231	Bug 55231 NPE and incorrect version detection in JspC	JspC's JspConfig now reads version and jsp-config information from the ServletContext. It uses getMajorVersion() which returns the maximum version supported by the container. It should use getEffectiveVersion() to use the version of the web application. ServletContext.getJspConfigDescriptor() can return null if there is no <jsp-config> in the web.xml. JspConfig does not allow for this and will throw a NPE e.g. if there is no web.xml in the application.	2013-07-10 04:10:10	1373440000	closed fixed	c8376e8	1373460000	java/org/apache/jasper/compiler/JspConfig.java	3:java/org/apache/jasper/compiler/JspConfig.java
89	55218	Bug 55218 Upgrade Digester to be based on DefaultHandler2 and use LexicalHandler to detect publicId	Digester uses SAX2 features but is still based the SAX1 DefaultHandler. By upgrading to DefaultHandler2 it would be able to handle baseURIs when resolving entities and would have a default implementation of a LexicalHandler. Using LexicalHandler would allow it to respond directly to the startDTD event that reports the DOCTYPE (if present) so that it would not need to infer that from the first attempt to resolve an entity.	2013-07-09 07:27:23	1373370000	closed fixed	aa7896b	1373360000	java/org/apache/catalina/core/StandardContext.java java/org/apache/tomcat/util/descriptor/web/WebXml.java java/org/apache/tomcat/util/digester/Digester.java test/javax/servlet/resources/TestSchemaValidation.java test/org/apache/tomcat/util/descriptor/web/TestWebXml.java	3:java/org/apache/tomcat/util/digester/Digester.java 4:java/org/apache/catalina/core/StandardContext.java 76:java/org/apache/tomcat/util/descriptor/web/WebXml.java 984:test/org/apache/tomcat/util/descriptor/web/TestWebXml.java
90	55217	Bug 55217 Common EntityResolver that can be used by Catalina and Jasper	Duplicate functionality exists in both SchemaResolver and ParserUtils.MyEntityResolver. There's also a basic version in Digester.	2013-07-09 07:09:00	1373370000	closed fixed	5344de0	1373360000	java/org/apache/tomcat/util/descriptor/LocalResolver.java java/org/apache/tomcat/util/descriptor/XmlIdentifiers.java test/org/apache/tomcat/util/descriptor/TestLocalResolver.java	
91	55166	Bug 55166 schemaLocation references between servlet and jsp XSDs are invalid	The javax/servlet/resources package does not contain the JSP specification XSDs. These are referenced from the web-app or web-common xsds and define elements like <jsp-config>.	2013-06-30 20:03:24	1372640000	resolved fixed	f554475	1373280000	java/org/apache/catalina/startup/Constants.java	5:java/org/apache/catalina/startup/Constants.java
92	55210	Bug 55210 SEVERE: The ServletContentInitializer [# Licensed to the Apache Software Foundation (ASF) under one or more] could not be created		2013-07-07 21:44:14	1373250000	resolved fixed	b932ace	1373270000	java/org/apache/catalina/startup/ContextConfig.java	71:java/org/apache/catalina/startup/ContextConfig.java
93	55200	Bug 55200 [websocket] Problem writing many subsequent binary messages	"I see sometimes failing connections due to IOException (see below). This happens when trying to send thousands of binary messages (1024 bytes each) without any delay between the subsequent messages. Having look at the code in AsyncChannelWrapperSecure$WriteTask.run(219), I think it is not correct to assume that if not all of the bytes in the buffer are written, this shall produce IOException. I think in this case, there shall be an attempt to write the rest of the bytes in a cycle. Here one exception I got during the test: Exception is :java.io.IOException: java.util.concurrent.ExecutionException: java.io.IOException: Only wrote [460] of [1,098] bytes at org.apache.tomcat.websocket.WsRemoteEndpointImplBase.startMessageBlock(WsRemoteEndpointImplBase.java:204) at org.apache.tomcat.websocket.WsRemoteEndpointImplBase.sendBytes(WsRemoteEndpointImplBase.java:113) at org.apache.tomcat.websocket.WsRemoteEndpointBasic.sendBinary(WsRemoteEndpointBasic.java:43) at WebsocketsTestManager$TestThread.run(WebsocketsTestManager.java:271) Caused by: java.util.concurrent.ExecutionException: java.io.IOException: Only wrote [460] of [1,098] bytes at org.apache.tomcat.websocket.WsRemoteEndpointImplBase$FutureToSendHandler.get(WsRemoteEndpointImplBase.java:729) at org.apache.tomcat.websocket.WsRemoteEndpointImplBase.startMessageBlock(WsRemoteEndpointImplBase.java:202) ... 3 more Caused by: java.io.IOException: Only wrote [460] of [1,098] bytes at org.apache.tomcat.websocket.AsyncChannelWrapperSecure$WriteTask.run(AsyncChannelWrapperSecure.java:220) at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615) at java.lang.Thread.run(Thread.java:789)"	2013-07-05 14:27:48	1373050000	resolved fixed	00e4f3f	1373040000	java/org/apache/tomcat/websocket/AsyncChannelWrapperSecure.java	4:java/org/apache/tomcat/websocket/AsyncChannelWrapperSecure.java
94	55186	"Bug 55186 useIPVHosts=true , incorrect to get Request.localName"		2013-07-03 00:54:24	1372830000	resolved fixed	2eb065f	1373030000	java/org/apache/coyote/Request.java	5:java/org/apache/coyote/Request.java
95	55184	Bug 55184 NPE in PojoMethodMapping getMessageHandler		2013-07-02 13:14:35	1372790000	resolved fixed	a267dbf	1372780000	java/org/apache/tomcat/websocket/pojo/PojoMethodMapping.java	1:java/org/apache/tomcat/websocket/pojo/PojoMethodMapping.java
96	55183	Bug 55183 Missing WS Protocol Header in session negotiatedHeaders		2013-07-02 12:04:47	1372780000	resolved fixed	a634d85	1372780000	java/org/apache/tomcat/websocket/Constants.java java/org/apache/tomcat/websocket/WsWebSocketContainer.java test/org/apache/tomcat/websocket/TestWsSubprotocols.java	2:java/org/apache/tomcat/websocket/WsWebSocketContainer.java 27:java/org/apache/tomcat/websocket/Constants.java
97	55165	Bug 55165 subprotocols not available with annotated serverendpoint		2013-06-30 19:49:03	1372640000	resolved fixed	b069c78	1372760000	java/org/apache/tomcat/websocket/server/WsServerContainer.java	4:java/org/apache/tomcat/websocket/server/WsServerContainer.java
98	55181	Bug 55181 Ping and Pong messages should have identical application data		2013-07-02 08:01:55	1372770000	resolved fixed	19c0bd3	1372750000	java/org/apache/tomcat/websocket/WsPongMessage.java test/org/apache/tomcat/websocket/TestWsPingPongMessages.java	8:java/org/apache/tomcat/websocket/WsPongMessage.java
99	55180	"Bug 55180 connectionTimeout=""-1"" causes timeout can't be negative"	"I configured server.xml like this: connectionTimeout=""-1"" disableUploadTimeout=""false"" connectionUploadTimeout=""200"" (maybe it is stupid to configure like this,if connectionTimeout=-1,can i make disableUploadTimeout=false?). It will cause : java.lang.IllegalArgumentException: timeout can't be negative at sun.nio.ch.SocketAdaptor.setSoTimeout(SocketAdaptor.java:361) at org.apache.coyote.http11.Http11NioProcessor.setSocketTimeout(Http11NioProcessor.java:251) ...... because of : if (!disableUploadTimeout) { //endpoint.getSoTimeout()=-1. setSocketTimeout(endpoint.getSoTimeout()); } ~~~~~~~~~~~~~~~~~~~~~~~~~ another thing: if i configure connectionTimeout=""0"". in NioBlockingSelector.read(ByteBuffer buf, NioChannel socket, long readTimeout),readTimeout = 0, in case socket.read(buf) == 0, it make timeout=true. if (readTimeout >= 0 && (keycount == 0)) timedout = (System.currentTimeMillis() - time) >= readTimeout; then throw the SocketTimeoutException(). thank you."	2013-07-02 00:01:40	1372740000	resolved fixed	4da2de0	1372750000	java/org/apache/coyote/http11/AbstractHttp11Processor.java	4:java/org/apache/coyote/http11/AbstractHttp11Processor.java
100	55174	Bug 55174 [jsr 356][websocket] MessageHandler never gets notified again after it throws exception	"I have a test which adds a MessageHandler which gets notified on text messages. If its implementation method onMessage(String text) throws some exception (e.g. runtime exception), this MessageHandler will never ever be notified again for any new text messages received by the session. I suppose this happens because the exception actually kills the underlying thread in which the notification has happened. I think the client side implementation shall be more robust and expect and be prepared for exceptions coming from calls to user code."	2013-07-01 12:14:30	1372700000	resolved fixed	ddd73d0	1372720000	java/org/apache/tomcat/websocket/WsFrameBase.java	9:java/org/apache/tomcat/websocket/WsFrameBase.java
101	55179	Bug 55179 Incorrect Parameter Name in RemoteIpValve Examples		2013-07-01 20:54:45	1372730000	resolved fixed	21f0a5c	1372710000	java/org/apache/catalina/valves/RemoteIpValve.java	1:java/org/apache/catalina/valves/RemoteIpValve.java
102	55177	Bug 55177 connectionTimeout=-1 causes high CPU		2013-07-01 19:49:21	1372720000	resolved fixed	df6cee7	1372710000	java/org/apache/coyote/http11/Http11Processor.java	78:java/org/apache/coyote/http11/Http11Processor.java
103	53777	Bug 53777 Ability to bundle JAAS Configuration in Webappp		2012-08-24 13:50:52	1345830000	resolved fixed	6871d4c	1372690000	java/org/apache/catalina/realm/JAASRealm.java	2:java/org/apache/catalina/realm/JAASRealm.java
104	55160	Bug 55160 NIO connectionUploadTimeout can't work	"when i configure disableUploadTimeout=""false"" and connectionTimeout=""20000"" ,connectionUploadTimeout=""30000"" . I found the connectionUploadTimeout doesn't work, because the code in internalNioInputBuffer.readSocket(): ~~~~~~~~~~~~~~~~~~~~~~~~~~~~ try { NioEndpoint.KeyAttachment att = (NioEndpoint.KeyAttachment)socket.getAttachment(false); if ( att == null ) throw new IOException(""Key must be cancelled.""); nRead = pool.read(socket.getBufHandler().getReadBuffer(),socket,selector,att.getTimeout()); } catch ( EOFException eof ) { nRead = -1; } finally { if ( selector != null ) pool.put(selector); } ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ att.getTimeout() is the connectionTimeout ,not the connectionUploadTimeout. so , in NioBlockingSelector.read(), the readTimeout is connectionTimeout"	2013-06-29 21:35:09	1372560000	resolved fixed	9a01f2d	1372690000	java/org/apache/coyote/http11/InternalNioInputBuffer.java	1:java/org/apache/coyote/http11/InternalNioInputBuffer.java
105	55158	Bug 55158 Wasted work in AttributeNamesEnumerator constructor		2013-06-29 18:55:30	1372550000	resolved fixed	ca956bd	1372680000	java/org/apache/catalina/core/ApplicationHttpRequest.java	1:java/org/apache/catalina/core/ApplicationHttpRequest.java
106	55159	Bug 55159 Wasted work in ErrorReportValve.getPartialServletStackTrace		2013-06-29 19:12:03	1372550000	resolved fixed	b7cad6b	1372680000	java/org/apache/catalina/valves/ErrorReportValve.java	1:java/org/apache/catalina/valves/ErrorReportValve.java
107	55017	Bug 55017 Ability to configure RMI bind address		2013-05-24 14:50:10	1369420000	resolved fixed	45f59bb	1372670000	java/org/apache/catalina/mbeans/JmxRemoteLifecycleListener.java	1:java/org/apache/catalina/mbeans/JmxRemoteLifecycleListener.java
108	55151	Bug 55151 Fix in MsgByte encoder and decoder TestEncodingDecoding websocket test		2013-06-27 18:00:57	1372370000	resolved fixed	d71136a	1372360000	test/org/apache/tomcat/websocket/pojo/TestEncodingDecoding.java	1:test/org/apache/tomcat/websocket/pojo/TestEncodingDecoding.java
109	55102	Bug 55102 Add ability to report time taken to prepare response		2013-06-15 17:09:47	1371330000	closed fixed	7aea9cb	1372020000	java/org/apache/catalina/valves/AccessLogValve.java java/org/apache/coyote/Response.java	142:java/org/apache/catalina/valves/AccessLogValve.java 157:java/org/apache/coyote/Response.java
110	55125	Bug 55125 Tomcat does not shut down if LifecycleListener throws an exception		2013-06-21 11:23:54	1371830000	resolved fixed	3a36a8f	1372020000	java/org/apache/catalina/core/StandardService.java java/org/apache/catalina/startup/Catalina.java	43:java/org/apache/catalina/startup/Catalina.java 110:java/org/apache/catalina/core/StandardService.java
111	55127	Bug 55127 Encoders init and destroy methods are never called		2013-06-22 06:04:48	1371900000	resolved fixed	93bcdde	1371910000	java/org/apache/tomcat/websocket/WsRemoteEndpointImplBase.java java/org/apache/tomcat/websocket/WsRemoteEndpointImplClient.java java/org/apache/tomcat/websocket/WsSession.java java/org/apache/tomcat/websocket/WsWebSocketContainer.java java/org/apache/tomcat/websocket/server/WsHttpUpgradeHandler.java java/org/apache/tomcat/websocket/server/WsRemoteEndpointImplServer.java test/org/apache/tomcat/websocket/pojo/TestEncodingDecoding.java	111:java/org/apache/tomcat/websocket/WsRemoteEndpointImplBase.java 143:java/org/apache/tomcat/websocket/server/WsHttpUpgradeHandler.java 211:java/org/apache/tomcat/websocket/WsSession.java 216:test/org/apache/tomcat/websocket/pojo/TestEncodingDecoding.java 259:java/org/apache/tomcat/websocket/WsWebSocketContainer.java 914:java/org/apache/tomcat/websocket/server/WsRemoteEndpointImplServer.java 1249:java/org/apache/tomcat/websocket/WsRemoteEndpointImplClient.java
112	55126	Bug 55126 IAE is thrown during deployment of ServerEndPoint having multiple text decoders		2013-06-21 13:16:22	1371840000	resolved fixed	366ddff	1371850000	java/org/apache/tomcat/websocket/pojo/PojoMethodMapping.java	39:java/org/apache/tomcat/websocket/pojo/PojoMethodMapping.java
113	55101	Bug 55101 BasicAuthenticator parser and associated unit tests		2013-06-15 15:01:40	1371320000	resolved fixed	c4a50f5	1371760000	java/org/apache/catalina/authenticator/BasicAuthenticator.java test/org/apache/catalina/authenticator/TestBasicAuthParser.java test/org/apache/catalina/authenticator/TestNonLoginAndBasicAuthenticator.java	1:java/org/apache/catalina/authenticator/BasicAuthenticator.java 2:test/org/apache/catalina/authenticator/TestNonLoginAndBasicAuthenticator.java
114	54745	Bug 54745 Tomcat JarScanning does not work when Tomcat started with Java Web Start		2013-03-22 23:07:06	1364010000	resolved fixed	c7c30b6	1371740000	java/org/apache/tomcat/util/scan/StandardJarScanner.java	1:java/org/apache/tomcat/util/scan/StandardJarScanner.java
115	53987	Bug 53987 Log uncovered HTTP methods in combined security constraints	"It is usually an error (and a security hole) if security constraints are defined for some but not all HTTP methods for a given URL. If such a situation is detected on web application start, log it."	2012-10-09 19:02:28	1349820000	resolved fixed	f78c1a4	1371680000	java/org/apache/catalina/core/StandardContext.java	1:java/org/apache/catalina/core/StandardContext.java
116	55073	Bug 55073 wasted work in ValidateVisitor.isExpression()		2013-06-07 14:23:24	1370630000	resolved fixed	3e2ceee	1371540000	java/org/apache/jasper/compiler/Validator.java	1:java/org/apache/jasper/compiler/Validator.java
117	55108	"Bug 55108 Wasted work in ""AbstractReplicatedMap.excludeFromSet"""		2013-06-17 18:12:00	1371510000	resolved fixed	4979721	1371540000	java/org/apache/catalina/tribes/tipis/AbstractReplicatedMap.java	1:java/org/apache/catalina/tribes/tipis/AbstractReplicatedMap.java
118	55109	"Bug 55109 Wasted work in ""WebdavServlet.isLocked"""		2013-06-17 18:24:46	1371510000	resolved fixed	82bccd2	1371540000	java/org/apache/catalina/servlets/WebdavServlet.java	1:java/org/apache/catalina/servlets/WebdavServlet.java
119	55110	"Bug 55110 Wasted work in ""TestNonLoginAndBasicAuthenticator.doTestBasic"""		2013-06-17 18:37:18	1371510000	resolved fixed	c48a2ed	1371540000	test/org/apache/catalina/authenticator/TestNonLoginAndBasicAuthenticator.java test/org/apache/tomcat/websocket/TestWsWebSocketContainer.java	1:test/org/apache/catalina/authenticator/TestNonLoginAndBasicAuthenticator.java 51:test/org/apache/tomcat/websocket/TestWsWebSocketContainer.java
120	55052	Bug 55052 [JULI] Make ClassLoaderLogManager.getProperty() to try unprefixed property if prefixed one does not exist		2013-06-03 13:08:20	1370280000	resolved fixed	99562d3	1370350000	java/org/apache/juli/ClassLoaderLogManager.java	1:java/org/apache/juli/ClassLoaderLogManager.java
121	55046	Bug 55046 CORS Filter		2013-06-02 00:48:49	1370150000	resolved fixed	72edec7	1370340000	java/org/apache/catalina/filters/CorsFilter.java test/org/apache/catalina/filters/TestCorsFilter.java test/org/apache/catalina/filters/TesterFilterChain.java test/org/apache/catalina/filters/TesterFilterConfigs.java test/org/apache/catalina/filters/TesterHttpServletRequest.java test/org/apache/catalina/filters/TesterHttpServletResponse.java test/org/apache/catalina/filters/TesterServletContext.java	
122	55035	Bug 55035 Deploy ROOT webapp with version through text manager using Ant	"Currently Ant ""deploy"" task does not support separate parameter ""version"" and, thanks to URLEncoder, there is no workaround for that. But for apps with not empty context it's possible to define version using ##, like setting path to ""/someContext#someVersion"". For apps with empty context we receive error: Case #1: <deploy url=""{tomcat.manager}/text"" username=""${username}"", password=""${password}"" path=""/ROOT##12345"" war=""${pathtowar}"" /> Result: Failed to deploy application at context path /ROOT##12345 Case #1: <deploy url=""{tomcat.manager}/text"" username=""${username}"", password=""${password}"" path=""/##12345"" war=""${pathtowar}"" /> Result: Failed to deploy application at context path /##12345"	2013-05-31 16:05:20	1370030000	resolved fixed	712a351	1370290000	java/org/apache/catalina/ant/DeployTask.java	12:java/org/apache/catalina/ant/DeployTask.java
123	54999	"Bug 54999 JSESSIONIDSSO not re-created upon re-authentication on the same request - logout() and login(username,password)"	"In testing I found that the JSESSIONIDSSO was not re-created upon re-authentication via logout() and login(username,password) in the same request. The problem stemmed from the REQ_SSOID_NOTE that was was not reset upon request.logout(), whereas the documentation indicates that a logout() from any web-app should logout() from all web-apps. When the REQ_SSOID_NOTE is not removed upon logout(), a subsequent login(username,password) on the same request will re-create a JSESSIONID for the current web-app but fails to re-create a JSESSIONIDSSO since the REQ_SSO_ID_NOTE still lingers on the request. AuthenticatorBase.java adjustment for logout(request) that removes the REQ_SSOID_NOTE so that a subsequent login(username,password) will work on the same request: @Override public void logout(Request request) throws ServletException { register(request, request.getResponse(), null, null, null, null); request.removeNote(Constants.REQ_SSOID_NOTE); } I'll upload a diff-patch against the trunk and for 7.0.40."	2013-05-21 19:50:48	1369180000	resolved fixed	6d789fe	1369920000	java/org/apache/catalina/authenticator/AuthenticatorBase.java	1:java/org/apache/catalina/authenticator/AuthenticatorBase.java
124	54997	Bug 54997 SSL Handshake implementation in AsycnChannelWrapperSecure does not handle SSLEngineResult.Status.BUFFER_UNDERFLOW and SSLEngineResult.Status.BUFFER_OVERFLOW states		2013-05-21 07:22:32	1369140000	resolved fixed	6c6b25c	1369820000	java/org/apache/tomcat/websocket/AsyncChannelWrapperSecure.java	4:java/org/apache/tomcat/websocket/AsyncChannelWrapperSecure.java
125	54971	Bug 54971 javax.servlet.http.Part.write(String fileName) is not properly implemented	"1. fileName parameter / relative vs absolute filaName parameter specification in <1><JSR-000315 Java Servlet 3.0 Final Release javadocs> is different from the <2><javax API tomcat refers to>. <1> <JSR-000315 Java Servlet 3.0 Final Release javadocs> Parameters:fileName - the name of the file to which the stream will be written. The file is created relative to the location as specified in the MultipartConfig <2> javax. API tomcat refers to * @param fileName The location into which the uploaded part should be * stored. Relative locations are relative to {@link * javax.servlet.MultipartConfigElement#getLocation()} Tomcat is implemented as specified in <2> so that it can process ""absolute path"", but it should only accept ""relative path"" as specified in <1> <JSR-000315 Java Servlet 3.0 Final Release javadocs> 2. If MultiPartConfig.location is not set, write( String relative path ) throws FileNotFound Exception. A default location needs to be set in order to avoid such exception. example) os: windows8 part.write(""/test""); java.io.IOException: java.io.FileNotFoundException: \test (Access is denied) at org.apache.catalina.core.ApplicationPart.write(ApplicationPart.java:123) at servlet.multipart.MultipleUploadServlet.doPost(MultipleUploadServlet.java:76) at javax.servlet.http.HttpServlet.service(HttpServlet.java:647) at javax.servlet.http.HttpServlet.service(HttpServlet.java:728) at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:305) at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:210) at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:222) at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:123) at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:472) at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:171) at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:99) at org.apache.catalina.valves.AccessLogValve.invoke(AccessLogValve.java:947) at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:118) at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:408) at org.apache.coyote.http11.AbstractHttp11Processor.process(AbstractHttp11Processor.java:1009) at org.apache.coyote.AbstractProtocol$AbstractConnectionHandler.process(AbstractProtocol.java:589) at org.apache.tomcat.util.net.JIoEndpoint$SocketProcessor.run(JIoEndpoint.java:312) at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:895) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:918) at java.lang.Thread.run(Thread.java:662)"	2013-05-15 02:16:03	1368600000	resolved fixed	cccd0ac	1369750000	java/org/apache/catalina/connector/Request.java java/org/apache/catalina/core/ApplicationPart.java	1:java/org/apache/catalina/connector/Request.java 14:java/org/apache/catalina/core/ApplicationPart.java
126	54964	"Bug 54964 Class loading issue of ""TagPlugin"" in TagPluginManager"		2013-05-14 06:57:34	1368530000	resolved fixed	65ab66e	1369740000	java/org/apache/jasper/compiler/TagPluginManager.java	1:java/org/apache/jasper/compiler/TagPluginManager.java
127	54963	Bug 54963 Concurrent issue of Spdy/NetSupportSocket		2013-05-14 06:50:20	1368530000	resolved fixed	6272fca	1369740000	java/org/apache/tomcat/spdy/NetSupportSocket.java	1:java/org/apache/tomcat/spdy/NetSupportSocket.java
128	54961	"Bug 54961 Make ""compress"" configurable in SpdyProxyProtocol"		2013-05-14 02:56:42	1368510000	resolved fixed	c25112b	1369740000	java/org/apache/coyote/spdy/SpdyProxyProtocol.java	1:java/org/apache/coyote/spdy/SpdyProxyProtocol.java
129	54947	Bug 54947 Http11NioProtocol generates HTTP 505 responses on valid requests if request is split across multiple packets	"If an HTTP request is broken up across multiple packets *and* the first packet contains a GET request up to ""\r"" AND the ""\n"" terminating the first line of the request is included in the next packet Tomcat incorrectly throws an HTTP ""505 Version Not Supported"" response. This is with the Http11NioProtocol connector only - the default HTTP/1.1 connector does not exhibit this problem. An example request: Packet 1: GET / HTTP/1.1\r Packet 2: \nHost: localhost\r\n Packet 3: Connection: Close\r\n\r\n Response: HTTP/1.1 505 HTTP Version Not Supported Server: Apache-Coyote/1.1 Date: Thu, 09 May 2013 20:23:58 GMT Connection: close The following Python program reproduces the problem for me in both Tomcat 6.0.37 and Tomcat 7.0.39: """""" #!/usr/bin/python import socket import time s = socket.socket() s.connect((""localhost"",8080)) s.sendall(""GET / HTTP/1.1\r"") time.sleep(1.5) # make sure the above goes out in its own packet s.sendall(""\nHost: localhost\r\n"") s.sendall(""Connection: close\r\n\r\n"") print s.makefile().read() """""" Moving the ""\n"" to from the second sendall to the end of the first sendall causes Tomcat to respond correctly."	2013-05-09 20:27:01	1368150000	resolved fixed	f763975	1369740000	java/org/apache/coyote/http11/InternalNioInputBuffer.java test/org/apache/catalina/startup/SimpleHttpClient.java test/org/apache/coyote/http11/TestInternalInputBuffer.java	39:java/org/apache/coyote/http11/InternalNioInputBuffer.java 123:test/org/apache/catalina/startup/SimpleHttpClient.java 155:test/org/apache/coyote/http11/TestInternalInputBuffer.java
130	54944	Bug 54944 Enhancements to TestFormAuthenticator		2013-05-09 14:33:23	1368120000	resolved fixed	0de078e	1369740000	test/org/apache/catalina/authenticator/TestFormAuthenticator.java	1:test/org/apache/catalina/authenticator/TestFormAuthenticator.java
131	55019	"Bug 55019 <jsp:include page=""blabla"" flush=""true""/> failed to compile under security manager"		2013-05-27 12:55:28	1369670000	resolved fixed	76a7098	1369670000	java/org/apache/coyote/http11/AbstractOutputBuffer.java	10:java/org/apache/coyote/http11/AbstractOutputBuffer.java
132	54984	Bug 54984 multipart/form-data is not always read with correct encoding	"The bug occurs when form data is posted as multipart/form-data and using Servlet 3 API to get posted files. In a servlet, if we set the encoding: request.setCharacterEncoding(""UTF-8""); Then invoke: request.getParts() And then invoke: String text = request.getParameter(""sometextfield""); UTF-8 characters in the text have been garbled. Order of method calls are significant, if a getParameter is called before getParts, the correct encoding will be used. However, the order which you invoke the methods should not matter."	2013-05-16 11:15:20	1368720000	resolved fixed	7558546	1369420000	java/org/apache/catalina/connector/Request.java test/org/apache/catalina/connector/TestRequest.java	2:java/org/apache/catalina/connector/Request.java 54:test/org/apache/catalina/connector/TestRequest.java
133	54928	Bug 54928 IllegalStateException: Calling [asyncError()] is not valid for a request with Async state [COMPLETING]	"In an async scenario (request.startAsync), when the client goes away, trying to write to the response raises an IOException. If I then call asyncContext.complete() in order to finalize and clean up the request, soon after the following exception occurs: java.lang.IllegalStateException: Calling [asyncError()] is not valid for a request with Async state [COMPLETING] at org.apache.coyote.AsyncStateMachine.asyncError(AsyncStateMachine.java:304) at org.apache.coyote.http11.AbstractHttp11Processor.action(AbstractHttp11Processor.java:793) at org.apache.coyote.Request.action(Request.java:373) at org.apache.catalina.core.AsyncContextImpl.setErrorState(AsyncContextImpl.java:441) at org.apache.catalina.connector.CoyoteAdapter.asyncDispatch(CoyoteAdapter.java:312) at org.apache.coyote.http11.AbstractHttp11Processor.asyncDispatch(AbstractHttp11Processor.java:1509) at org.apache.coyote.http11.Http11NioProcessor.asyncDispatch(Http11NioProcessor.java:221) at org.apache.coyote.AbstractProtocol$AbstractConnectionHandler.process(AbstractProtocol.java:619) at org.apache.coyote.http11.Http11NioProtocol$Http11ConnectionHandler.process(Http11NioProtocol.java:223) at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1581) at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.run(NioEndpoint.java:1540) at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603) at java.lang.Thread.run(Thread.java:722) It looks like an attempt to maybe to send an error event to AsyncListener's but asyncContext.complete has already been called. Is calling asyncContext.complete() a reasonable way to handle an IOException from the response in order to finalize the request and release any resorces associated with it?"	2013-05-04 12:41:30	1367690000	resolved fixed	3960b22	1369400000	test/org/apache/catalina/connector/TestCoyoteAdapter.java	204:test/org/apache/catalina/connector/TestCoyoteAdapter.java
134	54955	Bug 54955 Mapping to application context root returns 404 after reload		2013-05-13 03:50:12	1368430000	resolved fixed	cdbf6b0	1369080000	java/org/apache/catalina/mapper/Mapper.java	48:java/org/apache/catalina/mapper/Mapper.java
135	54981	Bug 54981 ServletContext.getJspConfigDescriptor() should return null when there is no jsp configuration	"According to Servlet 3.0 javadoc ServletContext.getJspConfigDescriptor() must return NULL when there is no jsp configuration: "" Returns: the <jsp-config> related configuration that was aggregated from the web.xml and web-fragment.xml descriptor files of the web application represented by this ServletContext, or null if no such configuration exists """	2013-05-16 08:02:36	1368710000	resolved fixed	aabef09	1368690000	java/org/apache/catalina/core/ApplicationContext.java test/org/apache/catalina/core/TestApplicationContext.java	2:java/org/apache/catalina/core/ApplicationContext.java 82:test/org/apache/catalina/core/TestApplicationContext.java
136	54974	Bug 54974 SessionCookieConfig.setXXX methods must throw IllegalStateException when invoked after initialization phase	"According to Servlet 3.0 javadoc javax.servlet.SessionCookieConfig setter methods must throw IllegalStateException when invoked after initialization phase setComment(String) setDomain(String) setHttpOnly(boolean) setMaxAge(int) setName(String) setPath(String) setSecure(boolean) "" Throws: java.lang.IllegalStateException - if the ServletContext from which this SessionCookieConfig was acquired has already been initialized """	2013-05-15 08:23:39	1368620000	resolved fixed	41462ca	1368610000	java/org/apache/catalina/core/ApplicationContext.java java/org/apache/catalina/core/ApplicationSessionCookieConfig.java test/org/apache/catalina/core/TestApplicationSessionCookieConfig.java	2:java/org/apache/catalina/core/ApplicationSessionCookieConfig.java 3:java/org/apache/catalina/core/ApplicationContext.java
137	54703	Bug 54703 Nullpointer exception in HttpParser.parseMediaType	"input for parseMediaType() is ---------- multipart/signed; protocol=""application/pkcs7-signature""; micalg=sha-256; boundary=""----=_Part_121_929034657.1363355797756"" ---------- exception trace java.lang.NullPointerException at org.apache.tomcat.util.http.parser.HttpParser.parseMediaType(HttpParser.java:215) at org.apache.tomcat.util.http.parser.MediaTypeCache.parse(MediaTypeCache.java:54) at org.apache.catalina.connector.Response.setContentType(Response.java:806) at org.apache.catalina.connector.Response.checkSpecialHeader(Response.java:1119) at org.apache.catalina.connector.Response.setHeader(Response.java:1446) at org.apache.catalina.connector.ResponseFacade.setHeader(ResponseFacade.java:535)"	2013-03-15 14:09:19	1363370000	resolved fixed	7aeab0e	1367940000	java/org/apache/tomcat/util/http/parser/HttpParser.java test/org/apache/tomcat/util/http/parser/TestMediaType.java	4:test/org/apache/tomcat/util/http/parser/TestMediaType.java 11:java/org/apache/tomcat/util/http/parser/HttpParser.java
138	54906	Bug 54906 WebappClassLoader.loadedByThisOrChild can throw ConcurrentModificationException		2013-04-29 19:25:04	1367280000	resolved fixed	c06707c	1367700000	java/org/apache/catalina/loader/WebappClassLoader.java	1:java/org/apache/catalina/loader/WebappClassLoader.java
139	54926	Bug 54926 WsFilter performs handshake validation even if it doesn't have a mapped endpoint	WsFilter performs several validations on WebSocket requests before checking if there is a registered Endpoint. I think the check for registered Endponts (and delegation to the next Filter) should take place first and the filter should do no further processing if there is mapped Endpoint for that URL. For example a SockJS protocol test send a POST request with a connection and upgrade headers but no ws version header and expects back a 405 (invalid HTTP method) where WsFilter sends 426 even though it has no Endpoint mapped at that URL.	2013-05-04 01:23:20	1367650000	resolved fixed	2df191f	1367660000	java/org/apache/tomcat/websocket/server/WsFilter.java	1:java/org/apache/tomcat/websocket/server/WsFilter.java
140	54888	"Bug 54888 TagPlugin ""ForEach"" doesn't support CSV items"		2013-04-24 16:49:45	1366840000	resolved fixed	d440ae2	1367240000	java/org/apache/jasper/tagplugins/jstl/core/ForEach.java test/org/apache/jasper/tagplugins/jstl/core/TestForEach.java	3:java/org/apache/jasper/tagplugins/jstl/core/ForEach.java 18:test/org/apache/jasper/tagplugins/jstl/core/TestForEach.java
141	54801	Bug 54801 EL-like expressions in jsp:scriptlet break compilation of JSP XML documents		2013-04-04 22:24:00	1365130000	resolved fixed	1631be1	1366900000	java/org/apache/jasper/compiler/JspDocumentParser.java test/org/apache/jasper/compiler/TestJspDocumentParser.java	12:java/org/apache/jasper/compiler/JspDocumentParser.java 90:test/org/apache/jasper/compiler/TestJspDocumentParser.java
142	54178	"Bug 54178 [CVE-2013-2071] runtime exception in onComplete of AsyncListener, will make org.apache.catalina.connector.Request not recycled (orginally reported MESSAGE POST to tomcat, but it called doGet)"	"one HTTP request use POST method, but in tomcat it calls doGet() what is really strage. as I only tested in 7.0.23, and 7.0.32. in 7.0.32, 7.0.32 is more reproduceable than 7.0.23. I know it must be a very strange issue, as tomcat has so many release. I can't believe it if I didn't see it with my own eyes. so I attache the image."	2012-11-21 08:22:00	1353500000	resolved fixed	4171baf	1366800000	java/org/apache/catalina/core/AsyncContextImpl.java test/org/apache/catalina/core/TestAsyncContextImpl.java	3:java/org/apache/catalina/core/AsyncContextImpl.java 6:test/org/apache/catalina/core/TestAsyncContextImpl.java
143	54708	"Bug 54708 Use base file name (""ROOT"") as the work directory for the default webapp instead of ""_"""		2013-03-15 22:22:13	1363400000	resolved fixed	59a0676	1366750000	java/org/apache/catalina/core/StandardContext.java	3:java/org/apache/catalina/core/StandardContext.java
144	54781	Bug 54781 NPE in WsServerContainer if there is no matching path		2013-04-01 19:32:18	1364860000	resolved fixed	67ed3e7	1366750000	java/org/apache/tomcat/websocket/server/WsFilter.java java/org/apache/tomcat/websocket/server/WsServerContainer.java	1:java/org/apache/tomcat/websocket/server/WsServerContainer.java 50:java/org/apache/tomcat/websocket/server/WsFilter.java
145	54792	Bug 54792 IllegalStateException with chat sample	"This looks related to 54659 and 54724 but possibly a new issue. To reproduce, open the chat sample page, send a message or two, and then close the browser tab. The following exception appears in the log and it doesn't seem to step from anything done in the application: java.lang.IllegalStateException: The WebSocket session has been closed and no method (apart from close()) may be called on a closed session at org.apache.tomcat.websocket.WsSession.checkState(WsSession.java:516) at org.apache.tomcat.websocket.WsSession.getMessageHandlers(WsSession.java:191) at org.apache.tomcat.websocket.pojo.PojoEndpointBase.onClose(PojoEndpointBase.java:113) at org.apache.tomcat.websocket.WsSession.fireEndpointOnClose(WsSession.java:392) at org.apache.tomcat.websocket.WsSession.onClose(WsSession.java:370) at org.apache.tomcat.websocket.server.WsHttpUpgradeHandler.close(WsHttpUpgradeHandler.java:166) at org.apache.tomcat.websocket.server.WsHttpUpgradeHandler.access$200(WsHttpUpgradeHandler.java:44) at org.apache.tomcat.websocket.server.WsHttpUpgradeHandler$WsReadListener.onDataAvailable(WsHttpUpgradeHandler.java:192) at org.apache.coyote.http11.upgrade.AbstractServletInputStream.onDataAvailable(AbstractServletInputStream.java:169) at org.apache.coyote.http11.upgrade.AbstractProcessor.upgradeDispatch(AbstractProcessor.java:94) at org.apache.coyote.AbstractProtocol$AbstractConnectionHandler.process(AbstractProtocol.java:618) at org.apache.coyote.http11.Http11NioProtocol$Http11ConnectionHandler.process(Http11NioProtocol.java:223) at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1581) at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.run(NioEndpoint.java:1537) at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603) at java.lang.Thread.run(Thread.java:722)"	2013-04-02 20:54:28	1364950000	resolved fixed	e26d61d	1366730000	webapps/examples/WEB-INF/classes/websocket/chat/ChatAnnotation.java	123:webapps/examples/WEB-INF/classes/websocket/chat/ChatAnnotation.java
146	54800	Bug 54800 Possible thread/memory leak with use of WebSocketContainer	"Whenever WebSocketContainer is used to connect to a server endpoint, the following message appears when Tomcat shuts down: SEVERE: The web application [/websocket-test] appears to have started a thread named [Thread-4] but has failed to stop it. This is very likely to create a memory leak. The message is repeated for 6 different threads. I don't have proof this is caused by the use of WebSocketContainer but the messages don't appear when it isn't used. The Endpoint used to connect is very simple. It sends a message when the session is opened to the EchoEndpoint on the server side, and prints the response and closes when the message is echoed back."	2013-04-04 21:47:00	1365130000	resolved fixed	d2630df	1366730000	java/org/apache/tomcat/websocket/WsWebSocketContainer.java	6:java/org/apache/tomcat/websocket/WsWebSocketContainer.java
147	54807	Bug 54807 [jsr356] java.lang.ClassCastException: org.apache.tomcat.websocket.server.WsServerContainer$TemplatePathMatch	"Caused by: java.lang.ClassCastException: org.apache.tomcat.websocket.server.WsServerContainer$TemplatePathMatch cannot be cast to java.lang.Comparable at java.util.TreeMap.compare(TreeMap.java:1188) at java.util.TreeMap.put(TreeMap.java:531) at java.util.TreeSet.add(TreeSet.java:255) at org.apache.tomcat.websocket.server.WsServerContainer.addEndpoint(WsServerContainer.java:144) at org.apache.tomcat.websocket.server.WsSci.onStartup(WsSci.java:118) at org.apache.catalina.core.StandardContext.startInternal(StandardContext.java:5195) at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:150) ... 11 more Reproducible when a path is defined as {path}. For example: @Override public Set<ServerEndpointConfig> getEndpointConfigs(Set<Class<? extends Endpoint>> endpointClasses) { logger.debug(""{} detected"", JSR356ServerEndpointConfig.class.getName()); return new HashSet<ServerEndpointConfig>() {{ add(ServerEndpointConfig.Builder.create(JSR356Endpoint.class, ""/{path}"").configurator(c).build()); }}; }"	2013-04-05 15:38:39	1365190000	resolved fixed	0339fec	1366400000	java/org/apache/tomcat/websocket/server/WsServerContainer.java test/org/apache/tomcat/websocket/server/TestWebSocketServerContainer.java	1:java/org/apache/tomcat/websocket/server/WsServerContainer.java
148	54822	Bug 54822 URL with Query String can't work over SPDY		2013-04-10 07:13:22	1365590000	resolved fixed	3da2133	1366380000	java/org/apache/coyote/spdy/SpdyProcessor.java	4:java/org/apache/coyote/spdy/SpdyProcessor.java
149	54851	Bug 54851 Folder without web-fragment.xml should not impact the status of distributable		2013-04-16 08:47:44	1366120000	resolved fixed	e97e158	1366120000	java/org/apache/catalina/startup/ContextConfig.java	1:java/org/apache/catalina/startup/ContextConfig.java
150	54755	Bug 54755 Type-based Endpoint's cannot be deployed by instance	"For type-based Endpoint's, WsServlet instantiates the Endpoint via reflection instead of using the Configurator as is done in PojoEndpointServer: sec.getConfigurator().getEndpointInstance(sec.getEndpointClass())"	2013-03-26 14:52:29	1364320000	resolved fixed	d025179	1364330000	java/org/apache/tomcat/websocket/server/WsServlet.java	7:java/org/apache/tomcat/websocket/server/WsServlet.java
151	54748	Bug 54748 IOException in echo WebSocket example	"The IOException ""New frame received after a close control frame"" is raised after pressing Disconnect. The exception can be detected by adding an onError method to EchoEndpoint."	2013-03-25 09:23:09	1364220000	resolved fixed	cf0c064	1364250000	java/org/apache/tomcat/websocket/WsFrameBase.java java/org/apache/tomcat/websocket/WsFrameClient.java java/org/apache/tomcat/websocket/server/WsFrameServer.java	24:java/org/apache/tomcat/websocket/WsFrameBase.java 50:java/org/apache/tomcat/websocket/WsFrameClient.java 69:java/org/apache/tomcat/websocket/server/WsFrameServer.java
152	54732	Bug 54732 StatementCache interceptor does not forward calls to Statement.close() which causes memory leaks		2013-03-20 16:09:31	1363810000	resolved fixed	8cf47b4	1363960000	modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/interceptor/StatementCache.java modules/jdbc-pool/src/test/java/org/apache/tomcat/jdbc/pool/interceptor/StatementCounterInterceptor.java modules/jdbc-pool/src/test/java/org/apache/tomcat/jdbc/test/TestStatementCache.java	1:modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/interceptor/StatementCache.java 8:modules/jdbc-pool/src/test/java/org/apache/tomcat/jdbc/test/TestStatementCache.java
153	54599	Bug 54599 DataSource password is exposed to applications via toString method	"On the server side, create a DataSource using ""org.apache.tomcat.jdbc.pool.DataSourceFactory"". Ex: <Resource auth=""Container"" description="""" name=""jdbc/testTomcatJdbc"" factory=""org.apache.tomcat.jdbc.pool.DataSourceFactory"" type=""javax.sql.DataSource"" username=""sa"" password=""super-secret"" driverClassName=""org.h2.Driver"" url=""jdbc:h2:mem:test"" minIdle=""1"" initialSize=""1"" /> In a web application, create a JSP file, add the following: <%@ page import=""javax.naming.*"" session=""false"" %> <!DOCTYPE HTML> <html> <head> <title>Display Password!</title> </head> <body> <h1>toString for Tomcat JDBC</h1> <% dataSource = (javax.sql.DataSource) ctx.lookup(""java:/comp/env/jdbc/testTomcatJdbc""); out.println(""<p>"" + dataSource.toString() + ""</p>""); %> </body> </html> Access the JSP in your browser. The output from toString on the DataSource will display the password that was configured in the <Resource/> tag. Example Output: toString for Tomcat JDBC org.apache.tomcat.jdbc.pool.DataSource@75cae120{ConnectionPool[defaultAutoCommit=null; defaultReadOnly=null; defaultTransactionIsolation=-1; defaultCatalog=null; driverClassName=org.h2.Driver; maxActive=100; maxIdle=100; minIdle=1; initialSize=1; maxWait=30000; testOnBorrow=false; testOnReturn=false; timeBetweenEvictionRunsMillis=5000; numTestsPerEvictionRun=0; minEvictableIdleTimeMillis=60000; testWhileIdle=false; testOnConnect=false; password=super-secret; url=jdbc:h2:mem:test; username=sa; validationQuery=null; validatorClassName=null; validationInterval=30000; accessToUnderlyingConnectionAllowed=true; removeAbandoned=false; removeAbandonedTimeout=60; logAbandoned=false; connectionProperties=null; initSQL=null; jdbcInterceptors=null; jmxEnabled=true; fairQueue=true; useEquals=true; abandonWhenPercentageFull=0; maxAge=0; useLock=false; dataSource=null; dataSourceJNDI=null; suspectTimeout=0; alternateUsernameAllowed=false; commitOnReturn=false; rollbackOnReturn=false; useDisposableConnectionFacade=true; logValidationErrors=false; propagateInterruptState=false; }"	2013-02-22 16:37:23	1361570000	resolved fixed	8445d9a	1363940000	modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/PoolProperties.java	2:modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/PoolProperties.java
154	54724	Bug 54724 WsSession does not throw IllegalStateException if closed when methods on it are called	"Spec JavaDoc says: ""Once the session is closed, it is no longer valid for use by applications. Calling any of its methods once the session has been closed will result in an IllegalStateException being thrown. Developers should retrieve any information from the session during the Endpoint.onClose(Session, CloseReason) method."" Of course, the rules of Closeable also apply here, and calling Session#close(...) more than once should have no effect subsequent times. There are actually three problems here: 1) None of the methods throw IllegalStateException if the session is closed. Instead, they return things (like the basic remote, for example), and some methods in the endpoint implementation will not notice concurrent exceptions from the socket and then block forever waiting four the Countdown to clear. 2) The Session#state is never actually changed to State.CLOSED unless Session#onClose is called. However, Session#onClose is never actually called that I can find (though I will look harder before I make changes). 3) Even in Session#onClose, the state is incorrectly changed to State.CLOSED BEFORE Endpoint#onClose is called, when it should be changed AFTER. I'm working on a patch for this."	2013-03-19 13:22:56	1363710000	resolved fixed	12f89ff	1363720000	java/org/apache/tomcat/websocket/WsSession.java test/org/apache/tomcat/websocket/TestWsWebSocketContainer.java	7:java/org/apache/tomcat/websocket/WsSession.java 34:test/org/apache/tomcat/websocket/TestWsWebSocketContainer.java
155	54721	Bug 54721 RemoteEndpoint blocks indefinitely if sendObject called with BinaryStream of TextStream encoders		2013-03-18 22:01:43	1363660000	resolved fixed	80ef59a	1363700000	java/org/apache/tomcat/websocket/WsRemoteEndpointImplBase.java	8:java/org/apache/tomcat/websocket/WsRemoteEndpointImplBase.java
156	54710	Bug 54710 Java WebSocket specification says @OnMessage methods can have InputStream/Reader parameters; @OnClose can have CloseReason parameters		2013-03-17 09:59:10	1363530000	resolved fixed	06800eb	1363640000	java/org/apache/tomcat/websocket/pojo/PojoEndpointBase.java java/org/apache/tomcat/websocket/pojo/PojoMessageHandlerBase.java java/org/apache/tomcat/websocket/pojo/PojoMessageHandlerPartialBase.java java/org/apache/tomcat/websocket/pojo/PojoMessageHandlerPartialBinary.java java/org/apache/tomcat/websocket/pojo/PojoMessageHandlerPartialText.java java/org/apache/tomcat/websocket/pojo/PojoMessageHandlerWholeBase.java java/org/apache/tomcat/websocket/pojo/PojoMessageHandlerWholeBinary.java java/org/apache/tomcat/websocket/pojo/PojoMessageHandlerWholePong.java java/org/apache/tomcat/websocket/pojo/PojoMessageHandlerWholeText.java java/org/apache/tomcat/websocket/pojo/PojoMethodMapping.java	9:java/org/apache/tomcat/websocket/pojo/PojoEndpointBase.java 10:java/org/apache/tomcat/websocket/pojo/PojoMethodMapping.java 15:java/org/apache/tomcat/websocket/pojo/PojoMessageHandlerWholeBase.java 22:java/org/apache/tomcat/websocket/pojo/PojoMessageHandlerWholePong.java 29:java/org/apache/tomcat/websocket/pojo/PojoMessageHandlerWholeText.java 31:java/org/apache/tomcat/websocket/pojo/PojoMessageHandlerWholeBinary.java 62:java/org/apache/tomcat/websocket/pojo/PojoMessageHandlerPartialBase.java 1164:java/org/apache/tomcat/websocket/pojo/PojoMessageHandlerBase.java 1187:java/org/apache/tomcat/websocket/pojo/PojoMessageHandlerPartialText.java 1198:java/org/apache/tomcat/websocket/pojo/PojoMessageHandlerPartialBinary.java
157	54709	"Bug 54709 Official schemes for WebSocket are ""ws""/""wss""; WsWebSocketContainer only allows ""http""/""https"""		2013-03-17 08:54:31	1363520000	resolved fixed	ad148dd	1363550000	java/org/apache/tomcat/websocket/WsWebSocketContainer.java test/org/apache/tomcat/websocket/TestWsRemoteEndpoint.java test/org/apache/tomcat/websocket/TestWsWebSocketContainer.java test/org/apache/tomcat/websocket/pojo/TestEncodingDecoding.java test/org/apache/tomcat/websocket/pojo/TestPojoMethodMapping.java	1:java/org/apache/tomcat/websocket/WsWebSocketContainer.java 47:test/org/apache/tomcat/websocket/TestWsWebSocketContainer.java 92:test/org/apache/tomcat/websocket/pojo/TestPojoMethodMapping.java 348:test/org/apache/tomcat/websocket/pojo/TestEncodingDecoding.java 407:test/org/apache/tomcat/websocket/TestWsRemoteEndpoint.java
158	54712	Bug 54712 Prefer Locale.ENGLISH over Locale.US for case conversion		2013-03-17 12:54:09	1363540000	resolved fixed	dc16474	1363530000	java/org/apache/catalina/connector/Connector.java java/org/apache/tomcat/util/buf/B2CConverter.java java/org/apache/tomcat/util/http/parser/HttpParser.java java/org/apache/tomcat/util/http/parser/MediaType.java modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/PoolProperties.java test/org/apache/catalina/startup/SimpleHttpClient.java	26:java/org/apache/tomcat/util/http/parser/MediaType.java 42:java/org/apache/tomcat/util/buf/B2CConverter.java 44:modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/PoolProperties.java 46:java/org/apache/catalina/connector/Connector.java 152:java/org/apache/tomcat/util/http/parser/HttpParser.java 255:test/org/apache/catalina/startup/SimpleHttpClient.java
159	54631	Bug 54631 @PathParam is not working with @OnMessage	"I have defined server end-point as: @ServerEndpoint(value = ""/ws/{mid}/{rid}/{uid}"") When using @PathParam with @OnMessage, values are null. Other annotations like @OnOpen and @OnClose print values specified in URL. @OnMessage public void onTextMessage(@PathParam(""mid"") Long mid, @PathParam(""rid"") Integer rid, @PathParam(""uid"") Long uid, Session session, String message, boolean pair) { log.debug(""[TEXT]"" + "" : "" + mid + "" : "" + rid + "" : "" + uid + message + "" : "" + session.getRequestURI()); }"	2013-03-04 05:03:35	1362390000	resolved fixed	7fd7279	1363380000	test/org/apache/tomcat/websocket/pojo/TestPojoMethodMapping.java	
160	54702	Bug 54702 File descriptor leak at web.xml loading	"Hello I think I've found a file descriptor leak in file /tomcat/trunk/java/org/apache/catalina/startup/ContextConfig.java (method getGlobalWebXmlSource). A stream is from file ""web.xml"" is not closed. private WebXml getDefaultWebXmlFragment() { ... 1284 InputSource globalWebXml = getGlobalWebXmlSource(); ... 1337 // Parse global web.xml if present 1338 if (globalWebXml == null) { 1339 // This is unusual enough to log 1340 log.info(sm.getString(""contextConfig.defaultMissing"")); 1341 } else { 1342 parseWebXml(globalWebXml, webXmlDefaultFragment, false); 1343 } Here is the full stack trace [java.io.FileInputStream.<init>(FileInputStream.java:109)] [org.apache.catalina.startup.ContextConfig.getWebXmlSource(ContextConfig.java:1837)] [org.apache.catalina.startup.ContextConfig.getGlobalWebXmlSource(ContextConfig.java:1744)] [org.apache.catalina.startup.ContextConfig.getDefaultWebXmlFragment(ContextConfig.java:1417)] [org.apache.catalina.startup.ContextConfig.webConfig(ContextConfig.java:1253)] [org.apache.catalina.startup.ContextConfig.configureStart(ContextConfig.java:878)] [org.apache.catalina.startup.ContextConfig.lifecycleEvent(ContextConfig.java:369)] [org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:119)] [org.apache.catalina.util.LifecycleBase.fireLifecycleEvent(LifecycleBase.java:90)] [org.apache.catalina.core.StandardContext.startInternal(StandardContext.java:5173)] [org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:150)] [org.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:901)] [org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:877)] [org.apache.catalina.core.StandardHost.addChild(StandardHost.java:633)] [org.apache.catalina.startup.HostConfig.deployWAR(HostConfig.java:977)] [org.apache.catalina.startup.HostConfig.deployApps(HostConfig.java:542)] [org.apache.catalina.startup.HostConfig.check(HostConfig.java:1462)] [sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)] [sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)] [sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)] [java.lang.reflect.Method.invoke(Method.java:597)] [org.apache.tomcat.util.modeler.BaseModelMBean.invoke(BaseModelMBean.java:301)] [com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.invoke(DefaultMBeanServerInterceptor.java:836)] [com.sun.jmx.mbeanserver.JmxMBeanServer.invoke(JmxMBeanServer.java:761)] [org.apache.catalina.manager.ManagerServlet.check(ManagerServlet.java:1445)] [org.apache.catalina.manager.HTMLManagerServlet.upload(HTMLManagerServlet.java:301)] [org.apache.catalina.manager.HTMLManagerServlet.doPost(HTMLManagerServlet.java:208)] [javax.servlet.http.HttpServlet.service(HttpServlet.java:647)] [javax.servlet.http.HttpServlet.service(HttpServlet.java:728)] [org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:305)] [org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:210)] [org.apache.catalina.filters.CsrfPreventionFilter.doFilter(CsrfPreventionFilter.java:213)] [org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:243)] [org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:210)] [org.apache.catalina.filters.SetCharacterEncodingFilter.doFilter(SetCharacterEncodingFilter.java:108)] [org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:243)] [org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:210)] [org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:222)] [org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:123)] [org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:581)] [org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:171)] [org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:99)] [org.apache.catalina.valves.AccessLogValve.invoke(AccessLogValve.java:931)] [org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:118)] [org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:407)] [org.apache.coyote.http11.AbstractHttp11Processor.process(AbstractHttp11Processor.java:1004)] [org.apache.coyote.AbstractProtocol$AbstractConnectionHandler.process(AbstractProtocol.java:589)] [org.apache.tomcat.util.net.AprEndpoint$SocketProcessor.run(AprEndpoint.java:1822)] [java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)] [java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)] [java.lang.Thread.run(Thread.java:662)]"	2013-03-15 08:53:36	1363350000	resolved fixed	7c88af9	1363360000	java/org/apache/catalina/startup/ContextConfig.java	1:java/org/apache/catalina/startup/ContextConfig.java
161	54658	Bug 54658 Implement Part#getSubmittedFileName from SERVLET_SPEC-57		2013-03-09 21:46:36	1362880000	resolved fixed	ca205c1	1363290000	java/javax/servlet/http/Part.java java/org/apache/catalina/connector/Request.java java/org/apache/catalina/core/ApplicationPart.java java/org/apache/catalina/manager/HTMLManagerServlet.java	1:java/javax/servlet/http/Part.java 2:java/org/apache/catalina/connector/Request.java 14:java/org/apache/catalina/manager/HTMLManagerServlet.java 52:java/org/apache/catalina/core/ApplicationPart.java
162	54660	Bug 54660 AccessLogValve fileDateFormat can not be changed through JMX	"When an AccessLogValve is added to a catalina host with the JMX addVale() operation on the Host object name, the valve will start with the default fileDateFormat. Changing the attribute on the valve through it's JMX object name has no effect because the valve is already started. Executing a rotate() operation on the valve does also have no effect. Steps to Reproduce: - Start tomcat server - Add Host using JMX - Add valve to Host using JMX - Set valve attribute fileDateFormat to something else than yyyy-MM-dd, for example yy-MM Actual Results: The access log file format will include the default fileDateFormat of yyyy-MM-dd Expected Results: The access log file format with yy-MM, as from the example."	2013-03-10 07:09:11	1362910000	resolved fixed	2a03ca6	1363280000	java/org/apache/catalina/valves/AccessLogValve.java	1:java/org/apache/catalina/valves/AccessLogValve.java
163	54690	Bug 54690 HTTPS BIO/NIO connector does not enable TLS 1.1 and TLS 1.2 by default		2013-03-13 17:07:20	1363210000	closed fixed	fedf189	1363270000	java/org/apache/tomcat/util/net/jsse/JSSESocketFactory.java	7:java/org/apache/tomcat/util/net/jsse/JSSESocketFactory.java
164	54671	"Bug 54671 Spec says ServerContainerProvider#getServerContainer() should be public, but implemented package-private in Tomcat 8.0"		2013-03-11 22:31:14	1363060000	resolved fixed	28c599f	1363040000	java/javax/websocket/server/ServerContainerProvider.java	1:java/javax/websocket/server/ServerContainerProvider.java
165	54628	Bug 54628 there is something wrong when send binary data by websocket.	"there is something wrong when send binary data by websocket. see org.apache.catalina.websocket.WsOutbound.doWriteBytes(ByteBuffer, boolean) I think // Write the content upgradeOutbound.write(buffer.array(), 0, buffer.limit()); upgradeOutbound.flush(); should change to : // Write the content upgradeOutbound.write(buffer.array(), buffer.arrayOffset(), buffer.limit()); upgradeOutbound.flush(); For example: byte[] bts = new byte[]{1,2,3,4,5} ByteBuffer bf = ByteBuffer.wrap(bts, 2, 2); out.writeBinaryMessage(bf); I mean write [3,4] to the client, but in fact [1,2,3,4] be sent;"	2013-03-02 08:37:25	1362230000	resolved fixed	e1d16fd	1362600000	java/org/apache/catalina/websocket/WsOutbound.java	1:java/org/apache/catalina/websocket/WsOutbound.java
166	54624	Bug 54624 Form authenticator hangs on re-authentication of POST request behind mod_proxy_ajp	"Setup: Tomcat AJP connector behind mod_proxy_ajp, form-based authentication. When session expires and a POST request is submitted, Tomcat shows login form, user logs in, authenticator tries to restore the original POST request. Doing that, it tries to swallow the AJP message body before replacing the body of the request with the original POST request body. It tries to read the first 4 bytes of the AJP message (the message length) and blocks forever waiting for those 4 bytes."	2013-02-28 21:44:55	1362110000	resolved fixed	c9e056c	1362600000	java/org/apache/catalina/authenticator/FormAuthenticator.java	4:java/org/apache/catalina/authenticator/FormAuthenticator.java
167	54612	Bug 54612 Fatal Error when trying to send data to WebSocket with conection closed		2013-02-27 06:32:43	1361960000	resolved fixed	1255d32	1362590000	java/org/apache/catalina/websocket/WsOutbound.java	15:java/org/apache/catalina/websocket/WsOutbound.java
168	54638	Bug 54638 /manager/status?XML=true	"Hi all, in /manager/status?XML=true, informations about memory pools are incorrect. for every row all the values (initial,committed,maximum,used) are the same: Memory Pools Name:Eden Space Type:Heap memory Initial:143130624 Committed:143130624 Maximum:143130624 Used:143130624 Name:Survivor Space Type:Heap memory Initial:17891328 Committed:17891328 Maximum:17891328 Used:17891328 Name:Tenured Gen Type:Heap memory Initial:357957632 Committed:357957632 Maximum:357957632 Used:357957632 Name:Code Cache Type:Non-heap memory Initial:163840 Committed:8421376 Maximum:33554432 Used:163840 Name:Perm Gen Type:Non-heap memory Initial:12582912 Committed:23330816 Maximum:67108864 Used:12582912 Name:Perm Gen [shared-ro] Type:Non-heap memory Initial:10485760 Committed:10485760 Maximum:10485760 Used:10485760 Name:Perm Gen [shared-rw] Type:Non-heap memory Initial:12582912 Committed:12582912 Maximum:12582912 Used:12582912 Instead in the gui page values are correct."	2013-03-05 12:29:57	1362500000	resolved fixed	78b3c10	1362530000	java/org/apache/catalina/manager/StatusTransformer.java	2:java/org/apache/catalina/manager/StatusTransformer.java
169	54585	Bug 54585 WebappLoader doesn't honor delegate attr while constructing jsp_classpath	If custom WebappClassLoader is created with delegate=true then parent-first classloading model is used. Everything works here as expected. However jsp_classpath is always constructed in the following manner: customWebappClassLoader.urls;parent.urls;parent...parent.urls Whereas it is expected to me that if delegate=true then parent's urls should come first.	2013-02-19 20:50:13	1361330000	resolved fixed	9ad4904	1362010000	java/org/apache/catalina/loader/WebappLoader.java	2:java/org/apache/catalina/loader/WebappLoader.java
170	54602	Bug 54602 B2CConverter character decode underflow leaves bytes in buffer	"If a request contains a uri that ends in a multi byte character which is missing a byte the extra bytes are left in a buffer which is reused by a future request. The problem comes from two different things: 1) If B2CConverter tries to convert a ByteChunk which ends in a character underflow it does not convert that last character and it is left in a buffer in B2CConver. 2) The B2CConverter in org.apache.catalina.connector.Request is not recycled with the rest of the objects. It looks like this is done intentionally based on the comment above it's declaration. The issue with B2CConverter can be demonstrated with the code below, which is a simplification of what is done inside of CoyoteAdapter.convertURI(): <code> B2CConverter conv = new B2CConverter(""UTF-8""); ByteChunk bc = new ByteChunk(); CharChunk cc = new CharChunk(); byte[] bytes = { 0x61, 0x62, 0x63, 0x64, -8, -69, -73, -77 }; bc.append(bytes, 0, bytes.length); cc.allocate(bc.getLength(), -1); conv.convert(bc, cc, cc.getBuffer().length - cc.getEnd()); System.out.println(cc); cc.recycle(); bc.recycle(); bc.append(bytes, 0, bytes.length); cc.allocate(bc.getLength(), -1); conv.convert(bc, cc, cc.getBuffer().length - cc.getEnd()); System.out.println(cc); </code> If the B2CConverter was recycled with everything else in Request this would prevent a previous request from corrupting the next request but it doesn't fix the issue that a character is dropped from the initial decode. I tried playing with B2CConverter and the only way I could get the convert to get everything was by ignoring the limit argument and reading to the end of the stream. It looks like tomcat8 is moving in this direction with the move to NIO, however I tried playing with the latest B2CConverter and was still seeing issues with the given byte sequence."	2013-02-22 20:06:36	1361580000	resolved fixed	b2f0e7c	1361570000	java/org/apache/catalina/connector/CoyoteAdapter.java	1:java/org/apache/catalina/connector/CoyoteAdapter.java
171	54203	Bug 54203 Part class missing documentation		2012-11-25 09:02:17	1353850000	resolved fixed	81eaf63	1360750000	java/javax/servlet/http/Part.java	1:java/javax/servlet/http/Part.java
172	54552	"Bug 54552 Completed Servlet 3.1 spec for changeSessionId, HttpSessionIdListener"		2013-02-12 13:56:32	1360700000	resolved fixed	c11952d	1360750000	java/javax/servlet/http/HttpServletRequest.java java/javax/servlet/http/HttpServletRequestWrapper.java java/javax/servlet/http/HttpSessionIdListener.java java/org/apache/catalina/connector/Request.java java/org/apache/catalina/connector/RequestFacade.java java/org/apache/catalina/core/ApplicationContext.java java/org/apache/catalina/core/StandardContext.java java/org/apache/catalina/ha/session/DeltaManager.java java/org/apache/catalina/session/ManagerBase.java java/org/apache/catalina/websocket/WsHttpServletRequestWrapper.java	1:java/org/apache/catalina/ha/session/DeltaManager.java 3:java/org/apache/catalina/session/ManagerBase.java 7:java/org/apache/catalina/connector/Request.java 9:java/org/apache/catalina/core/StandardContext.java 18:java/javax/servlet/http/HttpServletRequest.java 43:java/org/apache/catalina/core/ApplicationContext.java 50:java/javax/servlet/http/HttpServletRequestWrapper.java 70:java/org/apache/catalina/websocket/WsHttpServletRequestWrapper.java 99:java/org/apache/catalina/connector/RequestFacade.java
173	54536	"Bug 54536 ErrorReportValve doesn't respect HttpServletResponse.sendError(int sc, String msg)"		2013-02-07 12:33:41	1360260000	resolved fixed	ef9ed07	1360700000	java/org/apache/catalina/valves/ErrorReportValve.java test/org/apache/catalina/valves/TestErrorReportValve.java	1:java/org/apache/catalina/valves/ErrorReportValve.java 8:test/org/apache/catalina/valves/TestErrorReportValve.java
174	54239	Bug 54239 Extensible EL Interpreter		2012-12-04 06:56:18	1354620000	resolved fixed	f8ac6a0	1360680000	java/org/apache/jasper/compiler/ELInterpreter.java java/org/apache/jasper/compiler/ELInterpreterFactory.java java/org/apache/jasper/compiler/Generator.java test/org/apache/jasper/compiler/TestELInterpreterFactory.java	76:java/org/apache/jasper/compiler/Generator.java
175	54456	Bug 54456 ChunkedInputFilter returning EOF when client closes connection without sending end chunk		2013-01-21 16:45:51	1358800000	resolved fixed	cc2f8db	1360240000	java/org/apache/coyote/http11/filters/ChunkedInputFilter.java	1:java/org/apache/coyote/http11/filters/ChunkedInputFilter.java
176	54521	Bug 54521 DigestAuthenticator: nonceCountValid() fails in case of simultaneous asynchronous requests of the same client	"Concerned components: org.apache.catalina.authenticator.DigestAuthenticator org.apache.catalina.authenticator.DigestAuthenticator.NonceInfo Scenario: A multithreaded client sends two requests within one millisecond. The DigestAuthenticator creates for each request a nonce as well as a NonceInfo instance. The two nonces are equal, as they were created within the same millisecond. When writing data into the cache (method generateNonce()), the second NonceInfo instance overwrites the first one (same key!). Problem: The two client threads then send a second request with a digest authentication header. In both requests, nc (nonce count) is equal 1, as the nonce has been newly created. In the NonceInfo of the first request, array seen is set to true for index ((nonceCount + offset) % seen.length). In the second request the same NonceInfo instance is used, as the instance is retrieved from map nonces using nonce as a key, that is, in both requests the same key is used. Consequently, method nonceCountValid() returns false, as seen[(nonceCount + offset) % seen.length)] has already been set to true. Therefore the authentication fails, although the client has sent a valid digest authentication header. Conclusion: Working with multi-threaded clients with many requests, digest authentication does not function reliably."	2013-02-04 10:54:16	1359990000	resolved fixed	b68bbb8	1360230000	java/org/apache/catalina/authenticator/DigestAuthenticator.java test/org/apache/catalina/authenticator/TestDigestAuthenticator.java	1:java/org/apache/catalina/authenticator/DigestAuthenticator.java 14:test/org/apache/catalina/authenticator/TestDigestAuthenticator.java
177	54534	Bug 54534 JMX connection may load servlet with invalid ClassLoader		2013-02-06 19:14:48	1360200000	resolved fixed	a993d7c2	1360230000	java/org/apache/catalina/core/StandardWrapper.java	35:java/org/apache/catalina/core/StandardWrapper.java
178	54513	Bug 54513 NullPointerException in AprEndpoint$Poller.run	"Trunk at r1441188, running the test suite with APR connector, Native 1.1.26 Windows 32-bit with JDK 7u11. I encountered the following when running org.apache.catalina.loader.TestVirtualContext test On second re-run of the test the same issue happened, so it is as if there is something specific here. I have not encountered the issue with the rest of testsuite yet. [[[ Feb 01, 2013 2:07:26 AM org.apache.tomcat.util.net.AprEndpoint$Poller run WARNING: Unexpected poller error java.lang.NullPointerException at org.apache.tomcat.util.net.AprEndpoint$AprSocketWrapper.access$200(AprEndpoint.java:2198) at org.apache.tomcat.util.net.AprEndpoint$Poller.run(AprEndpoint.java:1632) at java.lang.Thread.run(Thread.java:722) ]]] The code at AprEndpoint$Poller.run(AprEndpoint.java:1632) is 1628 for (int n = 0; n < rv; n++) { 1629 timeouts.remove(desc[n*2+1]); 1630 AprSocketWrapper wrapper = connections.get( 1631 Long.valueOf(desc[n*2+1])); 1632 wrapper.pollerFlags = wrapper.pollerFlags & ~((int) desc[n*2]); I suspect that ""wrapper"" is null here. The above code is specific to Tomcat trunk and is not present in 7.0.x. When this happened, the test hung for 15 minutes (1000 secs) waiting on a socket read. When time out passed, it continued to run all the other tests. [[[ Testcase: testAdditionalWebInfClassesPaths took 1 006,735 sec Caused an ERROR Read timed out java.net.SocketTimeoutException: Read timed out at java.net.SocketInputStream.socketRead0(Native Method) at java.net.SocketInputStream.read(SocketInputStream.java:150) at java.net.SocketInputStream.read(SocketInputStream.java:121) at java.io.BufferedInputStream.fill(BufferedInputStream.java:235) at java.io.BufferedInputStream.read1(BufferedInputStream.java:275) at java.io.BufferedInputStream.read(BufferedInputStream.java:334) at sun.net.www.http.HttpClient.parseHTTPHeader(HttpClient.java:633) at sun.net.www.http.HttpClient.parseHTTP(HttpClient.java:579) at sun.net.www.protocol.http.HttpURLConnection.getInputStream(HttpURLConnection.java:1322) at java.net.HttpURLConnection.getResponseCode(HttpURLConnection.java:468) at org.apache.catalina.startup.TomcatBaseTest.methodUrl(TomcatBaseTest.java:247) at org.apache.catalina.startup.TomcatBaseTest.getUrl(TomcatBaseTest.java:219) at org.apache.catalina.startup.TomcatBaseTest.getUrl(TomcatBaseTest.java:213) at org.apache.catalina.startup.TomcatBaseTest.getUrl(TomcatBaseTest.java:202) at org.apache.catalina.loader.TestVirtualContext.assertPageContains(TestVirtualContext.java:326) at org.apache.catalina.loader.TestVirtualContext.assertPageContains(TestVirtualContext.java:320) at org.apache.catalina.loader.TestVirtualContext.testAdditionalWebInfClassesPaths(TestVirtualContext.java:311) ]]]"	2013-01-31 23:15:59	1359690000	resolved fixed	bbb13f6	1359840000	java/org/apache/tomcat/util/net/AprEndpoint.java	1:java/org/apache/tomcat/util/net/AprEndpoint.java
179	54497	Bug 54497 RuntimeException in WebappClassLoader.checkThreadLocalMapForLeaks() causes LifecycleException	"Observed this when testing Tomcat trunk at r1438747, at WinXP 32-bit, JDK 7u11. (running TestWsWebSocketContainer with APR, Tomcat-Native 1.1.26 RC) There occurred an NPE in WebappClassLoader.checkThreadLocalMapForLeaks(). It was uncaught and caused LifecycleException and ultimately a failure to stop Tomcat. =============== In stderr: SEVERE: A child container failed during stop java.util.concurrent.ExecutionException: org.apache.catalina.LifecycleException: Failed to stop component [StandardEngine[Tomcat].StandardHost[localhost].StandardContext[]] at java.util.concurrent.FutureTask$Sync.innerGet(FutureTask.java:252) at java.util.concurrent.FutureTask.get(FutureTask.java:111) at org.apache.catalina.core.ContainerBase.stopInternal(ContainerBase.java:974) at org.apache.catalina.util.LifecycleBase.stop(LifecycleBase.java:232) at org.apache.catalina.core.ContainerBase$StopChild.call(ContainerBase.java:1404) at org.apache.catalina.core.ContainerBase$StopChild.call(ContainerBase.java:1393) at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:334) at java.util.concurrent.FutureTask.run(FutureTask.java:166) at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603) at java.lang.Thread.run(Thread.java:722) Caused by: org.apache.catalina.LifecycleException: Failed to stop component [StandardEngine[Tomcat].StandardHost[localhost].StandardContext[]] at org.apache.catalina.util.LifecycleBase.stop(LifecycleBase.java:236) ... 7 more Caused by: org.apache.catalina.LifecycleException: Failed to stop component [WebappLoader[]] at org.apache.catalina.util.LifecycleBase.stop(LifecycleBase.java:236) at org.apache.catalina.core.StandardContext.stopInternal(StandardContext.java:5365) at org.apache.catalina.util.LifecycleBase.stop(LifecycleBase.java:232) ... 7 more Caused by: java.lang.NullPointerException at sun.reflect.UnsafeFieldAccessorImpl.ensureObj(UnsafeFieldAccessorImpl.java:54) at sun.reflect.UnsafeObjectFieldAccessorImpl.get(UnsafeObjectFieldAccessorImpl.java:36) at java.lang.reflect.Field.get(Field.java:372) at org.apache.catalina.loader.WebappClassLoader.checkThreadLocalMapForLeaks(WebappClassLoader.java:2247) at org.apache.catalina.loader.WebappClassLoader.checkThreadLocalsForLeaks(WebappClassLoader.java:2188) at org.apache.catalina.loader.WebappClassLoader.clearReferences(WebappClassLoader.java:1731) at org.apache.catalina.loader.WebappClassLoader.stop(WebappClassLoader.java:1641) at org.apache.catalina.loader.WebappLoader.stopInternal(WebappLoader.java:491) at org.apache.catalina.util.LifecycleBase.stop(LifecycleBase.java:232) ... 9 more =============== In testcase: Testcase: testSmallTextBufferClientTextMessage took 2,328 sec Caused an ERROR Failed to stop component [StandardServer[-1]] org.apache.catalina.LifecycleException: Failed to stop component [StandardServer[-1]] at org.apache.catalina.util.LifecycleBase.stop(LifecycleBase.java:236) at org.apache.catalina.startup.Tomcat.stop(Tomcat.java:336) at org.apache.catalina.startup.TomcatBaseTest.tearDown(TomcatBaseTest.java:163) Caused by: org.apache.catalina.LifecycleException: Failed to stop component [StandardService[Tomcat]] at org.apache.catalina.util.LifecycleBase.stop(LifecycleBase.java:236) at org.apache.catalina.core.StandardServer.stopInternal(StandardServer.java:766) at org.apache.catalina.util.LifecycleBase.stop(LifecycleBase.java:232) Caused by: org.apache.catalina.LifecycleException: Failed to stop component [StandardEngine[Tomcat]] at org.apache.catalina.util.LifecycleBase.stop(LifecycleBase.java:236) at org.apache.catalina.core.StandardService.stopInternal(StandardService.java:501) at org.apache.catalina.util.LifecycleBase.stop(LifecycleBase.java:232) Caused by: org.apache.catalina.LifecycleException: A child container failed during stop at org.apache.catalina.core.ContainerBase.stopInternal(ContainerBase.java:981) at org.apache.catalina.util.LifecycleBase.stop(LifecycleBase.java:232) =============== Thoughts: 1. We should catch throwables in those checkFor**Leaks methods. It should not cause a ""failed to stop component"" failure. 2. In that method there are many calls to ""table[j]"". The array member should be evaluated only once, so that it does not become null unexpectedly."	2013-01-25 23:16:17	1359170000	resolved fixed	ea16bda	1359720000	java/org/apache/catalina/loader/WebappClassLoader.java	1:java/org/apache/catalina/loader/WebappClassLoader.java
180	54496	Bug 54496 ..tribes.membership.MemberImpl.toString() might be better using .getClass().getName()	"public String toString() { StringBuilder buf = new StringBuilder(""org.apache.catalina.tribes.membership.MemberImpl[""); Might be better to use .getClass().getName() to cover StaticMember and any other sub-classes that might arise."	2013-01-25 18:34:53	1359160000	resolved fixed	e1e4e4e	1359390000	java/org/apache/catalina/tribes/membership/MemberImpl.java	1:java/org/apache/catalina/tribes/membership/MemberImpl.java
181	53869	Bug 53869 Performance tuning solution to resolve too many cascaded JspContextWrapper issue		2012-09-13 13:56:24	1347560000	resolved fixed	ce55f25	1359120000	java/org/apache/jasper/runtime/JspContextWrapper.java	1:java/org/apache/jasper/runtime/JspContextWrapper.java
182	54476	Bug 54476 incorrect param specification in javadoc ...tribes.group.GroupChannel send methods	* @param destination Member[] - destination.length > 1 I believe this should be: * @param destination Member[] - destination.length > 0	2013-01-23 20:05:14	1358990000	resolved fixed	6647531	1359020000	java/org/apache/catalina/tribes/group/GroupChannel.java	1:java/org/apache/catalina/tribes/group/GroupChannel.java
183	54466	Bug 54466 No file name information in detail error when compiling the java file generated from a tag file		2013-01-22 09:07:46	1358860000	resolved fixed	d7f744c	1358970000	java/org/apache/jasper/compiler/DefaultErrorHandler.java	10:java/org/apache/jasper/compiler/DefaultErrorHandler.java
184	54458	Bug 54458 DataSourceRealm should provide more info on SQLException	"The getPassword() method of the DataSourceRealm does not log enough information when it encounters an SQL error. The catch block is: } catch(SQLException e) { containerLog.error( sm.getString(""dataSourceRealm.getPassword.exception"", username)); } finally { it would be really helpful to have some details of what the SQLException is. I am getting this intermittently, and have resorted to subclassing getPassword() in an attempt to figure out what is going wrong."	2013-01-21 21:56:02	1358820000	resolved fixed	07a930d	1358960000	java/org/apache/catalina/realm/DataSourceRealm.java	1:java/org/apache/catalina/realm/DataSourceRealm.java
185	54450	Bug 54450 Injection fails when part of the servlet properties uses @Resource and the other uses 'injection-target'	"Hi, I have a servlet with: - annotated properties - and injection-target declarations in web.xml When I try to request this servlet I receive: javax.naming.NameNotFoundException: Name [envEntry1] is not bound in this Context. Unable to find [envEntry1]. at org.apache.naming.NamingContext.lookup(NamingContext.java:820) at org.apache.naming.NamingContext.lookup(NamingContext.java:154) at org.apache.naming.NamingContext.lookup(NamingContext.java:831) at org.apache.naming.NamingContext.lookup(NamingContext.java:168) at org.apache.catalina.core.DefaultInstanceManager.lookupMethodResource(DefaultInstanceManager.java:622) at org.apache.catalina.core.DefaultInstanceManager.processAnnotations(DefaultInstanceManager.java:466) at org.apache.catalina.core.DefaultInstanceManager.newInstance(DefaultInstanceManager.java:157) at org.apache.catalina.core.DefaultInstanceManager.newInstance(DefaultInstanceManager.java:138) at org.apache.catalina.core.StandardWrapper.loadServlet(StandardWrapper.java:1137) at org.apache.catalina.core.StandardWrapper.allocate(StandardWrapper.java:858) at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:136) at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:123) at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:472) at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:171) at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:99) at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:118) at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:407) at org.apache.coyote.http11.AbstractHttp11Processor.process(AbstractHttp11Processor.java:1004) at org.apache.coyote.AbstractProtocol$AbstractConnectionHandler.process(AbstractProtocol.java:589) at org.apache.tomcat.util.net.JIoEndpoint$SocketProcessor.run(JIoEndpoint.java:310) at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908) at java.lang.Thread.run(Thread.java:680) The problem is that when the application uses 'injection-target' declarations in org.apache.catalina.core.DefaultInstanceManager.populateAnnotationsCache(Class<?>, Map<String, String>) only the first setter method is evaluated and the rest are skipped. I would like to propose a patch and test case. I'm looking forward to your comments. Regards Violeta"	2013-01-18 18:18:08	1358550000	resolved fixed	ac78456	1358940000	java/org/apache/catalina/core/DefaultInstanceManager.java test/org/apache/catalina/startup/TestContextConfig.java test/org/apache/catalina/startup/TesterServletWithAnnotations.java	1:java/org/apache/catalina/core/DefaultInstanceManager.java 69:test/org/apache/catalina/startup/TestContextConfig.java 463:test/org/apache/catalina/startup/TesterServletWithAnnotations.java
186	54448	"Bug 54448 Field of primitive type, annotated with @Resource is not recognized as env entry"	"Hi, I have a servlet with one field of primitive type. The field is annotated with @Resource. public class MyServlet extends HttpServlet { @Resource(mappedName = ""1"") private int envEntry; protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException { ... } } When I request this servlet I receive the following exception: SEVERE: Allocate exception for servlet MyServlet javax.naming.NamingException: Cannot create resource instance at org.apache.naming.factory.ResourceEnvFactory.getObjectInstance(ResourceEnvFactory.java:117) at javax.naming.spi.NamingManager.getObjectInstance(NamingManager.java:304) at org.apache.naming.NamingContext.lookup(NamingContext.java:843) at org.apache.naming.NamingContext.lookup(NamingContext.java:154) at org.apache.naming.NamingContext.lookup(NamingContext.java:831) at org.apache.naming.NamingContext.lookup(NamingContext.java:168) at org.apache.catalina.core.DefaultInstanceManager.lookupFieldResource(DefaultInstanceManager.java:581) at org.apache.catalina.core.DefaultInstanceManager.processAnnotations(DefaultInstanceManager.java:470) at org.apache.catalina.core.DefaultInstanceManager.newInstance(DefaultInstanceManager.java:157) at org.apache.catalina.core.DefaultInstanceManager.newInstance(DefaultInstanceManager.java:138) at org.apache.catalina.core.StandardWrapper.loadServlet(StandardWrapper.java:1137) at org.apache.catalina.core.StandardWrapper.allocate(StandardWrapper.java:858) at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:136) at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:123) at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:472) at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:171) at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:99) at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:118) at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:407) at org.apache.coyote.http11.AbstractHttp11Processor.process(AbstractHttp11Processor.java:1004) at org.apache.coyote.AbstractProtocol$AbstractConnectionHandler.process(AbstractProtocol.java:589) at org.apache.tomcat.util.net.JIoEndpoint$SocketProcessor.run(JIoEndpoint.java:310) at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908) at java.lang.Thread.run(Thread.java:680) That's because in the method below the primitive types are not 'converted' to their corresponding wrappers and this field is interpreted not as env entry but as resource env ref. org.apache.catalina.startup.WebAnnotationSet.addResource(Context, Resource, String, String) I'm attaching a patch that solves this issue and a test case. I'm looking forward to your comments. Regards Violeta"	2013-01-17 21:48:35	1358480000	resolved fixed	74f5b3a	1358940000	java/org/apache/catalina/deploy/NamingResources.java java/org/apache/catalina/startup/WebAnnotationSet.java java/org/apache/catalina/util/Introspection.java test/org/apache/catalina/startup/TestContextConfig.java test/org/apache/catalina/startup/TesterServletWithAnnotations.java	15:java/org/apache/catalina/startup/WebAnnotationSet.java 38:java/org/apache/catalina/deploy/NamingResources.java 57:test/org/apache/catalina/startup/TestContextConfig.java 109:java/org/apache/catalina/util/Introspection.java
187	54324	Bug 54324 Support is required to disable TLS compression to prevent against CRIME attacks		2012-12-18 21:51:15	1355890000	resolved fixed	ab44514	1358450000	java/org/apache/coyote/http11/Http11AprProtocol.java java/org/apache/tomcat/jni/SSL.java java/org/apache/tomcat/util/net/AprEndpoint.java	23:java/org/apache/tomcat/jni/SSL.java 66:java/org/apache/tomcat/util/net/AprEndpoint.java 76:java/org/apache/coyote/http11/Http11AprProtocol.java
188	54438	Bug 54438 Bug fix 52953 introduces NullPointerException in RealmBase.java line 409 when user not found in JDBC		2013-01-16 21:14:31	1358390000	resolved fixed	c8d5d88	1358430000	java/org/apache/catalina/realm/RealmBase.java	1:java/org/apache/catalina/realm/RealmBase.java
189	54440	Bug 54440 TagPluginManager.init() throws NPE when used in Ant <jasper> task		2013-01-17 03:29:19	1358410000	resolved fixed	297b26a	1358430000	java/org/apache/jasper/JspC.java java/org/apache/jasper/servlet/JspCServletContext.java	3:java/org/apache/jasper/JspC.java 261:java/org/apache/jasper/servlet/JspCServletContext.java
190	54406	Bug 54406 NIO and BIO connectors handle unsupported SSL ciphers and sslEnabledProtocols differently	"The NIO and BIO connectors share (most of) a JSSE based SSLImplementation, but differ in their handling of the ciphers and sslEnabledProtocols attributes. The NIO connector sets the configured values for both attributes directly on the SSLEngine, which will fail immediately if any of them are unsupported. This makes creating a portable/superset collection of ciphers impossible - i.e. IBM JDKs do not support many of the cipher suite names used by JSSE and vice versa (usually TLS_ vs SSL_ prefixes differ) and the supported options differ between Java 6/7 etc. The BIO connector attempts to filter the specified values down to those supported by the SSL implementation, but has issues as well: if none of the specified ciphers/protocols are supported it will silently use the defaults of the SSL implementation, which can lead to unexpectedly (and unwittingly) insecure configurations. I propose to: - modify the NIO connector to use the same logic as the BIO connector to filter requested ciphers/protocols to supported values (by placing these operations on the SSLUtil interface). - modify the ciphers/protocols filtering logic to treat an explicit list of unsupported options as setting no supported ciphers/protocols and warn when this is done (it will also fail visibly with errors if SSL connections are attempted)."	2013-01-10 21:09:19	1357870000	resolved fixed	9f657ac	1358110000	java/org/apache/tomcat/util/net/NioEndpoint.java java/org/apache/tomcat/util/net/SSLUtil.java java/org/apache/tomcat/util/net/jsse/JSSESocketFactory.java	1:java/org/apache/tomcat/util/net/NioEndpoint.java 14:java/org/apache/tomcat/util/net/jsse/JSSESocketFactory.java 80:java/org/apache/tomcat/util/net/SSLUtil.java
191	54387	Bug 54387 Having servlets with same url should at least cause warning	"I've found this interesting ""mal functioning"" in a application where I just copied the mapping portion of web.xml for a new created servlet, but forgot to change de URI. Tomcat deployed the application without any warning, but when running the application only the last referenced servlet was working (like if the mapping of the first has been overwritten by the last in the XML file). I made additional tests using annotations in servlets, and the behavior of having more than one servlet with same mapping causes random access to one or another (I cannot determine a predictable way). In order to prevent breaking existing applications, I would like to have just a ""big warning"" in the log at startup and/or deployment of the application that have more than one servlet mapped to same URL. Examples of the problem: Example 1: Web.xml ... <servlet> <servlet-name>PrintDacteServlet</servlet-name> <servlet-class>br.com.simfreteV1.web.PrintDacteServlet</servlet-class> </servlet> <servlet> <servlet-name>CotacaoReportServlet</servlet-name> <servlet-class>br.com.simfreteV1.web.CotacaoReportServlet</servlet-class> </servlet> <servlet-mapping> <servlet-name>PrintDacteServlet</servlet-name> <url-pattern>/secure/relatorios/Action</url-pattern> </servlet-mapping> <servlet-mapping> <servlet-name>CotacaoReportServlet</servlet-name> <url-pattern>/secure/relatorios/Action</url-pattern> </servlet-mapping> ... Example 2: annotations in java servlet files @WebServlet(name = ""PdfReportPrint"", urlPatterns = {""/secure/relatorios/doReport""}) public class PdfReportPrint extends AbstractBaseServlet { ... @WebServlet(name = ""PrintBoletoServlet"", urlPatterns = {""/secure/relatorios/doReport""}) public class PrintBoletoServlet extends HttpServlet { ..."	2013-01-08 12:58:37	1357670000	resolved fixed	334c466	1357820000	java/org/apache/catalina/deploy/WebXml.java test/org/apache/catalina/deploy/TestWebXml.java	1:java/org/apache/catalina/deploy/WebXml.java 751:test/org/apache/catalina/deploy/TestWebXml.java
192	54379	Bug 54379 Implement support for post-construct and pre-destroy elements in web.xml		2013-01-07 04:07:15	1357550000	resolved fixed	71d075e	1357820000	java/org/apache/catalina/Context.java java/org/apache/catalina/core/DefaultInstanceManager.java java/org/apache/catalina/core/StandardContext.java java/org/apache/catalina/deploy/WebXml.java java/org/apache/catalina/startup/FailedContext.java java/org/apache/catalina/startup/WebRuleSet.java java/org/apache/catalina/util/Introspection.java test/org/apache/catalina/core/TestStandardContext.java test/org/apache/catalina/core/TesterContext.java test/org/apache/catalina/deploy/TestWebXml.java test/org/apache/catalina/startup/TestContextConfig.java test/org/apache/catalina/startup/TestWebRuleSet.java test/org/apache/catalina/startup/TesterServletWithLifeCycleMethods.java	1:java/org/apache/catalina/core/DefaultInstanceManager.java 2:java/org/apache/catalina/core/StandardContext.java 5:java/org/apache/catalina/deploy/WebXml.java 7:java/org/apache/catalina/Context.java 11:java/org/apache/catalina/startup/WebRuleSet.java 20:test/org/apache/catalina/startup/TestContextConfig.java 23:java/org/apache/catalina/startup/FailedContext.java 26:test/org/apache/catalina/core/TesterContext.java 156:test/org/apache/catalina/startup/TestWebRuleSet.java 297:test/org/apache/catalina/core/TestStandardContext.java 378:test/org/apache/catalina/deploy/TestWebXml.java 931:java/org/apache/catalina/util/Introspection.java
193	54382	Bug 54382 Nullpointer Exception after activating SSI and loading of any html-file with a specific comment	"1. Activate SSI on Tomcat and restart Tomcat 2. create an any html-file with a comment like this ""<!--#-->"" 3. put this html-file to the webapp folder of tomcat 4. when you now go to the html file via tomcat, you will get an Nullpointer Exception. The SSIServlet.class and other necessary SSI-classes cannot be found"	2013-01-07 23:56:21	1357620000	resolved fixed	d83a5e5	1357680000	java/org/apache/catalina/ssi/SSIProcessor.java	10:java/org/apache/catalina/ssi/SSIProcessor.java
194	54381	Bug 54381 Websocket StreamInbound never reports receipt of a Pong	"The tomcat websocket api now allows the send of a Ping frame by the server (as of 7.0.33), via WsOutbound, but never reports the receipt of a Pong. See StreamInbound in the onData() method... } else if (opCode == Constants.OPCODE_PONG) { // NO-OP } As the intended use of Pings is for heartbeat messages, allowing a Ping without informing the server extension of the returned Pong leaves out half the utility. I would suggest these changes to StreamInbound as a fix... 1) In the onData() method... } else if (opCode == Constants.OPCODE_PONG) { onPong(frame.getPayLoad()); } 2) Add a method onPong (ByteBuffer buffer)... protected void onPong(ByteBuffer buffer) { // NO-OP } ...which implementations may now override to handle Pong receipt and heartbeat logic. This is necessary as onData() is marked final, so there's no alternate workaround."	2013-01-07 19:44:37	1357610000	resolved fixed	5f7af1b	1357680000	java/org/apache/catalina/websocket/StreamHandler.java	3:java/org/apache/catalina/websocket/StreamHandler.java
195	54377	Bug 54377 RemoteIpFilter does not correctly set request attributes for AccessLog	"In RemoteIpFilter class, there is code that publishes the new request attributes to AccessLog (see below). 821 if (requestAttributesEnabled) { 822 request.setAttribute(AccessLog.REMOTE_ADDR_ATTRIBUTE, 823 request.getRemoteAddr()); 824 request.setAttribute(AccessLog.REMOTE_HOST_ATTRIBUTE, 825 request.getRemoteHost()); 826 request.setAttribute(AccessLog.PROTOCOL_ATTRIBUTE, 827 request.getProtocol()); 828 request.setAttribute(AccessLog.SERVER_PORT_ATTRIBUTE, 829 Integer.valueOf(request.getServerPort())); 830 } The problem is that the source values should come from xRequest, e.g. xRequest.getRemoteAddr() and xRequest.getRemoteHost(), etc. As it is written above, RemoteIpFilter simply republishes the current values, and AccessLog therefore does not display the correct values."	2013-01-05 23:52:37	1357450000	resolved fixed	95e6056	1357680000	java/org/apache/catalina/filters/RemoteIpFilter.java test/org/apache/catalina/filters/TestRemoteIpFilter.java test/org/apache/catalina/valves/TestRemoteIpValve.java	1:java/org/apache/catalina/filters/RemoteIpFilter.java 3:test/org/apache/catalina/filters/TestRemoteIpFilter.java 24:test/org/apache/catalina/valves/TestRemoteIpValve.java
196	54380	Bug 54380 In MapperListener.lifecycleEvent(..): check state of parent before calling registerWrapper()		2013-01-07 12:37:27	1357580000	resolved fixed	3a9990b	1357630000	java/org/apache/catalina/mapper/MapperListener.java	1:java/org/apache/catalina/mapper/MapperListener.java
197	54248	Bug 54248 Retrieving content that contains a BOM via request.getReader() issue	"If a request contains Content that includes the BOM - in my case Content-Type: application/xml; charset-utf-16 - and the content has a BOM (FF FE), when fetched utilizing the BufferedReader from getReader() - the first request serviced on the AJP thread works correctly (encoded correctly, only characters fetched), however, any subsequent request on the thread which includes the BOM has the BOM being delivered to the application. It appears via review of the Tomcat code, that the recycle() method in B2CConverter simply ensures the socket's data has been completely flushed and the underlying InputStream doesn't get reset (don't really know if there is a way to do this without re-instantiating it) to ensure subsequent requests BOM is consumed. I proved this as a test by adding a call to reset() within the recycle() method which re-instantiates the underlying InputStreams and the problem resolved itself. I've temporarily resolved the issue in my application code by using request.getInputStream() and using request.getCharacterEncoding() and encoding the content inside my application."	2012-12-05 11:56:08	1354730000	resolved fixed	f7fc27a	1357600000	java/org/apache/tomcat/util/buf/B2CConverter.java test/org/apache/tomcat/util/buf/TestB2CConverter.java	11:java/org/apache/tomcat/util/buf/B2CConverter.java
198	54284	Bug 54284 Util.objectNameValueNeedsQuote throws NPE for anonymous Filters	"How to reproduce? From inside the contextInitialized-Method of an ServletContextListener instance, call context.addFilter(null, new ArbitraryFilter(pathPrefix)).addMappingForUrlPatterns(null, false, pathPrefix); What happens? Dec 12, 2012 3:59:03 PM org.apache.catalina.core.StandardContext filterStart SEVERE: Exception starting filter null java.lang.NullPointerException at org.apache.tomcat.util.modeler.Util.objectNameValueNeedsQuote(Util.java:26) at org.apache.catalina.core.ApplicationFilterConfig.registerJMX(ApplicationFilterConfig.java:421) at org.apache.catalina.core.ApplicationFilterConfig.initFilter(ApplicationFilterConfig.java:282) at org.apache.catalina.core.ApplicationFilterConfig.<init>(ApplicationFilterConfig.java:108) at org.apache.catalina.core.StandardContext.filterStart(StandardContext.java:4650) at org.apache.catalina.core.StandardContext.startInternal(StandardContext.java:5306) at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:150) at org.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:901) at org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:877) at org.apache.catalina.core.StandardHost.addChild(StandardHost.java:633) at org.apache.catalina.startup.HostConfig.deployDescriptor(HostConfig.java:657) at org.apache.catalina.startup.HostConfig$DeployDescriptor.run(HostConfig.java:1637) at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471) at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:334) at java.util.concurrent.FutureTask.run(FutureTask.java:166) at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603) at java.lang.Thread.run(Thread.java:722) Dec 12, 2012 3:59:03 PM org.apache.catalina.core.StandardContext startInternal SEVERE: Error filterStart Dec 12, 2012 3:59:03 PM org.apache.catalina.core.StandardContext startInternal SEVERE: Context [] startup failed due to previous errors What should happen? Either - if null is not an allowed filter name, throw a IllegalArgumentException on context.addFilter(...) Or, if it is an allowed filter name, handle null-values gracefully"	2012-12-12 15:51:40	1355350000	resolved fixed	113c0bd	1357590000	java/org/apache/catalina/core/ApplicationContext.java java/org/apache/catalina/deploy/FilterDef.java java/org/apache/catalina/deploy/ServletDef.java test/org/apache/catalina/core/TestApplicationContext.java test/org/apache/catalina/deploy/TestFilterDef.java test/org/apache/catalina/deploy/TestServletDef.java	8:java/org/apache/catalina/core/ApplicationContext.java 208:java/org/apache/catalina/deploy/FilterDef.java 414:test/org/apache/catalina/core/TestApplicationContext.java 492:java/org/apache/catalina/deploy/ServletDef.java
199	54262	Bug 54262 An empty <absolute-ordering /> should turn off all web-fragments	"The use of an <absolute-ordering> element does disable ServletContainerInitializer classpath scanning as discussed also in issue 53619. However, it does seem to require having at least one web-fragment name to be listed. In other words I would this: <absolute-ordering /> To turn off all web-fragments since none are named. A workaround is to list a web-fragment even if it doesn't exist but that shouldn't be necessary."	2012-12-07 22:00:09	1354940000	resolved fixed	5418e2b	1357580000	java/org/apache/catalina/deploy/WebXml.java java/org/apache/catalina/startup/WebRuleSet.java test/org/apache/catalina/startup/TestContextConfig.java	3:java/org/apache/catalina/deploy/WebXml.java 4:java/org/apache/catalina/startup/WebRuleSet.java 44:test/org/apache/catalina/startup/TestContextConfig.java
200	54370	Bug 54370 NPE mapping method in EL		2013-01-03 14:20:38	1357240000	resolved fixed	5361e86	1357230000	java/org/apache/el/util/ReflectionUtil.java test/org/apache/el/util/TestReflectionUtil.java test/org/apache/el/util/Tester.java	532:java/org/apache/el/util/ReflectionUtil.java
201	54260	"Bug 54260 JSP unloading - NullPointerException when using "".tag"" files"		2012-12-07 17:58:25	1354920000	resolved fixed	94da507	1357220000	java/org/apache/jasper/util/FastRemovalDequeue.java	452:java/org/apache/jasper/util/FastRemovalDequeue.java
202	54256	Bug 54256 Enhance Exception reporting on JAR file error	"(I posted this to the mailing list on Oct 28, 2011, but didn't end up creating a report on it until now. I have the same error with Tomcat 7.) PROBLEM DESCRIPTION: I have an exception (appended below), and I think it would be nice to have more information about what is going on. If I had more context, it would help me find the cause of my problem much more quickly. For example, if the exception indicated what the file/resource that was having the problem was, it would speed up troubleshooting immensely. HOW TO REPRODUCE: In a JAR file contained in WAR file's WEB-INF/lib folder: Change the MANIFEST.MF file in the JAR file. Put in a line with ONLY ""Class-Path:"". Note there is no space after the period, which is what causes the error. During load of the application, the exception which I have appended at the end of this message will show up. SUGGESTED IMPROVEMENT: My suggestion would be to modify ExtensionValidator.validateApplication(...), around line 195. This is the location that actually knows about what the resource is. It would be nice if the IOException was caught, and information about the Resource was added to the exception, probably by wrapping the exception. Because I have not gone through the overhead of getting a version of Tomcat running from source, these changes have not been compiled and tested, but I think the suggestion is relatively straight-forward. Here are the suggested code changes: First code change - move the definition of ""resource"" outside of the try/catch: // Locate the Manifests for all bundled JARs Resource resource = null; // ADDED NamingEnumeration<Binding> ne = null; Second code change - make the existing declaration of ""resource"" just an assignment: resource = (Resource) obj; // MODIFIED inputStream = resource.streamContent(); Manifest jmanifest = getManifest(inputStream); Third code change: add a catch clause and re-throw: } catch (NamingException nex) { // Jump out of the check for this application because it // has no resources } catch (IOException ioex) { // ADDED throw new IOException(""validation problem in "" + resource.toString(), ioex); // ADDED } finally { The problem is that the resource may not have a proper toString(). I would suggest changing FileDirContext:898 (inner class=FileResource) to have a toString method, something along the lines of: public String toString() { // ADDED return file == null ? ""null"" : file.toString(); // ADDED } // ADDED Note: about this, in the original email thread, Konstantin Kolinko said: ""Not sure about FileResource.toString(), but adding a catch for IOException looks like doable."" Finally, here's the exception: 28-Oct-2011 11:03:03 AM org.apache.catalina.core.StandardContext startInternal SEVERE: Error in dependencyCheck java.io.IOException: invalid header field at java.util.jar.Attributes.read(Attributes.java:410) at java.util.jar.Manifest.read(Manifest.java:199) at java.util.jar.JarInputStream.<init>(JarInputStream.java:83) at java.util.jar.JarInputStream.<init>(JarInputStream.java:60) at org.apache.catalina.util.ExtensionValidator.getManifest(ExtensionValidator.java:394) at org.apache.catalina.util.ExtensionValidator.validateApplication(ExtensionValidator.java:195) at org.apache.catalina.core.StandardContext.startInternal(StandardContext.java:5037) at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:148) at org.apache.catalina.core.ContainerBase.startInternal(ContainerBase.java:1033) at org.apache.catalina.core.StandardHost.startInternal(StandardHost.java:774) at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:148) at org.apache.catalina.core.ContainerBase.startInternal(ContainerBase.java:1033) at org.apache.catalina.core.StandardEngine.startInternal(StandardEngine.java:291) at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:148) at org.apache.catalina.core.StandardService.startInternal(StandardService.java:443) at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:148) at org.apache.catalina.core.StandardServer.startInternal(StandardServer.java:727) at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:148) at org.apache.catalina.startup.Catalina.start(Catalina.java:621) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at java.lang.reflect.Method.invoke(Method.java:616) at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:322) at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:450) (And if only java.util.jar.Attributes.read reported WHICH attribute had the problem, we'd really be in business.)"	2012-12-06 20:44:32	1354840000	resolved fixed	0ae2f34	1357160000	java/org/apache/catalina/util/ExtensionValidator.java	1:java/org/apache/catalina/util/ExtensionValidator.java
203	54247	Bug 54247 Exception in JmxRemoteLifecycleListener.destroyServer		2012-12-05 10:00:36	1354720000	resolved fixed	29c4a0e	1357160000	java/org/apache/catalina/startup/Bootstrap.java	60:java/org/apache/catalina/startup/Bootstrap.java
204	54241	Bug 54241 NPE in BodyContentImpl		2012-12-04 07:53:25	1354630000	resolved fixed	ffc4525	1357140000	java/org/apache/jasper/runtime/JspWriterImpl.java test/org/apache/jasper/runtime/TestJspWriterImpl.java	5:java/org/apache/jasper/runtime/JspWriterImpl.java
205	54194	Bug 54194 NPE in DataSource.registerJmx() although DataSource is created with setJmxEnabled(false)		2012-11-23 14:35:58	1353700000	resolved fixed	1c61fb1	1354600000	modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/DataSource.java	1:modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/DataSource.java
206	54150	Bug 54150 SlowQueryReportJmx mbean deregistration failure due to NPE - properties not set during pool close callback	"Found while debugging version 7.0.29 I found that our SlowQueryReportJmx mbean was not being deregistered during webapp shutdown. I tracked this down to a NPE. The interceptor properties are not being set (as is done in setupConnection) prior to the pool close callback. ConnectionPool.close(boolean) poolClosed callback produces NPE in SlowQueryReportJmx. {code} PoolProperties.InterceptorDefinition[] proxies = getPoolProperties().getJdbcInterceptorsAsArray(); for (int i=0; i<proxies.length; i++) { try { proxies[i].getInterceptorClass().newInstance().poolClosed(this); }catch (Exception x) { log.debug(""Unable to inform interceptor of pool closure."",x); } } ... {code} NPE in SlowQueryReportJmx - null.containsKey {code} public ObjectName getObjectName(Class<?> clazz, String poolName) throws MalformedObjectNameException { ... NPE if (getProperties().containsKey(objectNameAttribute)) { ... {code} Sounds reasonable to set properties any time you need to instantiate interceptors. As is done in ConnectionPool.init(PoolConfiguration) {code} JdbcInterceptor interceptor = proxies[i].getInterceptorClass().newInstance(); interceptor.setProperties(proxies[i].getProperties()); interceptor.poolStarted(this); {code}"	2012-11-15 18:38:29	1353020000	resolved fixed	b021a22	1354600000	modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/ConnectionPool.java	2:modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/ConnectionPool.java
207	54220	Bug 54220 ErrorReportValve invoked on non-error responses too		2012-11-28 20:19:49	1354150000	resolved fixed	a2d1441	1354540000	java/org/apache/catalina/valves/ErrorReportValve.java test/org/apache/catalina/valves/TestErrorReportValve.java	1:java/org/apache/catalina/valves/ErrorReportValve.java 105:test/org/apache/catalina/valves/TestErrorReportValve.java
208	54217	Bug 54217 JDBC connection pool runs out of connections when Context reload=true is enabled in Tomcat		2012-11-28 10:35:43	1354120000	resolved fixed	a81538d	1354540000	modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/ConnectionPool.java	5:modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/ConnectionPool.java
209	54207	Bug 54207 javaURLContextFactory javadoc refers to defunct package names in initial context properties	"Javadoc for org.apache.naming.java.javaURLContextFactory: /** * Context factory for the ""java:"" namespace. * <p> * <b>Important note</b> : This factory MUST be associated with the ""java"" URL * prefix, which can be done by either : * <ul> * <li>Adding a * java.naming.factory.url.pkgs=org.apache.catalina.util.naming property * to the JNDI properties file</li> * <li>Setting an environment variable named Context.URL_PKG_PREFIXES with * its value including the org.apache.catalina.util.naming package name. * More detail about this can be found in the JNDI documentation : * {@link javax.naming.spi.NamingManager#getURLContext(java.lang.String, java.util.Hashtable)}.</li> * </ul> * * @author Remy Maucherat * @version $Id$ */ org.apache.catalina.util.naming is a very old package name. The correct name for both TC6 and TC7 is org.apache.naming ."	2012-11-26 02:10:22	1353910000	resolved fixed	d6b4740	1353930000	java/org/apache/naming/java/javaURLContextFactory.java	1:java/org/apache/naming/java/javaURLContextFactory.java
210	54198	Bug 54198 Improve HttpServletResponse#sendError(int) JavaDoc description	"This methods calls sendError(int, null) internally. Thus generating a HTML page without a message. This is not mentioned in the docs. One could assume that the response will be empty. One could duplicate the first paragraph of the sendError(int,String) method and alter it to ""The server defaults to creating the response to look like an HTML-formatted server error page with any specific message, setting the content type to ""text/html"",..."" further ""If an error-page declaration has been made for the web application corresponding to the status code passed in, it will be served back."" (Might need improvement in this case, I am not a native speaker). Moreover, I would add ""This method is effectively the same as calling sendError(int, null)"". Plus add @see #sendError(int,String). Though the JavaDocs seems to be a verbatim copy of Oracle's Servlet API, it does not reveal this information explicitly. Should I provide a patch if that doc is available in svn.apache.org?"	2012-11-23 22:33:12	1353730000	resolved fixed	3c13e90	1353930000	java/javax/servlet/http/HttpServletResponse.java	1:java/javax/servlet/http/HttpServletResponse.java
211	54144	"Bug 54144 Processing of java.io.Reader in ""Out"" tagplugin"		2012-11-14 08:38:29	1352900000	resolved fixed	7c4a841	1353110000	java/org/apache/jasper/tagplugins/jstl/Util.java java/org/apache/jasper/tagplugins/jstl/core/Out.java test/org/apache/jasper/tagplugins/jstl/core/TestOut.java	10:java/org/apache/jasper/tagplugins/jstl/core/Out.java 933:java/org/apache/jasper/tagplugins/jstl/Util.java
212	54143	Bug 54143 Add display of PermGen memory pool usage to the Status page of the Manager webapp		2012-11-13 22:39:44	1352860000	resolved fixed	9998c80	1352850000	java/org/apache/catalina/manager/StatusTransformer.java	18:java/org/apache/catalina/manager/StatusTransformer.java
213	54141	Bug 54141 Configuration does not allow Realms to be nested more than 2 levels deep		2012-11-13 01:55:35	1352790000	resolved fixed	2ed3d7d	1352820000	java/org/apache/catalina/startup/RealmRuleSet.java	32:java/org/apache/catalina/startup/RealmRuleSet.java
214	54087	Bug 54087 HTTP Connector incorrectly throws Exception on Invalid If-Modified-Since Header		2012-11-01 16:10:42	1351800000	resolved fixed	810732d	1352720000	java/javax/servlet/http/HttpServlet.java	9:java/javax/servlet/http/HttpServlet.java
215	54115	Bug 54115 Minor enhancements to HttpClient test helper class		2012-11-07 17:10:11	1352330000	resolved fixed	8f53c89	1352680000	test/org/apache/catalina/startup/SimpleHttpClient.java	118:test/org/apache/catalina/startup/SimpleHttpClient.java
216	54124	Bug 54124 wrong javax.servlet.async.request_uri information and javax.servlet.async.path_info is missing	"As it is clearly shown that org.apache.catalina.core.AsyncContextImpl.dispatch(ServletContext, String) @Override public void dispatch(ServletContext context, String path) { if (log.isDebugEnabled()) { logDebug(""dispatch ""); } check(); if (request.getAttribute(ASYNC_REQUEST_URI)==null) { request.setAttribute(ASYNC_REQUEST_URI, request.getRequestURI()+""?""+request.getQueryString()); request.setAttribute(ASYNC_CONTEXT_PATH, request.getContextPath()); request.setAttribute(ASYNC_SERVLET_PATH, request.getServletPath()); request.setAttribute(ASYNC_QUERY_STRING, request.getQueryString()); } .... } the value of ASYNC_REQUEST_URI is not the same as request.getRequestURI(). They must be equal to each other as defined by Servlet 3.0, 9.7.2 Dispatched Request Parameters. And ASYNC_PATH_INFO is missing."	2012-11-09 10:42:29	1352480000	resolved fixed	76f84eb	1352680000	java/org/apache/catalina/core/AsyncContextImpl.java	1:java/org/apache/catalina/core/AsyncContextImpl.java
217	54123	Bug 54123 servlet 3.0 spec violation in async timeout processing		2012-11-09 10:30:48	1352480000	resolved fixed	14637ef	1352680000	java/org/apache/catalina/core/AsyncContextImpl.java java/org/apache/catalina/core/StandardHostValve.java java/org/apache/coyote/AsyncStateMachine.java test/org/apache/catalina/core/TestAsyncContextImpl.java	2:java/org/apache/coyote/AsyncStateMachine.java 4:java/org/apache/catalina/core/AsyncContextImpl.java 12:test/org/apache/catalina/core/TestAsyncContextImpl.java 120:java/org/apache/catalina/core/StandardHostValve.java
218	54127	Bug 54127 WsOutbound is missing a ping method		2012-11-09 20:23:13	1352510000	resolved fixed	8fea85c	1352490000	java/org/apache/catalina/websocket/WsOutbound.java	1:java/org/apache/catalina/websocket/WsOutbound.java
219	54096	Bug 54096 env-entry rejects legal types	In servlet 3.0 the type in an env-entry can be any type which has a public constructor taking a single String (or character) as an argument. Tomcat only accepts a fixed list of types (see NamingContextListener from line 813). This is legal in web.xml but not accepted by tomcat: <env-entry> <env-entry-name>location</env-entry-name> <env-entry-type>java.io.File</env-entry-type> <env-entry-value>/var/lib/tomcat</env-entry-value> </env-entry>	2012-11-04 18:43:14	1352070000	resolved fixed	48314f9	1352490000	java/org/apache/catalina/core/NamingContextListener.java test/org/apache/catalina/core/TestNamingContextListener.java	2:java/org/apache/catalina/core/NamingContextListener.java 78:test/org/apache/catalina/core/TestNamingContextListener.java
220	54076	Bug 54076 SPNEGO authenticator's stateless-ness incompatible with stateful clients		2012-10-30 13:49:27	1351620000	resolved fixed	9f65875	1351980000	java/org/apache/catalina/authenticator/SpnegoAuthenticator.java	1:java/org/apache/catalina/authenticator/SpnegoAuthenticator.java
221	54068	Bug 54068 Web fragment sorting incorrectly detects circular reference		2012-10-30 05:30:27	1351590000	resolved fixed	07d343a	1351720000	java/org/apache/catalina/deploy/WebXml.java test/org/apache/catalina/deploy/TestWebXmlOrdering.java	4:test/org/apache/catalina/deploy/TestWebXmlOrdering.java 5:java/org/apache/catalina/deploy/WebXml.java
222	54067	Bug 54067 Upgrade Response with Transfer-Encoding: chunked invalid		2012-10-29 17:23:09	1351550000	resolved fixed	9308b3f	1351540000	java/org/apache/coyote/http11/AbstractHttp11Processor.java	4:java/org/apache/coyote/http11/AbstractHttp11Processor.java
223	53867	Bug 53867 Performance tuning solution for PageContextImpl.XmlEscape		2012-09-13 13:33:48	1347560000	resolved fixed	c40ca99	1351460000	java/org/apache/jasper/runtime/PageContextImpl.java test/org/apache/jasper/runtime/TesterPageContextImpl.java	1:java/org/apache/jasper/runtime/PageContextImpl.java
224	54054	Bug 54054 2 CGIServlet's with different Parameter passShellEnvironment		2012-10-26 07:24:33	1351250000	resolved fixed	05fe671	1351280000	java/org/apache/catalina/servlets/CGIServlet.java	1:java/org/apache/catalina/servlets/CGIServlet.java
225	54022	Bug 54022 CometEvent.END event is not sent on a suspended socket disconnect when running with Tomcat Native (tcnative-1.dll) on Windows Vista / Windows Server 2008 or newer.		2012-10-17 18:18:23	1350510000	resolved fixed	874c332	1351200000	java/org/apache/coyote/AbstractProtocol.java	71:java/org/apache/coyote/AbstractProtocol.java
226	54017	Bug 54017 new String instance is generated for constant string in Generator.convertString	"If the target class is ""Object.class"", the generator generates ""new String("" + quoted + "")""; as attribute value for Tag Handler. How about using quoted directly same as when the target class is ""Object.class""? Creating a String instance will cause some overhead from memory allocation and hash code recaluation when it is used as a key on HashMap. Here is the detail code, /* * @param c The target class to which to coerce the given string @param * s The string value @param attrName The name of the attribute whose * value is being supplied @param propEditorClass The property editor * for the given attribute @param isNamedAttribute true if the given * attribute is a named attribute (that is, specified using the * jsp:attribute standard action), and false otherwise */ private String convertString(Class<?> c, String s, String attrName, Class<?> propEditorClass, boolean isNamedAttribute) { String quoted = s; if (!isNamedAttribute) { quoted = quote(s); } if (propEditorClass != null) { String className = c.getCanonicalName(); return ""("" + className + "")org.apache.jasper.runtime.JspRuntimeLibrary.getValueFromBeanInfoPropertyEditor("" + className + "".class, \"""" + attrName + ""\"", "" + quoted + "", "" + propEditorClass.getCanonicalName() + "".class)""; } else if (c == String.class) { return quoted; } else if (c == boolean.class) { return JspUtil.coerceToPrimitiveBoolean(s, isNamedAttribute); } else if (c == Boolean.class) { return JspUtil.coerceToBoolean(s, isNamedAttribute); } else if (c == byte.class) { return JspUtil.coerceToPrimitiveByte(s, isNamedAttribute); } else if (c == Byte.class) { return JspUtil.coerceToByte(s, isNamedAttribute); } else if (c == char.class) { return JspUtil.coerceToChar(s, isNamedAttribute); } else if (c == Character.class) { return JspUtil.coerceToCharacter(s, isNamedAttribute); } else if (c == double.class) { return JspUtil.coerceToPrimitiveDouble(s, isNamedAttribute); } else if (c == Double.class) { return JspUtil.coerceToDouble(s, isNamedAttribute); } else if (c == float.class) { return JspUtil.coerceToPrimitiveFloat(s, isNamedAttribute); } else if (c == Float.class) { return JspUtil.coerceToFloat(s, isNamedAttribute); } else if (c == int.class) { return JspUtil.coerceToInt(s, isNamedAttribute); } else if (c == Integer.class) { return JspUtil.coerceToInteger(s, isNamedAttribute); } else if (c == short.class) { return JspUtil.coerceToPrimitiveShort(s, isNamedAttribute); } else if (c == Short.class) { return JspUtil.coerceToShort(s, isNamedAttribute); } else if (c == long.class) { return JspUtil.coerceToPrimitiveLong(s, isNamedAttribute); } else if (c == Long.class) { return JspUtil.coerceToLong(s, isNamedAttribute); } else if (c == Object.class) { return ""new String("" + quoted + "")""; } else { String className = c.getCanonicalName(); return ""("" + className + "")org.apache.jasper.runtime.JspRuntimeLibrary.getValueFromPropertyEditorManager("" + className + "".class, \"""" + attrName + ""\"", "" + quoted + "")""; } }"	2012-10-17 08:47:42	1350480000	resolved fixed	095a403	1351170000	java/org/apache/jasper/compiler/Generator.java	3:java/org/apache/jasper/compiler/Generator.java
227	54012	"Bug 54012 No ""pageContext"" in tag files' generated java code when using code generation by JSTL tagplugin ""Set"""		2012-10-16 09:01:56	1350390000	resolved fixed	a0ff3f9	1351170000	java/org/apache/jasper/compiler/Compiler.java java/org/apache/jasper/compiler/PageInfo.java java/org/apache/jasper/compiler/TagPluginManager.java java/org/apache/jasper/compiler/tagplugin/TagPluginContext.java java/org/apache/jasper/tagplugins/jstl/core/Set.java	2:java/org/apache/jasper/compiler/TagPluginManager.java 8:java/org/apache/jasper/compiler/tagplugin/TagPluginContext.java 15:java/org/apache/jasper/tagplugins/jstl/core/Set.java 26:java/org/apache/jasper/compiler/Compiler.java 58:java/org/apache/jasper/compiler/PageInfo.java
228	54045	Bug 54045 ReplicatedMap don't like TcpFailureDetector in static configuration	"Tribes stack using: * TcpPingInterceptor * TcpFailureDetector * MessageDispatchInterceptor * StaticMembershipInterceptor Do not work well in static cluster. First side (ie one thread): * call to TcpFailureDetector.heartbeat() * call to checkMembers(false) * call to performBasicCheck() in synchronized(membership) * in performBasicCheck, for a missing static node: * add ""missing"" member to membership with membership.memberAlive(m) * HERE THE SECOND THREAD HAVE SOME TIME TO WORK * check it with memberAlive(m) * remove it since if it doesn't exist Second side (ie another thread): * some call to channel.getMembers() like what the done by AbstractReplicatedMap * this call will call the TcpFailureDetector.getMembers() * this one could return a wrong value since it can contains unavailable nodes Note: * synchronize on membership isn't use by TcpFailureDetector in getMember(), getMembers(), hasMembers(), neither in Membership equivalent method (maybe because it's too heavy to lock every thread while the TcpFailureDetector check if node are alive). It must not be an issue for AbstractReplicatedMap since with or without TcpFailureDetector a node could disapear while replicated map try to use it. But ReplicatedMap use always Channel.SEND_OPTIONS_DEFAULT where the value is Channel.SEND_OPTIONS_USE_ACK. So a message sent to a missing node will fail with an exception. Personnaly I override TcpFailureDetector.heartbeat() to avoid performBasicCheck() if I use a static configuration (TcpPingInterceptor call performForcedCheck()). But this doesn't fix ReplicatedMap issue. Better fix could avoid adding missing member to membership list: * Add a method like memberAlive(MemberImpl) to Membership without side effect (add the member) * in TcpFailureDetector.performBasicCheck(): check this new method before adding the node This doesn't fix the AbstractReplicatedMap issue which work always with acknoledge from other nodes. Same code for Tomcat 6. best regards F.Arnoud"	2012-10-23 16:03:53	1351020000	resolved fixed	d2b41b5	1351170000	java/org/apache/catalina/tribes/group/interceptors/TcpFailureDetector.java	2:java/org/apache/catalina/tribes/group/interceptors/TcpFailureDetector.java
229	54010	Bug 54010 Suggestion for code improvement (avoiding potential bug)	"In connectors/jk/java/org/apache/jk/common/HandlerRequest.java coyote.Request's schemeMB is assigned in 2 places. 1st place: 400 boolean isSSL = msg.getByte() != 0; 401 if( isSSL ) { 402 // XXX req.setSecure( true ); 403 req.scheme().setString(""https""); 404 } 2nd place: 518 case AjpConstants.SC_A_SSL_CERT : 519 req.scheme().setString( ""https"" ); and similar assignments for SC_A_SSL_CIPHER and SC_A_SSL_SESSION cases below. It seems they do not make sense because the packet's 8-bit field is designated for telling whether it's SSL or not. So the 1st place is enough. Adding the 2nd place may pose potential bug in that a packet with the 8-bit SSL field being 0 and suffixes of SC_A_SSL_* key-value pairs can later incorrect trigger a wrong redirection message pointing to a https location. A simple correction is to honor the 8-bit SSL-field in packet and delete the 3 lines of 2nd place assigning ""https"". Even though the chances of such spurious packet is low, but it's best we can have threat-free, semantic-correct tomcat code. The same lines of code remain in 6.0 and 7.0. But maybe I misunderstand the code, in which case please kindly point out. Thanks."	2012-10-16 02:20:47	1350370000	resolved fixed	9f04094	1350950000	java/org/apache/coyote/ajp/AbstractAjpProcessor.java	2:java/org/apache/coyote/ajp/AbstractAjpProcessor.java
230	53993	Bug 53993 NPE in AccessLogValve	"During a load test of tomcat 7.0.30, we occasionally see NPEs from the AccessLogValve. Some of the requests that are being executed as part of the load test call HttpSession.invalidate. I mention this because the code in question appears to be susceptible to multithreaded manipulation of the session. I think the fix should be as simple as a check for null on the return value of request.getSessionInternal. Of course, our access log pattern includes logging the session id. java.lang.NullPointerException org.apache.catalina.valves.AccessLogValve$SessionIdElement.addElement(AccessLogValve.java:1733) org.apache.catalina.valves.AccessLogValve.log(AccessLogValve.java:955) org.apache.catalina.core.AccessLogAdapter.log(AccessLogAdapter.java:51) org.apache.catalina.core.StandardEngine.logAccess(StandardEngine.java:332) org.apache.catalina.core.ContainerBase.logAccess(ContainerBase.java:1270) org.apache.catalina.core.ContainerBase.logAccess(ContainerBase.java:1270) org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:441) org.apache.coyote.http11.AbstractHttp11Processor.process(AbstractHttp11Processor.java:1002) org.apache.coyote.AbstractProtocol$AbstractConnectionHandler.process(AbstractProtocol.java:585) org.apache.tomcat.util.net.JIoEndpoint$SocketProcessor.run(JIoEndpoint.java:312) java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110) java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603) java.lang.Thread.run(Thread.java:722) existing code for convenience: protected static class SessionIdElement implements AccessLogElement { @Override public void addElement(StringBuilder buf, Date date, Request request, Response response, long time) { if (request != null) { if (request.getSession(false) != null) { buf.append(request.getSessionInternal(false) // LINE 1733 .getIdInternal()); } else { buf.append('-'); } } else { buf.append('-'); } } } possible fix: ... if (request.getSession(false) != null) { Session internalSession = request.getSessionInternal(false); if (internalSession != null) { buf.append(internalSession.getIdInternal()); } else { buf.append('-'); } } else { buf.append('-'); }"	2012-10-11 19:56:38	1350000000	resolved fixed	39c4270	1350140000	java/org/apache/catalina/valves/AccessLogValve.java	1:java/org/apache/catalina/valves/AccessLogValve.java
231	53986	Bug 53986 Comment end tag preceded directly by a dash causes JSP fail compilation		2012-10-09 18:40:08	1349820000	resolved fixed	88d8dd5	1349880000	java/org/apache/jasper/compiler/JspReader.java test/org/apache/jasper/compiler/TestJspReader.java	8:java/org/apache/jasper/compiler/JspReader.java
232	53854	Bug 53854 DefaultServlet directory listings for aliased directories do not seem to work		2012-09-11 20:28:09	1347410000	resolved fixed	a3e0f09	1349030000	java/org/apache/naming/resources/BaseDirContext.java java/org/apache/naming/resources/FileDirContext.java java/org/apache/naming/resources/WARDirContext.java	28:java/org/apache/naming/resources/FileDirContext.java 56:java/org/apache/naming/resources/BaseDirContext.java 109:java/org/apache/naming/resources/WARDirContext.java
233	53863	Bug 53863 Unable to override default servlet when using Tomcat in embedded mode	"An implementation of ServletContainerInitializer can't add a mapping to ""/"" because the default servlet is loaded first, as first reported in 51278: public final class SampleServletContainerInitializer implements ServletContainerInitializer { public void onStartup(final Set<Class<?>> c, final ServletContext ctx) throws ServletException { final XmlWebApplicationContext appCtx = new XmlWebApplicationContext(); appCtx.setConfigLocation(""/WEB-INF/DispatcherServlet-servlet.xml""); final ServletRegistration.Dynamic dispatcher = ctx.addServlet(""DispatcherServlet"", new DispatcherServlet(appCtx)); dispatcher.setLoadOnStartup(1); final Set<String> conflictSet = dispatcher.addMapping(""/""); for (final String conflict : conflictSet) out.println(conflict); // prints ""/"" } } A test case follows attached."	2012-09-13 03:44:28	1347520000	resolved fixed	7f6f99e	1347820000	java/org/apache/catalina/startup/Tomcat.java	6:java/org/apache/catalina/startup/Tomcat.java
234	52777	Bug 52777 Automatically shut down old versions in parallel deployment	"Under parallel deployment, when an older version in an application has zero sessions, shut it down automatically to release tomcat and JVM resources. Christopher Schultz suggested these approaches might be possible (on the Tomcat user list): 1. Modify the parallel deployment code to register an MBean NotificationListener that filters for useful events (such as expiring session notifications on the outgoing webapp). 2. When the listener receives a notification, check the current state (e.g. session count=0; or, I suppose you could make this a part of your filter in step #1). If session count = 0, start a new thread that stops the outgoing webapp and de-registers the listener. Or. 1. Install a SessionEventListener that counts-down the sessions (you'll have to get the count from JMX, I suppose) until they equal 0, then starts a new thread that ... etc. Or. 1. Install a Timer thread that polls at intervals (1 minute?) to see if all the sessions are dead and then starts a thread ... etc. The first idea seems the cleanest, though Tomcat might not actually fire MBean events for things like session count changing."	2012-02-27 03:30:27	1330330000	resolved fixed	97cefcc	1347140000	java/org/apache/catalina/Host.java java/org/apache/catalina/core/StandardHost.java java/org/apache/catalina/startup/HostConfig.java	25:java/org/apache/catalina/startup/HostConfig.java 46:java/org/apache/catalina/core/StandardHost.java 245:java/org/apache/catalina/Host.java
235	53713	Bug 53713 Performance tuning solution for JspReader		2012-08-14 06:28:58	1344940000	resolved fixed	5fccf68	1346880000	java/org/apache/jasper/compiler/JspReader.java java/org/apache/jasper/compiler/Mark.java	1:java/org/apache/jasper/compiler/JspReader.java 5:java/org/apache/jasper/compiler/Mark.java
236	53828	Bug 53828 StreamInbound.closeOutboundConnection(WsFrame) closes with an opcode instead of status	"201 private void closeOutboundConnection(WsFrame frame) throws IOException { 202 try { 203 getWsOutbound().close(frame); 204 } finally { 205 doOnClose(Constants.OPCODE_CLOSE); 206 } 207 } Line 205 uses the close opcode instead of a valid status (Constants.STATUS_*). Not sure of the exact context of this called but it seems to only be called when the last frame from the client was a close frame, thus a Constants.STATUS_NORMAL may be in order. If not, the frame's opcode could be inspected and mapped to an appropriate status (normal, shutdown, etc...). Thanks, Michael"	2012-09-04 16:55:42	1346790000	resolved fixed	a81d941	1346790000	java/org/apache/catalina/websocket/StreamInbound.java	1:java/org/apache/catalina/websocket/StreamInbound.java
237	53801	Bug 53801 Nondeterministic behaviour of security constraints		2012-08-30 09:14:42	1346330000	resolved fixed	95d7a0f	1346370000	java/org/apache/catalina/realm/RealmBase.java	9:java/org/apache/catalina/realm/RealmBase.java
238	53800	"Bug 53800 Infinte loop cause by FileDirContext in a CDI/Weld project when using Eclipse's ""Server modules without publishing"""		2012-08-30 06:19:19	1346320000	resolved fixed	44eabba	1346310000	java/org/apache/naming/resources/FileDirContext.java	1:java/org/apache/naming/resources/FileDirContext.java
239	53793	Bug 53793 Change webapp links in Manager to point to /appname/ instead of /appname	"The first column of the table that lists Web Applications in Tomcat Manager webapp contains links to those applications, e.g. <a href=""/examples"">/examples</a> When the link is clicked and browser navigates to ""/examples"", it results in 302 redirect to ""/examples/"". It would be better to change that link to point directly to ""/examples/"". <a href=""/examples/"">/examples</a> I am changing the link address only, but not the text on it. That is because the ""Path"" of the web application displayed in that column (and used in Manager commands elsewhere) does not have the additional '/'."	2012-08-28 21:50:21	1346210000	resolved fixed	fcc3d65	1346190000	java/org/apache/catalina/manager/HTMLManagerServlet.java	8:java/org/apache/catalina/manager/HTMLManagerServlet.java
240	42181	Bug 42181 ArrayIndexOutOfBoundsException in parseChunkHeader	"Apr 22, 2007 11:53:32 AM org.apache.coyote.http11.Http11Processor process SEVERE: Error finishing request java.lang.ArrayIndexOutOfBoundsException: -28 at org.apache.coyote.http11.filters.ChunkedInputFilter.parseChunkHeader(ChunkedInputFilter.java:256) at org.apache.coyote.http11.filters.ChunkedInputFilter.doRead(ChunkedInputFilter.java:129) at org.apache.coyote.http11.filters.ChunkedInputFilter.end(ChunkedInputFilter.java:179) at org.apache.coyote.http11.InternalInputBuffer.endRequest(InternalInputBuffer.java:368) at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:894) at org.apache.coyote.http11.Http11BaseProtocol$Http11ConnectionHandler.processConnection(Http11BaseProtocol.java:664) at org.apache.tomcat.util.net.PoolTcpEndpoint.processSocket(PoolTcpEndpoint.java:527) at org.apache.tomcat.util.net.LeaderFollowerWorkerThread.runIt(LeaderFollowerWorkerThread.java:80) at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:684) at java.lang.Thread.run(Thread.java:595)"	2007-04-21 22:48:21	1177210000	resolved fixed	cd05aa1	1346110000	java/org/apache/coyote/http11/filters/ChunkedInputFilter.java java/org/apache/tomcat/util/buf/HexUtils.java test/org/apache/tomcat/util/buf/TestHexUtils.java	3:java/org/apache/coyote/http11/filters/ChunkedInputFilter.java 642:java/org/apache/tomcat/util/buf/HexUtils.java
241	53783	Bug 53783 Static resources and jsp files under WEB-INF/lib/*.jar!/META-INF/resources are not found		2012-08-27 13:32:16	1346090000	resolved fixed	6b934d8	1346090000	java/org/apache/catalina/startup/ContextConfig.java	1:java/org/apache/catalina/startup/ContextConfig.java
242	53758	Bug 53758 Dynamic Filter Registration mapping logic inverted	"In the class org.apache.catalina.core.ApplicationFilterRegistration, the methods addMappingForServletNames and addMappingForUrlPatterns have inverted logic on how to register the filter to the context. If the parameter isMatchAfter is passed as true, the filter is placed in the context using the addFilterMapBefore method. if (isMatchAfter) { context.addFilterMapBefore(filterMap); } else { context.addFilterMap(filterMap); } The logic should ultimate be (in both methods): if (!isMatchAfter) { context.addFilterMapBefore(filterMap); } else { context.addFilterMap(filterMap); } or if (isMatchAfter) { context.addFilterMap(filterMap); } else { context.addFilterMapBefore(filterMap); } svn rev on trunk is 1375614"	2012-08-21 19:59:03	1345590000	resolved fixed	8f169e4	1346020000	java/org/apache/catalina/core/ApplicationFilterRegistration.java	2:java/org/apache/catalina/core/ApplicationFilterRegistration.java
243	53725	Bug 53725 Some GZipped responses result in java.io.IOException: Corrupt GZIP trailer during gunzip.		2012-08-15 18:28:36	1345070000	resolved fixed	3dff241	1345930000	java/org/apache/coyote/http11/filters/FlushableGZIPOutputStream.java	17:java/org/apache/coyote/http11/filters/FlushableGZIPOutputStream.java
244	53714	Bug 53714 misleading log output when jarsToSkip cointains web-fragments	I have a jar which contains a web-fragment and no TLDs. When starting the server I get the Message: org.apache.jasper.compiler.TldLocationsCache tldScanJar INFO: At least one JAR was scanned for TLDs yet contained no TLDs. Enable debug logging for this logger for a complete list of JARs that were scanned but no TLDs were found in them. Skipping unneeded JARs during scanning can improve startup time and JSP compilation time. so far so good. When adding it to the tomcat.util.scan.DefaultJarScanner.jarsToSkip property the web-fragment won't be scanned either. The log message should only be printed when no TLDs and web-fragments could be found in the jar.	2012-08-14 09:13:38	1344950000	resolved fixed	15e8d8e	1345840000	java/org/apache/catalina/startup/Constants.java java/org/apache/catalina/startup/ContextConfig.java java/org/apache/catalina/startup/TldConfig.java java/org/apache/jasper/Constants.java java/org/apache/jasper/compiler/TldLocationsCache.java	1:java/org/apache/catalina/startup/ContextConfig.java 3:java/org/apache/jasper/compiler/TldLocationsCache.java 4:java/org/apache/catalina/startup/TldConfig.java 218:java/org/apache/jasper/Constants.java 293:java/org/apache/catalina/startup/Constants.java
245	53697	Bug 53697 java.lang.NullPointerException at org.apache.coyote.http11.Http11AprProcessor.actionInternal(Http11AprProcessor.java:277)	"I hit tomcat with ~20 different urls in ~2 seconds, test some functionality, wait ~3 minutes, then do it again and I always get this exception and then I get (intermitent) connection interrupted messages in the browser. Here's the full trace: Aug 10, 2012 6:33:14 PM org.apache.catalina.connector.CoyoteAdapter event SEVERE: null Aug 10, 2012 6:33:14 PM org.apache.catalina.connector.CoyoteAdapter event java.lang.NullPointerException at org.apache.coyote.http11.Http11AprProcessor.actionInternal(Http11AprProcessor.java:277) at org.apache.coyote.http11.AbstractHttp11Processor.action(AbstractHttp11Processor.java:846) at org.apache.coyote.Response.action(Response.java:172) at org.apache.catalina.connector.CoyoteAdapter.event(CoyoteAdapter.java:229) at org.apache.coyote.http11.Http11AprProcessor.event(Http11AprProcessor.java:133) at org.apache.coyote.AbstractProtocol$AbstractConnectionHandler.process(AbstractProtocol.java:581) at org.apache.tomcat.util.net.AprEndpoint$SocketProcessor.run(AprEndpoint.java:1770) at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603) at java.lang.Thread.run(Thread.java:722) Aug 10, 2012 6:33:14 PM org.apache.coyote.http11.Http11AprProcessor event SEVERE: Error processing request java.lang.NullPointerException at org.apache.coyote.http11.Http11AprProcessor.actionInternal(Http11AprProcessor.java:277) at org.apache.coyote.http11.AbstractHttp11Processor.action(AbstractHttp11Processor.java:846) at org.apache.coyote.Request.action(Request.java:346) at org.apache.catalina.connector.Request.getRemoteAddr(Request.java:1281) at org.apache.catalina.connector.Request.getRemoteHost(Request.java:1296) at org.apache.catalina.valves.AccessLogValve$HostElement.addElement(AccessLogValve.java:1327) at org.apache.catalina.valves.AccessLogValve.log(AccessLogValve.java:953) at org.apache.catalina.core.AccessLogAdapter.log(AccessLogAdapter.java:51) at org.apache.catalina.core.ContainerBase.logAccess(ContainerBase.java:1263) at org.apache.catalina.core.ContainerBase.logAccess(ContainerBase.java:1270) at org.apache.catalina.connector.CoyoteAdapter.event(CoyoteAdapter.java:250) at org.apache.coyote.http11.Http11AprProcessor.event(Http11AprProcessor.java:133) at org.apache.coyote.AbstractProtocol$AbstractConnectionHandler.process(AbstractProtocol.java:581) at org.apache.tomcat.util.net.AprEndpoint$SocketProcessor.run(AprEndpoint.java:1770) at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603) at java.lang.Thread.run(Thread.java:722) Additional information: - hp Proliant DL360 with two 3ghz processors - CentOS 6.3 - One app runs websockets under bleading edge Atmosphere and Grails - the 20 urls come from chrome and firefox, simulatneously"	2012-08-11 08:33:54	1344690000	resolved fixed	6c13431	1345070000	java/org/apache/coyote/http11/AbstractHttp11Processor.java java/org/apache/coyote/http11/Http11NioProcessor.java	3:java/org/apache/coyote/http11/AbstractHttp11Processor.java 14:java/org/apache/coyote/http11/Http11NioProcessor.java
246	53702	Bug 53702 Only the last url-pattern from jsp-property-group is processed		2012-08-12 14:54:17	1344800000	resolved fixed	e38a097	1345060000	java/org/apache/catalina/core/ApplicationJspPropertyGroupDescriptor.java java/org/apache/catalina/deploy/JspPropertyGroup.java java/org/apache/catalina/deploy/WebXml.java java/org/apache/catalina/startup/WebRuleSet.java	1:java/org/apache/catalina/deploy/JspPropertyGroup.java 2:java/org/apache/catalina/core/ApplicationJspPropertyGroupDescriptor.java 3:java/org/apache/catalina/deploy/WebXml.java 53:java/org/apache/catalina/startup/WebRuleSet.java
247	53654	Bug 53654 JSP file is always recompiled for using file based TLD URL	"Now, in Jasper codes, it only supports jar URL and relative URL, that may be enough for common web applications. While, it is possible that the third-party uses other protocol URL, like file: protocol based URL. So, the JSP files will be always recompiled for each access for the target page. The codes are located in Compiler.isOutDated() method. Is it possible to provide more generic handlering for the URL ?"	2012-08-05 14:47:43	1344190000	resolved fixed	1efc23d	1345050000	java/org/apache/jasper/compiler/Compiler.java	1:java/org/apache/jasper/compiler/Compiler.java
248	53624	Bug 53624 sendRedirect doesn't work after a dispatch through the AsyncContext		2012-07-30 19:07:39	1343690000	resolved fixed	e37b01e	1344980000	java/org/apache/catalina/core/ApplicationDispatcher.java	75:java/org/apache/catalina/core/ApplicationDispatcher.java
249	53701	Bug 53701 Javadoc fixes		2012-08-12 12:25:04	1344790000	resolved fixed	2a3b42d	1344970000	java/javax/servlet/ServletInputStream.java java/javax/servlet/ServletOutputStream.java java/javax/servlet/jsp/JspException.java java/org/apache/catalina/Executor.java java/org/apache/catalina/Manager.java java/org/apache/catalina/tribes/ErrorHandler.java java/org/apache/naming/SelectorContext.java java/org/apache/tomcat/util/http/fileupload/FileItem.java webapps/examples/WEB-INF/classes/compressionFilters/CompressionResponseStream.java	226:webapps/examples/WEB-INF/classes/compressionFilters/CompressionResponseStream.java 406:java/javax/servlet/jsp/JspException.java 631:java/org/apache/tomcat/util/http/fileupload/FileItem.java 644:java/org/apache/naming/SelectorContext.java 656:java/org/apache/catalina/Manager.java
250	53700	Bug 53700 InternalNioOutputBuffer unused (debug?) code	"The class InternalNioOutputBuffer includes the field: int total = 0; This is currently defined at line 227, which is between the Javadoc and method body to which the Javadoc applies, i.e. private synchronized int writeToSocket. This invalidates the method Javadoc. The field is used to keep a running total of bytes written by the method; however the field is not actually referenced - the System.out.println statement is commented out. The field and associated code shcould probably be deleted. If the field is to be kept, it should be private, and it should probably be changed to long, and of course should be moved so it does not invalidate the method Javadoc."	2012-08-12 11:17:07	1344780000	resolved fixed	a2ca744	1344970000	java/org/apache/coyote/http11/InternalNioOutputBuffer.java	1:java/org/apache/coyote/http11/InternalNioOutputBuffer.java
251	53574	"Bug 53574 metadata-complete=""true"" and servlet defined as jsp not working"	"We have a servlet defined as <servlet> <servlet-name>VersionInfoServlet</servlet-name> <jsp-file>/WEB-INF/svnrevision.jsp</jsp-file> </servlet> and mapped as <servlet-mapping> <servlet-name>VersionInfoServlet</servlet-name> <url-pattern>/svnrevision</url-pattern> </servlet-mapping> It worked fine. Then we changed metadata-complete to ""true"", and from now on we receive INFO: Marking servlet VersionInfoServlet as unavailable lip 20, 2012 11:05:36 AM org.apache.catalina.core.StandardWrapperValve invoke SEVERE: Allocate exception for servlet VersionInfoServlet javax.servlet.ServletException: No servlet class has been specified for servlet VersionInfoServlet at org.apache.catalina.core.StandardWrapper.loadServlet(StandardWrapper.java:1130) at org.apache.catalina.core.StandardWrapper.allocate(StandardWrapper.java:857) at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:136) at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:123) at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:168) at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:98) at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:118) at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:407) at org.apache.coyote.ajp.AjpNioProcessor.process(AjpNioProcessor.java:184) at org.apache.coyote.AbstractProtocol$AbstractConnectionHandler.process(AbstractProtocol.java:585) at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.run(NioEndpoint.java:1653) at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603) at java.lang.Thread.run(Thread.java:722)"	2012-07-20 09:35:23	1342790000	resolved fixed	f9b0182	1344710000	java/org/apache/catalina/startup/ContextConfig.java test/org/apache/catalina/startup/TestContextConfig.java	2:java/org/apache/catalina/startup/ContextConfig.java 134:test/org/apache/catalina/startup/TestContextConfig.java
252	53545	Bug 53545 jsp:forward action to static resources causes IllegalStateException when inside classic custom tag		2012-07-13 07:53:20	1342180000	resolved fixed	5a6b27b	1344680000	java/org/apache/jasper/runtime/PageContextImpl.java test/org/apache/jasper/runtime/TestPageContextImpl.java test/org/apache/tomcat/unittest/tags/Bug53545.java	22:java/org/apache/jasper/runtime/PageContextImpl.java
253	53541	"Bug 53541 Bug in virtual webapp feature. Custom tags badly supported. Error is ""org.apache.jasper.JasperException: The absolute uri: http://java.sun.com/jsp/jstl/core cannot be resolved in either web.xml or the jar files deployed with this application"		2012-07-12 18:16:08	1342130000	resolved fixed	432bd0f	1344630000	java/org/apache/naming/resources/VirtualDirContext.java	368:java/org/apache/naming/resources/VirtualDirContext.java
254	53481	Bug 53481 Support SSL_OP_CIPHER_SERVER_PREFERENCE / SSLHonorCipherOrder		2012-06-28 14:27:30	1340910000	resolved fixed	82e5dce	1344530000	java/org/apache/coyote/http11/Http11AprProtocol.java java/org/apache/tomcat/util/net/AprEndpoint.java	1:java/org/apache/tomcat/util/net/AprEndpoint.java 9:java/org/apache/coyote/http11/Http11AprProtocol.java
255	53641	Bug 53641 Wrong websocket's subprotocol implementation	"According to RFC6455 Section 4.3. the handling of subprotocol requests is not correct. It must be checked for ""Sec-WebSocket-Protocol"" instead of ""Sec-WebSocket-Protocol-Client"" in WebSocketServlet class."	2012-08-02 12:52:08	1343930000	resolved fixed	af45441	1344380000	java/org/apache/catalina/websocket/WebSocketServlet.java	1:java/org/apache/catalina/websocket/WebSocketServlet.java
256	53607	Bug 53607 No message set for PING: TcpPingInterceptor fail with NullPointerException in ChannelData.getDataPackageLength()	"I added data.setMessage(new XByteBuffer(TCP_PING_DATA, false)); to TcpPingInterceptor send ping message function by: protected void sendPingMessage(Member[] members) { if ( members == null || members.length == 0 ) return; ChannelData data = new ChannelData(true);//generates a unique Id data.setAddress(getLocalMember(false)); data.setTimestamp(System.currentTimeMillis()); data.setOptions(getOptionFlag()); data.setMessage(new XByteBuffer(TCP_PING_DATA, false)); try { super.sendMessage(members, data, null); }catch (ChannelException x) { log.warn(""Unable to send TCP ping."",x); } } error also for Tomcat 6 regards fred"	2012-07-26 18:33:54	1343340000	resolved fixed	57b56f2	1343720000	java/org/apache/catalina/tribes/group/interceptors/TcpPingInterceptor.java	1:java/org/apache/catalina/tribes/group/interceptors/TcpPingInterceptor.java
257	53606	Bug 53606 NullPointerException in TcpPingInterceptor	"start(int) method initializes failureDetector (resp. staticMembers) only if TcpFailureDetector (resp. StaticMembershipInterceptor) was found in channel interceptors stack. Without TcpFailureDetector (resp. StaticMembershipInterceptor), futur calls to sendPing() will fail because failureDetector (resp. staticMembers) wasn't initialized at least to new WeakReference<StaticMembershipInterceptor>(null). Fix: v1) initializes weak references containers: Replace: WeakReference<TcpFailureDetector> failureDetector = null; WeakReference<StaticMembershipInterceptor> staticMembers = null; for: WeakReference<TcpFailureDetector> failureDetector = new WeakReference<TcpFailureDetector>(); WeakReference<StaticMembershipInterceptor> staticMembers = new WeakReference<StaticMembershipInterceptor>(); v2) checks field before dereferencing it: sendPing becomes: protected void sendPing() { if (failureDetector!=null && failureDetector.get()!=null) { //we have a reference to the failure detector //piggy back on that dude failureDetector.get().checkMembers(true); }else { if (staticOnly && staticMembers!=null && staticMembers.get()!=null) { sendPingMessage(staticMembers.get().getMembers()); } else { sendPingMessage(getMembers()); } } } affect also tomcat 6 regards fred arnoud"	2012-07-26 16:15:05	1343330000	resolved fixed	eb9f94e	1343600000	java/org/apache/catalina/tribes/group/interceptors/TcpPingInterceptor.java	1:java/org/apache/catalina/tribes/group/interceptors/TcpPingInterceptor.java
258	53535	Bug 53535 Out of memory while performing ContextConfig.webConfig		2012-07-11 10:29:10	1342020000	resolved fixed	7db08d3	1343600000	java/org/apache/catalina/startup/ContextConfig.java	1:java/org/apache/catalina/startup/ContextConfig.java
259	53469	Bug 53469 possible bug in Response.normalize(CharChunk cc)	The Response.normalize(CharChunk cc) introduced in 7.0.28 introduced a bug. See Bug ID 53062 The URL that is being encoded is: ../../resources/org.apache.wicket.markup.html.WicketEventReference/wicket-event.js?w:lm=1340711670 which causes a IllegalArgumentException in this method java.lang.IllegalArgumentException at org.apache.catalina.connector.Response.normalize(Response.java:1799) at org.apache.catalina.connector.Response.toAbsolute(Response.java:1732) at org.apache.catalina.connector.Response.encodeURL(Response.java:1242) at org.apache.catalina.connector.ResponseFacade.encodeURL(ResponseFacade.java:406) at org.apache.wicket.protocol.http.WebResponse.encodeURL(WebResponse.java:149) at org.apache.wicket.protocol.http.request.WebRequestCodingStrategy.encode(WebRequestCodingStrategy.java:387) Running the same application in tomcat 7.0.27 and 6.0.18 works without issue	2012-06-26 12:45:09	1340730000	resolved fixed	9a80d06	1343590000	java/org/apache/catalina/connector/Response.java test/org/apache/catalina/connector/TestResponse.java	2:java/org/apache/catalina/connector/Response.java 28:test/org/apache/catalina/connector/TestResponse.java
260	53529	Bug 53529 Call interrupt() after InterruptedException instead interrupted()	In class: org\apache\catalina\tribes\group\GroupChannel.java line 692 org\apache\catalina\tribes\group\interceptors\NonBlockingCoordinator.java line 228 org\apache\catalina\tribes\group\interceptors\TcpPingInterceptor.java line 173 org\apache\catalina\tribes\membership\McastServiceImpl.java line 542 org\apache\juli\AsyncFileHandler.java line 124 line 146 org\apache\tomcat\util\net\AprEndpoint.java line 640 org\apache\tomcat\util\net\NioBlockingSelector.java line 112 line 177 org\apache\tomcat\util\threads\ThreadPoolExecutor.java line 187 Affect 7.0.29 (and previous release) but affect also Tomcat 6.	2012-07-10 11:27:42	1341930000	resolved fixed	3ea8285	1343430000	java/org/apache/catalina/tribes/group/GroupChannel.java java/org/apache/catalina/tribes/group/interceptors/NonBlockingCoordinator.java java/org/apache/catalina/tribes/group/interceptors/TcpPingInterceptor.java java/org/apache/catalina/tribes/membership/McastServiceImpl.java java/org/apache/juli/AsyncFileHandler.java java/org/apache/tomcat/util/net/AprEndpoint.java java/org/apache/tomcat/util/net/NioBlockingSelector.java java/org/apache/tomcat/util/threads/ThreadPoolExecutor.java	1:java/org/apache/catalina/tribes/membership/McastServiceImpl.java 2:java/org/apache/catalina/tribes/group/interceptors/TcpPingInterceptor.java 3:java/org/apache/catalina/tribes/group/GroupChannel.java 4:java/org/apache/tomcat/util/net/NioBlockingSelector.java 5:java/org/apache/tomcat/util/net/AprEndpoint.java 7:java/org/apache/catalina/tribes/group/interceptors/NonBlockingCoordinator.java 15:java/org/apache/juli/AsyncFileHandler.java 82:java/org/apache/tomcat/util/threads/ThreadPoolExecutor.java
261	53526	Bug 53526 .ConnectionPool.terminateTransaction unsafe == check of Boolean	"The method ConnectionPool.terminateTransaction(PooledConnection con) uses == to check the value of a Boolean, viz: if (con.getPoolProperties().getDefaultAutoCommit()==Boolean.FALSE) { This is not 100% safe - if the user sets the property as follows: String value; // e.g. derived from property file ... setDefaultAutoCommit(new Boolean(value)); then the condition will never be true, even if value=""false"". Although it is better to use Boolean.valueOf(value), which would not have the same problem, the code ought to work regardless."	2012-07-09 20:08:39	1341880000	resolved fixed	eac6366	1341930000	modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/ConnectionPool.java	1:modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/ConnectionPool.java
262	53523	Bug 53523 rollbackOnReturn/commitOnReturn does not work without defaultAutoCommit=false	"Hi, The properties rollbackOnReturn and commitOnReturn, which are critical for cleaning up connections after they are used and returned to the pool, does not work when the defaultAutoCommit property is not set or when it is set to true. The code segment at ConnectionPool class has this, protected boolean terminateTransaction(PooledConnection con) { try { if (con.getPoolProperties().getDefaultAutoCommit()==Boolean.FALSE) { .... The full logic is wrapped in that first if statement, and as I see, that is not correct. Because, the actual default auto commit value when we don't set this property can either be autoCommit true or false, which depends on the database driver. And also, even when we have a default setting provided, the user has the freedom to change the autoCommit flag to either true or false at the beginning when they get the connection from the pool. So we should not be reading the pool properties in this place, but just check the current live connection's autoCommit value and act accordingly. So I suppose the fix should be to simply remove the outer if statement. Cheers, Anjana."	2012-07-09 11:21:38	1341850000	resolved wontfix	f54bb45	1341860000	modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/PoolConfiguration.java	3:modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/PoolConfiguration.java
263	53513	Bug 53513 Race condition / out of order operation in session replication at node startup	"My configuration: 2 nodes running Tomcat 7.0.26 Using a custom session manager, which extends the DeltaManager My startInternal() method first calls super.startInternal(), then performs a few additional initializations. I reviewed the code of DeltaManager.startInternal(), and it calls getAllClusterSessions() which in turn calls waitForSendAllSessions(), which requires either getStateTransfered() to return true, or a timeout. So by this, I should be able to trust that as the second node starts, the initial sync up of all session data from the first node has completed prior to the startInternal() method exiting (and thus prior to my initializations). This is, however, not the case! I can confirm this by repeatedly logging the value of findSessions().length during my inializations, and see that number going up! There appears to be a race condition between the processing of the message containing the actual session data & the ""transfer complete"" message. After tracing this through a little further, I see the stateTransfered is set to true in the handleALL_SESSION_TRANSFERCOMPLETE() callback method. And that callback is being called PRIOR to the session data itself even being received! Here is the debug logging output (slightly scrubbed) which shows this out of order messaging: Jul 5, 2012 4:20:41 PM org.apache.catalina.ha.session.DeltaManager getAllClusterSessions INFO: Manager [wwwtest#], requesting session state from org.apache.catalina.tribes.membership.MemberImpl[...]. This operation will timeout if no session state has been received within 60 seconds. Jul 5, 2012 4:20:41 PM org.apache.catalina.ha.session.DeltaManager messageReceived FINE: Manager [wwwtest#]: Received SessionMessage of type=(SESSION-STATE-TRANSFERED) from [org.apache.catalina.tribes.membership.MemberImpl[...] Jul 5, 2012 4:20:41 PM org.apache.catalina.ha.session.DeltaManager handleALL_SESSION_TRANSFERCOMPLETE FINE: Manager [wwwtest#] received from node [[B@6789b939:4,000] session state transfered. Jul 5, 2012 4:20:41 PM org.apache.catalina.ha.session.DeltaManager messageReceived FINE: Manager [wwwtest#]: Received SessionMessage of type=(ALL-SESSION-DATA) from [org.apache.catalina.tribes.membership.MemberImpl[...] Jul 5, 2012 4:20:41 PM org.apache.catalina.ha.session.DeltaManager handleALL_SESSION_DATA FINE: Manager [wwwtest#]: received session state data"	2012-07-05 21:56:22	1341540000	resolved fixed	4c03dff	1341830000	java/org/apache/catalina/ha/tcp/SimpleTcpCluster.java	7:java/org/apache/catalina/ha/tcp/SimpleTcpCluster.java
264	53498	Bug 53498 Atomicity violation bugs because of misusing concurrent collections		2012-07-02 21:19:45	1341280000	resolved fixed	4aef8e3	1341440000	java/org/apache/catalina/core/ApplicationContext.java java/org/apache/catalina/ha/context/ReplicatedContext.java	7:java/org/apache/catalina/core/ApplicationContext.java 110:java/org/apache/catalina/ha/context/ReplicatedContext.java
265	45995	Bug 45995 RFE - MIME type extension not case sensitive	"Hi, On the dev-tomcat list I described in the topic ""Byte Serving and PDFs with the DefaultServlet"" an issue that I had with Tomcat to serve PDFs. Analysing the answers I could find that the matter was related to the case of the file extension. Today Tomcat is case sensitive for MIME type extensions. So the solution for me was enter two MIME specifications on the web.xml file. One is for ""pdf"" and another one for ""PDF"". This way I would like to ask for and request for enhancement to make Tomcat be able to, due a setup on configuration file, consider or not case for MIME type extensions. Regards, Vitor"	2008-10-13 04:32:38	1223890000	resolved fixed	f8e173b	1341220000	java/org/apache/catalina/core/StandardContext.java	1:java/org/apache/catalina/core/StandardContext.java
266	52135	Bug 52135 Global error page is not handled	"The new Servlet 3.0 global error page <error-page> <location>/error.jsp</location> </error-page> is not handled in Tomcat 7. On Glassfish 3 for example, it works fine."	2011-11-04 14:15:58	1320430000	resolved fixed	6213b38	1341060000	java/org/apache/catalina/core/StandardContext.java java/org/apache/catalina/core/StandardHostValve.java java/org/apache/catalina/deploy/ErrorPage.java test/org/apache/catalina/core/TestStandardHostValve.java	3:java/org/apache/catalina/core/StandardContext.java 4:java/org/apache/catalina/deploy/ErrorPage.java 6:java/org/apache/catalina/core/StandardHostValve.java
267	53467	Bug 53467 7.0.28 will no longer accept our jsp filenames		2012-06-25 21:56:46	1340680000	resolved fixed	4de4325	1340820000	java/org/apache/catalina/core/ApplicationContext.java test/org/apache/catalina/core/TestApplicationContext.java	17:java/org/apache/catalina/core/ApplicationContext.java 297:test/org/apache/catalina/core/TestApplicationContext.java
268	53416	Bug 53416 Two datasources with the same name in different web applications results in javax.management.InstanceAlreadyExistsException	"Deploy two different web applications onto Tomcat. Each web application has a resource that: * uses the Use Tomcat JDBC Connection Pool * has an identical name to the other one <Resource name=""jdbc/collision"" factory=""org.apache.tomcat.jdbc.pool.DataSourceFactory"" ... /> When starting the server you get a non fatal error in the logs InstanceAlreadyExistsException. Both applications appear to still work OK ERROR org.apache.tomcat.jdbc.pool.DataSource - Unable to register JDBC pool with JMX javax.management.InstanceAlreadyExistsException: tomcat.jdbc:name=""jdbc/soscvuk"",context=/,type=ConnectionPool,host=localhost,class=org.apache.tomcat.jdbc.pool. DataSource at com.sun.jmx.mbeanserver.Repository.addMBean(Repository.java:453) ~[na:1.6.0_32] at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.internal_addObject(DefaultMBeanServerInterceptor.java:1484) [na:1.6.0_32] at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.registerDynamicMBean(DefaultMBeanServerInterceptor.java:963) [na:1.6.0_32] at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.registerObject(DefaultMBeanServerInterceptor.java:917) [na:1.6.0_32] at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.registerMBean(DefaultMBeanServerInterceptor.java:312) [na:1.6.0_32] at com.sun.jmx.mbeanserver.JmxMBeanServer.registerMBean(JmxMBeanServer.java:482) [na:1.6.0_32] at org.apache.tomcat.jdbc.pool.DataSource.registerJmx(DataSource.java:135) [tomcat-jdbc.jar:na] at org.apache.tomcat.jdbc.pool.DataSource.preRegister(DataSource.java:102) [tomcat-jdbc.jar:na] at org.apache.tomcat.util.modeler.BaseModelMBean.preRegister(BaseModelMBean.java:1132) [tomcat-coyote.jar:7.0.27] at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.preRegisterInvoke(DefaultMBeanServerInterceptor.java:1010) [na:1.6.0_32] at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.registerDynamicMBean(DefaultMBeanServerInterceptor.java:938) [na:1.6.0_32] at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.registerObject(DefaultMBeanServerInterceptor.java:917) [na:1.6.0_32] at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.registerMBean(DefaultMBeanServerInterceptor.java:312) [na:1.6.0_32] at com.sun.jmx.mbeanserver.JmxMBeanServer.registerMBean(JmxMBeanServer.java:482) [na:1.6.0_32] at org.apache.tomcat.util.modeler.Registry.registerComponent(Registry.java:742) [tomcat-coyote.jar:7.0.27] at org.apache.catalina.core.NamingContextListener.addResource(NamingContextListener.java:1062) [catalina.jar:7.0.27] at org.apache.catalina.core.NamingContextListener.createNamingContext(NamingContextListener.java:671) [catalina.jar:7.0.27] at org.apache.catalina.core.NamingContextListener.lifecycleEvent(NamingContextListener.java:270) [catalina.jar:7.0.27] at org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:119) [catalina.jar:7.0.27] at org.apache.catalina.util.LifecycleBase.fireLifecycleEvent(LifecycleBase.java:90) [catalina.jar:7.0.27] at org.apache.catalina.core.StandardContext.startInternal(StandardContext.java:5161) [catalina.jar:7.0.27] at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:150) [catalina.jar:7.0.27] at org.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:895) [catalina.jar:7.0.27] at org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:871) [catalina.jar:7.0.27] at org.apache.catalina.core.StandardHost.addChild(StandardHost.java:615) [catalina.jar:7.0.27] at org.apache.catalina.startup.HostConfig.deployDescriptor(HostConfig.java:649) [catalina.jar:7.0.27] at org.apache.catalina.startup.HostConfig$DeployDescriptor.run(HostConfig.java:1585) [catalina.jar:7.0.27] at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:441) [na:1.6.0_32] at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303) [na:1.6.0_32] at java.util.concurrent.FutureTask.run(FutureTask.java:138) [na:1.6.0_32] at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886) [na:1.6.0_32] at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908) [na:1.6.0_32] at java.lang.Thread.run(Thread.java:662) [na:1.6.0_32]"	2012-06-14 13:37:06	1339700000	resolved fixed	ff9a272	1340820000	modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/DataSource.java	1:modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/DataSource.java
269	53465	"Bug 53465 mapped-name is read when in @Resource, but not when in web.xml"		2012-06-25 20:31:48	1340670000	resolved fixed	7ecd402	1340750000	java/org/apache/catalina/startup/WebRuleSet.java test/org/apache/naming/resources/TestNamingContext.java	23:test/org/apache/naming/resources/TestNamingContext.java 24:java/org/apache/catalina/startup/WebRuleSet.java
270	53460	Bug 53460 Use error handling when TooManyActiveSessionsException happens in JSP		2012-06-23 14:02:41	1340470000	resolved fixed	294c52b	1340740000	java/org/apache/jasper/compiler/Generator.java java/org/apache/jasper/runtime/JspFactoryImpl.java	70:java/org/apache/jasper/compiler/Generator.java 179:java/org/apache/jasper/runtime/JspFactoryImpl.java
271	53445	Bug 53445 Support consistent Jmx object naming strategy across managed resources	"Tomcat JDBC Pool Versions tested: 7.0.27 & 7.0.28 More of an inquiry. Let me preface by saying we have recently adopted this pool and are very pleased so far. Currently, Jmx managed resources like ConnectionPool and SlowQueryReportJmx are registered under the same domain (i.e. tomcat.jdbc). Some users may want to employ an alternate object naming strategy. With DataSource#createObjectName it is relatively easy to change the ConnectionPool ObjectName (i.e. subclass). However, with SlowQueryReportJmx, due to a static getObjectName method, it requires overriding additional methods which is less desirable. It appears that ConnectionPool has a constant POOL_JMX_TYPE_PREFIX. SlowQueryReportJmx appears to use this but DataSource does not? Is there any reason that the SlowQueryReportJmx#getObjectName method is static? What about registering an object naming strategy with the pool that the various components would use, facilitating consistency? This would mitigate the need to override just to alter the ObjectName. Reference: Spring MBean exporters and their ObjectNamingStrategy interface. Thanks."	2012-06-20 19:20:53	1340230000	resolved fixed	4e010fc	1340740000	modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/ConnectionPool.java modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/DataSource.java modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/interceptor/SlowQueryReportJmx.java modules/jdbc-pool/src/test/java/org/apache/tomcat/jdbc/test/TestSlowQueryReport.java	1:modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/ConnectionPool.java 3:modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/interceptor/SlowQueryReportJmx.java 8:modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/DataSource.java 16:modules/jdbc-pool/src/test/java/org/apache/tomcat/jdbc/test/TestSlowQueryReport.java
272	53430	Bug 53430 JVM crash at startup if TC-Native version is too old		2012-06-17 10:16:07	1339940000	resolved fixed	553259c	1340630000	java/org/apache/catalina/connector/Connector.java java/org/apache/coyote/AbstractProtocol.java java/org/apache/coyote/ProtocolHandler.java java/org/apache/coyote/ajp/AjpAprProtocol.java java/org/apache/coyote/http11/Http11AprProtocol.java	98:java/org/apache/coyote/ajp/AjpAprProtocol.java 102:java/org/apache/catalina/connector/Connector.java 103:java/org/apache/coyote/http11/Http11AprProtocol.java 581:java/org/apache/coyote/AbstractProtocol.java 678:java/org/apache/coyote/ProtocolHandler.java
273	53421	Bug 53421 BeanELResolver's inner class BeanProperty throws incorrect message while PropertyNotFound	"BeanELResolver's inner class BeanProperty(line: 264) has two methods (write, read) that will throw PropertyNotFoundException. And there current implementation are wrong: throw new PropertyNotFoundException(message(ctx, ""propertyNotWritable"", new Object[] { type.getName(), descriptor.getName() })); it should use owner.getName() instead of type.getName() because the assembled message will be: Property '[descriptor.getName()]' not readable on type [type.getName()] Here the descriptor.getName() means the property name, type.getName() means the property type's name and the owner.getName() means the property owner - bean's type name. Of course we developer would prefer to receive a message that tells us which bean type doesn't contain such property because this is a PropertyNotFoundException."	2012-06-15 13:54:17	1339780000	resolved fixed	8a13b39	1340460000	java/javax/el/BeanELResolver.java test/javax/el/TestBeanELResolver.java	1:java/javax/el/BeanELResolver.java
274	53450	Bug 53450 Deployment of an application with 'ROOT' context hangs forever	"Hi, The scenario is the following: - I have running Tomcat 7.0.28 - I deploy an application with 'ROOT' context - The deployment hangs forever. When taking a tread dump, the following is suspicious: ""localhost-startStop-2"" daemon prio=6 tid=0x0000000006607800 nid=0x2560 waiting on condition [0x0000000009ebf000] java.lang.Thread.State: WAITING (parking) at sun.misc.Unsafe.park(Native Method) - parking to wait for <0x00000007d80f0108> (a java.util.concurrent.locks.ReentrantReadWriteLock$NonfairSync) at java.util.concurrent.locks.LockSupport.park(LockSupport.java:158) at java.util.concurrent.locks.AbstractQueuedSynchronizer.parkAndCheckInterrupt(AbstractQueuedSynchronizer.java:811) at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireQueued(AbstractQueuedSynchronizer.java:842) at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquire(AbstractQueuedSynchronizer.java:1178) at java.util.concurrent.locks.ReentrantReadWriteLock$WriteLock.lock(ReentrantReadWriteLock.java:807) at org.apache.catalina.core.ContainerBase.removeContainerListener(ContainerBase.java:1071) at org.apache.catalina.core.StandardEngine$AccessLogListener.uninstall(StandardEngine.java:463) at org.apache.catalina.core.StandardEngine$AccessLogListener.containerEvent(StandardEngine.java:505) at org.apache.catalina.core.ContainerBase.fireContainerEvent(ContainerBase.java:1431) at org.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:907) at org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:875) at org.apache.catalina.core.StandardHost.addChild(StandardHost.java:618) at org.apache.catalina.startup.HostConfig.deployDirectory(HostConfig.java:1100) at org.apache.catalina.startup.HostConfig$DeployDirectory.run(HostConfig.java:1618) at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:441) at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303) at java.util.concurrent.FutureTask.run(FutureTask.java:138) at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908) at java.lang.Thread.run(Thread.java:662) As you can see - A read lock is acquired at org.apache.catalina.core.ContainerBase.fireContainerEvent(ContainerBase.java:1425) - Then every listener is invoked to process the container event - Then AccessLogListener is invoked org.apache.catalina.core.StandardEngine$AccessLogListener.uninstall(StandardEngine.java:463) - The latter causes a call for a write lock org.apache.catalina.core.ContainerBase.removeContainerListener(ContainerBase.java:1071) - Unfortunately in the ReentrantReadWriteLock it is stated that upgrade from read to write lock is not possible ""Reentrancy also allows downgrading from the write lock to a read lock, by acquiring the write lock, then the read lock and then releasing the write lock. However, upgrading from a read lock to the write lock is not possible."" Regards Violeta Georgieva"	2012-06-21 18:22:10	1340320000	resolved fixed	91a13d2	1340310000	java/org/apache/catalina/core/ContainerBase.java	1:java/org/apache/catalina/core/ContainerBase.java
275	53406	Bug 53406 Stack overflow in connector	"found against trunk on Jun 18, 2012 SEVERE: java.lang.StackOverflowError at org.apache.catalina.core.StandardContextValve.event(StandardContextValve.java:128) at org.apache.catalina.valves.ValveBase.event(ValveBase.java:204) at org.apache.catalina.core.StandardHostValve.event(StandardHostValve.java:223) at org.apache.catalina.valves.ValveBase.event(ValveBase.java:204) at org.apache.catalina.valves.ValveBase.event(ValveBase.java:204) at org.apache.catalina.core.StandardEngineValve.event(StandardEngineValve.java:110) at org.apache.catalina.connector.CoyoteAdapter.event(CoyoteAdapter.java:209) at org.apache.coyote.http11.Http11NioProcessor.event(Http11NioProcessor.java:124) at org.apache.coyote.AbstractProtocol$AbstractConnectionHandler.process(AbstractProtocol.java:569) at org.apache.coyote.http11.Http11NioProtocol$Http11ConnectionHandler.process(Http11NioProtocol.java:223) at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.run(NioEndpoint.java:1653) at org.apache.tomcat.util.net.NioEndpoint.processSocket(NioEndpoint.java:730) at org.apache.tomcat.util.net.NioEndpoint$Poller.add(NioEndpoint.java:1008) at org.apache.tomcat.util.net.NioEndpoint$Poller.add(NioEndpoint.java:999) at org.apache.coyote.http11.Http11NioProtocol$Http11ConnectionHandler.longPoll(Http11NioProtocol.java:277) at org.apache.coyote.AbstractProtocol$AbstractConnectionHandler.process(AbstractProtocol.java:596) at org.apache.coyote.http11.Http11NioProtocol$Http11ConnectionHandler.process(Http11NioProtocol.java:223) at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.run(NioEndpoint.java:1653) at org.apache.tomcat.util.net.NioEndpoint.processSocket(NioEndpoint.java:730) at org.apache.tomcat.util.net.NioEndpoint$Poller.add(NioEndpoint.java:1008) at org.apache.tomcat.util.net.NioEndpoint$Poller.add(NioEndpoint.java:999) at org.apache.coyote.http11.Http11NioProtocol$Http11ConnectionHandler.longPoll(Http11NioProtocol.java:277) at org.apache.coyote.AbstractProtocol$AbstractConnectionHandler.process(AbstractProtocol.java:596) at org.apache.coyote.http11.Http11NioProtocol$Http11ConnectionHandler.process(Http11NioProtocol.java:223) at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.run(NioEndpoint.java:1653) at org.apache.tomcat.util.net.NioEndpoint.processSocket(NioEndpoint.java:730) at org.apache.tomcat.util.net.NioEndpoint$Poller.add(NioEndpoint.java:1008) at org.apache.tomcat.util.net.NioEndpoint$Poller.add(NioEndpoint.java:999) at org.apache.coyote.http11.Http11NioProtocol$Http11ConnectionHandler.longPoll(Http11NioProtocol.java:277) at org.apache.coyote.AbstractProtocol$AbstractConnectionHandler.process(AbstractProtocol.java:596) at org.apache.coyote.http11.Http11NioProtocol$Http11ConnectionHandler.process(Http11NioProtocol.java:223) at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.run(NioEndpoint.java:1653) at org.apache.tomcat.util.net.NioEndpoint.processSocket(NioEndpoint.java:730) at org.apache.tomcat.util.net.NioEndpoint$Poller.add(NioEndpoint.java:1008) at org.apache.tomcat.util.net.NioEndpoint$Poller.add(NioEndpoint.java:999) at org.apache.coyote.http11.Http11NioProtocol$Http11ConnectionHandler.longPoll(Http11NioProtocol.java:277) at org.apache.coyote.AbstractProtocol$AbstractConnectionHandler.process(AbstractProtocol.java:596) at org.apache.coyote.http11.Http11NioProtocol$Http11ConnectionHandler.process(Http11NioProtocol.java:223) at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.run(NioEndpoint.java:1653) at org.apache.tomcat.util.net.NioEndpoint.processSocket(NioEndpoint.java:730) at org.apache.tomcat.util.net.NioEndpoint$Poller.add(NioEndpoint.java:1008) at org.apache.tomcat.util.net.NioEndpoint$Poller.add(NioEndpoint.java:999) at org.apache.coyote.http11.Http11NioProtocol$Http11ConnectionHandler.longPoll(Http11NioProtocol.java:277) at org.apache.coyote.AbstractProtocol$AbstractConnectionHandler.process(AbstractProtocol.java:596) at org.apache.coyote.http11.Http11NioProtocol$Http11ConnectionHandler.process(Http11NioProtocol.java:223) at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.run(NioEndpoint.java:1653) at org.apache.tomcat.util.net.NioEndpoint.processSocket(NioEndpoint.java:730) at org.apache.tomcat.util.net.NioEndpoint$Poller.add(NioEndpoint.java:1008) at org.apache.tomcat.util.net.NioEndpoint$Poller.add(NioEndpoint.java:999) at org.apache.coyote.http11.Http11NioProtocol$Http11ConnectionHandler.longPoll(Http11NioProtocol.java:277) at org.apache.coyote.AbstractProtocol$AbstractConnectionHandler.process(AbstractProtocol.java:596) at org.apache.coyote.http11.Http11NioProtocol$Http11ConnectionHandler.process(Http11NioProtocol.java:223) at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.run(NioEndpoint.java:1653) at org.apache.tomcat.util.net.NioEndpoint.processSocket(NioEndpoint.java:730) at org.apache.tomcat.util.net.NioEndpoint$Poller.add(NioEndpoint.java:1008) at org.apache.tomcat.util.net.NioEndpoint$Poller.add(NioEndpoint.java:999) at org.apache.coyote.http11.Http11NioProtocol$Http11ConnectionHandler.longPoll(Http11NioProtocol.java:277) at org.apache.coyote.AbstractProtocol$AbstractConnectionHandler.process(AbstractProtocol.java:596) at org.apache.coyote.http11.Http11NioProtocol$Http11ConnectionHandler.process(Http11NioProtocol.java:223) at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.run(NioEndpoint.java:1653) at org.apache.tomcat.util.net.NioEndpoint.processSocket(NioEndpoint.java:730) at org.apache.tomcat.util.net.NioEndpoint$Poller.add(NioEndpoint.java:1008) at org.apache.tomcat.util.net.NioEndpoint$Poller.add(NioEndpoint.java:999) at org.apache.coyote.http11.Http11NioProtocol$Http11ConnectionHandler.longPoll(Http11NioProtocol.java:277) at org.apache.coyote.AbstractProtocol$AbstractConnectionHandler.process(AbstractProtocol.java:596) at org.apache.coyote.http11.Http11NioProtocol$Http11ConnectionHandler.process(Http11NioProtocol.java:223) at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.run(NioEndpoint.java:1653) at org.apache.tomcat.util.net.NioEndpoint.processSocket(NioEndpoint.java:730) at org.apache.tomcat.util.net.NioEndpoint$Poller.add(NioEndpoint.java:1008) at org.apache.tomcat.util.net.NioEndpoint$Poller.add(NioEndpoint.java:999) at org.apache.coyote.http11.Http11NioProtocol$Http11ConnectionHandler.longPoll(Http11NioProtocol.java:277) at org.apache.coyote.AbstractProtocol$AbstractConnectionHandler.process(AbstractProtocol.java:596) at org.apache.coyote.http11.Http11NioProtocol$Http11ConnectionHandler.process(Http11NioProtocol.java:223) at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.run(NioEndpoint.java:1653) at org.apache.tomcat.util.net.NioEndpoint.processSocket(NioEndpoint.java:730) at org.apache.tomcat.util.net.NioEndpoint$Poller.add(NioEndpoint.java:1008) at org.apache.tomcat.util.net.NioEndpoint$Poller.add(NioEndpoint.java:999) at org.apache.coyote.http11.Http11NioProtocol$Http11ConnectionHandler.longPoll(Http11NioProtocol.java:277) at org.apache.coyote.AbstractProtocol$AbstractConnectionHandler.process(AbstractProtocol.java:596) at org.apache.coyote.http11.Http11NioProtocol$Http11ConnectionHandler.process(Http11NioProtocol.java:223) at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.run(NioEndpoint.java:1653) at org.apache.tomcat.util.net.NioEndpoint.processSocket(NioEndpoint.java:730) at org.apache.tomcat.util.net.NioEndpoint$Poller.add(NioEndpoint.java:1008) at org.apache.tomcat.util.net.NioEndpoint$Poller.add(NioEndpoint.java:999) at org.apache.coyote.http11.Http11NioProtocol$Http11ConnectionHandler.longPoll(Http11NioProtocol.java:277) at org.apache.coyote.AbstractProtocol$AbstractConnectionHandler.process(AbstractProtocol.java:596) at org.apache.coyote.http11.Http11NioProtocol$Http11ConnectionHandler.process(Http11NioProtocol.java:223) at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.run(NioEndpoint.java:1653) at org.apache.tomcat.util.net.NioEndpoint.processSocket(NioEndpoint.java:730) at org.apache.tomcat.util.net.NioEndpoint$Poller.add(NioEndpoint.java:1008) at org.apache.tomcat.util.net.NioEndpoint$Poller.add(NioEndpoint.java:999) at org.apache.coyote.http11.Http11NioProtocol$Http11ConnectionHandler.longPoll(Http11NioProtocol.java:277) at org.apache.coyote.AbstractProtocol$AbstractConnectionHandler.process(AbstractProtocol.java:596) at org.apache.coyote.http11.Http11NioProtocol$Http11ConnectionHandler.process(Http11NioProtocol.java:223)"	2012-06-13 03:51:40	1339570000	resolved fixed	ce24a10	1339600000	java/org/apache/coyote/http11/Http11AprProcessor.java java/org/apache/coyote/http11/Http11NioProcessor.java	3:java/org/apache/coyote/http11/Http11NioProcessor.java 17:java/org/apache/coyote/http11/Http11AprProcessor.java
276	52954	Bug 52954 Allowing for broken android HTTP DIGEST support		2012-03-21 06:53:16	1332330000	resolved fixed	bf41254	1339510000	java/org/apache/catalina/authenticator/DigestAuthenticator.java	14:java/org/apache/catalina/authenticator/DigestAuthenticator.java
277	53266	Bug 53266 ServletContainerInitializer will crash catalina if dependcy is not present.	"When using a ServletContainerInitializer with a HandlesTypes annotation if any of the classes specified in the HandlesTypes annotation are not available due to a missing jar file catalina will crash with a ""java.lang.ArrayStoreException: sun.reflect.annotation.TypeNotPresentExceptionProxy"". Caused by: java.lang.ArrayStoreException: sun.reflect.annotation.TypeNotPresentExceptionProxy at sun.reflect.annotation.AnnotationParser.parseClassArray(AnnotationParser.java:653) at sun.reflect.annotation.AnnotationParser.parseArray(AnnotationParser.java:460) at sun.reflect.annotation.AnnotationParser.parseMemberValue(AnnotationParser.java:286) at sun.reflect.annotation.AnnotationParser.parseAnnotation(AnnotationParser.java:222) at sun.reflect.annotation.AnnotationParser.parseAnnotations2(AnnotationParser.java:69) at sun.reflect.annotation.AnnotationParser.parseAnnotations(AnnotationParser.java:52) at java.lang.Class.initAnnotationsIfNecessary(Class.java:3070) at java.lang.Class.getAnnotation(Class.java:3029) at org.apache.catalina.startup.ContextConfig.processServletContainerInitializers(ContextConfig.java:1546) at org.apache.catalina.startup.ContextConfig.webConfig(ContextConfig.java:1222) at org.apache.catalina.startup.ContextConfig.configureStart(ContextConfig.java:855) at org.apache.catalina.startup.ContextConfig.lifecycleEvent(ContextConfig.java:345) at org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:119) at org.apache.catalina.util.LifecycleBase.fireLifecycleEvent(LifecycleBase.java:90) at org.apache.catalina.core.StandardContext.startInternal(StandardContext.java:5161) at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:150) ... 7 more Line where exception is thrown: ""HandlesTypes ht = sci.getClass().getAnnotation(HandlesTypes.class);"""	2012-05-20 14:32:34	1337540000	resolved fixed	37e8c59	1339450000	java/org/apache/catalina/startup/ContextConfig.java	1:java/org/apache/catalina/startup/ContextConfig.java
278	53398	Bug 53398 Incorrect tag on XML response when calling 'manager/status?XML=true'		2012-06-11 16:39:14	1339450000	resolved fixed	2bf1556	1339450000	java/org/apache/catalina/manager/StatusTransformer.java	28:java/org/apache/catalina/manager/StatusTransformer.java
279	52955	Bug 52955 Add a ThreadFactory implementation to the ExecutorService used to deploy applications		2012-03-21 07:55:31	1332330000	resolved fixed	d73c07a	1339250000	java/org/apache/catalina/core/ContainerBase.java	14:java/org/apache/catalina/core/ContainerBase.java
280	53374	Bug 53374 DataSourceFactory does not support commitOnReturn property	DataSourceFactory does not support commitOnReturn property. DataSourceFactory.ALL_PROPERTIES and DataSourceFactory.parsePoolProperties() omit commitOnReturn property.	2012-06-06 20:56:47	1339030000	resolved fixed	0290e57	1339160000	modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/DataSourceFactory.java	3:modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/DataSourceFactory.java
281	53373	Bug 53373 Allow whitespace around delimiters in <Context> aliases for readability		2012-06-06 20:01:27	1339030000	resolved fixed	cf703d2	1339010000	java/org/apache/naming/resources/BaseDirContext.java test/org/apache/naming/resources/TestNamingContext.java	11:java/org/apache/naming/resources/BaseDirContext.java 659:test/org/apache/naming/resources/TestNamingContext.java
282	53367	Bug 53367 Database failure may cause pool to hang	"during the con.connect(); call in the method protected PooledConnection borrowConnection(long now, PooledConnection con, String username, String password) in ConnectionPool.java There is no counting down the size of the pool. This means, if a connection failure happens here, the pool size remains the same. This means that 'size' will show the pool as full, but in reality the pool is empty"	2012-06-06 01:01:10	1338960000	resolved fixed	1412935	1338940000	modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/ConnectionPool.java modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/PooledConnection.java	1:modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/ConnectionPool.java 2:modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/PooledConnection.java
283	53032	Bug 53032 Ant Jasper task fails to run when using XML namespaces; no output; no errors		2012-04-03 21:41:35	1333500000	resolved fixed	957d33b	1338940000	java/org/apache/jasper/JspC.java	14:java/org/apache/jasper/JspC.java
284	53230	Bug 53230 Allow custom error mapping when Manager's maxActiveSessions is exceeded		2012-05-14 17:09:13	1337030000	resolved fixed	ea77dfb	1338930000	java/org/apache/catalina/session/ManagerBase.java java/org/apache/catalina/session/TooManyActiveSessionsException.java	1:java/org/apache/catalina/session/ManagerBase.java
285	53354	Bug 53354 <filter-mapping> doesn't find the @WebFilter(filterName)	"As it's not possible to specify the invocation order in a @WebFilter, users are forced to explicitly specify <filter-mapping> in web.xml. This works in combination with a @WebFilter(filterName) in Glassfish and JBoss AS as follows: @WebFilter(filterName=""filter1"") public class Filter1 implements Filter {} @WebFilter(filterName=""filter2"") public class Filter2 implements Filter {} with <filter-mapping> <filter-name>filter1</filter-name> <url-pattern>/url1/*</url-pattern> </filter-mapping> <filter-mapping> <filter-name>filter2</filter-name> <url-pattern>/url2/*</url-pattern> </filter-mapping> However it fails in Tomcat 7.0.27 with the following confusing exception (the <url-pattern> *is* been set) Caused by: java.lang.IllegalArgumentException: Filter mapping must specify either a <url-pattern> or a <servlet-name> at org.apache.catalina.core.StandardContext.validateFilterMap(StandardContext.java:3009) at org.apache.catalina.core.StandardContext.addFilterMap(StandardContext.java:2968) at org.apache.catalina.deploy.WebXml.configureContext(WebXml.java:1207) at org.apache.catalina.startup.ContextConfig.webConfig(ContextConfig.java:1294) at org.apache.catalina.startup.ContextConfig.configureStart(ContextConfig.java:855) at org.apache.catalina.startup.ContextConfig.lifecycleEvent(ContextConfig.java:345) at org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:119) at org.apache.catalina.util.LifecycleBase.fireLifecycleEvent(LifecycleBase.java:90) at org.apache.catalina.core.StandardContext.startInternal(StandardContext.java:5161) at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:150) ... 7 more"	2012-06-03 19:16:25	1338770000	resolved fixed	b82c47e	1338760000	java/org/apache/catalina/startup/ContextConfig.java	2:java/org/apache/catalina/startup/ContextConfig.java
286	53339	Bug 53339 ClassNotFoundException when using WebSocketServlet	"I'm trying to do a JNDI lookup inside the ""onOpen"" method of my StreamInbound class, but it gives me the exception below. The code works if I move my JNP JARs to the server lib instead of the webapp lib. The code also works fine from anywhere else, like in the ""doGet"" method. ERROR http-bio-8080-exec-3 Test javax.naming.NoInitialContextException: Cannot instantiate class: org.jnp.interfaces.NamingContextFactory [Root exception is java.lang.ClassNotFoundException: org.jnp.interfaces.NamingContextFactory] at javax.naming.spi.NamingManager.getInitialContext(NamingManager.java:657) at javax.naming.InitialContext.getDefaultInitCtx(InitialContext.java:288) at javax.naming.InitialContext.init(InitialContext.java:223) at javax.naming.InitialContext.<init>(InitialContext.java:197) at Test$TestStreamInbound.onOpen(Test.java:103) at org.apache.catalina.websocket.StreamInbound.onUpgradeComplete(StreamInbound.java:180) at org.apache.coyote.AbstractProtocol$AbstractConnectionHandler.process(AbstractProtocol.java:579) at org.apache.tomcat.util.net.JIoEndpoint$SocketProcessor.run(JIoEndpoint.java:307) at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908) at java.lang.Thread.run(Thread.java:662)"	2012-05-31 18:20:53	1338500000	resolved fixed	d713894	1338750000	java/org/apache/catalina/websocket/StreamInbound.java test/org/apache/catalina/websocket/TestWebSocket.java	2:java/org/apache/catalina/websocket/StreamInbound.java 96:test/org/apache/catalina/websocket/TestWebSocket.java
287	53008	Bug 53008 New test case for Basic Authenticator		2012-03-30 12:21:42	1333120000	resolved fixed	a1c6165	1338740000	test/org/apache/catalina/authenticator/TestNonLoginAndBasicAuthenticator.java	10:test/org/apache/catalina/authenticator/TestNonLoginAndBasicAuthenticator.java
288	53337	Bug 53337 IllegalStateException when trying to render a JSP after startAsync		2012-05-31 17:06:36	1338500000	resolved fixed	c6b691d	1338740000	java/org/apache/catalina/core/ApplicationDispatcher.java test/org/apache/catalina/core/TestAsyncContextImpl.java	30:test/org/apache/catalina/core/TestAsyncContextImpl.java 141:java/org/apache/catalina/core/ApplicationDispatcher.java
289	53301	Bug 53301 Servlet init method called twice with embedded Tomcat	"When using embedded Tomcat, the servlet init method is called twice by the container. This has been seen with an Apache DirectMemory unit test. I have checked with a normal Tomcat launched by the Tomcat Maven plugin (mvn tomcat7:run) and in this case, the init method is correctly called once."	2012-05-26 21:36:56	1338080000	resolved fixed	6ce3128	1338550000	java/org/apache/catalina/startup/Tomcat.java test/org/apache/catalina/startup/TestTomcat.java	2:test/org/apache/catalina/startup/TestTomcat.java 3:java/org/apache/catalina/startup/Tomcat.java
290	53285	Bug 53285 Web app configuration fails when security-role-ref does not contain role-link		2012-05-24 04:52:55	1337850000	resolved fixed	ad3b503	1338540000	java/org/apache/catalina/deploy/ServletDef.java java/org/apache/catalina/startup/WebRuleSet.java	2:java/org/apache/catalina/deploy/ServletDef.java 35:java/org/apache/catalina/startup/WebRuleSet.java
291	53342	"Bug 53342 If starting immediately after Tomcat stop fail, BindException will throw."	"e.g. When Context#stop throw LifecycleException, the main thread stops, but startStopThreads of Host/Engine will remain for a while. Because, startStopThreads is not a demon thread. As a result, even if a main thread stops, Acceptor Threads of 8080/8009 is not stopped. keepAliveTime for 10 seconds is set up now. === startStopExecutor = new ThreadPoolExecutor( getStartStopThreadsInternal(), getStartStopThreadsInternal(), 10, TimeUnit.SECONDS, startStopQueue); === Therefore, in order to avoid BindException, the waiting for 10 seconds is required. I think that I need to make startStopThreads into a demon thread. Best Regards."	2012-06-01 09:34:18	1338560000	resolved fixed	84342f5	1338540000	java/org/apache/catalina/core/ContainerBase.java	1:java/org/apache/catalina/core/ContainerBase.java
292	53225	"Bug 53225 IllegalStateException ""zip file closed"" with resource from webfragment jar if JreMemoryLeakPreventionListener is removed"		2012-05-12 20:32:50	1336870000	resolved fixed	e90cd4b	1338460000	java/org/apache/tomcat/util/scan/FileUrlJar.java	15:java/org/apache/tomcat/util/scan/FileUrlJar.java
293	53169	Bug 53169 [patch] don't do chunking with Connection: close		2012-05-01 09:35:06	1335880000	resolved fixed	280beac	1338390000	java/org/apache/coyote/http11/AbstractHttp11Processor.java test/org/apache/coyote/http11/TestAbstractHttp11Processor.java	70:java/org/apache/coyote/http11/AbstractHttp11Processor.java 353:test/org/apache/coyote/http11/TestAbstractHttp11Processor.java
294	53322	Bug 53322 Odd decapitalization when inferring JavaBean property from setter name for an injection target		2012-05-30 01:22:25	1338360000	resolved fixed	13100e9	1338340000	java/org/apache/catalina/core/DefaultInstanceManager.java	1:java/org/apache/catalina/core/DefaultInstanceManager.java
295	53180	Bug 53180 DefaultInstanceManager#populateAnnotationsCache - incomplete check is used when validating for a setter method		2012-05-02 20:27:25	1336000000	resolved fixed	39c8e18	1338300000	java/org/apache/catalina/core/DefaultInstanceManager.java	1:java/org/apache/catalina/core/DefaultInstanceManager.java
296	53081	Bug 53081 WebappClassLoader causes java.lang.OutOfMemoryError in findResourceInternal()		2012-04-13 21:46:53	1334370000	resolved fixed	5d12129	1338300000	java/org/apache/catalina/loader/WebappClassLoader.java	1:java/org/apache/catalina/loader/WebappClassLoader.java
297	53090	Bug 53090 Servlet superclass injection targets are ignored		2012-04-17 08:07:14	1334660000	resolved fixed	de1f763	1338240000	java/org/apache/catalina/core/DefaultInstanceManager.java	5:java/org/apache/catalina/core/DefaultInstanceManager.java
298	53074	Bug 53074 [websocket] java.net.SocketTimeoutException: Read timed caused by server.xml' connectTimeout	The default connectTimeout value is set to 20000 and cause issue with WebSocket connection java.net.SocketTimeoutException: Read timed out at java.net.SocketInputStream.socketRead0(Native Method) at java.net.SocketInputStream.read(SocketInputStream.java:129) at org.apache.coyote.http11.upgrade.UpgradeBioProcessor.read(UpgradeBioProcessor.java:75) at org.apache.catalina.websocket.WsFrame.nextFrame(WsFrame.java:213) at org.apache.catalina.websocket.WsInputStream.nextFrame(WsInputStream.java:68) at org.apache.catalina.websocket.StreamInbound.onData(StreamInbound.java:143) at org.apache.coyote.http11.upgrade.UpgradeProcessor.upgradeDispatch(UpgradeProcessor.java:83) at org.apache.coyote.AbstractProtocol$AbstractConnectionHandler.process(AbstractProtocol.java:563) at org.apache.tomcat.util.net.JIoEndpoint$SocketProcessor.run(JIoEndpoint.java:307) at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908) at java.lang.Thread.run(Thread.java:680) Increasing the value delay the issue (but the timeout should not occurs)	2012-04-13 13:45:11	1334340000	resolved fixed	098a647	1337960000	java/org/apache/catalina/websocket/StreamInbound.java java/org/apache/coyote/ajp/AjpAprProtocol.java java/org/apache/coyote/http11/Http11AprProtocol.java java/org/apache/coyote/http11/upgrade/UpgradeAprProcessor.java java/org/apache/coyote/http11/upgrade/UpgradeBioProcessor.java java/org/apache/coyote/http11/upgrade/UpgradeInbound.java java/org/apache/coyote/http11/upgrade/UpgradeNioProcessor.java java/org/apache/tomcat/util/net/AprEndpoint.java	5:java/org/apache/tomcat/util/net/AprEndpoint.java 7:java/org/apache/coyote/http11/upgrade/UpgradeBioProcessor.java 15:java/org/apache/catalina/websocket/StreamInbound.java 16:java/org/apache/coyote/http11/Http11AprProtocol.java 21:java/org/apache/coyote/ajp/AjpAprProtocol.java 31:java/org/apache/coyote/http11/upgrade/UpgradeInbound.java 46:java/org/apache/coyote/http11/upgrade/UpgradeAprProcessor.java 102:java/org/apache/coyote/http11/upgrade/UpgradeNioProcessor.java
299	53254	Bug 53254 Support for purging connection pool	"It is a common function of a connection pool to support ""purging"" the pool of all current connections and getting all fresh connections. Oracle UCP and Websphere pools are two such examples. It would be great if this pool supported such an operation as well. It would be useful if the operation were exposed through JMX too."	2012-05-17 17:59:28	1337290000	resolved fixed	f170929	1337360000	modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/ConnectionPool.java modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/DataSourceProxy.java modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/PooledConnection.java modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/jmx/ConnectionPool.java modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/jmx/ConnectionPoolMBean.java modules/jdbc-pool/src/test/java/org/apache/tomcat/jdbc/test/PoolPurgeTest.java	1:modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/ConnectionPool.java 2:modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/jmx/ConnectionPool.java 3:modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/PooledConnection.java 4:modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/DataSourceProxy.java 128:modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/jmx/ConnectionPoolMBean.java
300	53067	Bug 53067 WebSocket implementation issue with wrapped requests		2012-04-12 17:56:58	1334270000	resolved fixed	111dc8e	1336860000	java/org/apache/catalina/websocket/WebSocketServlet.java	2:java/org/apache/catalina/websocket/WebSocketServlet.java
301	53063	Bug 53063 Inconsistency in documentation regarding Connector's maxConnections property		2012-04-11 13:14:14	1334160000	resolved fixed	be365e5	1336680000	java/org/apache/tomcat/util/net/AbstractEndpoint.java java/org/apache/tomcat/util/net/JIoEndpoint.java	1:java/org/apache/tomcat/util/net/AbstractEndpoint.java 3:java/org/apache/tomcat/util/net/JIoEndpoint.java
302	53087	Bug 53087 BackupManager does not replicate session access time.		2012-04-17 05:44:46	1334660000	resolved fixed	48b9153	1334640000	java/org/apache/catalina/ha/session/DeltaSession.java java/org/apache/catalina/tribes/tipis/AbstractReplicatedMap.java java/org/apache/catalina/tribes/tipis/ReplicatedMapEntry.java	2:java/org/apache/catalina/ha/session/DeltaSession.java 3:java/org/apache/catalina/tribes/tipis/AbstractReplicatedMap.java 37:java/org/apache/catalina/tribes/tipis/ReplicatedMapEntry.java
303	53056	Bug 53056 Add APR version number to tcnative version INFO log message	"When tcnative starts, it emits information like this to catalina.out: pr 10, 2012 4:54:55 PM org.apache.catalina.core.AprLifecycleListener init INFO: Loaded APR based Apache Tomcat Native library 1.1.23. Apr 10, 2012 4:54:55 PM org.apache.catalina.core.AprLifecycleListener init INFO: APR capabilities: IPv6 [true], sendfile [true], accept filters [false], random [true]. It would be nice if the APR version in use could also be displayed as well as the tcnative version. Maybe the OpenSSL version, too."	2012-04-10 20:58:50	1334110000	resolved fixed	df88ecb	1334090000	java/org/apache/catalina/core/AprLifecycleListener.java	1:java/org/apache/catalina/core/AprLifecycleListener.java
304	50864	Bug 50864 Reconfigure pool on the fly using JMX		2011-03-03 11:15:31	1299170000	resolved fixed	518662f	1334080000	modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/ConnectionPool.java modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/PoolProperties.java modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/jmx/ConnectionPool.java	1:modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/ConnectionPool.java 2:modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/jmx/ConnectionPool.java 6:modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/PoolProperties.java
305	52998	Bug 52998 Performance issue with ExpressionFactory.newInstance()		2012-03-28 21:16:03	1332980000	resolved fixed	7da5fa9	1333140000	java/javax/el/ExpressionFactory.java	1:java/javax/el/ExpressionFactory.java
306	53001	Bug 53001 Behaviour of ResourceBundleELResolver		2012-03-29 09:41:39	1333030000	resolved fixed	1aced29	1333130000	test/javax/el/TestResourceBundleELResolver.java	
307	52974	Bug 52974 NameNotFoundException is thrown when field/method is annotated with @Resource annotation		2012-03-22 20:43:20	1332460000	resolved fixed	67a926c	1332880000	java/org/apache/catalina/startup/WebAnnotationSet.java	31:java/org/apache/catalina/startup/WebAnnotationSet.java
308	52833	Bug 52833 NPE with 7.0.26	"Upgrading the maven plugin 7.0.26, the goal which runs tomcat with a conf dir (not the embed version) generate the following NPE Log: at org.apache.catalina.util.LifecycleBase.stop(LifecycleBase.java:236) at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:141) at org.apache.catalina.startup.Catalina.start(Catalina.java:645) at org.apache.tomcat.maven.plugin.tomcat7.run.AbstractRunMojo.startContainer(AbstractRunMojo.java:679) at org.apache.tomcat.maven.plugin.tomcat7.run.AbstractRunMojo.execute(AbstractRunMojo.java:365) at org.apache.maven.plugin.DefaultBuildPluginManager.executeMojo(DefaultBuildPluginManager.java:101) at org.apache.maven.lifecycle.internal.MojoExecutor.execute(MojoExecutor.java:209) at org.apache.maven.lifecycle.internal.MojoExecutor.execute(MojoExecutor.java:153) at org.apache.maven.lifecycle.internal.MojoExecutor.execute(MojoExecutor.java:145) at org.apache.maven.lifecycle.internal.LifecycleModuleBuilder.buildProject(LifecycleModuleBuilder.java:84) at org.apache.maven.lifecycle.internal.LifecycleModuleBuilder.buildProject(LifecycleModuleBuilder.java:59) at org.apache.maven.lifecycle.internal.LifecycleStarter.singleThreadedBuild(LifecycleStarter.java:183) at org.apache.maven.lifecycle.internal.LifecycleStarter.execute(LifecycleStarter.java:161) at org.apache.maven.DefaultMaven.doExecute(DefaultMaven.java:320) at org.apache.maven.DefaultMaven.execute(DefaultMaven.java:156) at org.apache.maven.cli.MavenCli.execute(MavenCli.java:544) at org.apache.maven.cli.MavenCli.doMain(MavenCli.java:197) at org.apache.maven.cli.MavenCli.main(MavenCli.java:141) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at java.lang.reflect.Method.invoke(Method.java:597) at org.codehaus.plexus.classworlds.launcher.Launcher.launchEnhanced(Launcher.java:290) at org.codehaus.plexus.classworlds.launcher.Launcher.launch(Launcher.java:230) at org.codehaus.plexus.classworlds.launcher.Launcher.mainWithExitCode(Launcher.java:409) at org.codehaus.plexus.classworlds.launcher.Launcher.main(Launcher.java:352)"	2012-03-05 23:28:06	1331010000	resolved fixed	6a8e480	1332870000	java/org/apache/catalina/core/StandardServer.java	19:java/org/apache/catalina/core/StandardServer.java
309	52066	Bug 52066 ConnectionPool.borrowConnection swallows interrupt state.	"In this code snippet starting on line 6.15 of ConnectionPool.java version 7.0.22 try { //retrieve an existing connection con = idle.poll(timetowait, TimeUnit.MILLISECONDS); } catch (InterruptedException ex) { Thread.interrupted();//clear the flag, and bail out SQLException sx = new SQLException(""Pool wait interrupted.""); sx.initCause(ex); throw sx; } finally { waitcount.decrementAndGet(); } The line marked '//clear the flag, and bail out' is wrong, because after that there is no way for calling code to find out that the thread has been interrupted. The correct behavior should be Thread.currentThread( ).interrupt( ); Here is the excerpt from the Biran Goetz's ""Java Concurrency in Practice"" chapter 5.4. <!START QUOTATION> For library code there are basically two choices: -- Propagate the InterruptedException. This is often the most sensible policy if you can get away with it -- just propagate the InterruptedException to your caller. This could involve not catching InterruptedException, or catching it and throwing it again after performing some brief activity-specific cleanup. -- Restore the interrupt. Sometimes you cannot throw InterruptedException, for instance when your code is part of a Runnable. In these situations, you must catch InterruptedException and restore the interrupted status by calling interrupt on the current thread, so that code higher up the call stack can see that an interrupt was issued. <!END QUOTATION> In the case of borrowConnection, #1 is not really a choice, as it is running in the confines of JDBC interface. But it can definitely restore the interrupt status of the thread."	2011-10-20 19:28:24	1319150000	resolved fixed	fe16ac2	1332870000	modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/ConnectionPool.java modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/DataSourceProxy.java modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/PoolConfiguration.java modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/PoolProperties.java modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/jmx/ConnectionPool.java	1:modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/ConnectionPool.java 2:modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/jmx/ConnectionPool.java 5:modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/DataSourceProxy.java 15:modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/PoolConfiguration.java 24:modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/PoolProperties.java
310	52957	Bug 52957 ClassCastException while removing Valve		2012-03-21 12:47:49	1332350000	resolved fixed	d5cee34	1332430000	java/org/apache/catalina/core/StandardPipeline.java	5:java/org/apache/catalina/core/StandardPipeline.java
311	52839	Bug 52839 New unit test for DigestAuthenticator and SingleSignOn		2012-03-06 16:12:53	1331070000	resolved fixed	c0f1bb9	1332280000	test/org/apache/catalina/authenticator/TestSSOnonLoginAndDigestAuthenticator.java	
312	50860	Bug 50860 In case of invalid or empty slqQuery connection are always invalidated without usefull information	"The code is (in PooledConnection.java#validate(int validateAction,String sql) ) Statement stmt = null; try { stmt = connection.createStatement(); stmt.execute(query); stmt.close(); this.lastValidated = now; return true; } catch (Exception ignore) { if (log.isDebugEnabled()) log.debug(""Unable to validate object:"",ignore); if (stmt!=null) try { stmt.close();} catch (Exception ignore2){/*NOOP*/} } return false; So in the case of null or invalid query (connection is always invalidated : seems normal :-) ). But without any usefull message (except if you use debug : but seems complicated in a production env). So IMHO adding a log.warning in case of null query could be usefull."	2011-03-03 06:51:14	1299150000	resolved fixed	e092870	1332260000	modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/DataSourceProxy.java modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/PoolConfiguration.java modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/PoolProperties.java modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/PooledConnection.java modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/jmx/ConnectionPool.java	1:modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/PooledConnection.java 18:modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/DataSourceProxy.java 20:modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/PoolProperties.java 30:modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/PoolConfiguration.java 46:modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/jmx/ConnectionPool.java
313	51893	Bug 51893 JMX notification/Exception for empty/exhausted connection pool	"Currently, if there is an error getting a connection from the pool, a generic SQLException is thrown. The only way to determine if the problem is a result of the connection pool being exhausted is to catch the SQLException and parse the message (i.e. look for ""Pool empty"" in ex.getMessage()). Would like to see the following: 1) A subclass of SQLException thrown in the case of an empty pool 2) A JMX notification sent in the case of an empty pool (e.g. [POOL EXHAUSTED])"	2011-09-26 14:49:49	1317060000	resolved fixed	9d687eb	1332260000	modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/ConnectionPool.java modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/PoolExhaustedException.java modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/jmx/ConnectionPool.java	5:modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/ConnectionPool.java 15:modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/jmx/ConnectionPool.java
314	51237	Bug 51237 SlowQueryReport interceptor does not log anything		2011-05-20 22:01:35	1305940000	resolved fixed	0eb38b8	1332250000	modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/interceptor/SlowQueryReport.java	1:modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/interceptor/SlowQueryReport.java
315	52926	Bug 52926 NPE in processSocket	"We have sporadic issues triggering 502 proxy errors using the NIO connector behind Nginx, caused by dropped connections/end of streams in Tomcat. The Tomcat log shows: SEVERE: Error allocating socket processor java.lang.NullPointerException at org.apache.tomcat.util.net.NioEndpoint.processSocket(NioEndpoint.java:721) at org.apache.tomcat.util.net.NioEndpoint$Poller.cancelledKey(NioEndpoint.java:1048) at org.apache.tomcat.util.net.NioEndpoint$Poller.timeout(NioEndpoint.java:1392) at org.apache.tomcat.util.net.NioEndpoint$Poller.run(NioEndpoint.java:1174) at java.lang.Thread.run(Thread.java:662) Looking at the code in processSocket I see the line in NioEndpoint(721): attachment.setCometNotify(false); //will get reset upon next reg Attachment is fetched in line 720: KeyAttachment attachment = (KeyAttachment)socket.getAttachment(false); Looking at socket.getAttachement() method I see that this method is indeed capable of returning null, but no null-check for this is done (although it is in multiple other locations, so it seems inconsistent)."	2012-03-16 08:19:25	1331900000	resolved fixed	dcb8808	1332240000	java/org/apache/tomcat/util/net/NioEndpoint.java	1:java/org/apache/tomcat/util/net/NioEndpoint.java
316	52723	Bug 52723 An incomplete fix for the resource leak bugs in StandardManager.java		2012-02-21 10:22:02	1329840000	resolved wontfix	9f8c8d6	1331330000	java/org/apache/catalina/session/StandardManager.java	1:java/org/apache/catalina/session/StandardManager.java
317	52850	Bug 52850 Various miscellaneous fixes to Tomcat Memory Leak Detection code	"Problem Description - ---------------------- Tomcat memory leak detection has the following issues - Most of the detection and fixing code has been tested ONLY on Sun JVMs. A lot of the reflection based code does not work with the IBM JDK. - Tests in tomcat7.source\test\org\apache\catalina\loader do not seem to run successfully and are incomplete for all the protection that Tomcat provides for classloader memory leaks. - For some categories of threadlocal memory leaks the key and value are not displayed correctly in the warning messages; particularly ones dealing with indirect references to threadlocals - org.apache.catalina.loader.WebappClassLoader.loadedByThisOrChild(Object) incorrectly traverses the object classloader hierarchy instead of the current (this) classloader hierarchy Problem Conclusion - -------------------- - After extensive testing with the IBM JDKs, I have cleaned up and sanitized some of the reflection code to stop executors, timers, threads etc on the IBM JDK - Added new tests for detecting threadlocal leaks and thread leaks - Better ThreadLocal leak reporting with corrected loadedByThisOrChild method and addition of expungeStaleEntries method - Make code more resilient in certain leak detection scenarios."	2012-03-07 14:57:15	1331150000	resolved fixed	adbf442	1331320000	java/org/apache/catalina/loader/WebappClassLoader.java test/org/apache/catalina/loader/TestWebappClassLoaderExecutorMemoryLeak.java test/org/apache/catalina/loader/TestWebappClassLoaderThreadLocalMemoryLeak.java	1:java/org/apache/catalina/loader/WebappClassLoader.java
318	52776	Bug 52776 Generator's JspFragment.invoke implementation does not reset ELContext[JspContext.class]	"If a developer captures a JspFragment themselves and calls invoke on it, the JspContext.class attribute in the enclosing pageContext's ELContext is set by the generated JspFragment subclass, but not reset to its original value afterwards. Therefore after invoking a JspContext any EL expressions will be searching the wrong jspContext for attribute values. org.apache.jasper.compiler.Generator is responsible for creating the JspFragment subclass to represent the compiled fragment. The generatePostamble() method emits generated code to set the JspContext attribute in the ELContext: out.printil(""this.jspContext.getELContext().putContext(javax.servlet.jsp.JspContext.class,this.jspContext);""); However it doesn't later put back the original value. If you are using the <jsp:invoke> tag to invoke the fragment (which is undoubtedly what most people are doing) then the code generated by visit(Node.InvokeAction n) in Generator explicitly restores the EL context: out.printil(""jspContext.getELContext().putContext(javax.servlet.jsp.JspContext.class,getJspContext());""); However if you call invoke(Writer) on the JspFragment yourself you don't get that tidy up code. I suggest the resolution is to have the JspFragment.invoke method tidy up after itself. It ""puts"" the change to the JspContext.class attribute so it should also re""put"" it. Then there shouldn't be any need to restore the EL context in the generated <jsp:invoke> code. I have tested this solution successfully."	2012-02-27 00:46:22	1330320000	resolved fixed	faf26da	1331290000	java/org/apache/jasper/compiler/Generator.java	1:java/org/apache/jasper/compiler/Generator.java
319	52500	Bug 52500 Improve client certificate authentication		2012-01-23 13:02:04	1327340000	resolved fixed	401c703	1331230000	java/org/apache/catalina/realm/RealmBase.java java/org/apache/catalina/realm/X509SubjectDnRetriever.java java/org/apache/catalina/realm/X509UsernameRetriever.java	4:java/org/apache/catalina/realm/RealmBase.java
320	52719	Bug 52719 An incomplete fix for the resource leak bug in WebappClassLoader.java		2012-02-21 09:37:53	1329840000	resolved fixed	78c02a7	1331160000	java/org/apache/catalina/loader/WebappClassLoader.java	1:java/org/apache/catalina/loader/WebappClassLoader.java
321	52792	Bug 52792 Incomplete error message when lookup a resource that is not bound in the naming		2012-02-28 20:30:12	1330480000	resolved fixed	7cec4ff	1331150000	java/org/apache/naming/NamingContext.java	7:java/org/apache/naming/NamingContext.java
322	52772	Bug 52772 JspC : checking uriRoot option validness	"In org.apache.jasper.JspC#execute() method, if uriRoot is not null, it scans all jsp files under uriRoot, and then checks if uriRoot is a directory. It should be more desirable to check if uriRoot is a directory or not first and then scanning it. Here are my suggestion. if (uriRoot == null) { throw new JasperException( Localizer.getMessage(""jsp.error.jspc.no_uriroot"")); } File uriRootF = new File(uriRoot); if (!uriRootF.exists() || !uriRootF.isDirectory()) { throw new JasperException( Localizer.getMessage(""jsp.error.jspc.uriroot_not_dir"")); } if( context==null ) { initServletContext(); } // No explicit pages, we'll process all .jsp in the webapp if (pages.size() == 0) { scanFiles(uriRootF); }"	2012-02-26 07:41:43	1330260000	resolved fixed	35958df	1331130000	java/org/apache/jasper/JspC.java	1:java/org/apache/jasper/JspC.java
323	52770	Bug 52770 Potential Bug or Inconsistency in NioBlockingSelector.java	"This is Ken Cheung, a Computer Science M.Phil. student. I observed some code clones in Tomcat and found inconsistent code: /tomcat/trunk/java/org/apache/tomcat/util/net/NioBlockingSelector.java 103 try { 104 if ( att.getWriteLatch()==null || att.getWriteLatch().getCount()==0) att.startWriteLatch(1); 105 poller.add(att,SelectionKey.OP_WRITE,reference); 106 att.awaitWriteLatch(writeTimeout,TimeUnit.MILLISECONDS); 107 }catch (InterruptedException ignore) { 108 Thread.interrupted(); 109 } 110 if ( att.getWriteLatch()!=null && att.getWriteLatch().getCount()> 0) { 111 //we got interrupted, but we haven't received notification from the poller. 112 keycount = 0; 113 }else { 114 //latch countdown has happened 115 keycount = 1; 116 att.resetWriteLatch(); 117 } 118 119 if (writeTimeout > 0 && (keycount == 0)) 120 timedout = (System.currentTimeMillis() - time) >= writeTimeout; /tomcat/trunk/java/org/apache/tomcat/util/net/NioBlockingSelector.java 164 try { 165 if ( att.getReadLatch()==null || att.getReadLatch().getCount()==0) att.startReadLatch(1); 166 poller.add(att,SelectionKey.OP_READ, reference); 167 if (readTimeout < 0) { 168 att.awaitReadLatch(Long.MAX_VALUE, TimeUnit.MILLISECONDS); 169 } else { 170 att.awaitReadLatch(readTimeout, TimeUnit.MILLISECONDS); 171 } 172 }catch (InterruptedException ignore) { 173 Thread.interrupted(); 174 } 175 if ( att.getReadLatch()!=null && att.getReadLatch().getCount()> 0) { 176 //we got interrupted, but we haven't received notification from the poller. 177 keycount = 0; 178 }else { 179 //latch countdown has happened 180 keycount = 1; 181 att.resetReadLatch(); 182 } 183 if (readTimeout >= 0 && (keycount == 0)) 184 timedout = (System.currentTimeMillis() - time) >= readTimeout; Quick description of the inconsistency Two code snippets are very similar code, but as you see, the first code does not check ""if (readTimeout < 0)"" while the second code has the checker. We thought it could be a potential bug or inconsistency. Hope this helps."	2012-02-25 15:04:31	1330200000	resolved fixed	4f75b2d	1331130000	java/org/apache/tomcat/util/net/NioBlockingSelector.java	1:java/org/apache/tomcat/util/net/NioBlockingSelector.java
324	52767	Bug 52767 Potential Bug or Inconsistency in JDBCRealm.java and JDBCAccessLogValve.java	"This is Ken Cheung, a Computer Science M.Phil. student. I observed some code clones in Tomcat and found inconsistent code: /tomcat/trunk/java/org/apache/catalina/realm/JDBCRealm.java 676 if (driver == null) { 677 try { 678 Class<?> clazz = Class.forName(driverName); 679 driver = (Driver) clazz.newInstance(); 680 } catch (Throwable e) { 681 ExceptionUtils.handleThrowable(e); 682 throw new SQLException(e.getMessage(), e); 683 } 684 } 685 686 // Open a new connection 687 Properties props = new Properties(); 688 if (connectionName != null) 689 props.put(""user"", connectionName); 690 if (connectionPassword != null) 691 props.put(""password"", connectionPassword); 692 dbConnection = driver.connect(connectionURL, props); /tomcat/trunk/java/org/apache/catalina/valves/JDBCAccessLogValve.java 566 if (driver == null) { 567 try { 568 Class<?> clazz = Class.forName(driverName); 569 driver = (Driver) clazz.newInstance(); 570 } catch (Throwable e) { 571 ExceptionUtils.handleThrowable(e); 572 throw new SQLException(e.getMessage(), e); 573 } 574 } 575 576 // Open a new connection 577 Properties props = new Properties(); 578 props.put(""autoReconnect"", ""true""); 579 if (connectionName != null) { 580 props.put(""user"", connectionName); 581 } 582 if (connectionPassword != null) { 583 props.put(""password"", connectionPassword); 584 } 585 conn = driver.connect(connectionURL, props); Quick description of the inconsistency Two code snippets are very similar code, but as you see, in JDBCRealm.java does not use ""props.put(""autoReconnect"", ""true"")"" while JDBCAccessLogValve.java has. We thought it could be a potential bug or inconsistency. Hope this helps."	2012-02-25 14:32:33	1330200000	resolved fixed	1f4663d	1331130000	java/org/apache/catalina/valves/JDBCAccessLogValve.java	2:java/org/apache/catalina/valves/JDBCAccessLogValve.java
325	52846	Bug 52846 Programmatic login using UserDatabaseRealm returns 403 error.	"IMHO,HttpServletRequest#login does not need to define a <login-config>. NonLoginAuthenticator is used when <login-config> is not specified in HttpServletRequest#login. When UserDatabaseRealm is used, not GenericPrincipal but Memory User is set to a session. In AuthenticatorBase#invoke, principal registered into a session is set to a request. Because MemoryUser is set to a request as principal, RealmBase#hasRole always returns false. As a result, 403 error is returned."	2012-03-07 08:40:46	1331130000	resolved fixed	a01418d	1331110000	java/org/apache/catalina/authenticator/NonLoginAuthenticator.java	7:java/org/apache/catalina/authenticator/NonLoginAuthenticator.java
326	52732	Bug 52732 An incomplete fix for the resource leak bug in ExpressionFactory.java		2012-02-21 12:22:44	1329840000	resolved fixed	6399c83	1331070000	java/javax/el/ExpressionFactory.java	1:java/javax/el/ExpressionFactory.java
327	52731	Bug 52731 An incomplete fix for the resource leak bug in JDTCompiler.java		2012-02-21 12:16:28	1329840000	resolved fixed	2b1d195	1331070000	java/org/apache/jasper/compiler/JDTCompiler.java	1:java/org/apache/jasper/compiler/JDTCompiler.java
328	52729	Bug 52729 An incomplete fix for the resource leak bug in CometConnectionManagerValve.java		2012-02-21 12:01:25	1329840000	resolved fixed	683d5c1	1331070000	java/org/apache/catalina/valves/CometConnectionManagerValve.java	1:java/org/apache/catalina/valves/CometConnectionManagerValve.java
329	52727	Bug 52727 An incomplete fix for the resource leak bug in HostConfig.java		2012-02-21 11:58:35	1329840000	resolved fixed	8293a6e	1331070000	java/org/apache/catalina/startup/HostConfig.java	1:java/org/apache/catalina/startup/HostConfig.java
330	52726	Bug 52726 An incomplete fix for the resource leak bug in MemoryUserDatabase.java		2012-02-21 11:50:36	1329840000	resolved fixed	a30ce07	1331070000	java/org/apache/catalina/users/MemoryUserDatabase.java	1:java/org/apache/catalina/users/MemoryUserDatabase.java
331	52725	Bug 52725 org.apache.jasper.compiler.JspUtil#getTagHandlerClassName() does not use org.apache.jasper.Constants.TAG_FILE_PACKAGE_NAME	"In the class org.apache.jasper.compiler.JspUtil, its method public static String getTagHandlerClassName(String path, String urn, ErrorDispatcher err) throws JasperException { ... } uses the string constants directly like ""org.apache.jsp.tag.web."", ""org.apache.jsp.tag.meta."". But you know there is TAG_FILE_PACKAGE_NAME field in the class org.apache.jasper.Constants. The code should be adjusted like below : Constants.TAG_FILE_PACKAGE_NAME + "".web"" Constants.TAG_FILE_PACKAGE_NAME + "".meta"""	2012-02-21 11:28:46	1329840000	resolved fixed	bf0287e	1330980000	java/org/apache/jasper/compiler/JspUtil.java	1:java/org/apache/jasper/compiler/JspUtil.java
332	52724	Bug 52724 An incomplete fix for the resource leak bugs in Catalina.java		2012-02-21 10:35:32	1329840000	resolved fixed	7c51f61	1330980000	java/org/apache/catalina/startup/Catalina.java	20:java/org/apache/catalina/startup/Catalina.java
333	52804	Bug 52804 Make PoolProperties implement Cloneable.	"It would be very useful to have the PoolProperties class implement the java.lang.Cloneable interface. We have many databases that share the same schema, username, password, configuration etc but differ only in their URL. Implementing a routing datasource based on something like org.springframework.jdbc.datasource.AbstractDataSource can then just clone a PoolProperties object and set the one or two properties that differ in the clone. In a spring project the properties that are common across all the datasources are only supplied once."	2012-03-01 17:18:03	1330640000	resolved fixed	55baca6	1330630000	modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/PoolProperties.java	1:modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/PoolProperties.java
334	52760	Bug 52760 Mime type for javascript incorrect in documentation		2012-02-24 13:35:39	1330110000	resolved fixed	833e6b1	1330260000	java/org/apache/catalina/filters/ExpiresFilter.java	118:java/org/apache/catalina/filters/ExpiresFilter.java
335	52758	Bug 52758 Jasper illegally implements org.eclipse.jdt.internal.compiler.env.ICompilationUnit from Eclipse		2012-02-24 04:21:56	1330080000	resolved fixed	2e7f5ab	1330080000	java/org/apache/jasper/compiler/JDTCompiler.java	6:java/org/apache/jasper/compiler/JDTCompiler.java
336	52671	Bug 52671 NIO Connector: Exception invoking method readBufSize / writeBufSize in the JMX Proxy Servlet		2012-02-15 11:47:03	1329320000	resolved fixed	3fe64a5	1329340000	java/org/apache/catalina/mbeans/MBeanDumper.java	170:java/org/apache/catalina/mbeans/MBeanDumper.java
337	52669	"Bug 52669 Annotation processing, in WEB-INF/classes, for Servlets/Listeners/Filters is skipped when the web app is not extracted, classes do not have packages and for some embedded scenarios"		2012-02-14 21:39:46	1329270000	resolved fixed	34b1a7e	1329340000	java/org/apache/catalina/startup/ContextConfig.java	2:java/org/apache/catalina/startup/ContextConfig.java
338	52666	Bug 52666 EL should coerce String to Integer in equals operation		2012-02-14 12:55:34	1329240000	resolved fixed	bf9bf39	1329320000	java/org/apache/el/lang/ELSupport.java test/org/apache/el/lang/TestELSupport.java	2:test/org/apache/el/lang/TestELSupport.java 7:java/org/apache/el/lang/ELSupport.java
339	52607	"Bug 52607 It is not well defined how ""Dependencies on extensions"" mechanism can be used in Tomcat"		2012-02-05 22:19:35	1328500000	resolved fixed	4b6d583	1328740000	java/org/apache/catalina/core/StandardServer.java java/org/apache/catalina/util/ExtensionValidator.java	32:java/org/apache/catalina/util/ExtensionValidator.java 33:java/org/apache/catalina/core/StandardServer.java
340	52606	Bug 52606 FORM authentication POST replay broken for AJP		2012-02-05 18:10:19	1328480000	resolved fixed	6f766be	1328720000	java/org/apache/coyote/ajp/AbstractAjpProcessor.java	6:java/org/apache/coyote/ajp/AbstractAjpProcessor.java
341	52591	Bug 52591 UnsupportedOperationException logged when fetching BasicDataSource 'loginTimeout'	"With a BasicDataSource configured (using a <Resource>), simply list the available MBeans and this exception will be emitted to stdout: SEVERE: Error getting attribute Catalina:type=DataSource,context=/context,host=localhost,class=javax.sql.DataSource,name=""jdbc/myDataSource"" loginTimeout javax.management.RuntimeOperationsException: Exception invoking method loginTimeout at org.apache.tomcat.util.modeler.BaseModelMBean.getAttribute(BaseModelMBean.java:197) at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.getAttribute(DefaultMBeanServerInterceptor.java:666) at com.sun.jmx.mbeanserver.JmxMBeanServer.getAttribute(JmxMBeanServer.java:638) at org.apache.catalina.mbeans.MBeanDumper.dumpBeans(MBeanDumper.java:81) at org.apache.catalina.manager.JMXProxyServlet.listBeans(JMXProxyServlet.java:166) at org.apache.catalina.manager.JMXProxyServlet.doGet(JMXProxyServlet.java:121) at javax.servlet.http.HttpServlet.service(HttpServlet.java:621) [...] Caused by: java.lang.UnsupportedOperationException: Not supported by BasicDataSource at org.apache.tomcat.dbcp.dbcp.BasicDataSource.getLoginTimeout(BasicDataSource.java:1083) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) This exception does not cause the request to fail, but definitely puts an ugly stack trace in catalina.out. It might be better to catch UnsupportedOperationException and emit a one-line error message -- one that isn't SEVERE."	2012-02-03 14:43:28	1328300000	resolved fixed	fbf9166	1328710000	java/org/apache/catalina/mbeans/MBeanDumper.java	5:java/org/apache/catalina/mbeans/MBeanDumper.java
342	52586	"Bug 52586 When requests are forwarded, the request attribute javax.servlet.forward.path_info is assigned an incorrect value."	"As per the servlet spec, the values for: javax.servlet.forward.request_uri javax.servlet.forward.context javax.servlet.forward.servlet_path javax.servlet.forward.path_info javax.servlet.forward.query_string MUST be set to the values from the very first servlet that serviced the current request. However, it seems that Tomcat is populating path_info with the value of the LAST path_info serviced in the request (i.e. the final servlet that serviced the request). It's possible the other value assignments are afflicted by similar defects, I've not explicitly tested for this. Because of this issue, it's impossible to correctly reconstruct the original request's URI piecemeal by concatenating context+servlet_path+path_info+?+query_string, since path_info will contain the path to another servlet and thus this concatenation will produce a probably invalid URI target. Therefore, creating ""click here to retry"" links is impossible without workaround code. The critical issue here is the deviation from the servlet spec, which spells out the behavior of those attributes."	2012-02-02 18:49:59	1328230000	resolved fixed	660513c	1328480000	java/org/apache/catalina/core/StandardHostValve.java	63:java/org/apache/catalina/core/StandardHostValve.java
343	52577	Bug 52577 Response output written in filter can be truncated	"Due to changes 1229726, 1229727 and 1229728 output written to response in the filter can be truncated up to 8192 bytes. Consider the following scenario: - you have a filter that invoke getWriter() before chain.doFilter(request, responseWrapper) - responseWrapper overrides getWriter() method and returns some buffered writer, not the real one - during execution of chain.doFilter there is a forward Before the forward ApplicationDispather calls resetBuffer on response, which in turn calls reset() on OutputBuffer, which sets gotEnc field to false. This field is initialized in the setConverter() method which is called from response.getWriter(), but since our wrapperResponse overrides getWriter(), OutputBuffer.setConverter() never called and OutputBuffer still has gotEnc = false. Response's close() and flushBuffer() methods call OutputBuffer's flush(), but since gotEnc == false, conv.flushBuffer() is not called: if (gotEnc && conv != null) { conv.flushBuffer(); } A workaround for us is to implement getWriter() method in responseWrapper like this: public Writer getWriter() { Writer originalWriter = originalResponse.getWriter();//save for future processing return ourWriter; } Maybe you should change flushing to something like that: if (conv != null) { conv.flushBuffer(); } because you invoke conv.convert() without any checks in the write*() methods and it seems like conv is never null."	2012-02-02 07:45:44	1328190000	resolved fixed	2fd117b	1328480000	java/org/apache/catalina/connector/OutputBuffer.java java/org/apache/catalina/connector/Response.java test/org/apache/catalina/connector/TestOutputBuffer.java	1:java/org/apache/catalina/connector/OutputBuffer.java 2:java/org/apache/catalina/connector/Response.java 294:test/org/apache/catalina/connector/TestOutputBuffer.java
344	52587	Bug 52587 NPE in authenticator when no realm/resource is defined	"When no Realm is available to authenticate against, an NPE is thrown. STR: 1. Start with a stock 7.0.25 and modify server.xml: 2. Comment-out <Resource> in <GlobalNamingResources> 3. Comment-out <Realm> in <Engine> 4. Deploy manager app and try to log in java.lang.NullPointerException org.apache.catalina.realm.RealmBase.authenticate(RealmBase.java:340) org.apache.catalina.authenticator.BasicAuthenticator.authenticate(BasicAuthenticator.java:158) org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:544) org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:98) org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:407) org.apache.coyote.http11.AbstractHttp11Processor.process(AbstractHttp11Processor.java:987) org.apache.coyote.AbstractProtocol$AbstractConnectionHandler.process(AbstractProtocol.java:579) org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.run(NioEndpoint.java:1600) java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886) java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908) java.lang.Thread.run(Thread.java:680) Clearly, this is a pathological setup, but it might be nice to get a decent error message instead of an NPE."	2012-02-02 20:00:01	1328230000	resolved fixed	49a52cb	1328470000	java/org/apache/catalina/core/StandardEngine.java	148:java/org/apache/catalina/core/StandardEngine.java
345	52444	Bug 52444 Classloading-based ServletContainerInitializer @HandlesTypes processing can result in long startup times	"See 52326 for background, noting particularly the following: ""As long as SCI processing involves expensive classloading, larger applications will suffer from long startup times and thus be encouraged to ""shut off"" this functionality via metadata-complete='true'."" This issue, then, is intended to address classloading-based approach to @HandlesTypes processing by replacing it with something faster and generally less problematic. ASM would be one way to get it done."	2012-01-09 17:11:12	1326150000	resolved fixed	f4896de	1327920000	java/org/apache/catalina/startup/ContextConfig.java java/org/apache/tomcat/util/bcel/classfile/JavaClass.java test/org/apache/catalina/startup/TestContextConfigAnnotation.java	1:java/org/apache/catalina/startup/ContextConfig.java 6:test/org/apache/catalina/startup/TestContextConfigAnnotation.java 325:java/org/apache/tomcat/util/bcel/classfile/JavaClass.java
346	52547	Bug 52547 incorrect byeswritten log after completed async request under http1.0		2012-01-27 19:43:42	1327710000	resolved fixed	f2edc92	1327780000	java/org/apache/coyote/http11/AbstractOutputBuffer.java	21:java/org/apache/coyote/http11/AbstractOutputBuffer.java
347	52543	Bug 52543 Exception	SEVERE: Error finishing response java.lang.ArrayIndexOutOfBoundsException at java.lang.System.arraycopy(Native Method) at org.apache.coyote.http11.AbstractOutputBuffer.write(AbstractOutputBuffer.java:495) at org.apache.coyote.http11.AbstractOutputBuffer.sendStatus(AbstractOutputBuffer.java:337) at org.apache.coyote.http11.AbstractHttp11Processor.prepareResponse(AbstractHttp11Processor.java:1418) at org.apache.coyote.http11.AbstractHttp11Processor.action(AbstractHttp11Processor.java:756) at org.apache.coyote.Response.action(Response.java:168) at org.apache.coyote.http11.AbstractOutputBuffer.endRequest(AbstractOutputBuffer.java:310) at org.apache.coyote.http11.InternalOutputBuffer.endRequest(InternalOutputBuffer.java:158) at org.apache.coyote.http11.AbstractHttp11Processor.endRequest(AbstractHttp11Processor.java:1586) at org.apache.coyote.http11.AbstractHttp11Processor.process(AbstractHttp11Processor.java:1022) at org.apache.coyote.AbstractProtocol$AbstractConnectionHandler.process(AbstractProtocol.java:579) at org.apache.tomcat.util.net.JIoEndpoint$SocketProcessor.run(JIoEndpoint.java:307) at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603) at java.lang.Thread.run(Thread.java:722) big application i dont know why its happens may be due to the fact that twice as add some cookie	2012-01-27 11:18:09	1327680000	resolved fixed	ee0562d	1327780000	java/org/apache/coyote/http11/AbstractOutputBuffer.java	4:java/org/apache/coyote/http11/AbstractOutputBuffer.java
348	52511	Bug 52511 Exception logged in annotation scanning for web apps without /WEB-INF/classes		2012-01-23 21:02:08	1327370000	resolved fixed	3277494	1327700000	java/org/apache/catalina/startup/ContextConfig.java	4:java/org/apache/catalina/startup/ContextConfig.java
349	52474	Bug 52474 Do not load listeners declared with blank spaces on tld file.		2012-01-17 05:41:49	1326800000	resolved fixed	2dd8a40	1327090000	java/org/apache/catalina/startup/TldRuleSet.java	18:java/org/apache/catalina/startup/TldRuleSet.java
350	51408	Bug 51408 String.getBytes() and new String(byte[]) use default charset - may cause problems in some Locales	"There seem to be rather a lot of instances where Strings and bytes are cconverted using the default charset. Since the default charset is unknown, its behaviour cannot be relied on."	2011-06-21 15:47:16	1308690000	resolved fixed	9722128	1326990000	java/org/apache/catalina/ant/AbstractCatalinaTask.java java/org/apache/catalina/authenticator/DigestAuthenticator.java java/org/apache/catalina/realm/JNDIRealm.java java/org/apache/catalina/realm/RealmBase.java java/org/apache/catalina/servlets/WebdavServlet.java java/org/apache/catalina/util/RequestUtil.java java/org/apache/catalina/valves/AccessLogValve.java java/org/apache/catalina/valves/SSLValve.java java/org/apache/coyote/http11/filters/BufferedInputFilter.java java/org/apache/coyote/http11/filters/ChunkedInputFilter.java java/org/apache/coyote/http11/filters/IdentityInputFilter.java java/org/apache/coyote/http11/filters/VoidInputFilter.java java/org/apache/jasper/Constants.java java/org/apache/jasper/compiler/SmapUtil.java java/org/apache/naming/resources/Constants.java java/org/apache/naming/resources/ProxyDirContext.java java/org/apache/tomcat/util/buf/MessageBytes.java	5:java/org/apache/catalina/realm/RealmBase.java 7:java/org/apache/catalina/ant/AbstractCatalinaTask.java 10:java/org/apache/tomcat/util/buf/MessageBytes.java 12:java/org/apache/catalina/util/RequestUtil.java 36:java/org/apache/catalina/valves/AccessLogValve.java 51:java/org/apache/catalina/realm/JNDIRealm.java 52:java/org/apache/naming/resources/ProxyDirContext.java 59:java/org/apache/jasper/compiler/SmapUtil.java 76:java/org/apache/coyote/http11/filters/VoidInputFilter.java 92:java/org/apache/catalina/authenticator/DigestAuthenticator.java 126:java/org/apache/coyote/http11/filters/BufferedInputFilter.java 130:java/org/apache/coyote/http11/filters/IdentityInputFilter.java 216:java/org/apache/catalina/servlets/WebdavServlet.java 244:java/org/apache/coyote/http11/filters/ChunkedInputFilter.java 285:java/org/apache/catalina/valves/SSLValve.java 627:java/org/apache/jasper/Constants.java 1183:java/org/apache/naming/resources/Constants.java
351	52480	Bug 52480 TC7 + AntCompiler problems with whitespace in pathname		2012-01-18 00:28:00	1326860000	resolved fixed	b553519	1326890000	java/org/apache/catalina/loader/WebappLoader.java	187:java/org/apache/catalina/loader/WebappLoader.java
352	38216	Bug 38216 Extend Jmxproxy to allow call of MBean Operations	Currently one can only query Beans or set/get Attributes of them. It would be good if a certain operation of a MBean could be called by the Jmxproxy Servlet.	2006-01-10 18:01:22	1136930000	resolved fixed	bd478e5	1326660000	java/org/apache/catalina/manager/JMXProxyServlet.java	27:java/org/apache/catalina/manager/JMXProxyServlet.java
353	52461	"Bug 52461 java.lang.IllegalArgumentException: URI scheme is not ""file"" is thrown in ContextConfig.getDefaultWebXmlFragment"		2012-01-12 20:34:28	1326420000	resolved fixed	53615e5	1326490000	java/org/apache/catalina/startup/ContextConfig.java	1:java/org/apache/catalina/startup/ContextConfig.java
354	52445	Bug 52445 Methodexpression with arguments fails on nested properties		2012-01-10 03:25:21	1326180000	resolved fixed	3c8f40f	1326490000	java/org/apache/el/parser/AstValue.java test/org/apache/el/TestMethodExpressionImpl.java	7:test/org/apache/el/TestMethodExpressionImpl.java 67:java/org/apache/el/parser/AstValue.java
355	52443	"Bug 52443 Tomcat#defaultRealm shares Realm instance between web applications, resulting in INFO log message from lifecycle"		2012-01-09 16:43:35	1326150000	resolved fixed	c38ed95	1326400000	java/org/apache/catalina/startup/Tomcat.java test/org/apache/catalina/mbeans/TestRegistration.java	1:java/org/apache/catalina/startup/Tomcat.java 235:test/org/apache/catalina/mbeans/TestRegistration.java
356	52245	Bug 52245 Add detection of EL Jar to WebappClassLoader	The EL API is not currently detected by the code in WebappClassLoader. Applications containing el-api.jar will not start. (patch to follow).	2011-11-25 15:13:41	1322250000	resolved fixed	ee2a461	1326400000	java/org/apache/catalina/loader/WebappClassLoader.java	1:java/org/apache/catalina/loader/WebappClassLoader.java
357	52440	Bug 52440 Wrong getValueReference behaviour with Facelets parameter expressions	"ValueExpression method getValueReference should return base object and property. But it returns null if ValueExpression is Facelets parameter. Example: someVar = #{concreteObject.property} ValueExpression for #{someVar} return null from method getValueReference (guess because it is simple expression #{someVar}), but logicaly it should return parent expressions ValueReference (need hierachical ValueReference lookup). I made workaround with Java Reflect API in my code and it illustrates problem: ELContext elContext = FacesContext.getCurrentInstance().getELContext(); ValueReference reference = exp.getValueReference(elContext); if (reference == null && exp instanceof TagValueExpressionUEL) { ValueExpressionImpl origExp = (ValueExpressionImpl) ((TagValueExpressionUEL) exp).getWrapped(); // TODO: JR: find better way to get base and property. ! Code is not portable because uses Tomcat EL implementation details. ! Field field = ReflectionUtils.findField(origExp.getClass(), EL_IMPL_VAR_PROPERTY); field.setAccessible(true); VariableMapper varMapper = (VariableMapper) ReflectionUtils.getField(field, origExp); field = ReflectionUtils.findField(origExp.getClass(), EL_IMPL_NODE_PROPERTY); field.setAccessible(true); SimpleNode node = (SimpleNode) ReflectionUtils.getField(field, origExp); if (varMapper != null && node != null) { ValueExpression parentExp = varMapper.resolveVariable(node.getImage()); if (parentExp != null) { try { reference = parentExp.getValueReference(elContext); if (reference == null) { reference = getValueReference(parentExp); } } catch (PropertyNotFoundException e) { LOG.warn(""Property not found: "" + e.getMessage()); } } } }"	2012-01-09 09:11:20	1326120000	resolved fixed	f277b14	1326400000	java/org/apache/el/parser/AstIdentifier.java test/org/apache/el/TestValueExpressionImpl.java	4:java/org/apache/el/parser/AstIdentifier.java 29:test/org/apache/el/TestValueExpressionImpl.java
358	52328	Bug 52328 Massive garbage production observed when using the response writer	"In our application we used to use Tomcat 5, by writing our content directly to the response writer in our servlet: Writer w = response.getWriter(); w.append(...) We have regularly measured performance of our application under stress with multiple simultaneous requests per second. We recently upgraded to Tomcat 7, and immediately observed a performance degradation of 10% on the request roundtrip on the same machine and the same tests, compared to our application deployed on Tomcat 5. Profiling with JProfiler showed that we got massive amount of transient objects {{java.nio.HeapCharBuffer}} produced - 400Mb+ within a few minutes. The way we are writing the response is by multiple statements of {{append}} of small strings or single chars, which used to work properly. For experiment, we wrapped the response writer with a {{BufferedWriter}} with a buffer of 64k. This brought our application's performance back to normal. We see this as either a: - anti-pattern usage since Tomcat 6/7, in which case please provide some documentation about that. - bug in the C2BConverter that is applied per every call to the CoyoteWriter write methods, which generates the garbage buffers per every call. We know that the response stream has a 8k buffer by default. Nevertheless, this buffer comes after the encoding step and as such it is too late to help with the garbage. Perhaps Tomcat can buffer before it encodes? Still, so much transient objects for just a pattern of eligible use of the servlet API seems a bug to me."	2011-12-14 11:03:38	1323880000	resolved fixed	9c7ec4c	1326230000	java/org/apache/catalina/connector/OutputBuffer.java	6:java/org/apache/catalina/connector/OutputBuffer.java
359	52387	Bug 52387 org.catalina.tomcat.startup.Tomcat#silence method doesn't use the host where we add the applications		2011-12-27 01:48:16	1324970000	resolved fixed	3787242	1325330000	java/org/apache/catalina/startup/Tomcat.java	1:java/org/apache/catalina/startup/Tomcat.java
360	52326	Bug 52326 Lower log level for failed class loading		2011-12-13 18:47:41	1323820000	resolved fixed	addd522	1325190000	java/org/apache/catalina/startup/ContextConfig.java	11:java/org/apache/catalina/startup/ContextConfig.java
361	52316	Bug 52316 AccessLog does not log size for files sent with sendfile		2011-12-09 22:23:47	1323490000	resolved fixed	9f52382	1325110000	java/org/apache/catalina/valves/AccessLogValve.java	2:java/org/apache/catalina/valves/AccessLogValve.java
362	52303	Bug 52303 NonLoginAuthenticator does not honour session timeout with SingleSignOn Valve		2011-12-08 09:35:59	1323360000	resolved fixed	8b6d341	1325020000	java/org/apache/catalina/authenticator/NonLoginAuthenticator.java	1:java/org/apache/catalina/authenticator/NonLoginAuthenticator.java
363	52384	Bug 52384 URL parameter without value should be parsed successfully when logging level = DEBUG		2011-12-24 18:16:23	1324770000	resolved fixed	34b011b	1324860000	java/org/apache/tomcat/util/http/Parameters.java	2:java/org/apache/tomcat/util/http/Parameters.java
364	52356	"Bug 52356 Prevent potential data races on ""org.apache.catalina.tribes.transport.bio.util.FastQueue.size""."		2011-12-18 23:41:25	1324270000	resolved fixed	6f3cafe	1324680000	java/org/apache/catalina/tribes/transport/bio/util/FastQueue.java	1:java/org/apache/catalina/tribes/transport/bio/util/FastQueue.java
365	52354	"Bug 52354 Protect concurrent accesses to field ""org.apache.catalina.tribes.transport.bio.util.FastQueue.inRemove"""		2011-12-18 23:04:53	1324270000	resolved fixed	8983419	1324670000	java/org/apache/catalina/tribes/transport/bio/util/FastQueue.java	1:java/org/apache/catalina/tribes/transport/bio/util/FastQueue.java
366	52213	"Bug 52213 Field ""org.apache.catalina.tribes.transport.bio.util.FastQueue.enabled"" should be volatile."		2011-11-18 23:29:32	1321680000	resolved fixed	d69fb8e	1324670000	java/org/apache/catalina/tribes/transport/bio/util/FastQueue.java	1:java/org/apache/catalina/tribes/transport/bio/util/FastQueue.java
367	52293	Bug 52293 antiResourceLocking and unpackWARs		2011-12-06 18:54:27	1323220000	resolved fixed	33e48db	1324500000	java/org/apache/catalina/startup/ContextConfig.java	5:java/org/apache/catalina/startup/ContextConfig.java
368	52321	Bug 52321 coda/prelude order not respected		2011-12-13 00:13:28	1323750000	resolved fixed	22e7e15	1323810000	java/org/apache/catalina/core/ApplicationJspConfigDescriptor.java java/org/apache/catalina/deploy/WebXml.java	23:java/org/apache/catalina/deploy/WebXml.java
369	52208	Bug 52208 NullPointerException in tribes.transport.nio.NioReceiver.listen() in test run		2011-11-18 10:37:32	1321630000	resolved fixed	9403e4f	1323380000	java/org/apache/catalina/tribes/transport/nio/NioReceiver.java	1:java/org/apache/catalina/tribes/transport/nio/NioReceiver.java
370	52028	Bug 52028 Embeded Tomcat using a Connector with a random port (port 0)		2011-10-14 12:27:22	1318610000	resolved fixed	63f708a	1322520000	java/org/apache/catalina/connector/Connector.java java/org/apache/coyote/AbstractProtocol.java java/org/apache/tomcat/util/net/AbstractEndpoint.java java/org/apache/tomcat/util/net/AprEndpoint.java java/org/apache/tomcat/util/net/JIoEndpoint.java java/org/apache/tomcat/util/net/NioEndpoint.java test/org/apache/catalina/authenticator/TestFormAuthenticator.java test/org/apache/catalina/connector/TestConnector.java test/org/apache/catalina/connector/TestRequest.java test/org/apache/catalina/core/TestStandardContext.java test/org/apache/catalina/core/TestSwallowAbortedUploads.java test/org/apache/catalina/filters/TestExpiresFilter.java test/org/apache/catalina/filters/TestRemoteIpFilter.java test/org/apache/catalina/mbeans/TestRegistration.java test/org/apache/catalina/servlets/TestDefaultServlet.java test/org/apache/catalina/startup/SimpleHttpClient.java test/org/apache/catalina/startup/TomcatBaseTest.java test/org/apache/coyote/http11/TestAbstractHttp11Processor.java test/org/apache/coyote/http11/TestInternalInputBuffer.java test/org/apache/coyote/http11/filters/TestChunkedInputFilter.java test/org/apache/tomcat/util/http/TestCookiesAllowEquals.java test/org/apache/tomcat/util/http/TestCookiesAllowHttpSeps.java test/org/apache/tomcat/util/http/TestCookiesAllowNameOnly.java test/org/apache/tomcat/util/http/TestCookiesDisallowEquals.java test/org/apache/tomcat/util/net/TestXxxEndpoint.java	2:java/org/apache/catalina/connector/Connector.java 7:test/org/apache/catalina/startup/TomcatBaseTest.java 16:java/org/apache/tomcat/util/net/AbstractEndpoint.java 25:test/org/apache/catalina/mbeans/TestRegistration.java 35:test/org/apache/catalina/connector/TestConnector.java 57:java/org/apache/coyote/AbstractProtocol.java 80:test/org/apache/catalina/filters/TestExpiresFilter.java 95:test/org/apache/catalina/startup/SimpleHttpClient.java 108:test/org/apache/tomcat/util/net/TestXxxEndpoint.java 116:test/org/apache/catalina/core/TestStandardContext.java 120:test/org/apache/catalina/servlets/TestDefaultServlet.java 124:java/org/apache/tomcat/util/net/NioEndpoint.java 126:java/org/apache/tomcat/util/net/JIoEndpoint.java 144:test/org/apache/tomcat/util/http/TestCookiesDisallowEquals.java 149:test/org/apache/tomcat/util/http/TestCookiesAllowNameOnly.java 150:java/org/apache/tomcat/util/net/AprEndpoint.java 151:test/org/apache/tomcat/util/http/TestCookiesAllowHttpSeps.java 157:test/org/apache/tomcat/util/http/TestCookiesAllowEquals.java 167:test/org/apache/catalina/connector/TestRequest.java 216:test/org/apache/coyote/http11/filters/TestChunkedInputFilter.java 246:test/org/apache/catalina/filters/TestRemoteIpFilter.java 256:test/org/apache/coyote/http11/TestAbstractHttp11Processor.java 286:test/org/apache/coyote/http11/TestInternalInputBuffer.java 312:test/org/apache/catalina/core/TestSwallowAbortedUploads.java 401:test/org/apache/catalina/authenticator/TestFormAuthenticator.java
371	52225	Bug 52225 Adding Alias for existing host on running Tomcat causes ClassCastException		2011-11-22 07:14:09	1321960000	resolved fixed	f3a7cd9	1321950000	java/org/apache/tomcat/util/http/mapper/Mapper.java test/org/apache/tomcat/util/http/mapper/TestMapper.java	4:java/org/apache/tomcat/util/http/mapper/Mapper.java 133:test/org/apache/tomcat/util/http/mapper/TestMapper.java
372	52173	Bug 52173 Add a drop of additional clarification to doc on the delegate setting of the WebappClassLoader		2011-11-13 14:59:57	1321210000	resolved fixed	574af73	1321310000	java/org/apache/catalina/loader/WebappClassLoader.java	1:java/org/apache/catalina/loader/WebappClassLoader.java
373	50570	Bug 50570 Allow explicit use of FIPS mode in APR lifecycle listener		2011-01-11 12:27:44	1294770000	resolved fixed	c2001ce	1320870000	java/org/apache/catalina/core/AprLifecycleListener.java java/org/apache/tomcat/jni/SSL.java	1:java/org/apache/catalina/core/AprLifecycleListener.java 123:java/org/apache/tomcat/jni/SSL.java
374	52156	"Bug 52156 ServletContext.getResource(path) doesn't accept "".."" anymore"		2011-11-08 18:59:53	1320800000	resolved fixed	b7f5c7e	1320790000	java/org/apache/catalina/core/ApplicationContext.java	2:java/org/apache/catalina/core/ApplicationContext.java
375	52113	Bug 52113 Tomcat reports missing context xml at wrong location on JMX deployment	"Hello, I'm using Tomcat JMX interface to deploy apps as follows: 1) call MBeanFactory#createStandardContext, where MBeanFactory is ""Catalina:type=MBeanFactory"", with parameters: parent = ""Catalina:type=Host,host=localhost"", path = ""/w1"", docBase = <my path to the app> 2) call <my app>#start, where <my app> is ""Catalina:j2eeType=WebModule,name=//localhost/w1,J2EEApplication=none,J2EEServer=none"" As result, my app _is succesfully deployed (its context is available)_, but nevertheless I see the following exceptions in the server console (full stacktraces are skipped, to be attached next comment): 31 ???? 2011 14:05:53 org.apache.catalina.startup.ContextConfig processContextConfig SEVERE: Missing context.xml: file:/C:/<my Tomcat base folder>/conf/Catalina/localhost/w1.xml java.io.FileNotFoundException: C:\<my Tomcat base folder>\conf\Catalina\localhost\w1.xml 31 ???? 2011 14:05:53 org.apache.catalina.startup.ContextConfig processContextConfig SEVERE: Parse error in context.xml for /w1 java.io.FileNotFoundException: C:\<my Tomcat base folder>\conf\Catalina\localhost\w1.xml 31 ???? 2011 14:05:53 org.apache.catalina.startup.ContextConfig configureStart SEVERE: Marking this application unavailable due to previous error(s) 31 ???? 2011 14:05:53 org.apache.catalina.core.StandardContext startInternal SEVERE: Error getConfigured 31 ???? 2011 14:05:53 org.apache.catalina.core.StandardContext startInternal SEVERE: Context [/w1] startup failed due to previous errors The exceptions looks strange to me, since I don't understand why Tomcat searches for a context xml file during the jmx deploy. Do I do something wrong in the deployment workflow? Regards, Michael"	2011-10-31 14:09:21	1320080000	resolved fixed	d7af36d	1320180000	java/org/apache/catalina/mbeans/MBeanFactory.java	1:java/org/apache/catalina/mbeans/MBeanFactory.java
376	52051	Bug 52051 NullPointerException when Jasper tries to compile a directory		2011-10-18 19:33:51	1318980000	resolved fixed	62ff013	1319040000	java/org/apache/jasper/JspCompilationContext.java java/org/apache/jasper/compiler/JspUtil.java	15:java/org/apache/jasper/JspCompilationContext.java 56:java/org/apache/jasper/compiler/JspUtil.java
377	52009	Bug 52009 NPE exception in org.apache.catalina.connector.CoyoteAdapter.service		2011-10-11 08:06:49	1318330000	resolved fixed	b90c0a1	1318630000	java/org/apache/catalina/connector/CoyoteAdapter.java test/org/apache/catalina/comet/TestCometProcessor.java	1:java/org/apache/catalina/connector/CoyoteAdapter.java 312:test/org/apache/catalina/comet/TestCometProcessor.java
378	51972	Bug 51972 sendRedirect does not support protocol relative URLs		2011-10-05 21:31:50	1317860000	resolved fixed	e70797e	1318250000	java/org/apache/catalina/connector/Response.java	6:java/org/apache/catalina/connector/Response.java
379	51952	Bug 51952 IllegalStateException using CompressionFilter with Tomcat 7.0.21/22		2011-10-04 15:36:57	1317760000	resolved fixed	3ab3757	1318020000	java/org/apache/catalina/Context.java java/org/apache/catalina/connector/Response.java java/org/apache/catalina/core/StandardContext.java	12:java/org/apache/catalina/core/StandardContext.java 20:java/org/apache/catalina/Context.java 25:java/org/apache/catalina/connector/Response.java
380	51956	Bug 51956 RemoteAddrFilter uses remote host (not address) in doFilterEvent	"public void doFilterEvent(CometEvent event, CometFilterChain chain) throws IOException, ServletException { processCometEvent(event.getHttpServletRequest().getRemoteHost(), event, chain); } Use of getRemoteHost should be getRemoteAddr."	2011-10-04 21:58:18	1317780000	resolved fixed	d6d1c6f	1317770000	java/org/apache/catalina/filters/RemoteAddrFilter.java	1:java/org/apache/catalina/filters/RemoteAddrFilter.java
381	51630	Bug 51630 java.lang.IllegalStateException: Calling [asyncComplete()]	example: webapps\examples\WEB-INF\classes\async\Async0.java log file: logs\localhost.2011-08-07.log ============================================= java.lang.IllegalStateException: Calling [asyncComplete()] is not valid for a request with Async state [DISPATCHED] at org.apache.coyote.AsyncStateMachine.asyncComplete(AsyncStateMachine.java:221) at org.apache.coyote.http11.Http11Processor.actionInternal(Http11Processor.java:525) at org.apache.coyote.http11.AbstractHttp11Processor.action(AbstractHttp11Processor.java:773) at org.apache.coyote.Request.action(Request.java:344) at org.apache.catalina.core.AsyncContextImpl.complete(AsyncContextImpl.java:89) at async.Async0.service(Async0.java:42) at javax.servlet.http.HttpServlet.service(HttpServlet.java:722) at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:304) at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:210) at org.apache.catalina.core.ApplicationDispatcher.invoke(ApplicationDispatcher.java:684) at org.apache.catalina.core.ApplicationDispatcher.doInclude(ApplicationDispatcher.java:593) at org.apache.catalina.core.ApplicationDispatcher.include(ApplicationDispatcher.java:530) at org.apache.catalina.core.AsyncContextImpl$1.run(AsyncContextImpl.java:173) at org.apache.catalina.core.AsyncContextImpl.doInternalDispatch(AsyncContextImpl.java:314) at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:219) at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:175) at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:462) at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:164) at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:100) at org.apache.catalina.valves.AccessLogValve.invoke(AccessLogValve.java:851) at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:118) at org.apache.catalina.connector.CoyoteAdapter.asyncDispatch(CoyoteAdapter.java:296) at org.apache.coyote.http11.AbstractHttp11Processor.asyncDispatch(AbstractHttp11Processor.java:1220) at org.apache.coyote.AbstractProtocol$AbstractConnectionHandler.process(AbstractProtocol.java:511) at org.apache.tomcat.util.net.JIoEndpoint$SocketProcessor.run(JIoEndpoint.java:302) at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908) at java.lang.Thread.run(Thread.java:619)	2011-08-07 02:34:08	1312700000	resolved fixed	b080c7e	1317670000	webapps/examples/WEB-INF/classes/async/Async0.java	16:webapps/examples/WEB-INF/classes/async/Async0.java
382	51910	Bug 51910 NPE in comet processing when shutting down Tomcat		2011-09-28 12:05:19	1317230000	resolved fixed	a450d2c	1317480000	java/org/apache/catalina/core/StandardWrapperValve.java	112:java/org/apache/catalina/core/StandardWrapperValve.java
383	51905	Bug 51905 Infinite loop when shutting down AprEndpoint		2011-09-28 09:20:16	1317220000	resolved fixed	136097e	1317200000	java/org/apache/tomcat/util/net/AprEndpoint.java	1:java/org/apache/tomcat/util/net/AprEndpoint.java
384	51872	Bug 51872 request.getRemoteAddr() sometimes returning IP address from the previous request	"request.getRemoteAddr() sometimes returning IP address from the previous request. We have compared the IP address returned from the getRemoteHost() and from the headers with getRemoteAddr() and getRemoteAddr is returning wrong IP address. We believe that this may come from the ""pooled"" request objects where it is sometimes sees the previous value of the remote IP. The problem doesn't occur all the time. We are heavily relying on the getRemoteAddr to verify the remote client for some of our authentication. Can this be fixed? 2011-09-22 16:49:55,713 DEBUG [yjava.tomcat.valves.YahooConnectionValve] THREADID:1262 YahooConnectionValve invoked 2011-09-22 16:49:55,826 DEBUG [yjava.tomcat.valves.YahooConnectionValve] THREADID:1262 YahooConnectionValve request.getInfo(): org.apache.coyote.catalina.CoyoteRequest/1.0 2011-09-22 16:49:56,013 DEBUG [yjava.tomcat.valves.YahooConnectionValve] THREADID:1262 YahooConnectionValve request.getRemoteAddr(): 98.138.85.230 2011-09-22 16:49:56,014 DEBUG [yjava.tomcat.valves.YahooConnectionValve] THREADID:1262 YahooConnectionValve request.getRemoteHost(): web120016.mail.ne1.yahoo.com [][~]$ nslookup web120016.mail.ne1.yahoo.com Server: 10.72.226.8 Address: 10.72.226.8#53 Name: web120016.mail.ne1.yahoo.com Address: 98.138.85.143 2011-09-22 16:49:56,014 DEBUG [yjava.tomcat.valves.YahooConnectionValve] THREADID:1262 YahooConnectionValve request.getRequestedSessionId(): null 2011-09-22 16:49:56,015 DEBUG [yjava.tomcat.valves.YahooConnectionValve] THREADID:1262 YahooConnectionValve request.getHeader(): accept:*/* host:ls100.mail.vip.ne1.yahoo.com:4080 content-type:application/x-ypy yahoo-app-auth:v=1;a=yahoo.mail.acl.yca.lsg-prod;h=98.138.85.143;t=1319282225; content-length:574 2011-09-22 16:49:56,015 DEBUG [yjava.filter.address.RemoteIPTranslator] THREADID:1262 Got remote address '98.138.85.230' and port '46663'"	2011-09-22 17:52:57	1316730000	resolved fixed	18792f4	1317150000	java/org/apache/catalina/connector/CoyoteAdapter.java java/org/apache/coyote/ajp/AbstractAjpProcessor.java java/org/apache/coyote/ajp/AjpAprProcessor.java java/org/apache/coyote/ajp/AjpNioProcessor.java java/org/apache/coyote/ajp/AjpProcessor.java java/org/apache/coyote/http11/AbstractHttp11Processor.java	39:java/org/apache/catalina/connector/CoyoteAdapter.java 86:java/org/apache/coyote/http11/AbstractHttp11Processor.java 123:java/org/apache/coyote/ajp/AbstractAjpProcessor.java 163:java/org/apache/coyote/ajp/AjpProcessor.java 168:java/org/apache/coyote/ajp/AjpAprProcessor.java 313:java/org/apache/coyote/ajp/AjpNioProcessor.java
385	51887	Bug 51887 Speedup sessionid generation when running testsuite		2011-09-24 14:09:54	1316890000	resolved fixed	73a6e56	1316880000	test/org/apache/catalina/startup/FastNonSecureRandom.java test/org/apache/catalina/startup/TomcatBaseTest.java	113:test/org/apache/catalina/startup/TomcatBaseTest.java
386	51860	Bug 51860 HTTP/SSL with NIO won't work		2011-09-21 10:03:38	1316610000	resolved fixed	66f2d5b	1316610000	java/org/apache/tomcat/util/net/jsse/JSSEKeyManager.java	201:java/org/apache/tomcat/util/net/jsse/JSSEKeyManager.java
387	51852	Bug 51852 BeanELResolver varargs handling is broken in multiple ways		2011-09-20 19:16:07	1316560000	resolved fixed	bfabec5	1316610000	java/javax/el/BeanELResolver.java test/javax/el/TestBeanELResolverVarargsInvocation.java	1:java/javax/el/BeanELResolver.java
388	51580	Bug 51580 Severe error deploying WAR application (ExpandWar error)		2011-07-28 22:41:57	1311910000	resolved fixed	feff880	1316550000	java/org/apache/catalina/startup/ExpandWar.java	1:java/org/apache/catalina/startup/ExpandWar.java
389	51687	Bug 51687 Improve JreMemoryLeakPreventionListener against leak caused by sun.java2d.Disposer	"The sun.java2d.Disposer class, when loaded, starts an endless daemon thread that can inherit the WebappClassLoader as its context loader. This will cause a leak when the webapp is unloaded. It would be useful if JreMemoryLeakPreventionListener could load this class to prevent the leak."	2011-08-19 14:41:36	1313780000	resolved fixed	423fd89	1316550000	java/org/apache/catalina/core/JreMemoryLeakPreventionListener.java	1:java/org/apache/catalina/core/JreMemoryLeakPreventionListener.java
390	51811	Bug 51811 SSL configuration property name illegal		2011-09-14 14:57:22	1316030000	resolved fixed	9425437	1316350000	java/org/apache/coyote/http11/AbstractHttp11JsseProtocol.java test/org/apache/tomcat/util/net/TestCustomSsl.java	25:java/org/apache/coyote/http11/AbstractHttp11JsseProtocol.java 43:test/org/apache/tomcat/util/net/TestCustomSsl.java
391	51794	Bug 51794 Race condition in NioEndpoint$Poller causes socket to not be read until selectorTimeout	"I'm seeing an occasional race condition that happens between NioEndpoint$Poller#run and Http11NioProtocol finishing an event. What happens is that there is a race condition upon waking up the Selector that can cause a SelectionKey to not be marked with InterestOps.READ as soon as it could. The race is on Poller.wakeupCounter. These steps can occur which causes my SelectionKey to not have its interest ops reset soon and the Selector to not have wakeup() called on it. 1. Poller0 - Starts processing its run loop and calls events(). 2. Poller0 - Checks the wakeupCounter.get() > 0 which evaluates to false (wakeupCounter is 0). 3. Worker1 - Finishes an event and calls in to Poller#addEvent 4. Worker1 - Enqueues the PollerEvent that will reset the interest ops. 5. Worker1 - Calls wakeupCounter.incrementAndGet to increment and get wakeupCounter to 1. This fails the check to call selector.wakeup(); 6. Poller0 - Calls wakeupCounter.set(-1) 7. Poller0 - Calls selector.select(selectorTimeout) and blocks for either the full time out or until another unrelated SelectionKey is polled. 8. Poller0 - Ultimately gets around to calling events() again which now resets the interest ops for the SelectionKey that was processed by Worker1. The simple fix for this is to change this code: if (wakeupCounter.get() > 0) { //if we are here, means we have other stuff to do //do a non blocking select keyCount = selector.selectNow(); } else { wakeupCounter.set(-1); keyCount = selector.select(selectorTimeout); } to this if (wakeupCounter.getAndSet(-1) > 0) { //if we are here, means we have other stuff to do //do a non blocking select keyCount = selector.selectNow(); } else { keyCount = selector.select(selectorTimeout); }"	2011-09-09 18:51:35	1315610000	resolved fixed	58429a8	1316010000	java/org/apache/tomcat/util/net/NioEndpoint.java	1:java/org/apache/tomcat/util/net/NioEndpoint.java
392	51698	"Bug 51698 ajp CPing/Forward-Request packet forgery, is a design decision? or a security vulnerability?"		2011-08-20 07:54:08	1313840000	resolved fixed	a2538ce	1314650000	java/org/apache/coyote/ajp/AbstractAjpProcessor.java java/org/apache/coyote/ajp/AjpAprProcessor.java java/org/apache/coyote/ajp/AjpNioProcessor.java java/org/apache/coyote/ajp/AjpProcessor.java	3:java/org/apache/coyote/ajp/AbstractAjpProcessor.java 7:java/org/apache/coyote/ajp/AjpProcessor.java 9:java/org/apache/coyote/ajp/AjpAprProcessor.java 32:java/org/apache/coyote/ajp/AjpNioProcessor.java
393	51739	"Bug 51739 If landingpage is a XHTML (JSF/CDI), nullpointer exception."		2011-08-29 13:47:09	1314640000	resolved fixed	3513acc	1314640000	java/org/apache/catalina/authenticator/FormAuthenticator.java	1:java/org/apache/catalina/authenticator/FormAuthenticator.java
394	51712	Bug 51712 Regression in cache-control headers for requests with security-constraints		2011-08-23 20:55:25	1314150000	resolved fixed	196a8f5	1314630000	java/org/apache/catalina/authenticator/AuthenticatorBase.java	7:java/org/apache/catalina/authenticator/AuthenticatorBase.java
395	51736	Bug 51736 Make rpcTimeout configurable in BackupManager.	"Default rpcTimeout that BackupManager sets to AbstractReplicatedMap is 15000 msec. This is not configurable. When receiving MapMessage.MSG_START (and after a new member is added), publishEntryInfo is called for all sessions where primary and backup node are not included. And, the backup node is set to the session. When only one Tomcat starts in cluster, publishEntryInfo will be called for all sessions. As a result, the RPC message has the possibility of the timeout. When acquiring session from restarting Tomcat, warning of ""Unable to retrieve remote object for key:XXX"" is logged. And the session cannot be continued. I make rpcTimeout configurable in BackupManager. Additionally, if RPC message timeouted in AbstractReplicatedMap#broadcast, add warning message. Best Regards."	2011-08-29 10:26:09	1314630000	resolved fixed	87a32d6	1314610000	java/org/apache/catalina/ha/session/BackupManager.java java/org/apache/catalina/tribes/tipis/AbstractReplicatedMap.java	1:java/org/apache/catalina/tribes/tipis/AbstractReplicatedMap.java 2:java/org/apache/catalina/ha/session/BackupManager.java
396	51704	Bug 51704 Dubious use of mkdirs() return code in juli FileHandler		2011-08-22 13:17:27	1314030000	resolved fixed	4587f13	1314380000	java/org/apache/catalina/core/StandardContext.java java/org/apache/catalina/loader/WebappClassLoader.java java/org/apache/catalina/loader/WebappLoader.java java/org/apache/catalina/manager/ManagerServlet.java java/org/apache/catalina/manager/host/HostManagerServlet.java java/org/apache/catalina/servlets/CGIServlet.java java/org/apache/catalina/session/FileStore.java java/org/apache/catalina/startup/ExpandWar.java java/org/apache/catalina/startup/HostConfig.java java/org/apache/catalina/valves/AccessLogValve.java java/org/apache/jasper/JspCompilationContext.java java/org/apache/juli/FileHandler.java test/org/apache/catalina/connector/TestCoyoteAdapter.java test/org/apache/catalina/core/TestAsyncContextImpl.java test/org/apache/catalina/core/TestStandardContext.java test/org/apache/catalina/servlets/TestDefaultServlet.java test/org/apache/catalina/startup/TomcatBaseTest.java	1:java/org/apache/juli/FileHandler.java 12:java/org/apache/jasper/JspCompilationContext.java 14:java/org/apache/catalina/core/StandardContext.java 17:java/org/apache/catalina/manager/ManagerServlet.java 19:java/org/apache/catalina/session/FileStore.java 24:java/org/apache/catalina/loader/WebappLoader.java 27:java/org/apache/catalina/startup/HostConfig.java 29:java/org/apache/catalina/valves/AccessLogValve.java 37:java/org/apache/catalina/manager/host/HostManagerServlet.java 39:java/org/apache/catalina/loader/WebappClassLoader.java 68:test/org/apache/catalina/startup/TomcatBaseTest.java 77:java/org/apache/catalina/startup/ExpandWar.java 103:test/org/apache/catalina/connector/TestCoyoteAdapter.java 131:test/org/apache/catalina/core/TestStandardContext.java 134:test/org/apache/catalina/core/TestAsyncContextImpl.java 143:java/org/apache/catalina/servlets/CGIServlet.java 155:test/org/apache/catalina/servlets/TestDefaultServlet.java
397	51558	Bug 51558 Tomcat Embedded: using tomcat.addWebapp always overrides programmatic context-settings with default values for the context at start of tomcat server	"when i deploy an webapp with a tomcat server, i use the Function ""tomcat.addWebapp"". I looked into the code of this function and it makes the following call: ctx.addLifecycleListener(new DefaultWebXmlListener()); When i start tomcat, this DefaultWebXmlListener is activated automatically, and always does the following code, so the manager i set for my context gets overriden with this code: public static void initWebappDefaults(Context ctx) { ... // Sessions ctx.setManager( new StandardManager()); ctx.setSessionTimeout(30); ... } so when i set a StandardManager programatically, it gets overriden by this code. The workaround i used, is to unregister the DefaultWebXmlListener, and than add my own context.xml specific settings, like a custom manager for deactivating session persistance: Context warContext = tomcat.addWebapp(warContextPath, warLocation); LifecycleListener[] lclisteners = warContext.findLifecycleListeners(); LifecycleListener defaultWebXMLListener = null; for (int i=0; i < lclisteners.length; i++){ if (lclisteners[i] instanceof DefaultWebXmlListener){ defaultWebXMLListener = lclisteners[i]; } } warContext.removeLifecycleListener(defaultWebXMLListener); ... StandardManager manager = new StandardManager(); manager.setPathname(null); // disable session persistance: //manager.setPathname(""SESSIONS.ser""); warContext.setCookies(true); warContext.setCrossContext(true); warContext.setManager(manager); i think its a bug that using the ""tomcat.addWebapp"" method makes it impossible to set context.xml specific settings programmatically, because they always get overriden by default values at the tomcat start."	2011-07-26 10:11:48	1311690000	resolved fixed	25f02b4	1314370000	java/org/apache/catalina/startup/Tomcat.java test/org/apache/catalina/startup/TestTomcat.java	1:java/org/apache/catalina/startup/Tomcat.java 43:test/org/apache/catalina/startup/TestTomcat.java
398	51713	Bug 51713 Bad Connector protocol causes NullPointerException when using Executor	"Under the following configuration, an NPE is thrown because _setExecutor() calls con.getProtocolHandler().getClass() when the protocol handler is null. It would be nice to report a bad configuration instead of suffering an NPE. server.xml: <Executor name=""tomcatThreadPool"" namePrefix=""catalina-exec-"" maxThreads=""150"" minSpareThreads=""4""/> <Connector port=""12345"" redirectPort=""443"" protocol=""HTTP"" secure=""true"" scheme=""https"" proxyPort=""80"" URIEncoding=""UTF-8"" executor=""tomcatThreadPool"" /> catalina.out: Aug 23, 2011 5:18:30 PM org.apache.catalina.connector.Connector <init> SEVERE: Protocol handler instantiation failed Aug 23, 2011 5:18:30 PM org.apache.tomcat.util.digester.Digester startElement SEVERE: Begin event threw exception java.lang.NullPointerException at org.apache.catalina.startup.ConnectorCreateRule._setExecutor(ConnectorCreateRule.java:69) at org.apache.catalina.startup.ConnectorCreateRule.begin(ConnectorCreateRule.java:63) at org.apache.tomcat.util.digester.Digester.startElement(Digester.java:1276) at com.sun.org.apache.xerces.internal.parsers.AbstractSAXParser.startElement(AbstractSAXParser.java:501) at com.sun.org.apache.xerces.internal.parsers.AbstractXMLDocumentParser.emptyElement(AbstractXMLDocumentParser.java:179) at com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl.scanStartElement(XMLDocumentFragmentScannerImpl.java:1343) at com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl$FragmentContentDriver.next(XMLDocumentFragmentScannerImpl.java:2755) at com.sun.org.apache.xerces.internal.impl.XMLDocumentScannerImpl.next(XMLDocumentScannerImpl.java:648) at com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl.scanDocument(XMLDocumentFragmentScannerImpl.java:511) at com.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse(XML11Configuration.java:808) at com.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse(XML11Configuration.java:737) at com.sun.org.apache.xerces.internal.parsers.XMLParser.parse(XMLParser.java:119) at com.sun.org.apache.xerces.internal.parsers.AbstractSAXParser.parse(AbstractSAXParser.java:1205) at com.sun.org.apache.xerces.internal.jaxp.SAXParserImpl$JAXPSAXParser.parse(SAXParserImpl.java:522) at org.apache.tomcat.util.digester.Digester.parse(Digester.java:1537) at org.apache.catalina.startup.Catalina.load(Catalina.java:555) at org.apache.catalina.startup.Catalina.load(Catalina.java:596) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at java.lang.reflect.Method.invoke(Method.java:597) at org.apache.catalina.startup.Bootstrap.load(Bootstrap.java:281) at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:449) Aug 23, 2011 5:18:30 PM org.apache.catalina.startup.Catalina load WARNING: Catalina.start using conf/server.xml: Error at (104, 66) : null Aug 23, 2011 5:18:30 PM org.apache.catalina.connector.Connector <init> SEVERE: Protocol handler instantiation failed Aug 23, 2011 5:18:30 PM org.apache.tomcat.util.digester.Digester startElement SEVERE: Begin event threw exception java.lang.NullPointerException at org.apache.catalina.startup.ConnectorCreateRule._setExecutor(ConnectorCreateRule.java:69) at org.apache.catalina.startup.ConnectorCreateRule.begin(ConnectorCreateRule.java:63) at org.apache.tomcat.util.digester.Digester.startElement(Digester.java:1276) at com.sun.org.apache.xerces.internal.parsers.AbstractSAXParser.startElement(AbstractSAXParser.java:501) at com.sun.org.apache.xerces.internal.parsers.AbstractXMLDocumentParser.emptyElement(AbstractXMLDocumentParser.java:179) at com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl.scanStartElement(XMLDocumentFragmentScannerImpl.java:1343) at com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl$FragmentContentDriver.next(XMLDocumentFragmentScannerImpl.java:2755) at com.sun.org.apache.xerces.internal.impl.XMLDocumentScannerImpl.next(XMLDocumentScannerImpl.java:648) at com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl.scanDocument(XMLDocumentFragmentScannerImpl.java:511) at com.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse(XML11Configuration.java:808) at com.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse(XML11Configuration.java:737) at com.sun.org.apache.xerces.internal.parsers.XMLParser.parse(XMLParser.java:119) at com.sun.org.apache.xerces.internal.parsers.AbstractSAXParser.parse(AbstractSAXParser.java:1205) at com.sun.org.apache.xerces.internal.jaxp.SAXParserImpl$JAXPSAXParser.parse(SAXParserImpl.java:522) at org.apache.tomcat.util.digester.Digester.parse(Digester.java:1537) at org.apache.catalina.startup.Catalina.load(Catalina.java:555) at org.apache.catalina.startup.Catalina.start(Catalina.java:609) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at java.lang.reflect.Method.invoke(Method.java:597) at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:322) at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:450) Aug 23, 2011 5:18:31 PM org.apache.catalina.startup.Catalina load WARNING: Catalina.start using conf/server.xml: Error at (104, 66) : null Aug 23, 2011 5:18:31 PM org.apache.catalina.startup.Catalina start SEVERE: Cannot start server. Server instance is not configured."	2011-08-23 21:44:53	1314150000	resolved fixed	517fd9b	1314230000	java/org/apache/catalina/connector/Connector.java	1:java/org/apache/catalina/connector/Connector.java
399	51688	Bug 51688 JreMemoryLeakPreventionListener should protect against AWT thread creation	"Any webapp that calls java.awt.Toolkit.getDefaultToolkit will launch a new thread (AWT-Windows, AWT-XAWT, etc.) which will capture the ContextClassLoader, pinning the webapp in memory after an undeploy/redeploy. A simple addition to JreMemoryLeakPreventionListener can alleviate this condition."	2011-08-19 14:49:17	1313780000	resolved fixed	0cdbfa6	1314220000	java/org/apache/catalina/core/JreMemoryLeakPreventionListener.java	1:java/org/apache/catalina/core/JreMemoryLeakPreventionListener.java
400	49683	Bug 49683 Separate keep-alive and connection timeout with APR/native connector		2010-08-01 15:40:53	1280690000	resolved fixed	bf4a544	1313520000	java/org/apache/coyote/ajp/AjpAprProtocol.java java/org/apache/coyote/http11/Http11AprProtocol.java java/org/apache/tomcat/util/net/AprEndpoint.java	1:java/org/apache/tomcat/util/net/AprEndpoint.java 19:java/org/apache/coyote/ajp/AjpAprProtocol.java 43:java/org/apache/coyote/http11/Http11AprProtocol.java
401	51658	Bug 51658 Potential NPE in CoyoteAdapter.log		2011-08-13 11:10:19	1313250000	resolved fixed	5d55842	1313480000	java/org/apache/catalina/connector/CoyoteAdapter.java	1:java/org/apache/catalina/connector/CoyoteAdapter.java
402	51654	Bug 51654 NullPointerException in startup (org.apache.catalina.startup.HostConfig.filterAppPaths) due to missing app base	"A hard-to-diagnose NullPointerException at startup which can be bettered with an appropriate error message: INFO: Starting Servlet Engine: Apache Tomcat/7.0.19 java.lang.NullPointerException at org.apache.catalina.startup.HostConfig.filterAppPaths(HostConfig.java:493) at org.apache.catalina.startup.HostConfig.deployApps(HostConfig.java:466) at org.apache.catalina.startup.HostConfig.start(HostConfig.java:1322) at org.apache.catalina.startup.HostConfig.lifecycleEvent(HostConfig.java:311) at org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:119) at org.apache.catalina.util.LifecycleBase.fireLifecycleEvent(LifecycleBase.java:89) Ok, what's this about? In ""protected String[] filterAppPaths(String[] unfilteredAppPaths)"" the exception is raised at for (String appPath : unfilteredAppPaths) Which means the ""unfilteredAppPaths"" passed in is null. filterAppPaths does not check for that (shouldn't there be an assertion at least) The problems comes from ""deployApps()"": protected void deployApps() { File appBase = appBase(); File configBase = configBase(); String[] filteredAppPaths = filterAppPaths(appBase.list()); <---- // Deploy XML descriptors from configBase deployDescriptors(configBase, configBase.list()); // Deploy WARs, and loop if additional descriptors are found deployWARs(appBase, filteredAppPaths); // Deploy expanded folders deployDirectories(appBase, filteredAppPaths); } Where ""appBase.list()"" returns null. This must be because ""appBase"" does not actually denote a directory (A-HA!) Indeed, the server.xml points to a nonexisting appBase. Suggesting to add a check to ""deployApps"": protected void deployApps() { File appBase = appBase(); File configBase = configBase(); if (!appBase.exists() || appBase.list()==null) { throw new IllegalArgumentException(""The appBase "" + appBase + "" does not exist or cannot be listed""); } String[] filteredAppPaths = filterAppPaths(appBase.list()); <---- // Deploy XML descriptors from configBase deployDescriptors(configBase, configBase.list()); // Deploy WARs, and loop if additional descriptors are found deployWARs(appBase, filteredAppPaths); // Deploy expanded folders deployDirectories(appBase, filteredAppPaths); } This probably violates some I18N requirement though."	2011-08-12 10:36:54	1313160000	resolved fixed	c4d1631	1313430000	java/org/apache/catalina/startup/HostConfig.java	1:java/org/apache/catalina/startup/HostConfig.java
403	51650	Bug 51650 possible nullpointer exception in RequestUtil.parseParameters		2011-08-11 17:03:48	1313100000	resolved fixed	7562fc1	1313140000	java/org/apache/catalina/util/RequestUtil.java	1:java/org/apache/catalina/util/RequestUtil.java
404	41673	Bug 41673 Jasper output the message of compiling error using LF(\n) on ANY OS.	"Jasper output the message of compiling error using LF(\n) on ANY OS. This cannot be correctly displayed with Windows notepad. I think the line feed code along OS would be better, though I know other text editor solves this."	2007-02-21 17:37:02	1172100000	resolved fixed	841e9fc	1313000000	java/org/apache/jasper/compiler/DefaultErrorHandler.java java/org/apache/jasper/compiler/ErrorDispatcher.java	52:java/org/apache/jasper/compiler/DefaultErrorHandler.java 60:java/org/apache/jasper/compiler/ErrorDispatcher.java
405	51644	Bug 51644 Unable to deploy applications with the name a#b.xml	"When I try to deploy a context with the name ""a#b.xml"" I get the following exception. SEVERE: Unable to process JNDI URL [jndi:/localhost/sample/one/WEB-INF/classes] for annotations java.io.FileNotFoundException: jndi:/localhost/sample/one/WEB-INF/classes at org.apache.naming.resources.DirContextURLConnection.list(DirContextUR LConnection.java:452) at org.apache.catalina.startup.ContextConfig.processAnnotationsJndi(Cont extConfig.java:1901) at org.apache.catalina.startup.ContextConfig.processAnnotationsUrl(Conte xtConfig.java:1828) at org.apache.catalina.startup.ContextConfig.webConfig(ContextConfig.jav a:1295) at org.apache.catalina.startup.ContextConfig.configureStart(ContextConfi g.java:896) at org.apache.catalina.startup.ContextConfig.lifecycleEvent(ContextConfi g.java:322) at org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(Lifecycl eSupport.java:119) at org.apache.catalina.util.LifecycleBase.fireLifecycleEvent(LifecycleBa se.java:89) at org.apache.catalina.core.StandardContext.startInternal(StandardContex t.java:5103) at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:145) at org.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase .java:812) at org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:78 7) at org.apache.catalina.core.StandardHost.addChild(StandardHost.java:607) at org.apache.catalina.startup.HostConfig.deployDescriptor(HostConfig.ja va:633) at org.apache.catalina.startup.HostConfig.deployDescriptors(HostConfig.j ava:558) at org.apache.catalina.startup.HostConfig.deployApps(HostConfig.java:468 ) at org.apache.catalina.startup.HostConfig.check(HostConfig.java:1363) at org.apache.catalina.startup.HostConfig.lifecycleEvent(HostConfig.java :294) at org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(Lifecycl eSupport.java:119) at org.apache.catalina.util.LifecycleBase.fireLifecycleEvent(LifecycleBa se.java:89) at org.apache.catalina.core.ContainerBase.backgroundProcess(ContainerBas e.java:1233) at org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.p rocessChildren(ContainerBase.java:1391) at org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.p rocessChildren(ContainerBase.java:1401) at org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.r un(ContainerBase.java:1380) at java.lang.Thread.run(Thread.java:619) I would have expected the application to be available in the URI a/b. The bug seems to be in the ""list()"" method ""of DirContextURLConnection.java. The method assumes that context name does not have any ""/"" characters in it. See the developer note just before the ""if"" block. I have added the ""else if"" condition that seems to have solved the problem for me. try { String file = getURL().getFile(); // This will be of the form /<hostname>/<contextpath>/file name // if <contextpath> is not empty otherwise this will be of the // form /<hostname>/file name // Strip off the hostname and the contextpath int start; if(context instanceof ProxyDirContext && """".equals(((ProxyDirContext)context).getContextPath())){ start = file.indexOf('/',1); } else if(context instanceof ProxyDirContext){ start=""/"".length() +((ProxyDirContext)context).getHostName().length() +((ProxyDirContext)context).getContextPath().length(); /* * Seems like a bug in Tomcat. below was the code in Tomcat. * How can it handle contextpath like ""/sample/one"". It cannot */ //start = file.indexOf('/', file.indexOf('/', 1) + 1); } else start = file.indexOf('/', file.indexOf('/', 1) + 1); NamingEnumeration<NameClassPair> enumeration = context.list(file.substring(start)); while (enumeration.hasMoreElements()) { NameClassPair ncp = enumeration.nextElement(); result.addElement(ncp.getName()); } } catch (NamingException e) {"	2011-08-10 10:00:36	1312980000	resolved fixed	bb7072c	1313000000	java/org/apache/naming/resources/DirContextURLConnection.java	1:java/org/apache/naming/resources/DirContextURLConnection.java
406	51640	Bug 51640 clearReferencesJdbc seems to be causing leaks with com.oracle.ojdbc5 driver		2011-08-10 00:21:38	1312950000	resolved fixed	cd2fecd	1312980000	java/org/apache/catalina/core/JreMemoryLeakPreventionListener.java	12:java/org/apache/catalina/core/JreMemoryLeakPreventionListener.java
407	51641	Bug 51641 Http11NioProcessor not correct release	"org.apache.coyote.http11.Http11NioProtocol.Http11ConnectionHandler code segment: ================================== @Override public void release(SocketWrapper<NioChannel> socket) { Http11NioProcessor processor = connections.remove(socket); if (processor != null) { processor.recycle(); recycledProcessors.offer(processor); } } ================================== should be: ================================== @Override public void release(SocketWrapper<NioChannel> socket) { Http11NioProcessor processor = connections.remove(socket.getSocket()); if (processor != null) { processor.recycle(); recycledProcessors.offer(processor); } } ================================== type of connections is ConcurrentHashMap<NioChannel, Http11NioProcessor> , not ConcurrentHashMap<SocketWrapper<NioChannel>, Http11NioProcessor>."	2011-08-10 03:37:44	1312960000	resolved fixed	7ffca5b	1312980000	java/org/apache/coyote/http11/Http11NioProtocol.java	2:java/org/apache/coyote/http11/Http11NioProtocol.java
408	51615	"Bug 51615 Line 267 of ""org.apache.tomcat.jdbc.pool.PooledConnection"": double assignment typo"	"Nothing bad here, but my compiler lights up: connection = connection = driver.connect(driverURL, properties); Clearly, to be fixed."	2011-08-04 19:14:11	1312500000	resolved fixed	8c41e9c	1312560000	modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/PooledConnection.java	1:modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/PooledConnection.java
409	51610	Bug 51610 Context fails to reload after an error in web.xml was corrected	"With current trunk. Steps to reproduce: 1. Start Tomcat 7 2. Go to webapps/examples/WEB-INF/web.xml and uncomment <filter-mapping> for ""Timing Filter"" (line 75). 3. Wait several seconds. The examples webapp is reloaded, but fails to start. This happens because there is a typo. The <filter-name> value should be s/Timing Filter/Timing filter/. There is stack trace in the logs: [[[ 04.08.2011 8:09:39 org.apache.catalina.startup.HostConfig checkResources WARNING: Error during context [/examples] restart java.lang.IllegalArgumentException: Filter mapping specifies an unknown filter name Timing Filter at org.apache.catalina.core.StandardContext.validateFilterMap(StandardContext.java:2950) at org.apache.catalina.core.StandardContext.addFilterMap(StandardContext.java:2915) at org.apache.catalina.deploy.WebXml.configureContext(WebXml.java:1206) at org.apache.catalina.startup.ContextConfig.webConfig(ContextConfig.java:1343) at org.apache.catalina.startup.ContextConfig.configureStart(ContextConfig.java:896) at org.apache.catalina.startup.ContextConfig.lifecycleEvent(ContextConfig.java:322) at org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:119) at org.apache.catalina.util.LifecycleBase.fireLifecycleEvent(LifecycleBase.java:89) at org.apache.catalina.core.StandardContext.startInternal(StandardContext.java:5103) at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:145) at org.apache.catalina.startup.HostConfig.checkResources(HostConfig.java:1279) at org.apache.catalina.startup.HostConfig.check(HostConfig.java:1360) at org.apache.catalina.startup.HostConfig.lifecycleEvent(HostConfig.java:294) at org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:119) at org.apache.catalina.util.LifecycleBase.fireLifecycleEvent(LifecycleBase.java:89) at org.apache.catalina.core.ContainerBase.backgroundProcess(ContainerBase.java:1240) at org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.processChildren(ContainerBase.java:1398) at org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.processChildren(ContainerBase.java:1408) at org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.run(ContainerBase.java:1387) at java.lang.Thread.run(Thread.java:662) ]]] 4. Go to web.xml and edit it once again. E.g. re-comment the mapping, or correct the typo. 5. Wait several seconds. Here is an issue: EXPECTED: The examples webapp should reload successfully. ACTUAL: Reload fails. The following is printed in the logs: 04.08.2011 8:09:59 org.apache.catalina.startup.HostConfig checkResources INFO: Reloading context [/examples] 04.08.2011 8:09:59 org.apache.catalina.util.LifecycleBase start INFO: The start() method was called on component [StandardEngine[Catalina].StandardHost[localhost].StandardContext[/examples]] after start() had already been called. The second call will be ignored. 6. Stop Tomcat. Here is the second issue: EXPECTED: Successful shutdown ACTUAL: [[[ 04.08.2011 8:14:10 org.apache.catalina.startup.Catalina stop SEVERE: Catalina.stop org.apache.catalina.LifecycleException: An invalid Lifecycle transition was attempted ([before_stop]) for component [StandardEngine[Catalina].StandardHost[localhost].StandardContext[/examples]] in state [STARTING_PREP] at org.apache.catalina.util.LifecycleBase.invalidTransition(LifecycleBase.java:387) at org.apache.catalina.util.LifecycleBase.stop(LifecycleBase.java:212) at org.apache.catalina.core.ContainerBase.stopInternal(ContainerBase.java:1072) at org.apache.catalina.util.LifecycleBase.stop(LifecycleBase.java:225) at org.apache.catalina.core.ContainerBase.stopInternal(ContainerBase.java:1072) at org.apache.catalina.util.LifecycleBase.stop(LifecycleBase.java:225) at org.apache.catalina.core.StandardService.stopInternal(StandardService.java:502) at org.apache.catalina.util.LifecycleBase.stop(LifecycleBase.java:225) at org.apache.catalina.core.StandardServer.stopInternal(StandardServer.java:748) at org.apache.catalina.util.LifecycleBase.stop(LifecycleBase.java:225) at org.apache.catalina.startup.Catalina.stop(Catalina.java:694) at org.apache.catalina.startup.Catalina$CatalinaShutdownHook.run(Catalina.java:847) ]]] This exception at shutdown happens only if examples webapp was correct when Tomcat started, but was broken afterwards. If it was already broken at startup time, nothing happens. 7. Here is the third issue: when the above happens the shutdown sequence is apparently aborted abnormally. EXPECTED: ""INFO: Stopping ProtocolHandler [""http-bio-8080""]"" etc. messages ACTUAL: There are no messages after the ""SEVERE: Catalina.stop"" one that I cited above."	2011-08-04 04:28:49	1312450000	resolved fixed	ed0588b	1312560000	java/org/apache/catalina/util/LifecycleBase.java	3:java/org/apache/catalina/util/LifecycleBase.java
410	51614	Bug 51614 PersistentManager loads session from Store and calls session.expire() twice.	"To check whether session is loaded into memory, StoreBase#processExpires calls findSession(id). ===== ... if (manager.findSession(keys[i]) != null) { isLoaded = true; } ... ===== However, PersistentManager#findSession(id) loads session from Store when there is no session in memory. Because session loaded from Store is an invalid session PersistentManager logs errorlog, calls session.expire(), and deletes session from Store. As a result, findSession(id) returns null, and isLoaded becomes false. And, session.expire() is called again, and the session is deleted from Store. If manager is PersistentManager, it is necessary to call PersistentManagerBase#isLoaded(id). However, to avoid regression of r1033024, other managers call findSession(id). Best regards."	2011-08-04 11:19:47	1312470000	resolved fixed	29e9966	1312460000	java/org/apache/catalina/session/StoreBase.java	2:java/org/apache/catalina/session/StoreBase.java
411	51588	Bug 51588 Change access modifiers in AccessLogValve to make it easier to extend	I'm adding some fields to a subclass of org.apache.catalina.valves.AccessLogValve but createLogElements() is the closest extension point available. Rather than reimplement the functionality there it would be preferable if both of the createAccessLogElement() methods were protected rather than private then it's a simple method of matching the char you want to use and falling back to super.createAccessLogElement().	2011-07-30 02:33:45	1312010000	resolved fixed	77213bb	1312130000	java/org/apache/catalina/valves/AccessLogValve.java	1:java/org/apache/catalina/valves/AccessLogValve.java
412	51586	Bug 51586 ContextConfig.checkHandlesTypes() doesn't check for VerifyError when loading class	"I've recently upgraded to Tomcat 7 and used to run with metadata-complete=""true"" in my web.xml. With Servlet 3 I decided I'd try some of the annotation features. When I turned off metadata-complete I got a VerifyError trying to load one of my classes. This class is meant to only work on Tomcat 6 so the fact Tomcat 7 cannot load this class is expected. What is not expected is that Tomcat 7 doesn't just ignore the error and continue scanning for annotations. Looking in ContextConfig.checkHandlesTypes() I checks for virtually every type of loading failure except VerifyError. Perhaps VerifyError should be added to this list? java.lang.VerifyError: class org.lds.stack.tomcat.decrypt.DecryptingStandardContext overrides final method start.()V at java.lang.ClassLoader.defineClass1(Native Method) at java.lang.ClassLoader.defineClassCond(ClassLoader.java:631) at java.lang.ClassLoader.defineClass(ClassLoader.java:615) at java.security.SecureClassLoader.defineClass(SecureClassLoader.java:141) at java.net.URLClassLoader.defineClass(URLClassLoader.java:283) at java.net.URLClassLoader.access$000(URLClassLoader.java:58) at java.net.URLClassLoader$1.run(URLClassLoader.java:197) at java.security.AccessController.doPrivileged(Native Method) at java.net.URLClassLoader.findClass(URLClassLoader.java:190) at java.lang.ClassLoader.loadClass(ClassLoader.java:306) at java.lang.ClassLoader.loadClass(ClassLoader.java:247) at java.lang.Class.forName0(Native Method) at java.lang.Class.forName(Class.java:247) at org.apache.catalina.loader.WebappClassLoader.loadClass(WebappClassLoader.java:1665) at org.apache.catalina.loader.WebappClassLoader.loadClass(WebappClassLoader.java:1523) at org.apache.catalina.startup.ContextConfig.checkHandlesTypes(ContextConfig.java:2006) at org.apache.catalina.startup.ContextConfig.processAnnotationsStream(ContextConfig.java:1969) at org.apache.catalina.startup.ContextConfig.processAnnotationsJar(ContextConfig.java:1858) at org.apache.catalina.startup.ContextConfig.processAnnotationsUrl(ContextConfig.java:1826) at org.apache.catalina.startup.ContextConfig.processAnnotations(ContextConfig.java:1812) at org.apache.catalina.startup.ContextConfig.webConfig(ContextConfig.java:1306) at org.apache.catalina.startup.ContextConfig.configureStart(ContextConfig.java:896) at org.apache.catalina.startup.ContextConfig.lifecycleEvent(ContextConfig.java:322) at org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:119) at org.apache.catalina.util.LifecycleBase.fireLifecycleEvent(LifecycleBase.java:89) at org.apache.catalina.core.StandardContext.startInternal(StandardContext.java:5103) at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:145) at org.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:812) at org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:787) at org.apache.catalina.core.StandardHost.addChild(StandardHost.java:607) at org.apache.catalina.startup.HostConfig.deployDescriptor(HostConfig.java:633) at org.apache.catalina.startup.HostConfig.deployDescriptors(HostConfig.java:558) at org.apache.catalina.startup.HostConfig.deployApps(HostConfig.java:468) at org.apache.catalina.startup.HostConfig.start(HostConfig.java:1322) at org.apache.catalina.startup.HostConfig.lifecycleEvent(HostConfig.java:311) at org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:119) at org.apache.catalina.util.LifecycleBase.fireLifecycleEvent(LifecycleBase.java:89) at org.apache.catalina.util.LifecycleBase.setStateInternal(LifecycleBase.java:379) at org.apache.catalina.util.LifecycleBase.setState(LifecycleBase.java:324) at org.apache.catalina.core.ContainerBase.startInternal(ContainerBase.java:1041) at org.apache.catalina.core.StandardHost.startInternal(StandardHost.java:774) at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:145) at org.apache.catalina.core.ContainerBase.startInternal(ContainerBase.java:1033) at org.apache.catalina.core.StandardEngine.startInternal(StandardEngine.java:291) at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:145) at org.apache.catalina.core.StandardService.startInternal(StandardService.java:443) at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:145) at org.apache.catalina.core.StandardServer.startInternal(StandardServer.java:727) at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:145) at org.apache.catalina.startup.Catalina.start(Catalina.java:621) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at java.lang.reflect.Method.invoke(Method.java:597) at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:322) at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:450)"	2011-07-29 19:25:49	1311980000	resolved fixed	0b340ac	1312130000	java/org/apache/catalina/startup/ContextConfig.java	1:java/org/apache/catalina/startup/ContextConfig.java
413	51557	Bug 51557 Newline during a http header field name obscures next value		2011-07-26 06:12:43	1311680000	resolved fixed	6200dd9	1311760000	java/org/apache/coyote/http11/AbstractInputBuffer.java java/org/apache/coyote/http11/InternalAprInputBuffer.java java/org/apache/coyote/http11/InternalInputBuffer.java java/org/apache/coyote/http11/InternalNioInputBuffer.java test/org/apache/coyote/http11/TestInternalInputBuffer.java	18:java/org/apache/coyote/http11/InternalInputBuffer.java 19:java/org/apache/coyote/http11/InternalAprInputBuffer.java 56:java/org/apache/coyote/http11/InternalNioInputBuffer.java 121:java/org/apache/coyote/http11/AbstractInputBuffer.java 338:test/org/apache/coyote/http11/TestInternalInputBuffer.java
414	51545	Bug 51545 make threadname available in ExtendedAccessLogValve		2011-07-23 09:07:02	1311430000	resolved fixed	00a1fdf	1311670000	java/org/apache/catalina/valves/ExtendedAccessLogValve.java	1:java/org/apache/catalina/valves/ExtendedAccessLogValve.java
415	51555	Bug 51555 An invalid Lifecycle transition ([before_stop]) for component in state [INITIALIZED]: MapperListener		2011-07-25 21:40:38	1311640000	resolved fixed	95d67fe	1311670000	java/org/apache/catalina/Lifecycle.java java/org/apache/catalina/util/LifecycleBase.java	2:java/org/apache/catalina/Lifecycle.java 4:java/org/apache/catalina/util/LifecycleBase.java
416	41709	"Bug 41709 When calling the API that relates to the buffer after the response is committed, ISE with no messages is thrown."	"After the response is committed, following API throws IllegalStateException. It's O.K. but the message of the exception is not set. - HttpServletResponse#resetBuffer - HttpServletResponse#sendError - HttpServletResponse#sendRedirect - HttpServletResponse#setBufferSize To understand the bug of the application, it is hoped that the message is set like other exceptions."	2007-02-26 17:43:51	1172530000	resolved fixed	8baaa98	1311360000	java/org/apache/catalina/connector/ResponseFacade.java	7:java/org/apache/catalina/connector/ResponseFacade.java
417	51056	Bug 51056 Disable / drop support for SSLv2		2011-04-13 14:12:26	1302720000	resolved fixed	4d9fcc0	1311240000	java/org/apache/tomcat/jni/SSL.java	13:java/org/apache/tomcat/jni/SSL.java
418	51532	Bug 51532 Performance Issue when retriving JAR files during TLD file parsing.		2011-07-19 21:47:15	1311130000	resolved fixed	bcee77d	1311190000	java/org/apache/jasper/compiler/Compiler.java	31:java/org/apache/jasper/compiler/Compiler.java
419	51509	Bug 51509 Csrf Prevention Filter's LruCache is not thread save	"The LruCache (org.apache.catalina.filters.CsrfPreventionFilter$LruCache) use by Csrf Prevention Filter is base on LinkedHashMap. From the LinkedHashMap Java Doc: Note that this implementation is not synchronized. If multiple threads access a linked hash map concurrently, and at least one of the threads modifies the map structurally, it must be synchronized externally. ... But the LruCache implementation does not synchronize the access to the map."	2011-07-14 14:54:22	1310670000	resolved fixed	400745e	1311100000	java/org/apache/catalina/filters/CsrfPreventionFilter.java test/org/apache/catalina/filters/TestCsrfPreventionFilter2.java	1:java/org/apache/catalina/filters/CsrfPreventionFilter.java
420	51518	"Bug 51518 ""/absolute-ordering/name/others"" should not include ""name"" element"	"method: org.apache.catalina.startup.WebRuleSet.addRuleInstances(Digester digester) code: ==================================================== digester.addCallMethod(fullPrefix + ""/absolute-ordering/name/others"", ""addAbsoluteOrderingOthers""); ==================================================== web-common_3_0.xsd ==================================================== <xsd:complexType name=""absoluteOrderingType""> <xsd:annotation> <xsd:documentation> Please see section 8.2.2 of the specification for details. </xsd:documentation> </xsd:annotation> <xsd:choice minOccurs=""0"" maxOccurs=""unbounded""> <xsd:element name=""name"" type=""javaee:java-identifierType"" minOccurs=""0"" maxOccurs=""unbounded""/> <xsd:element name=""others"" type=""javaee:ordering-othersType"" minOccurs=""0"" maxOccurs=""1""/> </xsd:choice> </xsd:complexType> ===================================================="	2011-07-17 01:22:30	1310880000	resolved fixed	5de2739	1311080000	java/org/apache/catalina/startup/WebRuleSet.java	1:java/org/apache/catalina/startup/WebRuleSet.java
421	49595	Bug 49595 Tomcat crashes in tcnative-1.dll frequently		2010-07-15 06:34:41	1279190000	resolved fixed	a3f3379	1311060000	java/org/apache/coyote/ajp/AjpAprProcessor.java	225:java/org/apache/coyote/ajp/AjpAprProcessor.java
422	51503	"Bug 51503 Additional error checking required for connector port attribute (e.g. for port="""")"	"With 7.0.18 packaged as a candidate for release and finally unreleased, when I stop the Tomcat service (only 1 war deployed), the service takes a lot of time to stop and finally was killed by system. Having a look into the stderr log, I see it paused right after the folowing line : INFO: Stopping ProtocolHandler [http-apr-0] Then went into a slow loop and fill the log with these lines : 13 juil. 2011 14:30:30 org.apache.tomcat.util.net.AprEndpoint stopInternal ATTENTION: Acceptor thread [http-apr-0-Acceptor-0] failed to unlock. Forcing hard socket shutdown. 13 juil. 2011 14:30:31 org.apache.tomcat.util.net.AprEndpoint stopInternal ATTENTION: Acceptor thread [http-apr-0-Acceptor-0] failed to unlock. Forcing hard socket shutdown. 13 juil. 2011 14:30:32 org.apache.tomcat.util.net.AprEndpoint stopInternal ATTENTION: Acceptor thread [http-apr-0-Acceptor-0] failed to unlock. Forcing hard socket shutdown. etc. (about 30 times before it was killed) I think there was no such issue with 7.0.16."	2011-07-13 12:40:11	1310580000	resolved fixed	1e79993	1311010000	java/org/apache/catalina/connector/Connector.java	10:java/org/apache/catalina/connector/Connector.java
423	51477	Bug 51477 Support all protocol combinations in SSLProtocol of APR Connector		2011-07-05 16:53:25	1309900000	resolved fixed	6ee5a22	1310400000	java/org/apache/tomcat/jni/Library.java java/org/apache/tomcat/util/net/AprEndpoint.java	1:java/org/apache/tomcat/jni/Library.java 2:java/org/apache/tomcat/util/net/AprEndpoint.java
424	46252	Bug 46252 Tomcat access log doesn't support Unicode	"AccessLogValve, which is responsible for handling the access log uses FileWriter (that doesn't support Unicode). I guess that instantiating the writer like this would solve the case: writer = new PrintWriter(new OutputStreamWriter(new FileOutputStream(pathname), ""UTF-8""), true);"	2008-11-20 11:18:55	1227200000	resolved fixed	871dabd	1310400000	java/org/apache/catalina/valves/AccessLogValve.java	1:java/org/apache/catalina/valves/AccessLogValve.java
425	51494	Bug 51494 NPE in StandardContextValve.invoke() when a webapp is redeployed while a request is still being processed		2011-07-10 01:56:23	1310280000	resolved fixed	3a95db4	1310390000	java/org/apache/catalina/core/StandardContextValve.java	1:java/org/apache/catalina/core/StandardContextValve.java
426	51475	Bug 51475 GzipInterceptor#decompress is not completly implemented		2011-07-05 09:58:12	1309870000	resolved fixed	acc5619	1309880000	java/org/apache/catalina/tribes/group/interceptors/GzipInterceptor.java test/org/apache/catalina/tribes/group/interceptors/TestGzipInterceptor.java	1:java/org/apache/catalina/tribes/group/interceptors/GzipInterceptor.java 2:test/org/apache/catalina/tribes/group/interceptors/TestGzipInterceptor.java
427	51473	"Bug 51473 SecurityConfig,set ""package.definition"" security property to ""nullsun.,java.,..."""		2011-07-05 05:37:09	1309860000	resolved fixed	ec00abf	1309850000	java/org/apache/catalina/security/SecurityConfig.java	1:java/org/apache/catalina/security/SecurityConfig.java
428	51467	Bug 51467 usage of method run instead of start to start a thread	"In StandardContext method Thread#run is used. This is most probably a mistake, since a few lines below Thread#join is called to wait for the completion of the thread. So we could either remove the join and get rid of the thread by using just a runnable, or start the thread."	2011-07-03 10:19:46	1309700000	resolved fixed	eb98373	1309780000	java/org/apache/catalina/core/StandardContext.java	1:java/org/apache/catalina/core/StandardContext.java
429	51466	Bug 51466 typos in comments of HostManagerServlet		2011-07-02 14:09:02	1309630000	resolved fixed	6020bf6	1309780000	java/org/apache/catalina/manager/host/HostManagerServlet.java	1:java/org/apache/catalina/manager/host/HostManagerServlet.java
430	51453	Bug 51453 Requests to open URL that include an Authorization header do not reach servlet	"In Tomcat 7, I've noticed that a request to a URL that does not require authentication will get forwarded to the login page if the request contains an ""Authorization"" header. Our application expects these requests to be processed by the servlet. The servlet parses the Authorization header and takes appropriate action (possibly redirecting to the login page or allowing the request if the headers contain an acceptible token). This has worked in older versions of Tomcat. The relevant part of our web.xml looks like: <security-constraint> <web-resource-collection> <web-resource-name>open</web-resource-name> <url-pattern>/*</url-pattern> <!-- several other url patterns --> </web-resource-collection> <user-data-constraint> <transport-guarantee>CONFIDENTIAL</transport-guarantee> </user-data-constraint> <!-- Notice no auth-constraint element --> </security-constraint> I observed the behavior of org.apache.catalina.authenticator.AuthenticatorBase.invoke(), here's what I saw: The constraints variable contains a single constraint that matches the security constraint from our web.xml above. On line 520, authRequired is set to true because of the presence of the Authorization header. The authenticate() call on line 535 fails and redirects to the login page."	2011-06-30 14:10:50	1309460000	resolved fixed	df9bc17	1309450000	java/org/apache/catalina/authenticator/AuthenticatorBase.java	2:java/org/apache/catalina/authenticator/AuthenticatorBase.java
431	51088	Bug 51088 ArrayIndexOutOfBoundsException from org.apache.el.parser.JJTELParserState	I found the following ArrayIndexOutOfBoundsException in my logfile. It occurred directly after login into my webApp without any further user interaction. Unfortunately it is not reproducible at all. I am not sure whether Jasper is the right component. However the class JJTELParserState is in the jasper-el.jar. Environment: Tomcat 6.0.32 Facelets 1.1.14 Myfaces 1.2.9 SCHWERWIEGEND: Error Rendering View[/facelets/myview.xhtml] java.lang.ArrayIndexOutOfBoundsException: -1 at java.util.ArrayList.remove(ArrayList.java:390) at org.apache.el.parser.JJTELParserState.closeNodeScope(JJTELParserState.java:108) at org.apache.el.parser.ELParser.CompositeExpression(ELParser.java:74) at org.apache.el.lang.ExpressionBuilder.createNodeInternal(ExpressionBuilder.java:115) at org.apache.el.lang.ExpressionBuilder.build(ExpressionBuilder.java:172) at org.apache.el.lang.ExpressionBuilder.createValueExpression(ExpressionBuilder.java:216) at org.apache.el.ExpressionFactoryImpl.createValueExpression(ExpressionFactoryImpl.java:68) at com.sun.facelets.el.ELText$ELTextVariable.apply(ELText.java:161) at com.sun.facelets.compiler.AttributeInstruction.apply(AttributeInstruction.java:60) at com.sun.facelets.compiler.UIInstructionHandler.apply(UIInstructionHandler.java:95) at com.sun.facelets.tag.CompositeFaceletHandler.apply(CompositeFaceletHandler.java:47) at com.sun.facelets.tag.jstl.core.IfHandler.apply(IfHandler.java:54) at com.sun.facelets.tag.CompositeFaceletHandler.apply(CompositeFaceletHandler.java:47) at com.sun.facelets.tag.jsf.ComponentHandler.applyNextHandler(ComponentHandler.java:360) at com.sun.facelets.tag.jsf.ComponentHandler.apply(ComponentHandler.java:190) at com.sun.facelets.tag.CompositeFaceletHandler.apply(CompositeFaceletHandler.java:47) at com.sun.facelets.tag.jsf.ComponentHandler.applyNextHandler(ComponentHandler.java:360) at com.sun.facelets.tag.jsf.ComponentHandler.apply(ComponentHandler.java:190) at com.sun.facelets.tag.CompositeFaceletHandler.apply(CompositeFaceletHandler.java:47) at com.sun.facelets.tag.jsf.ComponentHandler.applyNextHandler(ComponentHandler.java:360) at org.apache.myfaces.custom.aliasbean.AliasBeansScopeTagHandler.applyNextHandler(AliasBeansScopeTagHandler.java:52) at com.sun.facelets.tag.jsf.ComponentHandler.apply(ComponentHandler.java:190) at com.sun.facelets.tag.CompositeFaceletHandler.apply(CompositeFaceletHandler.java:47) at com.sun.facelets.tag.ui.CompositionHandler.apply(CompositionHandler.java:124) at com.sun.facelets.compiler.NamespaceHandler.apply(NamespaceHandler.java:49) at com.sun.facelets.compiler.EncodingHandler.apply(EncodingHandler.java:39) at com.sun.facelets.impl.DefaultFacelet.include(DefaultFacelet.java:248) at com.sun.facelets.impl.DefaultFacelet.include(DefaultFacelet.java:294) at com.sun.facelets.impl.DefaultFacelet.include(DefaultFacelet.java:273) at com.sun.facelets.impl.DefaultFaceletContext.includeFacelet(DefaultFaceletContext.java:140) at com.sun.facelets.tag.ui.IncludeHandler.apply(IncludeHandler.java:66) at com.sun.facelets.tag.ui.DefineHandler.applyDefinition(DefineHandler.java:64) at com.sun.facelets.tag.ui.CompositionHandler.apply(CompositionHandler.java:136) at com.sun.facelets.impl.DefaultFaceletContext$TemplateManager.apply(DefaultFaceletContext.java:337) at com.sun.facelets.impl.DefaultFaceletContext.includeDefinition(DefaultFaceletContext.java:307) at com.sun.facelets.tag.ui.InsertHandler.apply(InsertHandler.java:68) at com.sun.facelets.tag.CompositeFaceletHandler.apply(CompositeFaceletHandler.java:47) at com.sun.facelets.tag.jsf.ComponentHandler.applyNextHandler(ComponentHandler.java:360) at com.sun.facelets.tag.jsf.ComponentHandler.apply(ComponentHandler.java:190) at com.sun.facelets.tag.CompositeFaceletHandler.apply(CompositeFaceletHandler.java:47) at com.sun.facelets.tag.jsf.ComponentHandler.applyNextHandler(ComponentHandler.java:360) at com.sun.facelets.tag.jsf.ComponentHandler.apply(ComponentHandler.java:190) at com.sun.facelets.tag.CompositeFaceletHandler.apply(CompositeFaceletHandler.java:47) at com.sun.facelets.tag.ui.CompositionHandler.apply(CompositionHandler.java:124) at com.sun.facelets.compiler.NamespaceHandler.apply(NamespaceHandler.java:49) at com.sun.facelets.compiler.EncodingHandler.apply(EncodingHandler.java:39) at com.sun.facelets.impl.DefaultFacelet.include(DefaultFacelet.java:248) at com.sun.facelets.impl.DefaultFacelet.include(DefaultFacelet.java:294) at com.sun.facelets.impl.DefaultFacelet.include(DefaultFacelet.java:273) at com.sun.facelets.impl.DefaultFaceletContext.includeFacelet(DefaultFaceletContext.java:140) at com.sun.facelets.tag.ui.CompositionHandler.apply(CompositionHandler.java:116) at com.sun.facelets.compiler.NamespaceHandler.apply(NamespaceHandler.java:49) at com.sun.facelets.compiler.EncodingHandler.apply(EncodingHandler.java:39) at com.sun.facelets.impl.DefaultFacelet.apply(DefaultFacelet.java:95) at com.sun.facelets.FaceletViewHandler.buildView(FaceletViewHandler.java:596) at com.sun.facelets.FaceletViewHandler.renderView(FaceletViewHandler.java:651) at org.ajax4jsf.application.ViewHandlerWrapper.renderView(ViewHandlerWrapper.java:100) at org.ajax4jsf.application.AjaxViewHandler.renderView(AjaxViewHandler.java:176) at org.apache.myfaces.lifecycle.RenderResponseExecutor.execute(RenderResponseExecutor.java:41) at org.apache.myfaces.lifecycle.LifecycleImpl.render(LifecycleImpl.java:140) at org.apache.myfaces.custom.ppr.PPRLifecycleWrapper.render(PPRLifecycleWrapper.java:84) at javax.faces.webapp.FacesServlet.service(FacesServlet.java:187) at com.foo..client.web.servlets.FacesServletWrapper.service(FacesServletWrapper.java:125) at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:290) at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206) at org.ajax4jsf.webapp.BaseXMLFilter.doXmlFilter(BaseXMLFilter.java:206) at org.ajax4jsf.webapp.BaseFilter.handleRequest(BaseFilter.java:290) at org.ajax4jsf.webapp.BaseFilter.processUploadsAndHandleRequest(BaseFilter.java:388) at org.ajax4jsf.webapp.BaseFilter.doFilter(BaseFilter.java:515) at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235) at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206) at org.apache.myfaces.webapp.filter.ExtensionsFilter.doFilter(ExtensionsFilter.java:392) at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235) at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206) at com.foo..client.web.filters.LoginFilter.doFilter(LoginFilter.java:219) at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235) at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206) at com.foo..client.web.filters.CacheFilter.doFilter(CacheFilter.java:110) at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235) at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206) at com.foo..client.web.filters.EncodingFilter.doFilter(EncodingFilter.java:54) at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235) at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206) at com.foo..client.web.filters.TimerFilter.doFilter(TimerFilter.java:80) at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235) at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206) at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:233) at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191) at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:470) at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:127) at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:102) at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:109) at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:298) at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:859) at org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.process(Http11Protocol.java:588) at org.apache.tomcat.util.net.JIoEndpoint$Worker.run(JIoEndpoint.java:489) at java.lang.Thread.run(Thread.java:662)	2011-04-20 05:42:42	1303290000	resolved wontfix	92af111	1309360000	java/org/apache/el/lang/ExpressionBuilder.java	37:java/org/apache/el/lang/ExpressionBuilder.java
432	51436	Bug 51436 ServletRequestListener fails to access request parameters when an Expect-Header is sent		2011-06-27 09:56:45	1309180000	resolved fixed	6dffc54	1309280000	java/org/apache/catalina/core/StandardContextValve.java java/org/apache/catalina/core/StandardWrapperValve.java	13:java/org/apache/catalina/core/StandardContextValve.java 375:java/org/apache/catalina/core/StandardWrapperValve.java
433	50353	Bug 50353 Calling asyncContext.getResponse() returns null after async timeout	"If the async thread calls asyncContext.getResponse() after the async timeout, it gets a null reference. In the following example, it leads to a NPE. The servlet spec is not very clear on the behavior to adopt after a timeout, but I don't think null should be returned. Maybe an IllegalStateException instead ? It seems to be the case if complete() is called after the timeout. package test; import java.io.IOException; import java.io.PrintWriter; import javax.servlet.AsyncContext; import javax.servlet.AsyncEvent; import javax.servlet.AsyncListener; import javax.servlet.ServletException; import javax.servlet.ServletResponse; import javax.servlet.annotation.WebServlet; import javax.servlet.http.HttpServlet; import javax.servlet.http.HttpServletRequest; import javax.servlet.http.HttpServletResponse; /** * Servlet implementation class MyServlet */ @WebServlet(value = ""/MyServlet"", asyncSupported = true) public class MyServlet extends HttpServlet implements AsyncListener { private static final long serialVersionUID = 1L; protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException { final AsyncContext asyncContext = request.startAsync(request, response); asyncContext.addListener(this); asyncContext.setTimeout(10*1000); asyncContext.start(new Runnable() { @Override public void run() { System.out.println(""Entering async thread""); try { Thread.sleep(20 * 1000); System.out.println(""<Asyncthread> about to write response""); ServletResponse response2 = asyncContext.getResponse(); PrintWriter writer = response2.getWriter(); writer.write(""Hello world""); System.out.println(""<Asyncthread> about to complete""); asyncContext.complete(); } catch (Exception e) { e.printStackTrace(); } } }); } @Override public void onComplete(AsyncEvent evt) throws IOException { System.out.println(""onComplete "" + evt); } @Override public void onError(AsyncEvent evt) throws IOException { System.out.println(""onError "" + evt); } @Override public void onStartAsync(AsyncEvent evt) throws IOException { System.out.println(""onStartAsync "" + evt); } @Override public void onTimeout(AsyncEvent evt) throws IOException { System.out.println(""onTimeout "" + evt); evt.getAsyncContext().getResponse().getWriter().write(""Timed out""); evt.getAsyncContext().complete(); } }"	2010-11-27 17:45:41	1290900000	resolved fixed	d36c5d9	1309280000	java/org/apache/catalina/core/AsyncContextImpl.java	6:java/org/apache/catalina/core/AsyncContextImpl.java
434	51447	Bug 51447 Session type changes from Backup to Primary		2011-06-28 11:15:18	1309270000	resolved fixed	3d85a85	1309280000	java/org/apache/catalina/manager/HTMLManagerServlet.java	14:java/org/apache/catalina/manager/HTMLManagerServlet.java
435	51418	Bug 51418 Allow more flexibility in adding webapps to org.apache.catalina.startup.Tomcat		2011-06-22 15:54:00	1308770000	resolved fixed	f83c07e	1308770000	java/org/apache/catalina/startup/Tomcat.java	1:java/org/apache/catalina/startup/Tomcat.java
436	51403	Bug 51403 Avoid NullPointerException in JULI FileHandler if formatter is misconfigured	"If formatter assigned to org.apache.juli.FileHandler in logging.properties is misconfigured and fails to load, the FileHandler starts without formatter and fails with an NPE later. To reproduce: assign some bogus value to 1catalina.org.apache.juli.FileHandler.formatter When Tomcat starts, the following will be printed at the console: java.util.logging.ErrorManager: 4 java.lang.NullPointerException at org.apache.juli.FileHandler.openWriter(FileHandler.java:377) at org.apache.juli.FileHandler.<init>(FileHandler.java:99) at org.apache.juli.FileHandler.<init>(FileHandler.java:90) I think we can be more tolerant to this configuration error and fall back to the default formatter. I will commit a fix shortly."	2011-06-21 13:13:00	1308680000	resolved fixed	f2dd57b	1308660000	java/org/apache/juli/FileHandler.java	1:java/org/apache/juli/FileHandler.java
437	51401	Bug 51401 java.lang.IllegalArgumentException: <session-config> element is limited to 1 occurrence		2011-06-21 01:36:08	1308630000	resolved fixed	7c274bb	1308650000	java/org/apache/catalina/startup/WebRuleSet.java	4:java/org/apache/catalina/startup/WebRuleSet.java
438	51396	Bug 51396 Embedding class cannot launch a webapp with a jsp servlet		2011-06-20 17:02:09	1308600000	resolved fixed	f75418b	1308610000	java/org/apache/catalina/startup/ContextConfig.java test/org/apache/catalina/startup/TestContextConfig.java	11:java/org/apache/catalina/startup/ContextConfig.java 259:test/org/apache/catalina/startup/TestContextConfig.java
439	49165	Bug 49165 Enhancement - Allow %{TIME_FORMAT}t As Configuration for AccessLogValve	"AccessLogValve.DateAndTimeElement() can currently be configured only with %t which output the date/time in Common Log Format. By adding the capability to configure with %{TIME_FORMAT}, one could override (at least) the timeFormatter property of the class ... or it could go further and allow overriding of all the [day, month, year, time]Formatter properties. Justification for enhancement: The log currenlty provide the ability to log processing time in millis (via %T), but an accurate log of the order in which requests are received cannot be determined without the capabilities of logging a a format with milliseconds using the %t element."	2010-04-21 14:20:08	1271870000	resolved fixed	7d6c439	1308480000	java/org/apache/catalina/valves/AccessLogValve.java	1:java/org/apache/catalina/valves/AccessLogValve.java
440	51386	Bug 51386 @HandlingType not correctly handled at server startup leads to incorrect classes set passed to initializers		2011-06-16 14:12:27	1308250000	resolved fixed	9f8b983	1308240000	java/org/apache/catalina/startup/ContextConfig.java test/org/apache/catalina/startup/TestContextConfigAnnotation.java	6:java/org/apache/catalina/startup/ContextConfig.java 307:test/org/apache/catalina/startup/TestContextConfigAnnotation.java
441	48956	Bug 48956 SSI regular expressions not working		2010-03-22 11:48:29	1269270000	resolved fixed	874048a	1308180000	java/org/apache/catalina/ssi/ExpressionParseTree.java	3:java/org/apache/catalina/ssi/ExpressionParseTree.java
442	43538	Bug 43538 [patch] Show the hostname and IP address in the manager webapp	"We have an environment with a couple of load-balanced Tomcats fronted by httpd. If someone accesses the manager application through the load-balancer, they will not know which of the load-balanced Tomcats they end up at. In these situations, and others as well, it would be nice if the manager could tell the hostname and IP address of the machine it is running on."	2007-10-02 14:42:39	1191350000	resolved fixed	2b8e6cf	1308180000	java/org/apache/catalina/manager/Constants.java java/org/apache/catalina/manager/HTMLManagerServlet.java java/org/apache/catalina/manager/StatusManagerServlet.java	5:java/org/apache/catalina/manager/HTMLManagerServlet.java 209:java/org/apache/catalina/manager/Constants.java 278:java/org/apache/catalina/manager/StatusManagerServlet.java
443	51306	Bug 51306 NPE in DeltaRequest.writeExternal(DeltaRequest.java:267) when handling remote session expiration	"Occasionally we got errors like following: ====== 2011-05-30 03:40:17,697 ERROR [pool-1-thread-2] (org.apache.catalina.ha.session.DeltaManager) Manager [localhost#]: Unable to receive message through TCP channel java.lang.NullPointerException at java.io.ObjectOutputStream$BlockDataOutputStream.getUTFLength(ObjectOutputStream.java:2106) at java.io.ObjectOutputStream$BlockDataOutputStream.writeUTF(ObjectOutputStream.java:1977) at java.io.ObjectOutputStream.writeUTF(ObjectOutputStream.java:849) at org.apache.catalina.ha.session.DeltaRequest.writeExternal(DeltaRequest.java:267) at org.apache.catalina.ha.session.DeltaRequest.serialize(DeltaRequest.java:287) at org.apache.catalina.ha.session.DeltaManager.serializeDeltaRequest(DeltaManager.java:716) at org.apache.catalina.ha.session.DeltaManager.requestCompleted(DeltaManager.java:1224) at org.apache.catalina.ha.session.DeltaSession.expire(DeltaSession.java:403) at org.apache.catalina.ha.session.DeltaManager.handleSESSION_EXPIRED(DeltaManager.java:1546) at org.apache.catalina.ha.session.DeltaManager.messageReceived(DeltaManager.java:1452) at org.apache.catalina.ha.session.DeltaManager.messageDataReceived(DeltaManager.java:1173) at org.apache.catalina.ha.session.ClusterSessionListener.messageReceived(ClusterSessionListener.java:92) at org.apache.catalina.ha.tcp.SimpleTcpCluster.messageReceived(SimpleTcpCluster.java:901) at org.apache.catalina.ha.tcp.SimpleTcpCluster.messageReceived(SimpleTcpCluster.java:882) at org.apache.catalina.tribes.group.GroupChannel.messageReceived(GroupChannel.java:269) at org.apache.catalina.tribes.group.ChannelInterceptorBase.messageReceived(ChannelInterceptorBase.java:79) at org.apache.catalina.tribes.group.interceptors.TcpFailureDetector.messageReceived(TcpFailureDetector.java:110) at org.apache.catalina.tribes.group.ChannelInterceptorBase.messageReceived(ChannelInterceptorBase.java:79) at org.apache.catalina.tribes.group.ChannelInterceptorBase.messageReceived(ChannelInterceptorBase.java:79) at org.apache.catalina.tribes.group.ChannelCoordinator.messageReceived(ChannelCoordinator.java:241) at org.apache.catalina.tribes.transport.ReceiverBase.messageDataReceived(ReceiverBase.java:225) at org.apache.catalina.tribes.transport.nio.NioReplicationTask.drainChannel(NioReplicationTask.java:188) at org.apache.catalina.tribes.transport.nio.NioReplicationTask.run(NioReplicationTask.java:91) at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908) at java.lang.Thread.run(Thread.java:662) It looks like the functionality of Tomcat is not affected by this. The NPE comes from trying to write null sessionId, but why does Tomcat try to send something from handling received authoritative SESSION_EXPIRED message?"	2011-06-01 12:21:28	1306950000	resolved fixed	4e5571f	1307960000	java/org/apache/catalina/ha/session/DeltaManager.java java/org/apache/catalina/ha/session/DeltaSession.java	1:java/org/apache/catalina/ha/session/DeltaManager.java 3:java/org/apache/catalina/ha/session/DeltaSession.java
444	51348	Bug 51348 Potential NullPointerException in org.apache.catalina.servlets.WebdavServlet at line 1336	A WebDAV LOCK_REFRESH request may cause a NullPointerException because of an (IMHO) wrong check at line 1332 in WebdavServlet.java 1056763 2011-01-08 18:56:57Z markt. I suggest line 1332 should be: ... if (toRenew != null) { ...	2011-06-09 08:53:41	1307620000	resolved fixed	71b18c8	1307650000	java/org/apache/catalina/servlets/WebdavServlet.java	1:java/org/apache/catalina/servlets/WebdavServlet.java
445	51344	Bug 51344 org.apache.catalina.startup.Embedded overrides Lifecycle incorrectly?	"Not sure if this is a bug or just my mis-coding... I've been using the Embedded component in Tomcat 6.0.29 for integration testing. Something like this: server = new EmbeddedTomcat(""/test"", 7890, ""JVM-1""); PeerToPeerCacheLifecycleListener p2pListener = new PeerToPeerCacheLifecycleListener(); p2pListener.setProperty(""mcast-port"", ""19991""); server.getEmbedded().addLifecycleListener(p2pListener); sessionManager = new DeltaSessionManager(); server.getRootContext().setManager(sessionManager); Here the EmbeddedTomcat class is simply a wrapper for Embedded - I'm passing in the context, port and 'JVM route' - nothing special. Then I add a listener which should be the programmatic equivalent of having the following server.xml snippet: <Server> <Listener className=""PeerToPeerCacheLifecycleListener""/> </Server> DeltaSessionManager performs custom session management and thus extends ManagerBase and implements Lifecycle and SessionManager. During the start of DeltaSessionManager I initialize the listener by doing this.lifecycle.fireLifecycleEvent(START_EVENT, null); The listener picks up this event and starts. All works nicely under Tomcat 6, but breaks under Tomcat 7.0.12. My initial investigation shows that the LifecycleEvent, being fired, is not reaching the Embedded component which is where the listener is registered. Removing the overridden Lifecycle methods from Embedded (so that the Lifecyle processing happens in LifecycleBase) seems to work as the triggered event then reaches my listener."	2011-06-08 21:35:55	1307580000	resolved fixed	4892b57	1307650000	java/org/apache/catalina/startup/Embedded.java	1:java/org/apache/catalina/startup/Embedded.java
446	51340	Bug 51340 Intermittent java.lang.IllegalArgumentException: <session-config> element is limited to 1 occurrence		2011-06-08 13:37:25	1307550000	resolved fixed	1fe28a6	1307550000	java/org/apache/catalina/startup/ContextConfig.java	7:java/org/apache/catalina/startup/ContextConfig.java
447	51324	"Bug 51324 When OutputBuffer.doFlush gets Exception, doFlush gets stuck to true"		2011-06-05 05:17:12	1307270000	resolved fixed	1bbbdb2	1307460000	java/org/apache/catalina/connector/OutputBuffer.java	1:java/org/apache/catalina/connector/OutputBuffer.java
448	51251	Bug 51251 Patch to add version parameter to ant task		2011-05-24 01:28:35	1306210000	resolved fixed	d19daf5	1307140000	java/org/apache/catalina/ant/AbstractCatalinaCommandTask.java java/org/apache/catalina/ant/ReloadTask.java java/org/apache/catalina/ant/SessionsTask.java java/org/apache/catalina/ant/StartTask.java java/org/apache/catalina/ant/StopTask.java java/org/apache/catalina/ant/UndeployTask.java	5:java/org/apache/catalina/ant/UndeployTask.java 46:java/org/apache/catalina/ant/StartTask.java 47:java/org/apache/catalina/ant/StopTask.java 49:java/org/apache/catalina/ant/ReloadTask.java 60:java/org/apache/catalina/ant/SessionsTask.java
449	51276	"Bug 51276 Startup time is too high if there are few JARs in ""lib/"" and a few webapps."	"Startup time in tomcat 7.0.14 is 10x higher than 7.0.12, if there are a few shared JARs in tomcat/lib and a few webapps. The issue is very simple to reproduce, simply add 10 empty directories in tomcat/webapps and (for example) the Metro webservices jars in tomcat/lib. On my machine the startup time increase from 0.5 secs (default installation) to 35.2 secs. When using tomcat 7.0.12 the startup time is about 3 secs on my machine in this test case."	2011-05-27 11:09:03	1306510000	resolved fixed	5109678	1307010000	java/org/apache/catalina/startup/ContextConfig.java java/org/apache/catalina/startup/TldConfig.java java/org/apache/jasper/compiler/TldLocationsCache.java java/org/apache/tomcat/util/scan/FileUrlJar.java java/org/apache/tomcat/util/scan/Jar.java java/org/apache/tomcat/util/scan/JarFactory.java java/org/apache/tomcat/util/scan/UrlJar.java	2:java/org/apache/catalina/startup/ContextConfig.java 3:java/org/apache/catalina/startup/TldConfig.java 22:java/org/apache/jasper/compiler/TldLocationsCache.java
450	51277	Bug 51277 NPE during the form authentication when form-login-config is missed		2011-05-27 12:04:07	1306510000	resolved fixed	5b0919c	1306850000	java/org/apache/catalina/authenticator/FormAuthenticator.java	2:java/org/apache/catalina/authenticator/FormAuthenticator.java
451	51240	Bug 51240 maxConnections not honors config when acceptorThreadCount > 1		2011-05-22 19:22:26	1306110000	resolved fixed	73f9592	1306420000	java/org/apache/tomcat/util/net/AbstractEndpoint.java java/org/apache/tomcat/util/net/AprEndpoint.java java/org/apache/tomcat/util/net/JIoEndpoint.java java/org/apache/tomcat/util/net/NioEndpoint.java java/org/apache/tomcat/util/threads/CounterLatch.java java/org/apache/tomcat/util/threads/LimitLatch.java test/org/apache/tomcat/util/threads/TestCounterLatch.java test/org/apache/tomcat/util/threads/TestLimitLatch.java	1:java/org/apache/tomcat/util/net/AprEndpoint.java 2:java/org/apache/tomcat/util/net/NioEndpoint.java 3:java/org/apache/tomcat/util/net/JIoEndpoint.java 4:java/org/apache/tomcat/util/net/AbstractEndpoint.java 341:test/org/apache/tomcat/util/threads/TestCounterLatch.java 351:java/org/apache/tomcat/util/threads/CounterLatch.java
452	51226	Bug 51226 [Patch] to add FindLeaks ant task	There is no ant task for FindLeaks.	2011-05-19 06:26:15	1305800000	resolved fixed	1cd5e7b	1306250000	java/org/apache/catalina/ant/FindLeaksTask.java java/org/apache/catalina/manager/HTMLManagerServlet.java java/org/apache/catalina/manager/ManagerServlet.java	1:java/org/apache/catalina/manager/ManagerServlet.java 2:java/org/apache/catalina/manager/HTMLManagerServlet.java
453	27122	Bug 27122 IE plugins cannot access components through Tomcat 5 over SSL	"SSL seems to be failing when the Content-Type header is set to ""image/svg+xml"". I've only seen this failure when SSL was running on a Solaris machine. (uname -a: SunOS [hostname removed] 5.8 Generic_108528-18 sun4u sparc SUNW,Ultra-60) When attempted on Windows, we were unable to duplicate the error. This reliably fails when attempted on this specific Solaris machine. If I get a chance, I'll try to create a test-case and see if I can reproduce this on other Solaris machines. Unfortunately, this was a show-stopper for a release that's being made today so I'm pressed for time. Basically, what happens is that we're using a JSP page to create an SVG file. Because of this, we have to set the Content-Type header to ""image/svg+xml"". When the MIME type is set to this value, the page fails to load in Internet Explorer 6 (SP1) with a message of ""connection failed"" or something similar. When an attempt was made in Opera, Opera responded by crashing. Mozilla successfully downloaded the file, though. However, when resetting the MIME type in the page to ""text/plain"" all three browsers can access the page without failure. By back-revving Tomcat to version 4.1.29, we were able to resolve this issue and access the page in all three browsers. I'll try and create a test-case later today and verify that it isn't just our SVG JSP that's failing but any that creates SVG but I'm currently pressed for time - sorry."	2004-02-20 21:09:17	1077330000	resolved fixed	4161179	1306100000	java/org/apache/catalina/authenticator/AuthenticatorBase.java	5:java/org/apache/catalina/authenticator/AuthenticatorBase.java
454	51185	Bug 51185 Performance : DataSourceProxy#createPool should use more fine grained synchronisation		2011-05-11 10:21:44	1305120000	resolved fixed	4bdd8d0	1305930000	modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/DataSourceProxy.java	1:modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/DataSourceProxy.java
455	35054	Bug 35054 warn if appBase is not existing as a File or directory	"otherwise, it may very hard to find what is wrong"	2005-05-25 10:03:08	1117030000	resolved fixed	9bb6e4f	1305920000	java/org/apache/catalina/startup/HostConfig.java	1:java/org/apache/catalina/startup/HostConfig.java
456	51220	Bug 51220 Add system property that makes it possible for jsp pages with the extends page directive to take advantage of tag pooling		2011-05-18 15:42:54	1305750000	resolved fixed	c46e56c	1305800000	java/org/apache/jasper/compiler/Generator.java	6:java/org/apache/jasper/compiler/Generator.java
457	51229	Bug 51229 Some async examples are not work correctly		2011-05-19 06:55:54	1305800000	resolved fixed	55d8b72	1305800000	webapps/examples/WEB-INF/classes/async/Async0.java	84:webapps/examples/WEB-INF/classes/async/Async0.java
458	51212	Bug 51212 QueryStats has synchornisation issues		2011-05-17 16:25:52	1305660000	resolved fixed	b24b17c	1305740000	modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/interceptor/SlowQueryReport.java	2:modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/interceptor/SlowQueryReport.java
459	51208	Bug 51208 SVN TRUNK : JDBC interceptor options are not taken into account		2011-05-17 09:14:29	1305640000	resolved fixed	2bb247a	1305640000	modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/PoolProperties.java	5:modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/PoolProperties.java
460	51156	"Bug 51156 ""Expire sessions"" button not visible for context configured in server.xml"	"If app is configured in server.xml like this: {code} <Host name=""www.myapp.pl"" appBase=""/usr/lib/tomcat/webapps"" unpackWARs=""false"" autoDeploy=""false"" xmlValidation=""false"" xmlNamespaceAware=""false"" > <Context docBase=""/var/www/myapp"" path="""" cacheMaxSize=""5120"" cacheTTL=""60000"" cachingAllowed=""true"" > </Context> <Context path=""/manager"" privileged=""true"" docBase=""/usr/lib/tomcat/webapps/manager""> </Context> </Host> {code} In Tomcat Manager, on the application list, there is a button ""Expire sessions"" available only for ""/manager"" application. There is no button ""Expire sessions"" for ""/"" path. I think bug is in HTMLManagerServlet.java in this part: {code} if (context.getPath().equals(this.context.getPath())) { writer.print(MessageFormat.format( MANAGER_APP_ROW_BUTTON_SECTION, args)); } else if (context.getAvailable() && isDeployed) { writer.print(MessageFormat.format( STARTED_DEPLOYED_APPS_ROW_BUTTON_SECTION, args)); } else if (context.getAvailable() && !isDeployed) { writer.print(MessageFormat.format( STARTED_NONDEPLOYED_APPS_ROW_BUTTON_SECTION, args)); } else if (!context.getAvailable() && isDeployed) { writer.print(MessageFormat.format( STOPPED_DEPLOYED_APPS_ROW_BUTTON_SECTION, args)); } else { writer.print(MessageFormat.format( STOPPED_NONDEPLOYED_APPS_ROW_BUTTON_SECTION, args)); } {code}"	2011-05-06 00:30:54	1304660000	resolved fixed	de7f0e1	1304670000	java/org/apache/catalina/manager/HTMLManagerServlet.java	1:java/org/apache/catalina/manager/HTMLManagerServlet.java
461	51155	Bug 51155 Missing @deprecated comments		2011-05-05 19:36:28	1304640000	resolved fixed	f477068	1304670000	java/javax/servlet/jsp/el/ELException.java java/javax/servlet/jsp/el/ELParseException.java java/javax/servlet/jsp/el/Expression.java java/javax/servlet/jsp/el/ExpressionEvaluator.java java/javax/servlet/jsp/el/FunctionMapper.java java/javax/servlet/jsp/el/VariableResolver.java	27:java/javax/servlet/jsp/el/ELParseException.java 35:java/javax/servlet/jsp/el/ELException.java 41:java/javax/servlet/jsp/el/FunctionMapper.java 43:java/javax/servlet/jsp/el/VariableResolver.java 44:java/javax/servlet/jsp/el/Expression.java 57:java/javax/servlet/jsp/el/ExpressionEvaluator.java
462	51154	Bug 51154 Spurious @deprecated tags in ServletContext		2011-05-05 19:33:18	1304640000	resolved fixed	01e1850	1304670000	java/javax/servlet/ServletContext.java	2:java/javax/servlet/ServletContext.java
463	50950	Bug 50950 NotSerializableException: org.apache.catalina.realm.GenericPrincipal		2011-03-20 13:28:18	1300640000	resolved fixed	0559491	1304600000	java/org/apache/catalina/ha/session/DeltaSession.java	9:java/org/apache/catalina/ha/session/DeltaSession.java
464	51099	Bug 51099 SPNEGO loginConfigName does not work	"As reported by fhanik on the dev list: 2. com.sun.security.jgss.krb5.accept is not configurable While the authenticator has the attribute loginConfigName, there seems to be a place in the code where it omits this entry. renaming this entry in jaas.conf and setting the loginConfigName will fail to validate a ticket The problem code is here: gssContext = manager.createContext(manager.createCredential(null, GSSCredential.DEFAULT_LIFETIME, new Oid(""1.3.6.1.5.5.2""), GSSCredential.ACCEPT_ONLY)); should look like final GSSManager manager = GSSManager.getInstance(); final PrivilegedExceptionAction<GSSCredential> action = new PrivilegedExceptionAction<GSSCredential>() { public GSSCredential run() throws GSSException { return manager.createCredential(null, GSSCredential.DEFAULT_LIFETIME, new Oid(""1.3.6.1.5.5.2""), GSSCredential.ACCEPT_ONLY); } }; gssContext = manager.createContext(Subject.doAs(lc.getSubject(), action));|| best Filip"	2011-04-21 05:11:31	1303380000	resolved fixed	343a609	1304550000	java/org/apache/catalina/authenticator/SpnegoAuthenticator.java	1:java/org/apache/catalina/authenticator/SpnegoAuthenticator.java
465	51119	Bug 51119 extras - JmxRemoteLifecycleListener does not support JAAS based authentication and authorisation	"(Also true in Tomcat 7) The JmxRemoteLifecycleListener does not support JAAS based authentication. That is, when authentication is required, it only supports file based authentication."	2011-04-26 05:29:40	1303810000	resolved fixed	2ffa0f7	1304540000	java/org/apache/catalina/mbeans/JmxRemoteLifecycleListener.java	1:java/org/apache/catalina/mbeans/JmxRemoteLifecycleListener.java
466	51124	Bug 51124 ArrayIndexOutOfBoundsException after setting org.apache.jasper.runtime.BodyContentImpl.LIMIT_BUFFER=true	"First of all, I know that there has been a bug regarding a similar problem before and that it was fixed. But currently this bugs occurs even with tomcat version 6.0.32. We have a problem with the tomcat runnign with the parameter org.apache.jasper.runtime.BodyContentImpl.LIMIT_BUFFER=true. After the tomcat has just started, everything is fine but after one or two days a lot of ArrayIndexOutOfBoundsException occur on random pages of the application. Tomcats started without this parameter don't seem to have that problem. Unfortunately we weren't able reproduce the bug locally, It appears only on our production system. Could there be a concurrency problem, that only shows if a lot it going on on the platform? I can provide two small stackstraces that can show the classes where the problem occurs: 1. Caused by: java.lang.ArrayIndexOutOfBoundsException at org.apache.jasper.runtime.BodyContentImpl.write(Unknown Source) at java.io.PrintWriter.write(PrintWriter.java:382) at org.apache.jasper.runtime.JspWriterImpl.flushBuffer(Unknown Source) at org.apache.jasper.runtime.PageContextImpl.release(Unknown Source) at org.apache.jasper.runtime.JspFactoryImpl.internalReleasePageContext(Unknown Source) at org.apache.jasper.runtime.JspFactoryImpl.releasePageContext(Unknown Source) at org.apache.jsp.members.lists.short_.incomingShortList_jsp._jspService(incomingShortList_jsp.java:796) at org.apache.jasper.runtime.HttpJspBase.service(Unknown Source) at javax.servlet.http.HttpServlet.service(Unknown Source) 2. Caused by: java.lang.ArrayIndexOutOfBoundsException at java.lang.String.getChars(String.java:854) at org.apache.jasper.runtime.BodyContentImpl.write(Unknown Source) at org.apache.jasper.runtime.BodyContentImpl.write(Unknown Source) at org.apache.jasper.runtime.BodyContentImpl.print(Unknown Source) at org.apache.taglibs.standard.tag.common.fmt.MessageSupport.doEndTag(MessageSupport.java:203) at org.apache.jsp.members.profiles.profile_jsp._jspx_meth_fmt_005fmessage_005f2(profile_jsp.java:4897) at org.apache.jsp.members.profiles.profile_jsp._jspService(profile_jsp.java:481) at org.apache.jasper.runtime.HttpJspBase.service(Unknown Source) at javax.servlet.http.HttpServlet.service(Unknown Source)"	2011-04-27 06:31:47	1303900000	resolved fixed	2cdbcd5	1304540000	java/org/apache/jasper/runtime/BodyContentImpl.java	4:java/org/apache/jasper/runtime/BodyContentImpl.java
467	51136	Bug 51136 Allow to set the context name through Tomcat's embeded class before adding it to the host	"org.apache.catalina.startup.Tomcat creates contexts and add them to the host directly. It would be nice if we could set the name of the context before adding it to the host. I'm including a patch that overloads the methods ""addWebapp"" and ""addContext"" to take that name as a parameter."	2011-04-29 16:18:31	1304110000	resolved fixed	2dc54c4	1304500000	java/org/apache/catalina/startup/Tomcat.java	3:java/org/apache/catalina/startup/Tomcat.java
468	51095	Bug 51095 NPE in AprEndpoint.java		2011-04-20 12:51:05	1303320000	resolved fixed	75d28d4	1303600000	java/org/apache/tomcat/util/net/AprEndpoint.java	1:java/org/apache/tomcat/util/net/AprEndpoint.java
469	50173	Bug 50173 JDBCSampler discards ResultSet from a PreparedStatement.	"Hi, I am using JMeter with a Test Plan that uses a JDBC Request with a PreparedStatement query type. When running this I am getting the following error in the jmeter.log file 2010/10/28 11:30:31 INFO - jmeter.threads.JMeterThread: Thread started: JDBC Users 1-1 2010/10/28 12:13:38 ERROR - jmeter.threads.JMeterThread: Error while processing sampler 'PREPARED SELECT Customer JDBC Request' : java.lang.NullPointerException at org.apache.jmeter.protocol.jdbc.sampler.JDBCSampler.getStringFromResultSet(JDBCSampler.java:415) at org.apache.jmeter.protocol.jdbc.sampler.JDBCSampler.resultSetsToString(JDBCSampler.java:268) at org.apache.jmeter.protocol.jdbc.sampler.JDBCSampler.sample(JDBCSampler.java:208) at org.apache.jmeter.threads.JMeterThread.process_sampler(JMeterThread.java:348) at org.apache.jmeter.threads.JMeterThread.run(JMeterThread.java:243) at java.lang.Thread.run(Thread.java:619) The query (below) can be expected to return a number of records SELECT * FROM Customer WHERE ID=?; the param is set to 1 If I use instead a SelectStatement results are returned so the query itself is not at fault. I have retrieved the code for the v2_4 tag to identify the root cause for the NPE and create a patch. This bug report includes a patch against trunk as the issue is also in trunk. The root cause is due to: org.apache.jmeter.protocol.jdbc.sampler.JDBCSampler.sample(Entry e) The code path for PreparedStatements types starting on line 204 has in it a call to org.hsqldb.jdbc.JDBCPreparedStatement.executeUpdate() which returns a ResultSet. The side effect of the call is to set the JDBCPreparedStatement.currentResultSet field member to null. JDBCSampler does not keep the ResultSet reference. Instead it is discarded. The call on the next line (208) String sb = resultSetsToString(pstmt,true,null) again tries to get the ResultSet on line 267. This causes a NullPointerException because the JDBCPreparedStatement.currentResultSet field was set to null earlier. Looking at the code path for a CALLABLE statement type (line 190) shows better handling for queries that return ResultSet. The two lines 207,208 replaced with boolean hasResultSet = pstmt.execute(); String sb = resultSetsToString(pstmt,hasResultSet,null); fixes the defect. Regards, Jeremy Whiting Red Hat"	2010-10-28 10:14:39	1288280000	resolved fixed	3a847c7	1303000000	java/org/apache/tomcat/util/net/AprEndpoint.java	41:java/org/apache/tomcat/util/net/AprEndpoint.java
470	51042	Bug 51042 HttpSessionListener.sessionCreated() is called a second time when user is authenticated with no matching sessionDestroyed() call.	"When my web application has a HttpSessionListener configured in its web.xml, then that classes sessionCreated() is called when a user is assigned a new session. However, that method is *also* called when that user authenticates itself and the session is assigned a new ID (whether or not this is actually a ""new session"" can be disputed, but that's not the point of this bug). When the session is removed (due to a timeout, for example), then a single sessionDestroyed() call is executed. When the HttpSessionListener manages some kind of external resource, this behaviour leads to a resource leak, because sessionCreated() is called twice, while sessionRemoved() is only called once! I'm aware of the reason for changing the session ID and (somehow) understand why sessionCreated() is called again (after all there's a new session ID), but there must be *some* way for the SessionListener to be notified that the ""old session"" no longer exists. The same behaviour is seen in Tomcat 6.0 (and probably 5.5 as well, but I didn't test that)."	2011-04-08 05:54:06	1302260000	resolved fixed	dc3758e	1302990000	java/org/apache/catalina/Session.java java/org/apache/catalina/ha/session/DeltaManager.java java/org/apache/catalina/ha/session/DeltaSession.java java/org/apache/catalina/ha/session/JvmRouteBinderValve.java java/org/apache/catalina/manager/DummyProxySession.java java/org/apache/catalina/session/ManagerBase.java java/org/apache/catalina/session/StandardSession.java	3:java/org/apache/catalina/ha/session/DeltaManager.java 5:java/org/apache/catalina/session/StandardSession.java 6:java/org/apache/catalina/Session.java 9:java/org/apache/catalina/manager/DummyProxySession.java 10:java/org/apache/catalina/ha/session/DeltaSession.java 11:java/org/apache/catalina/session/ManagerBase.java 63:java/org/apache/catalina/ha/session/JvmRouteBinderValve.java
471	51038	Bug 51038 No access logs for Servlet 3.0 async requests	"Access logs written by org.apache.catalina.valves.AccessLogValve are not being written for servlet 3.0 async requests. To reproduce: - Handle a request asynchronously by marking the servlet with @WebServlet(asyncSupported=true) - Send some traffic and notice that nothing is being written to the access logs. AccessLogValve.log() is called by org.apache.catalina.Context.logAccess(). From the source for version 7.0.11, in org.apache.catalina.connector.CoyoteAdapter.java, line 416: AsyncContextImpl asyncConImpl = (AsyncContextImpl)request.getAsyncContext(); if (asyncConImpl != null) { async = true; } else if (!comet) { response.finishResponse(); if (postParseSuccess) { // Log only if processing was invoked. // If postParseRequest() failed, it has already logged it. ((Context) request.getMappingData().context).logAccess( request, response, System.currentTimeMillis() - req.getStartTime(), false); } req.action(ActionCode.POST_REQUEST , null); } In the async case logAccess() isn't called here. I've searched through the code and don't see logAccess() being called anywhere else, except in error cases. So, it looks like the async case is missing a call to logAccess() somewhere."	2011-04-07 11:18:30	1302190000	resolved fixed	dc3dff4	1302990000	java/org/apache/catalina/connector/CoyoteAdapter.java test/org/apache/catalina/core/TestAsyncContextImpl.java test/org/apache/catalina/valves/TesterAccessLogValve.java	1:java/org/apache/catalina/connector/CoyoteAdapter.java 30:test/org/apache/catalina/core/TestAsyncContextImpl.java
472	50997	"Bug 50997 StandardJarScanner ignores web-fragment.xml files in unpacked jars if they are not ending with "".jar"""		2011-03-30 11:57:49	1301500000	resolved fixed	62ddb9e	1301520000	java/org/apache/catalina/startup/ContextConfig.java java/org/apache/tomcat/util/scan/StandardJarScanner.java	2:java/org/apache/catalina/startup/ContextConfig.java 4:java/org/apache/tomcat/util/scan/StandardJarScanner.java
473	50927	Bug 50927 [patch] More specific error message for missing SSLCertificateFile		2011-03-14 08:59:04	1300110000	resolved fixed	e34f848	1300270000	java/org/apache/tomcat/util/net/AprEndpoint.java	1:java/org/apache/tomcat/util/net/AprEndpoint.java
474	50929	Bug 50929 [patch] Ensure rethrown exceptions retain the original cause		2011-03-14 11:08:56	1300120000	resolved fixed	0c96676	1300230000	java/javax/servlet/http/HttpUtils.java java/org/apache/catalina/connector/CoyoteInputStream.java java/org/apache/catalina/realm/JDBCRealm.java java/org/apache/catalina/valves/JDBCAccessLogValve.java java/org/apache/naming/resources/WARDirContext.java java/org/apache/tomcat/util/digester/NodeCreateRule.java	13:java/org/apache/catalina/realm/JDBCRealm.java 81:java/org/apache/catalina/valves/JDBCAccessLogValve.java 341:java/org/apache/naming/resources/WARDirContext.java 627:java/org/apache/catalina/connector/CoyoteInputStream.java 665:java/javax/servlet/http/HttpUtils.java 670:java/org/apache/tomcat/util/digester/NodeCreateRule.java
475	50903	Bug 50903 Current keep-alive request processed after connector.stop()	"When the connector is stopped, if a connection is in a keep-alive state the next request received by that connection will be processed and then the connection will be closed. When the request is received, it should be rejected. Outstanding questions: - What return code (if any) should be sent back to the client? - If the reading of a request starts before the connector is stopped, should that request be allowed to complete or should it be rejected?"	2011-03-09 14:34:53	1299700000	resolved fixed	c8ea62e	1300210000	java/org/apache/coyote/ajp/AjpProcessor.java java/org/apache/coyote/http11/Http11AprProcessor.java java/org/apache/coyote/http11/Http11NioProcessor.java java/org/apache/coyote/http11/Http11Processor.java test/org/apache/catalina/connector/TestConnector.java test/org/apache/catalina/startup/TesterServlet.java test/org/apache/catalina/startup/TomcatBaseTest.java	9:java/org/apache/coyote/http11/Http11Processor.java 11:java/org/apache/coyote/http11/Http11AprProcessor.java 21:java/org/apache/coyote/http11/Http11NioProcessor.java 28:java/org/apache/coyote/ajp/AjpProcessor.java 255:test/org/apache/catalina/startup/TomcatBaseTest.java
476	50887	Bug 50887 Enhancement to set security-provider within AjpAprProcessor		2011-03-08 04:49:48	1299580000	resolved fixed	552c4b7	1300020000	java/org/apache/catalina/valves/SSLValve.java java/org/apache/coyote/AbstractProtocolHandler.java java/org/apache/coyote/ajp/AbstractAjpProcessor.java java/org/apache/coyote/ajp/AjpAprProtocol.java java/org/apache/coyote/ajp/AjpProtocol.java java/org/apache/coyote/http11/Http11AprProcessor.java java/org/apache/coyote/http11/Http11AprProtocol.java	3:java/org/apache/coyote/ajp/AjpAprProtocol.java 4:java/org/apache/coyote/http11/Http11AprProcessor.java 7:java/org/apache/coyote/ajp/AbstractAjpProcessor.java 8:java/org/apache/coyote/ajp/AjpProtocol.java 13:java/org/apache/coyote/http11/Http11AprProtocol.java 57:java/org/apache/coyote/AbstractProtocolHandler.java 280:java/org/apache/catalina/valves/SSLValve.java
477	50895	Bug 50895 JSP compiler initializes classes during compile which can result in failures		2011-03-08 15:27:00	1299620000	resolved fixed	5d61212	1299680000	java/org/apache/jasper/compiler/ELFunctionMapper.java	47:java/org/apache/jasper/compiler/ELFunctionMapper.java
478	25060	Bug 25060 Reloading context orphans currently open jndi datasource connections	"I fiddled around with this a while and have determined to the best of my ability that this is a real bug. I have a jndi datasource connected to a postgresql server. I have two jndi resources (a reader and writer) so that later I can implement a system with replication etc and deal with writes and reads to different connections. To summarize, after using the system, there are two connections to postgres that get reused -- one reader and writer. Under load, this number increases and will slowly go back down. I usually end up with two idle connections (one reader and one writer) left under no load. If you reload the context where the datasource is at (it's a context specific datasource), the number of connections will jump by two when used. Each reload produces 2 more connections min until I restart the server. It appears that after a reload, the 'persisted connections' get abandoned / orphaned. Eventually, I hit my max connections and cannot aquire any more and the system fails. I have tried the abandond collection parameters and have added debug logging to my code to ensure that I am indeed calling close on the connections I checkout, even on exceptions and error cases. Under normal useage without reloads, no connection leakage happens. This is on a solaris 8 machine with the 4.1.27-hotfix-22096.tar.gz applied. Let me know if more information is required. I have this in a development environment and can let somone attach in jdb and hammer on the thing since it's not a production system -- if that will help in getting a repro. Wayne"	2003-11-27 21:15:10	1069990000	resolved fixed	1211dbe	1299620000	java/org/apache/catalina/core/StandardContext.java java/org/apache/catalina/deploy/NamingResources.java	1:java/org/apache/catalina/core/StandardContext.java 36:java/org/apache/catalina/deploy/NamingResources.java
479	26701	Bug 26701 Enabling web applications to register their own stream handlers	A stream handler factory can be registered once per VM and tomcat registers the DirContextStreamHandlerFactory for the jndi protocol. However if there are web applications running inside that want to register handlers for custom scheme currently it is not possible. Can the DirContextStreamHandlerFactory be enhanced to allow applications to register stream handler for custom schemes they might have. Or better can this be a made a property in the context.xml file ? Is this already there - or can this enhanced in the future?	2004-02-05 21:30:18	1076030000	resolved fixed	f622e3a	1299450000	java/org/apache/catalina/loader/WebappLoader.java java/org/apache/naming/resources/Constants.java java/org/apache/naming/resources/DirContextURLStreamHandlerFactory.java test/org/apache/naming/resources/TestDirContextURLStreamHandlerFactory.java	5:java/org/apache/naming/resources/DirContextURLStreamHandlerFactory.java 43:java/org/apache/catalina/loader/WebappLoader.java 147:java/org/apache/naming/resources/Constants.java
480	50855	Bug 50855 NullPointerException thrown in AuthenticatorBase.register method for null principal		2011-03-02 11:19:27	1299080000	resolved fixed	b24b0c0	1299400000	java/org/apache/catalina/authenticator/AuthenticatorBase.java	1:java/org/apache/catalina/authenticator/AuthenticatorBase.java
481	50857	"Bug 50857 Test failures on Windows 7, 24 thread system"	"testPoolThreads20Connections10FairAsync [junit] java.sql.SQLException: [tomcat-pool-10] NoWait: Pool empty. Unable to fetch a connection, none available[10 in use]. [junit] at org.apache.tomcat.jdbc.pool.ConnectionPool.borrowConnection(ConnectionPool.java:615) [junit] at org.apache.tomcat.jdbc.pool.ConnectionPool.getConnectionAsync(ConnectionPool.java:143) [junit] at org.apache.tomcat.jdbc.pool.DataSourceProxy.getConnectionAsync(DataSourceProxy.java:122) [junit] at org.apache.tomcat.jdbc.test.FairnessTest$TestThread.run(FairnessTest.java:231)"	2011-03-02 15:50:18	1299100000	resolved fixed	ef547fb	1299100000	modules/jdbc-pool/java/org/apache/tomcat/jdbc/pool/ConnectionPool.java	1:modules/jdbc-pool/java/org/apache/tomcat/jdbc/pool/ConnectionPool.java
482	27988	Bug 27988 Unhelpful FileNotFoundException raised	"org.apache.naming.resources.DirContextURLConnection raises FileNotFoundException on lines 311, 344, 382 and 396. It would be more helpful if these provided a message string. For example, change line 344 to throw new FileNotFoundException(getURL().getFile()); This would make it easier to diagnose mistakes in server configurations."	2004-03-26 17:01:25	1080340000	resolved fixed	4a4d86e	1299070000	java/org/apache/naming/resources/DirContextURLConnection.java	1:java/org/apache/naming/resources/DirContextURLConnection.java
483	28852	Bug 28852 failonerror attribute on Ant tasks	failonerror boolean attribute on manager Ant tasks would be a nice have to allow for more flexible operation within Ant build files. I will attach a patch next week that also fixes unecessary CRs during response read/print and missing url encoding in some tasks.	2004-05-08 20:23:38	1084060000	resolved fixed	e1bf740	1298920000	java/org/apache/catalina/ant/JMXGetTask.java java/org/apache/catalina/ant/JMXQueryTask.java java/org/apache/catalina/ant/JMXSetTask.java java/org/apache/catalina/ant/ResourcesTask.java java/org/apache/catalina/ant/UndeployTask.java	10:java/org/apache/catalina/ant/ResourcesTask.java 15:java/org/apache/catalina/ant/UndeployTask.java 27:java/org/apache/catalina/ant/JMXGetTask.java 37:java/org/apache/catalina/ant/JMXSetTask.java 78:java/org/apache/catalina/ant/JMXQueryTask.java
484	31027	Bug 31027 major error from minor whitespace error in properties file	"A developer accidentally placed a tab character after the port number in the properties file for a tomcat instance. This prevented tomcat from listening on that port, but it was difficult to track down whether tomcat was running. Seems like the properties-file reader could easily trim excess whitespace before trying to use entries."	2004-09-02 22:36:52	1094180000	resolved wontfix	4b4ef0c	1298810000	java/org/apache/catalina/startup/CatalinaProperties.java	3:java/org/apache/catalina/startup/CatalinaProperties.java
485	50836	Bug 50836 LifecycleState#isAvailable() to be more restrictive	"I think some of the values returned by LifecycleState#isAvailable() are wrong. 1. I am certain that MUST_DESTROY should return false, because it is a state that is later than stopped. 2. I think that STOPPING_PREP should return false, because we can get there from the FAILED state. 3. I think that STARTING should return false, because it is too early to return true there. As a result, the following is the complete list of states are to return true in #isAvailable(): STARTED, MUST_STOP"	2011-02-26 14:05:18	1298750000	resolved fixed	92ff888	1298800000	java/org/apache/catalina/Lifecycle.java java/org/apache/catalina/LifecycleListener.java java/org/apache/catalina/LifecycleState.java java/org/apache/catalina/util/LifecycleBase.java	5:java/org/apache/catalina/util/LifecycleBase.java 6:java/org/apache/catalina/Lifecycle.java 166:java/org/apache/catalina/LifecycleListener.java
486	49284	Bug 49284 Implement SSL renegotiation for the NIO connector	Summary says it all. Entered as a reminder that it would be good to do this.	2010-05-12 19:06:24	1273710000	resolved fixed	dcda15d	1298660000	java/org/apache/coyote/http11/Http11NioProcessor.java java/org/apache/tomcat/util/net/NioChannel.java java/org/apache/tomcat/util/net/SecureNioChannel.java	3:java/org/apache/coyote/http11/Http11NioProcessor.java 51:java/org/apache/tomcat/util/net/SecureNioChannel.java 56:java/org/apache/tomcat/util/net/NioChannel.java
487	50826	Bug 50826 (Embedded) Tomcat.destroy() throws java.lang.IllegalArgumentException	Embedded Tomcat sometimes throws this exception when calling destroy() method: java.lang.IllegalArgumentException: null source at java.util.EventObject.<init>(EventObject.java:56) at javax.management.Notification.<init>(Notification.java:184) at org.apache.catalina.core.StandardContext.destroyInternal(StandardContext.java:5433) at org.apache.catalina.util.LifecycleBase.destroy(LifecycleBase.java:285) at org.apache.catalina.core.ContainerBase.removeChild(ContainerBase.java:969) at org.apache.catalina.core.ContainerBase.destroyInternal(ContainerBase.java:1108) at org.apache.catalina.util.LifecycleBase.destroy(LifecycleBase.java:285) at org.apache.catalina.core.ContainerBase.removeChild(ContainerBase.java:969) at org.apache.catalina.core.ContainerBase.destroyInternal(ContainerBase.java:1108) at org.apache.catalina.util.LifecycleBase.destroy(LifecycleBase.java:285) at org.apache.catalina.core.StandardService.destroyInternal(StandardService.java:593) at org.apache.catalina.util.LifecycleBase.destroy(LifecycleBase.java:285) at org.apache.catalina.core.StandardServer.destroyInternal(StandardServer.java:786) at org.apache.catalina.util.LifecycleBase.destroy(LifecycleBase.java:285) at org.apache.catalina.startup.Tomcat.destroy(Tomcat.java:323) at su.msk.jet.nioproxy.rule.config.EmbeddedWebserver.stop(EmbeddedWebserver.java:26) I think that StandardContext.destroyInternal() misses check that this.getObjectName()!=null	2011-02-24 08:47:47	1298560000	resolved fixed	9d542ed	1298570000	java/org/apache/catalina/core/StandardContext.java test/org/apache/catalina/startup/TestTomcat.java	2:java/org/apache/catalina/core/StandardContext.java 102:test/org/apache/catalina/startup/TestTomcat.java
488	21669	Bug 21669 JNDIRealm roleBase pattern enahncement	"Currently the roleBase attribute must be a fxed location in the directory. A simple change would allow the role base to be specified relative to the user DN. My enhancement suggestion would change the roleBase definition as follows: roleBase - the base entry for the role search. If not specified, the search base is the top level directory context. If specified it may optionally include pattern replacements ""{0}""..""{n}"" corrosponding to the name parts of the user's distinguished name (as returned by javax.naming.Name.get()). For example, in the <Realm> defintion in server.xml you could specify the roleBase as: roleBase=""ou=Groups,{1},{0}"" The majority of the code to accomplish this would be in JNDIRealm.getRoles() and could look like this: String base = null; if ( roleBaseFormat != null ) { NameParser np = context.getNameParser(""""); Name name = np.parse(dn); String nameParts[] = new String[name.size()]; for ( int idx = 0 ; idx < name.size() ; idx++ ) nameParts[idx] = name.get(idx); base = roleBaseFormat.format(nameParts); } // Perform the configured search and process the results if (debug >= 3) { log("" Searching role base '"" + base + ""' for attribute '"" + roleName + ""'""); log("" With filter expression '"" + filter + ""'""); } NamingEnumeration results = context.search(base, filter, controls); Thank You, Art"	2003-07-16 22:59:24	1058410000	resolved fixed	f22600c	1298380000	java/org/apache/catalina/realm/JNDIRealm.java	1:java/org/apache/catalina/realm/JNDIRealm.java
489	19444	Bug 19444 JNDI Authentication roles must be anonymous accessible	"It appears that for the JNDIRealm to be able to locate roles, they must be anonymous accessible. I believe that for security purposes this should not be necessary if we are validating the user by binding to the directory. In that case the roles could be accessible to any bound user or that particular user. I discussed this very briefly on the Tomcat user list. It sounds like this had been discussed previously and for whatever reason, the idea rejected. Anyhow I submit that there is a bug, either in the code - which requires the roles to be anonymous, or in the documentation which does not make it clear that this is the case (at least in ""Tomcat 4 Servlet/JSP Container - Realm Configuration HOW- TO). It seems reasonable to me that if we are binding to the directory to authenticate, we would have that user's access to roles. Perhaps the documentation should more explicetly state that this is not the case. In the hope that it would be accepted as an enhancement, I am going to attempt to attach a modified JNDIRealm that uses the authenticated connection to obtain the roles. Thank You, Art"	2003-04-29 21:58:13	1051670000	resolved fixed	a085c4a	1298370000	java/org/apache/catalina/realm/JNDIRealm.java	1:java/org/apache/catalina/realm/JNDIRealm.java
490	50189	Bug 50189 AJP connector sends GET BODY CHUNK when reading after response closed	"If a servlet (probably incorrectly) closes the writer/outputstream of a response, and then attempts to read from the request, the AJP connector sends GET BODY CHUNK to the mod_jk worker. This then starts a series of very confusing communication between the worker and tomcat. The worker doesn't read it until it makes its next request. After making its next request, it reads it, and then sends a response with 0 length. At the same time, Tomcat responds to the request made by the worker with another GET BODY CHUNK, which the worker also responds with a message of 0 length. Then the really weird thing happens, Tomcat replays the first request made by that worker. At this point, based on what I'm looking at with tcpdump, I get too confused to work out exactly what is happening."	2010-10-31 23:27:02	1288580000	resolved fixed	514e713	1298050000	java/org/apache/catalina/connector/OutputBuffer.java	188:java/org/apache/catalina/connector/OutputBuffer.java
491	50802	Bug 50802 Deviation from servlet3 spec concerning resource lookup from META-INF/resources		2011-02-17 13:20:33	1297970000	resolved fixed	a9c3193	1297980000	java/org/apache/naming/resources/BaseDirContext.java java/org/apache/naming/resources/FileDirContext.java java/org/apache/naming/resources/VirtualDirContext.java java/org/apache/naming/resources/WARDirContext.java	17:java/org/apache/naming/resources/WARDirContext.java 21:java/org/apache/naming/resources/BaseDirContext.java 23:java/org/apache/naming/resources/VirtualDirContext.java 30:java/org/apache/naming/resources/FileDirContext.java
492	50780	Bug 50780 AjpConnectionHandler keeps many connections causing memory leak	"Hi, Sorry for my english. I use Tomcat 7.0.6 with APR 1.1.20. I noticed (from heap dump) many org.apache.tomcat.util.net.SocketWrapper objects, which are kept by ""connections"" atribute in org.apache.coyote.ajp.AjpAprProtocol$AjpConnectionHandler object. I don't understand, why there are so many objects representing old connections which are not active. In my example it was 300000 objects created, after 7 days of Tomcat work. Has someone forgotten to clean this HashMap from time to time? best regards Sergiusz Brzezinski"	2011-02-15 04:51:49	1297760000	resolved fixed	b56bf50	1297960000	java/org/apache/coyote/ajp/AjpAprProtocol.java	1:java/org/apache/coyote/ajp/AjpAprProtocol.java
493	50789	Bug 50789 custom error pages and CDI/weld problem		2011-02-15 12:09:28	1297790000	resolved fixed	3810b04	1297940000	java/org/apache/catalina/Context.java java/org/apache/catalina/core/ApplicationDispatcher.java java/org/apache/catalina/core/StandardContext.java	1:java/org/apache/catalina/core/StandardContext.java 9:java/org/apache/catalina/Context.java 281:java/org/apache/catalina/core/ApplicationDispatcher.java
494	50790	Bug 50790 EL parser needs to be more dynamic	"String.containes(CharSequence) is not being resolved correctly in the following situation: <span class=""#{(facesContext.externalContext.request.requestURI.contains(item.url)) ? 'activepage' : ''}"">#{template[item.labelKey]}</span> Exception: javax.el.ELException: /faces/template/mainLayout.xhtml: java.lang.NoSuchMethodException: java.lang.String.contains(java.lang.String) at com.sun.faces.facelets.compiler.AttributeInstruction.write(AttributeInstruction.java:87) at com.sun.faces.facelets.compiler.UIInstructions.encodeBegin(UIInstructions.java:75) at com.sun.faces.renderkit.html_basic.HtmlBasicRenderer.encodeRecursive(HtmlBasicRenderer.java:285) at com.sun.faces.renderkit.html_basic.OutputLinkRenderer.encodeChildren(OutputLinkRenderer.java:125) at javax.faces.component.UIComponentBase.encodeChildren(UIComponentBase.java:848) at javax.faces.component.UIComponent.encodeAll(UIComponent.java:1613) at com.sun.faces.facelets.component.RepeatRenderer.encodeChildren(RepeatRenderer.java:97) at com.sun.faces.facelets.component.UIRepeat.process(UIRepeat.java:496) at com.sun.faces.facelets.component.UIRepeat.encodeChildren(UIRepeat.java:926) at javax.faces.component.UIComponent.encodeAll(UIComponent.java:1613) at javax.faces.render.Renderer.encodeChildren(Renderer.java:168) at javax.faces.component.UIComponentBase.encodeChildren(UIComponentBase.java:848) at javax.faces.component.UIComponent.encodeAll(UIComponent.java:1613) at javax.faces.component.UIComponent.encodeAll(UIComponent.java:1616) at javax.faces.component.UIComponent.encodeAll(UIComponent.java:1616) at com.sun.faces.application.view.FaceletViewHandlingStrategy.renderView(FaceletViewHandlingStrategy.java:380) at com.sun.faces.application.view.MultiViewHandler.renderView(MultiViewHandler.java:126) at com.ocpsoft.pretty.faces.application.PrettyViewHandler.renderView(PrettyViewHandler.java:157) at com.sun.faces.lifecycle.RenderResponsePhase.execute(RenderResponsePhase.java:127) at com.sun.faces.lifecycle.Phase.doPhase(Phase.java:101) at com.sun.faces.lifecycle.LifecycleImpl.render(LifecycleImpl.java:139) at javax.faces.webapp.FacesServlet.service(FacesServlet.java:313) at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:306) at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:210) at com.reardeninc.tigris.ui.facesutil.FacesFilter.doFilter(FacesFilter.java:86) at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:244) at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:210) at org.primefaces.webapp.filter.FileUploadFilter.doFilter(FileUploadFilter.java:79) at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:244) at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:210) at com.ocpsoft.pretty.PrettyFilter.doFilter(PrettyFilter.java:100) at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:244) at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:210) at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:240) at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:161) at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:496) at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:164) at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:100) at org.apache.catalina.valves.AccessLogValve.invoke(AccessLogValve.java:541) at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:118) at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:383) at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:243) at org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.process(Http11Protocol.java:188) at org.apache.tomcat.util.net.JIoEndpoint$SocketProcessor.run(JIoEndpoint.java:288) at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908) at java.lang.Thread.run(Thread.java:680) Caused by: java.lang.NoSuchMethodException: java.lang.String.contains(java.lang.String) at java.lang.Class.getMethod(Class.java:1605) at javax.el.BeanELResolver.invoke(BeanELResolver.java:405) at javax.el.CompositeELResolver.invoke(CompositeELResolver.java:161) at org.apache.el.parser.AstValue.getValue(AstValue.java:159) at org.apache.el.parser.AstChoice.getValue(AstChoice.java:45) at org.apache.el.ValueExpressionImpl.getValue(ValueExpressionImpl.java:189) at com.sun.faces.facelets.el.ELText$ELTextVariable.toString(ELText.java:207) at com.sun.faces.facelets.compiler.AttributeInstruction.write(AttributeInstruction.java:82) ... 46 more"	2011-02-15 15:04:47	1297800000	resolved fixed	cfab791	1297940000	java/javax/el/BeanELResolver.java java/org/apache/el/parser/AstValue.java test/org/apache/el/TestMethodExpressionImpl.java	35:java/org/apache/el/parser/AstValue.java 125:java/javax/el/BeanELResolver.java 280:test/org/apache/el/TestMethodExpressionImpl.java
495	50793	Bug 50793 Invalid DispatchType in ServletRequestListener on async dispatch	"If a ServletRequestListener is defined, when is invoked after a call to AsyncContext#dispatch() the DispatcherType returned from the ServletRequest is REQUEST rather than ASYNC. When the actual servlet is invoked, the type is correctly set to ASYNC. If the listener is intended to be invoked for each dispatch, then the DispatcherType should match the value returned in the filter/servlet."	2011-02-15 22:47:30	1297830000	closed fixed	72418ba	1297880000	java/org/apache/catalina/connector/CoyoteAdapter.java java/org/apache/catalina/core/StandardContext.java java/org/apache/catalina/core/StandardContextValve.java test/org/apache/catalina/core/TestAsyncContextImpl.java	1:java/org/apache/catalina/core/StandardContext.java 23:test/org/apache/catalina/core/TestAsyncContextImpl.java 43:java/org/apache/catalina/connector/CoyoteAdapter.java 57:java/org/apache/catalina/core/StandardContextValve.java
496	50713	"Bug 50713 The ""roles"" command doesn't work"		2011-02-03 02:38:46	1296720000	resolved fixed	4b21973	1297860000	java/org/apache/catalina/ant/RolesTask.java java/org/apache/catalina/manager/ManagerServlet.java	16:java/org/apache/catalina/manager/ManagerServlet.java 36:java/org/apache/catalina/ant/RolesTask.java
497	50700	Bug 50700 Context parameters are being overridden with parameters from the web application deployment descriptor	"Context parameters are being overridden with parameters from the web application deployment descriptor even through ""override"" attribute is set to ""false"" For example: lines from context file <Context path=""/path"" docBase=""/path/to/docbase"" cookies=""true""> <Parameter name=""parameter_name"" value=""test1"" override=""false""/> .... </Context> lines from web.xml <context-param> <description>default value for parameter_name</description> <param-name>parameter_name</param-name> <param-value>test2</param-value> </context-param> Now servletContext.getInitParameter(""parameter_name"") returns ""test2"""	2011-02-01 13:04:17	1296580000	resolved fixed	a073ac8	1297710000	java/org/apache/catalina/core/StandardContext.java	1:java/org/apache/catalina/core/StandardContext.java
498	50771	Bug 50771 HttpServletRequest#getAuthType() returns null though the request is authenticated.		2011-02-14 03:30:02	1297670000	resolved fixed	877a3df	1297670000	java/org/apache/catalina/ha/session/DeltaRequest.java java/org/apache/catalina/ha/session/DeltaSession.java	75:java/org/apache/catalina/ha/session/DeltaSession.java 400:java/org/apache/catalina/ha/session/DeltaRequest.java
499	50726	Bug 50726 Jasper can generate uncompilable source code if genStringAsCharArray is turned on	"Our jsp pages are compiled at build time. If I turn on genStringAsCharArray optimization switch, in some cases there will be longer lines in the generated java code than the javac compiler can process. It provides the following error message: [javac] Compiling 1609 source files to d:\...\jspc\classes [javac] d:\...\jspc\src\org\apache\jsp\WEB_002dINF\..._005fAPP\pages\termsconditions\TermsAndConditions_005fms_005fMY_jsp.java:96: constant string too long"	2011-02-07 08:14:03	1297080000	resolved fixed	d0f3899	1297540000	java/org/apache/jasper/compiler/Generator.java	9:java/org/apache/jasper/compiler/Generator.java
500	50759	Bug 50759 ValidatorClassName Validation fails to set lastValidated timestamp		2011-02-10 19:12:21	1297380000	resolved fixed	50f16fe	1297440000	modules/jdbc-pool/java/org/apache/tomcat/jdbc/pool/PooledConnection.java	2:modules/jdbc-pool/java/org/apache/tomcat/jdbc/pool/PooledConnection.java
501	50751	Bug 50751 JNDIRealm invokes getAttributes with no attribute ids. Prevents using DOMAIN\{0} to login.		2011-02-10 12:11:43	1297360000	resolved fixed	0313ded	1297440000	java/org/apache/catalina/realm/JNDIRealm.java	1:java/org/apache/catalina/realm/JNDIRealm.java
502	50752	Bug 50752 Typo in Embedded.java log message	"There's a debug log message in Embedded.java with a typo in it: ""INITIAL_CONTEXT_FACTORY alread set "" Attached is a patch against the 6_0_29 tag, but the issue exists in tc6.0.x/trunk"	2011-02-10 12:17:31	1297360000	resolved fixed	272e30c	1297430000	java/org/apache/catalina/startup/Embedded.java	1:java/org/apache/catalina/startup/Embedded.java
503	50720	"Bug 50720 When using jsp mapped as servlet in web.xml, cyrillic characters are not allowed in web.xml"		2011-02-04 09:07:57	1296830000	resolved fixed	e4bc803	1297360000	java/org/apache/jasper/compiler/WebXml.java	7:java/org/apache/jasper/compiler/WebXml.java
504	50721	Bug 50721 RequestUtil.URLDecode() throws IllegalArgumentException for URLs with %xx-Code as last character		2011-02-04 20:42:49	1296870000	resolved fixed	5c9e352	1297290000	java/org/apache/catalina/util/RequestUtil.java test/org/apache/catalina/util/TestRequestUtil.java	1:java/org/apache/catalina/util/RequestUtil.java 11:test/org/apache/catalina/util/TestRequestUtil.java
505	50709	Bug 50709 Make class org.apache.catalina.core.ApplicationContextFacade non-final	"Please make class org.apache.catalina.core.ApplicationContextFacade non-final so it can be subclassed. Need to extend ApplicationContextFacade so Mobicents Sip Servlet, working on top of Tomcat 7, to integrate with Weld. Thanks George"	2011-02-02 13:11:45	1296670000	resolved fixed	9f41c91	1296820000	java/org/apache/catalina/core/ApplicationContextFacade.java	1:java/org/apache/catalina/core/ApplicationContextFacade.java
506	50673	Bug 50673 Error when stopping Tomcat using services.msc	"When stopping Tomcat using services.msc, an error message is displayed: ""Windows could not stop the Apache Tomcat 7 service on Local Computer. Error 109: The pipe has been ended."" Despite this error, Tomcat appears to stop normally. No such problem was encountered in 6.0.29."	2011-01-27 10:09:50	1296140000	resolved fixed	6ac4a27	1296610000	java/org/apache/catalina/core/StandardServer.java java/org/apache/catalina/startup/Catalina.java	3:java/org/apache/catalina/startup/Catalina.java 12:java/org/apache/catalina/core/StandardServer.java
507	50631	Bug 50631 InternalNioInputBuffer should honor maxHttpHeadSize	"InternalNioInputBuffer automatically expands its buffer while reading in request line, effectively ignoring the maxHttpHeaderSize setting."	2011-01-21 13:23:52	1295630000	resolved fixed	0084470	1296550000	java/org/apache/coyote/http11/InternalNioInputBuffer.java	1:java/org/apache/coyote/http11/InternalNioInputBuffer.java
508	50325	Bug 50325 Update Tomcat to use JRE provided solutions for CVE-2009-3555 if available		2010-11-24 05:38:15	1290600000	resolved fixed	b4e9488	1296520000	java/org/apache/tomcat/util/net/jsse/JSSESocketFactory.java	83:java/org/apache/tomcat/util/net/jsse/JSSESocketFactory.java
509	50683	"Bug 50683 Servlet 3.0 annotations not scanned if unpackWars=""false"""		2011-01-28 18:36:29	1296260000	resolved fixed	d21437e	1296260000	java/org/apache/naming/resources/WARDirContext.java	42:java/org/apache/naming/resources/WARDirContext.java
510	46819	Bug 46819 Remove redundant object instantiations in JspRuntimeLibrary		2009-03-07 23:30:10	1236490000	resolved fixed	20ace41	1296260000	java/org/apache/jasper/runtime/JspRuntimeLibrary.java	1:java/org/apache/jasper/runtime/JspRuntimeLibrary.java
511	50680	"Bug 50680 NPE in TagFileProcessor when tag file is in an expanded directory ""jar"""		2011-01-28 09:03:07	1296220000	resolved fixed	af4549f	1296250000	java/org/apache/jasper/compiler/TagFileProcessor.java	1:java/org/apache/jasper/compiler/TagFileProcessor.java
512	50679	Bug 50679 FarmDeployer doesn't support parallel deployment	"Version: Tomcat 7.0.6 Component: Catalina OS: Windows 7 64bit Overview: Parallel deployment works like a charm in a non-clustered environment. But when deploying a versioned app (APPNAME##VERSION.war) to a farm deployer directory, it seems that the filename encoding of the ## delimiter is not translated correctly to identify the war file on the file system: ## is translated to %23%23 Reproduce: 1. Create a version app file 2. Deploy file to watched farm deployer directory Expected result: - Versioned app is copyied to cluster members and deployed Actual result: - Versioned app is NOT copyied to cluster members. catalina.log displays the following error messages: [ContainerBackgroundProcessor[StandardEngine[Catalina]]] INFO org.apache.catalina.ha.deploy.FarmWarDeployer- Installing webapp[/Shop##201101261] from C:\Apache\Tomcat7\cluster\webapps\Shop##201101261.war [ContainerBackgroundProcessor[StandardEngine[Catalina]]] INFO org.apache.catalina.ha.deploy.FarmWarDeployer- Cluster wide remove of web app /Shop##201101261 [ContainerBackgroundProcessor[StandardEngine[Catalina]]] ERROR org.apache.catalina.ha.deploy.FarmWarDeployer- Unable to install WAR file java.io.FileNotFoundException: C:\Apache\Tomcat7\cluster\webapps\Shop%23%23201101261.war (Das System kann die angegebene Datei nicht finden) at java.io.FileInputStream.open(Native Method) at java.io.FileInputStream.<init>(FileInputStream.java:106) at org.apache.catalina.ha.deploy.FileMessageFactory.<init>(FileMessageFactory.java:152) at org.apache.catalina.ha.deploy.FileMessageFactory.getInstance(FileMessageFactory.java:175) at org.apache.catalina.ha.deploy.FarmWarDeployer.install(FarmWarDeployer.java:372) at org.apache.catalina.ha.deploy.FarmWarDeployer.fileModified(FarmWarDeployer.java:468) at org.apache.catalina.ha.deploy.WarWatcher.check(WarWatcher.java:95) at org.apache.catalina.ha.deploy.FarmWarDeployer.backgroundProcess(FarmWarDeployer.java:591) at org.apache.catalina.ha.tcp.SimpleTcpCluster.backgroundProcess(SimpleTcpCluster.java:627) at org.apache.catalina.core.ContainerBase.backgroundProcess(ContainerBase.java:1200) at org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.processChildren(ContainerBase.java:1393) at org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.processChildren(ContainerBase.java:1403) at org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.run(ContainerBase.java:1382) at java.lang.Thread.run(Thread.java:662) [ContainerBackgroundProcessor[StandardEngine[Catalina]]] INFO org.apache.catalina.startup.HostConfig- Deploying web application archive Shop##201101261.war Relevant configuration in server.xml: ... <Host name=""sbwebapp1"" appBase=""${catalina.base}/cluster/webapps"" unpackWARs=""true"" autoDeploy=""true""> <Cluster className=""org.apache.catalina.ha.tcp.SimpleTcpCluster"" channelSendOptions=""8""> <Manager className=""org.apache.catalina.ha.session.DeltaManager"" expireSessionsOnShutdown=""true"" notifyListenersOnReplication=""false"" stateTransferTimeout=""5""/> <Channel className=""org.apache.catalina.tribes.group.GroupChannel""> <Membership className=""org.apache.catalina.tribes.membership.McastService"" address=""228.0.0.4"" port=""45564"" frequency=""500"" dropTime=""3000""/> <Receiver className=""org.apache.catalina.tribes.transport.nio.NioReceiver"" address=""192.168.222.220"" port=""4000"" autoBind=""100"" selectorTimeout=""5000"" maxThreads=""6""/> <Sender className=""org.apache.catalina.tribes.transport.ReplicationTransmitter""> <Transport className=""org.apache.catalina.tribes.transport.nio.PooledParallelSender""/> </Sender> <Interceptor className=""org.apache.catalina.tribes.group.interceptors.TcpFailureDetector""/> <Interceptor className=""org.apache.catalina.tribes.group.interceptors.MessageDispatch15Interceptor""/> <Interceptor className=""org.apache.catalina.tribes.group.interceptors.ThroughputInterceptor""/> </Channel> <Valve className=""org.apache.catalina.ha.tcp.ReplicationValve"" filter="".*\.gif;.*\.js;.*\.jpg;.*\.png;.*\.htm;.*\.html;.*\.css;.*\.txt;.*\.swf;.*\.flv;""/> <Valve className=""org.apache.catalina.ha.session.JvmRouteBinderValve""/> <ClusterListener className=""org.apache.catalina.ha.session.JvmRouteSessionIDBinderListener""/> <ClusterListener className=""org.apache.catalina.ha.session.ClusterSessionListener""/> <Deployer className=""org.apache.catalina.ha.deploy.FarmWarDeployer"" tempDir=""${catalina.base}/cluster/temp/"" deployDir=""${catalina.base}/cluster/webapps/"" watchDir=""${catalina.base}/cluster/deploy/"" watchEnabled=""true""/> </Cluster> <!-- Access log processes all example. Documentation at: /docs/config/valve.html Note: The pattern used is equivalent to using pattern=""common"" --> <Valve className=""org.apache.catalina.valves.AccessLogValve"" directory=""logs"" prefix=""ajp_access_"" suffix="".log"" pattern=""%h %l %u %t &quot;%r&quot; %s %b"" resolveHosts=""false""/> </Host> ..."	2011-01-28 03:22:33	1296200000	resolved fixed	2377f51	1296250000	java/org/apache/catalina/ha/ClusterDeployer.java java/org/apache/catalina/ha/deploy/FarmWarDeployer.java java/org/apache/catalina/ha/deploy/FileMessage.java java/org/apache/catalina/ha/deploy/FileMessageFactory.java java/org/apache/catalina/ha/deploy/UndeployMessage.java	2:java/org/apache/catalina/ha/deploy/FarmWarDeployer.java 33:java/org/apache/catalina/ha/deploy/FileMessageFactory.java 42:java/org/apache/catalina/ha/ClusterDeployer.java 272:java/org/apache/catalina/ha/deploy/FileMessage.java 424:java/org/apache/catalina/ha/deploy/UndeployMessage.java
513	50642	Bug 50642 keepAliveProtection doesn't work		2011-01-24 10:45:14	1295880000	resolved fixed	5c13d8c	1296220000	java/org/apache/catalina/core/JreMemoryLeakPreventionListener.java java/org/apache/catalina/core/StandardContext.java java/org/apache/catalina/loader/WebappClassLoader.java java/org/apache/catalina/loader/WebappLoader.java	1:java/org/apache/catalina/core/JreMemoryLeakPreventionListener.java 5:java/org/apache/catalina/core/StandardContext.java 23:java/org/apache/catalina/loader/WebappClassLoader.java 87:java/org/apache/catalina/loader/WebappLoader.java
514	50646	Bug 50646 Tribes ByteMessage will get corrupted if message size exceeds the underlying buffer size	"The Tribes ByteMessage class is used to transfer byte payloads in the context of the tribes communication framework. Due to how the message is deserialized, there will be data loss (and hence corruption) if the message size exceeds the underlying buffer size. The solution is to replace an ObjectInput#read(byte[]) call by ObjectInput#readFully(byte[]). Fix is attached."	2011-01-25 07:08:10	1295960000	resolved fixed	0119483	1296070000	java/org/apache/catalina/tribes/ByteMessage.java	1:java/org/apache/catalina/tribes/ByteMessage.java
515	50629	Bug 50629 Make the bindThread/unbindThread method protected	"In the latest Tomcat codes, I saw that a new thread is created for listener start, filter start and loadOnStartup. But the two methods bindThread and unbindThread is marked as private, how about making those methods protected ? So that other containers could use those two methods for their own initialization works. Thanks."	2011-01-21 07:23:54	1295610000	resolved fixed	3898ed0	1295620000	java/org/apache/catalina/core/StandardContext.java	1:java/org/apache/catalina/core/StandardContext.java
516	50620	Bug 50620 Session related errors prevent clean recycle of Request and Response objects by CoyoteAdapter		2011-01-19 15:54:38	1295470000	resolved fixed	fbd0110	1295550000	java/org/apache/catalina/connector/Request.java	7:java/org/apache/catalina/connector/Request.java
517	50606	Bug 50606 Error running CGI executable in Tomcat 6.0.30		2011-01-18 02:26:41	1295340000	resolved fixed	c0cd721	1295550000	java/org/apache/catalina/servlets/CGIServlet.java	3:java/org/apache/catalina/servlets/CGIServlet.java
518	50613	Bug 50613 ConnectionPool.size corruption when evictions enabled:	"When (the various forms of) eviction run on the connection pool, ConnectionPool.size goes negative. This appears to be a concurrency problem. Attached is a unit test that illustrates the issue."	2011-01-18 17:33:53	1295390000	resolved fixed	5cb0b7a	1295470000	modules/jdbc-pool/java/org/apache/tomcat/jdbc/pool/ConnectionPool.java modules/jdbc-pool/test/org/apache/tomcat/jdbc/test/TestSizePreservation.java	2:modules/jdbc-pool/java/org/apache/tomcat/jdbc/pool/ConnectionPool.java
519	50601	Bug 50601 Redundant null checks before instanceof in equals()		2011-01-17 08:54:21	1295270000	resolved fixed	d95db3f	1295460000	java/org/apache/catalina/core/ApplicationTaglibDescriptor.java java/org/apache/catalina/deploy/LoginConfig.java java/org/apache/catalina/tribes/tipis/AbstractReplicatedMap.java java/org/apache/el/parser/SimpleNode.java java/org/apache/naming/NamingEntry.java java/org/apache/tomcat/util/net/URL.java	27:java/org/apache/catalina/tribes/tipis/AbstractReplicatedMap.java 59:java/org/apache/naming/NamingEntry.java 75:java/org/apache/el/parser/SimpleNode.java 106:java/org/apache/tomcat/util/net/URL.java 136:java/org/apache/catalina/core/ApplicationTaglibDescriptor.java 214:java/org/apache/catalina/deploy/LoginConfig.java
520	50598	Bug 50598 Sample build.xml uses wrong manager.url		2011-01-16 14:08:25	1295200000	resolved fixed	de188ad	1295280000	java/org/apache/catalina/ant/AbstractCatalinaTask.java	23:java/org/apache/catalina/ant/AbstractCatalinaTask.java
521	50597	Bug 50597 Class.newInstance is used for Dynamic instance filters causing InstantiationException	"Class.newInstance is called even when the following method ServletContext.addFilter method is called: javax.servlet.FilterRegistration.Dynamic addFilter(java.lang.String s, javax.servlet.Filter filter); This leads to an InstantiationException at runtime if there is no no-args constructor for the filter (pasted below). I'll supply a simple patch that fixes the issue for me. SEVERE: Exception starting filter testFilter java.lang.InstantiationException: test.TestFilter at java.lang.Class.newInstance0(Class.java:340) at java.lang.Class.newInstance(Class.java:308) at org.apache.catalina.core.DefaultInstanceManager.newInstance(DefaultIn stanceManager.java:119) at org.apache.catalina.core.ApplicationFilterConfig.getFilter(Applicatio nFilterConfig.java:252) at org.apache.catalina.core.ApplicationFilterConfig.setFilterDef(Applica tionFilterConfig.java:372) at org.apache.catalina.core.ApplicationFilterConfig.<init>(ApplicationFi lterConfig.java:98) at org.apache.catalina.core.StandardContext.filterStart(StandardContext. java:4382) at org.apache.catalina.core.StandardContext$2.call(StandardContext.java: 5040) at org.apache.catalina.core.StandardContext$2.call(StandardContext.java:5035) at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303) at java.util.concurrent.FutureTask.run(FutureTask.java:138) at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908) at java.lang.Thread.run(Thread.java:662)"	2011-01-16 12:25:24	1295200000	resolved fixed	30468b7	1295280000	java/org/apache/catalina/core/ApplicationFilterConfig.java	4:java/org/apache/catalina/core/ApplicationFilterConfig.java
522	50600	Bug 50600 ConcurrentModificationException removing WAR via FarmWarDeployer	The following exception was reported via $work WARNING: Exception processing cluster org.apache.catalina.ha.tcp.SimpleTcpCluster@68e4e358 background process java.util.ConcurrentModificationException at java.util.HashMap$HashIterator.nextEntry(HashMap.java:810) at java.util.HashMap$EntryIterator.next(HashMap.java:851) at java.util.HashMap$EntryIterator.next(HashMap.java:849) at org.apache.catalina.ha.deploy.WarWatcher.check(WarWatcher.java:87) at org.apache.catalina.ha.deploy.FarmWarDeployer.backgroundProcess(FarmWarDeployer.java:609) at org.apache.catalina.ha.tcp.SimpleTcpCluster.backgroundProcess(SimpleTcpCluster.java:596) at org.apache.catalina.core.ContainerBase.backgroundProcess(ContainerBase.java:1302) at org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.processChildren(ContainerBase.java:1601) at org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.processChildren(ContainerBase.java:1610) at org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.run(ContainerBase.java:1590) at java.lang.Thread.run(Thread.java:636) The root cause is removing the entry directly from the Map rather than from the iterator. I have a patch that I'll apply shortly.	2011-01-17 06:20:11	1295260000	resolved fixed	d269ce3	1295260000	java/org/apache/catalina/ha/deploy/WarWatcher.java	4:java/org/apache/catalina/ha/deploy/WarWatcher.java
523	50582	Bug 50582 Small JSPs do not set Content-Length (and use chunked encoding) if AccessLogValve is configured		2011-01-14 02:16:41	1294990000	resolved fixed	35a84d1	1295180000	java/org/apache/catalina/connector/CoyoteAdapter.java java/org/apache/catalina/valves/AccessLogValve.java java/org/apache/catalina/valves/JDBCAccessLogValve.java java/org/apache/coyote/http11/AbstractOutputBuffer.java	1:java/org/apache/catalina/valves/AccessLogValve.java 20:java/org/apache/catalina/valves/JDBCAccessLogValve.java 41:java/org/apache/catalina/connector/CoyoteAdapter.java 156:java/org/apache/coyote/http11/AbstractOutputBuffer.java
524	50591	Bug 50591 NPE in ReplicationValve in 7.0.6		2011-01-15 12:33:11	1295110000	resolved fixed	d8f8be1	1295110000	java/org/apache/catalina/ha/tcp/ReplicationValve.java	1:java/org/apache/catalina/ha/tcp/ReplicationValve.java
525	18797	Bug 18797 MemoryUserRule doesn't validate user attributes	The implementation of org.apache.catalina.realm.MemoryRuleSet.begin dosen't validate the attribute values before adding a user to the MemoryRealm. If username or name are not present then a null username is used which can cause odd problems later on. Basically the method should check that parameters passed to MemoryRealm.addUser are not null before calling the method.	2003-04-08 06:33:14	1049800000	resolved fixed	51650a1	1294940000	java/org/apache/catalina/users/MemoryUserDatabase.java	19:java/org/apache/catalina/users/MemoryUserDatabase.java
526	18462	Bug 18462 System.err gets overriden to output to System.out	I am using Eclipse to do my development and I am running tomcat 4.1.24 from within eclipse. One of the nice features of eclipse is that anything you display with System.out comes out in blue and anything you send to System.err is displayed in red. However when tomcat is running Catalina overrides System.err and makes it point to System.out. This is very inconvinient because its much harder to search for severe error messages in a list of millions of trivial ones.	2003-03-28 12:35:32	1048870000	resolved fixed	164fd40	1294880000	java/org/apache/catalina/startup/Catalina.java java/org/apache/catalina/startup/Embedded.java	2:java/org/apache/catalina/startup/Catalina.java 59:java/org/apache/catalina/startup/Embedded.java
527	15688	Bug 15688 full-qualified names instead of imports	"Hi, Jasper generated *.java-files that are compiled. The template for those files is very ""unaesthetic"". I could demonstrate nice side-effects using a simple <%@ page import=""mypackage.Jspfactory"" %> You should use full qualified names instead of a bunch of import-staments. For example _jspxFactory = JspFactory.getDefaultFactory(); would become _jspxFactory = javax.servlet.jsp.JspFactory.getDefaultFactory(); and if you don't already do, you should use the this-reference where possible. I don't know what the spec says about that conflict, but it shouldn't be a bad idea to use full-qualified names instead of imports."	2002-12-27 22:30:47	1041050000	resolved fixed	e69347b	1294830000	java/org/apache/jasper/compiler/Generator.java java/org/apache/jasper/compiler/JspUtil.java	2:java/org/apache/jasper/compiler/Generator.java 23:java/org/apache/jasper/compiler/JspUtil.java
528	50333	Bug 50333 IllegalArgumentException occurs when setting maxActive to smaller than 1.		2010-11-25 00:22:29	1290660000	resolved fixed	0ccff07	1294680000	modules/jdbc-pool/java/org/apache/tomcat/jdbc/pool/ConnectionPool.java modules/jdbc-pool/java/org/apache/tomcat/jdbc/pool/PoolProperties.java	1:modules/jdbc-pool/java/org/apache/tomcat/jdbc/pool/PoolProperties.java 9:modules/jdbc-pool/java/org/apache/tomcat/jdbc/pool/ConnectionPool.java
529	49953	Bug 49953 Missing @Override annotations		2010-09-17 14:00:04	1284750000	resolved wontfix	fd990a4	1294680000	modules/jdbc-pool/java/org/apache/tomcat/jdbc/pool/interceptor/StatementCache.java modules/jdbc-pool/java/org/apache/tomcat/jdbc/pool/jmx/ConnectionPool.java	806:modules/jdbc-pool/java/org/apache/tomcat/jdbc/pool/jmx/ConnectionPool.java 978:modules/jdbc-pool/java/org/apache/tomcat/jdbc/pool/interceptor/StatementCache.java
530	21157	Bug 21157 CookieExample is setting cookie after writing data	"A servlet can not set the headers and cookies after writing data to the servlet's output stream. Once the servlet writes data, headers are committed. However CookieExample writes some data first before doing addCookie on the response. The reason why this code works at all even with the above bug is: The CookieExample is only writing a small amount of data before doing response.addCookie. That data is still held in buffer and not yet sent over the wire. Hence the headers are not yet committed. So it is pure luck that this example works. You can easily expose the bug by writing say 20K characters in this example before response.addCookie is called. You will see that the cookies that are adding to response are not actually sent back to client. Fix is simple. Move up the response.addCookie() before response.getWriter()"	2003-06-27 23:12:00	1056770000	resolved fixed	4ce656a	1294530000	webapps/examples/WEB-INF/classes/CookieExample.java	
531	50552	"Bug 50552 Ant Tasks give a null pointer exception when an error occurs, masking true error"		2011-01-06 12:39:49	1294340000	resolved fixed	a6b37af	1294400000	java/org/apache/catalina/ant/BaseRedirectorHelperTask.java	43:java/org/apache/catalina/ant/BaseRedirectorHelperTask.java
532	50554	Bug 50554 Bad use of getClass() could potentially lead to concurrency bugs in future		2011-01-06 14:38:25	1294340000	resolved fixed	06b8609	1294400000	java/org/apache/naming/java/javaURLContextFactory.java	382:java/org/apache/naming/java/javaURLContextFactory.java
533	50477	"Bug 50477 If you set 0 to initialSize, can't obtain Connection by using getConnectionAsync method."		2010-12-15 04:40:32	1292410000	resolved fixed	869c6f4	1294360000	modules/jdbc-pool/java/org/apache/tomcat/jdbc/pool/ConnectionPool.java modules/jdbc-pool/test/org/apache/tomcat/jdbc/test/Async0IdleTestBug50477.java	5:modules/jdbc-pool/java/org/apache/tomcat/jdbc/pool/ConnectionPool.java
534	49543	"Bug 49543 Request for a ""shared"" datasource configuration as in DBCP"	"The ability to configure the datasource at the server level and have it shared amongst all applications on that server with each application supplying their own credentials for the datasource. This type of configuration is supported by DBCP and is called a ""shared"" datasource configuration."	2010-07-02 15:07:50	1278100000	resolved fixed	3560f39	1294340000	java/org/apache/naming/factory/DataSourceLinkFactory.java	
535	50550	Bug 50550 PropFind 404 error after MkCol succes		2011-01-06 09:11:12	1294320000	resolved fixed	5c2742c	1294340000	java/org/apache/naming/resources/ProxyDirContext.java	52:java/org/apache/naming/resources/ProxyDirContext.java
536	47319	"Bug 47319 With APR, getRemoteHost() returns NULL for unknown clients"		2009-06-05 05:11:52	1244190000	resolved fixed	ce64f9b	1294330000	java/org/apache/coyote/http11/Http11AprProcessor.java	8:java/org/apache/coyote/http11/Http11AprProcessor.java
537	50547	Bug 50547 The CHANGE_SESSION_ID message that received during cluster session synchronization is dropped.	"Neither CHANGE_SESSION_ID message nor SESSION_EXPIRED message set timestamp. If these messages are received during cluster sessions synchronization in DeltaManager startup, because the timestamp is not set, they are dropped. I made a patch that add timestamp for CHANGE_SESSION_ID and SESSION_EXPIRED message. Best Regards."	2011-01-06 03:48:03	1294300000	resolved fixed	a0ef3e6	1294310000	java/org/apache/catalina/ha/session/DeltaManager.java	1:java/org/apache/catalina/ha/session/DeltaManager.java
538	50453	Bug 50453 Multiple X-Forwarded-For headers not handled by RemoteIP valve		2010-12-10 09:29:39	1291990000	resolved fixed	3541fc6	1294240000	java/org/apache/catalina/filters/RemoteIpFilter.java java/org/apache/catalina/valves/RemoteIpValve.java test/org/apache/catalina/filters/TestRemoteIpFilter.java test/org/apache/catalina/valves/TestRemoteIpValve.java	1:java/org/apache/catalina/valves/RemoteIpValve.java 2:java/org/apache/catalina/filters/RemoteIpFilter.java 6:test/org/apache/catalina/valves/TestRemoteIpValve.java 13:test/org/apache/catalina/filters/TestRemoteIpFilter.java
539	50467	Bug 50467 Occasional NIO connector lockups on high load	"We've been running Tomcat 6.0.29 on FC8 2.6.21 with tens of thousands of long polling threads which usually work fine. Every few days though we will experience a sudden lockup of the NIO connector and it has to be restarted. These have been seen to be accompanied by the following stack trace: Exception in thread ""http-8082-ClientPoller-0"" java.lang.NullPointerException at org.apache.tomcat.util.net.NioEndpoint$Poller.run(NioEndpoint.java:1620) at java.lang.Thread.run(Thread.java:662) Looking at the source it seems the issue is likely to be a race condition where access() is called on a null attachment, probably while it's in the process of being cancelled: while (iterator != null && iterator.hasNext()) { SelectionKey sk = (SelectionKey) iterator.next(); KeyAttachment attachment = (KeyAttachment)sk.attachment(); /*NPE*/ attachment.access(); iterator.remove(); processKey(sk, attachment); }//while"	2010-12-13 14:02:35	1292270000	resolved fixed	688e61e	1294240000	java/org/apache/tomcat/util/net/NioEndpoint.java	1:java/org/apache/tomcat/util/net/NioEndpoint.java
540	50541	Bug 50541 JNDIRealm: support configuring LDAP sizeLimit (countLimit in SearchControls)		2011-01-04 11:35:07	1294160000	resolved fixed	76b6415	1294160000	java/org/apache/catalina/realm/JNDIRealm.java	1:java/org/apache/catalina/realm/JNDIRealm.java
541	50500	Bug 50500 EL evaluation of floating-point String value vs BigInteger loses precision	"According to the EL spec ch.1.7.1, the A+B,A-B,A*B expressions when A is a ""String containing ., e, or E"" and B is a BigInteger have to be evaluated as follows: ""coerce both A and B to BigDecimal and apply operator"" The actual implementation though, instead of coercing A as String -> BigDecimal, does two coercions: String -> Double -> BigDecimal, which produces a different result. To reproduce, run the following JSP page: <% pageContext.setAttribute(""a"", ""1.1""); pageContext.setAttribute(""b"", new java.math.BigInteger(""1000000000000000000000"")); // ""c"" is used to explicitly coerce arguments to BigDecimal pageContext.setAttribute(""c"", new java.math.BigDecimal(""0"")); %>${a + b}<br> ${(a+c) + (b+c)}<br> ${a - b}<br> ${(a+c) - (b+c)}<br> ${a * b}<br> ${(a+c) * (b+c)} Actual result: 1000000000000000000001.100000000000000088817841970012523233890533447265625 1000000000000000000001.1 -999999999999999999998.899999999999999911182158029987476766109466552734375 -999999999999999999998.9 1100000000000000088817.841970012523233890533447265625000000000000000000000 1100000000000000000000.0 Expected result: 1000000000000000000001.1 1000000000000000000001.1 -999999999999999999998.9 -999999999999999999998.9 1100000000000000000000.0 1100000000000000000000.0 I think it is a minor issue, though. This is reproducible in the current tc6.0.x as well. Maybe o.a.el.lang.ELArithmetic#add(Object, Object) should delegate to BIGDECIMAL instead of DOUBLE with these types of arguments."	2010-12-19 19:00:53	1292800000	resolved fixed	b19fb3b	1294150000	java/org/apache/el/lang/ELArithmetic.java test/org/apache/el/lang/TestELArithmetic.java	1:java/org/apache/el/lang/ELArithmetic.java
542	50025	Bug 50025 getConnection method in class DataSourceProxy is ignoring credentials		2010-09-29 09:48:26	1285770000	resolved fixed	59b17c1	1294090000	modules/jdbc-pool/java/org/apache/tomcat/jdbc/pool/ConnectionPool.java modules/jdbc-pool/java/org/apache/tomcat/jdbc/pool/DataSourceFactory.java modules/jdbc-pool/java/org/apache/tomcat/jdbc/pool/DataSourceProxy.java modules/jdbc-pool/java/org/apache/tomcat/jdbc/pool/PoolConfiguration.java modules/jdbc-pool/java/org/apache/tomcat/jdbc/pool/PoolProperties.java modules/jdbc-pool/java/org/apache/tomcat/jdbc/pool/PooledConnection.java modules/jdbc-pool/java/org/apache/tomcat/jdbc/pool/jmx/ConnectionPool.java modules/jdbc-pool/test/org/apache/tomcat/jdbc/test/AlternateUsernameTest.java modules/jdbc-pool/test/org/apache/tomcat/jdbc/test/driver/Connection.java modules/jdbc-pool/test/org/apache/tomcat/jdbc/test/driver/Driver.java	1:modules/jdbc-pool/java/org/apache/tomcat/jdbc/pool/DataSourceProxy.java 2:modules/jdbc-pool/java/org/apache/tomcat/jdbc/pool/PooledConnection.java 8:modules/jdbc-pool/java/org/apache/tomcat/jdbc/pool/DataSourceFactory.java 16:modules/jdbc-pool/java/org/apache/tomcat/jdbc/pool/ConnectionPool.java 24:modules/jdbc-pool/java/org/apache/tomcat/jdbc/pool/PoolConfiguration.java 29:modules/jdbc-pool/java/org/apache/tomcat/jdbc/pool/jmx/ConnectionPool.java 119:modules/jdbc-pool/java/org/apache/tomcat/jdbc/pool/PoolProperties.java 154:modules/jdbc-pool/test/org/apache/tomcat/jdbc/test/driver/Connection.java 261:modules/jdbc-pool/test/org/apache/tomcat/jdbc/test/driver/Driver.java
543	50503	Bug 50503 Engine level Clustering does not work correctly if the web application has a version.	"In Engine level clustering, the name of the cluster manager is ""HostName#contextName"". SimpleTcpCluster#getManagerName(String, Manager) is as follows. ==== public String getManagerName(String name, Manager manager) { String clusterName = name ; if ( clusterName == null ) clusterName = manager.getContainer().getName(); if(getContainer() instanceof Engine) { Container context = manager.getContainer() ; if(context != null && context instanceof Context) { Container host = ((Context)context).getParent(); if(host != null && host instanceof Host && clusterName!=null && !(clusterName.indexOf(""#"")>=0)) clusterName = host.getName() +""#"" + clusterName ; } } return clusterName; } ==== In this method, clusterName.indexOf(""#"") >= 0 is checked. Because the context name becomes contextName##version if the web application has a version, the name of the cluster manager doesn't become a format of ""HostName#contextName"". As a result, Engine level Clustering doesn't work correctly. Best regards."	2010-12-21 01:42:21	1292910000	resolved fixed	701d5dc	1292910000	java/org/apache/catalina/ha/tcp/SimpleTcpCluster.java	1:java/org/apache/catalina/ha/tcp/SimpleTcpCluster.java
544	13731	"Bug 13731 Final request, response, session and other variables."	"Provide a capability to declare request, response, session and other variables in jspService function as final. As tunable feature, just like others, in tomcat`s web.xml file. Why need this feature? To use request, response, session variables in anonymous implementations of classes. For example - declaration of iterator through elements, which includes some other JSP file (statically). And usage of this iterator in other JSP file."	2002-10-17 13:23:42	1034880000	resolved fixed	73531cb	1292540000	java/org/apache/jasper/compiler/Generator.java	22:java/org/apache/jasper/compiler/Generator.java
545	10972	Bug 10972 <Realm> without className in server.xml produces NullPointerException	"If the className attribute is not included with the <Realm> tag in server.xml, the server dies with a cryptic NullPointerException. It would be nice if it produced a more meaningful error message (like ""Missing className attribute for <Realm> tag"")."	2002-07-19 02:30:07	1027060000	resolved fixed	71ad1bd	1292440000	java/org/apache/catalina/startup/Catalina.java java/org/apache/tomcat/util/digester/Digester.java java/org/apache/tomcat/util/digester/ObjectCreateRule.java	31:java/org/apache/catalina/startup/Catalina.java 50:java/org/apache/tomcat/util/digester/Digester.java 106:java/org/apache/tomcat/util/digester/ObjectCreateRule.java
546	10526	Bug 10526 Authenticators do not always cache the Principal	"Once a user is authenticated a Principal object is supposed to be cached for the duration of the user's session. This is especially important when using JDBCRealm or JNDIRealm to reduce the load on external authentication services. Most authenticators (BasicAuthenticator, SSLAuthenticator and DigestAuthenticator) call AuthenticatorBase.register()to cache the Principal. However register() does nothing if a session object does not already exist, so caching does not occur when the application does not create a session object itself. The problem can be seen by setting a security constraint on tomcat-docs and then browsing the Tomcat documentation - the external authentication service is hit on every request. The problem does not occur with form based login, because FormAuthenticator caches the Principal itself and creates a new session if necessary to do it. Probably the best fix would be to change AuthenticatorBase.register() to create a new session by calling getSession(request, true) instead of getSession (request, false). However, perhaps there is a reason why this is not being done - though if so I cannot see what it is. An alternative is to change the concrete authentication classes to make sure a session exists before calling register(), e.g. --- BasicAuthenticator.java 23 Mar 2002 17:52:16 -0000 1.12 +++ BasicAuthenticator.java 6 Jul 2002 12:46:30 -0000 @@ -160,6 +160,7 @@ String password = parsePassword(authorization); principal = context.getRealm().authenticate(username, password); if (principal != null) { + Session session = getSession(request, true); register(request, response, principal, Constants.BASIC_METHOD, username, password); return (true); Similar patches would be required for SSLAuthenticator and DigestAuthenticator of course."	2002-07-06 13:11:40	1025980000	resolved fixed	ca34a30	1292430000	java/org/apache/catalina/authenticator/AuthenticatorBase.java	4:java/org/apache/catalina/authenticator/AuthenticatorBase.java
547	49125	Bug 49125 toString on byte[] array probably is not correct	"Two examples of using toString() on a byte[] array, which is unlikely to produce the desired output: ha.deploy.FileMessageFactory.writeMessage() log message uses toString on msg.getData() which is a byte[] array coyote.ajp.AjpMessage.dump use toString on ""msg"" which is of type byte[]"	2010-04-14 18:54:35	1271290000	resolved fixed	5614817	1292360000	java/org/apache/catalina/ha/deploy/FileMessageFactory.java java/org/apache/coyote/ajp/AjpMessage.java java/org/apache/tomcat/util/buf/HexUtils.java	1:java/org/apache/coyote/ajp/AjpMessage.java 2:java/org/apache/catalina/ha/deploy/FileMessageFactory.java 333:java/org/apache/tomcat/util/buf/HexUtils.java
548	50460	Bug 50460 First access to a jspx page causes classloader leak in JspDocumentParser		2010-12-11 21:33:47	1292120000	resolved fixed	345e6b5	1292200000	java/org/apache/jasper/compiler/JspDocumentParser.java java/org/apache/naming/resources/ImmutableNameNotFoundException.java	1:java/org/apache/jasper/compiler/JspDocumentParser.java 397:java/org/apache/naming/resources/ImmutableNameNotFoundException.java
549	50448	Bug 50448 StandardSession.expire causes IllegalStateException: getCreationTime: Session already invalidated	"Hi, when verifying the fix for #50360 I ran into an issue with expired sessions during processExpires: Dec 10, 2010 12:59:32 AM org.apache.catalina.core.ContainerBase backgroundProcess WARNING: Exception processing manager de.javakaffee.web.msm.MemcachedBackupSessionManager[/] background process java.lang.IllegalStateException: getCreationTime: Session already invalidated at org.apache.catalina.session.StandardSession.getCreationTime(StandardSession.java:1096) at org.apache.catalina.session.ManagerBase.remove(ManagerBase.java:802) at org.apache.catalina.session.StandardSession.expire(StandardSession.java:840) at org.apache.catalina.session.StandardSession.isValid(StandardSession.java:655) at org.apache.catalina.session.ManagerBase.processExpires(ManagerBase.java:609) at org.apache.catalina.session.ManagerBase.backgroundProcess(ManagerBase.java:594) at de.javakaffee.web.msm.MemcachedBackupSessionManager.backgroundProcess(MemcachedBackupSessionManager.java:1130) at org.apache.catalina.core.ContainerBase.backgroundProcess(ContainerBase.java:1214) AFAICS in MemcachedBackupSessionManager I could override remove(Session session, boolean update) with calling super.remove(session, false) for invalid sessions. Another option would be to change StandardSession.expire(StandardSession.java:840) so that it does not invoke manager.remove(this, true) but manager.remove(this, false). Or even better: change ManagerBase.remove(ManagerBase.java:802) to invoke some session.getCreationTimeInternal() which skips validation. What do you think? Cheers, Martin"	2010-12-09 19:23:29	1291940000	resolved fixed	4117b78	1291990000	java/org/apache/catalina/Session.java java/org/apache/catalina/manager/DummyProxySession.java java/org/apache/catalina/session/ManagerBase.java java/org/apache/catalina/session/StandardSession.java	1:java/org/apache/catalina/session/StandardSession.java 2:java/org/apache/catalina/session/ManagerBase.java 6:java/org/apache/catalina/Session.java 27:java/org/apache/catalina/manager/DummyProxySession.java
550	50408	Bug 50408 Scoped EL variable in methodexpression is treated as Object	"Consider following example: <dl> <c:forEach items=""${pageContext.response.headerNames}"" var=""name""> <c:forEach items=""${pageContext.response.getHeaders(name)}"" var=""value""> <dt>${name}</dt><dd>${value}</dd> </c:forEach> </c:forEach> </dl> The ${name} is a String. The ${name.class.name} also proves that. The getHeaders(name) call however results in: org.apache.jasper.el.JspELException: /test.jsp(23,12) '${pageContext.response.getHeaders(name)}' java.lang.NoSuchMethodException: org.apache.catalina.connector.ResponseFacade.getHeaders(java.lang.Object) Another example which also results in NoSuchMethodException which suggests that an Object is been passed as argument: <c:set var=""name"" value=""test"" /> ${pageContext.response.getHeader(name)} This works all fine on Glassfish v3."	2010-12-03 12:37:00	1291400000	resolved fixed	4ed7b7e	1291410000	java/javax/el/CompositeELResolver.java test/javax/el/TestCompositeELResolver.java	356:java/javax/el/CompositeELResolver.java
551	48692	Bug 48692 Provide option to parse application/x-www-form-urlencoded PUT requests	Provide an option to treat application/x-www-form-urlencoded encoded parameters in a PUT request in a similar manner to application/x-www-form-urlencoded parameters in a POST request	2010-02-07 02:41:33	1265530000	resolved fixed	e34b164	1291390000	java/org/apache/catalina/connector/Connector.java java/org/apache/catalina/connector/Request.java test/org/apache/catalina/connector/TestRequest.java	1:java/org/apache/catalina/connector/Request.java 46:java/org/apache/catalina/connector/Connector.java 85:test/org/apache/catalina/connector/TestRequest.java
552	50358	"Bug 50358 Embedded.stopInternal sets state to STARTING, should be STOPPING"		2010-11-28 18:13:10	1290990000	resolved fixed	07b72f1	1291040000	java/org/apache/catalina/startup/Embedded.java	1:java/org/apache/catalina/startup/Embedded.java
553	49142	Bug 49142 Missing serialVersionUIDs	org.apache.catalina.ha.ClusterMessageBase is Serializable; consider declaring a serialVersionUID Similarly for: org.apache.catalina.ha.session.ReplicatedSession org.apache.catalina.ha.session.SerializablePrincipal org.apache.catalina.session.StandardSession org.apache.catalina.tribes.tipis.AbstractReplicatedMap.MapMessage org.apache.tomcat.util.modeler.ManagedBean	2010-04-16 21:25:34	1271470000	resolved fixed	4cbb52f	1290640000	java/javax/servlet/GenericServlet.java java/javax/servlet/ServletContextAttributeEvent.java java/javax/servlet/ServletContextEvent.java java/javax/servlet/ServletException.java java/javax/servlet/ServletRequestAttributeEvent.java java/javax/servlet/ServletRequestEvent.java java/javax/servlet/UnavailableException.java java/javax/servlet/http/HttpServlet.java java/javax/servlet/http/HttpSessionBindingEvent.java java/javax/servlet/http/HttpSessionEvent.java java/javax/servlet/jsp/JspException.java java/javax/servlet/jsp/JspTagException.java java/javax/servlet/jsp/SkipPageException.java java/javax/servlet/jsp/el/ELException.java java/javax/servlet/jsp/el/ELParseException.java java/javax/servlet/jsp/tagext/TagSupport.java java/org/apache/catalina/ha/deploy/FileMessage.java java/org/apache/catalina/ha/deploy/UndeployMessage.java java/org/apache/catalina/manager/StatusManagerServlet.java java/org/apache/catalina/session/StandardSession.java java/org/apache/catalina/ssi/SSIServlet.java java/org/apache/catalina/ssi/SSIStopProcessingException.java java/org/apache/catalina/tribes/ChannelException.java java/org/apache/catalina/tribes/RemoteProcessException.java java/org/apache/catalina/tribes/UniqueId.java java/org/apache/catalina/tribes/io/ChannelData.java java/org/apache/catalina/tribes/tipis/AbstractReplicatedMap.java java/org/apache/catalina/tribes/tipis/LazyReplicatedMap.java java/org/apache/catalina/tribes/tipis/ReplicatedMap.java java/org/apache/catalina/tribes/util/ExecutorFactory.java java/org/apache/catalina/util/ParameterMap.java java/org/apache/catalina/util/ResourceSet.java java/org/apache/jasper/JasperException.java java/org/apache/jasper/compiler/JspDocumentParser.java java/org/apache/jasper/runtime/HttpJspBase.java java/org/apache/juli/logging/LogConfigurationException.java java/org/apache/naming/EjbRef.java java/org/apache/naming/HandlerRef.java java/org/apache/naming/JndiPermission.java java/org/apache/naming/ResourceEnvRef.java java/org/apache/naming/ResourceLinkRef.java java/org/apache/naming/ServiceRef.java java/org/apache/naming/TransactionRef.java java/org/apache/tomcat/util/buf/CharChunk.java java/org/apache/tomcat/util/buf/MessageBytes.java java/org/apache/tomcat/util/modeler/BaseAttributeFilter.java java/org/apache/tomcat/util/modeler/FixedNotificationFilter.java java/org/apache/tomcat/util/modeler/ManagedBean.java java/org/apache/tomcat/util/net/URL.java test/org/apache/catalina/tribes/demos/MapDemo.java webapps/examples/WEB-INF/jsp/applet/Clock2.java	1:java/org/apache/catalina/tribes/tipis/AbstractReplicatedMap.java 2:java/org/apache/catalina/session/StandardSession.java 3:java/org/apache/catalina/tribes/tipis/ReplicatedMap.java 4:java/org/apache/catalina/tribes/tipis/LazyReplicatedMap.java 21:java/org/apache/tomcat/util/modeler/ManagedBean.java 34:java/org/apache/catalina/tribes/io/ChannelData.java 45:java/org/apache/catalina/tribes/UniqueId.java 130:java/javax/servlet/http/HttpSessionBindingEvent.java 132:java/org/apache/catalina/util/ParameterMap.java 135:java/org/apache/jasper/compiler/JspDocumentParser.java 227:test/org/apache/catalina/tribes/demos/MapDemo.java 239:java/org/apache/catalina/ssi/SSIStopProcessingException.java 276:java/org/apache/tomcat/util/buf/MessageBytes.java 297:java/org/apache/tomcat/util/buf/CharChunk.java 339:java/javax/servlet/http/HttpSessionEvent.java 417:java/org/apache/catalina/ha/deploy/FileMessage.java 444:java/javax/servlet/UnavailableException.java 456:java/javax/servlet/http/HttpServlet.java 478:java/javax/servlet/GenericServlet.java 501:java/javax/servlet/jsp/tagext/TagSupport.java 513:java/javax/servlet/ServletRequestEvent.java 558:java/javax/servlet/ServletContextAttributeEvent.java 559:java/javax/servlet/ServletRequestAttributeEvent.java 615:java/org/apache/jasper/JasperException.java 641:java/org/apache/catalina/ha/deploy/UndeployMessage.java 655:java/org/apache/jasper/runtime/HttpJspBase.java 664:java/org/apache/catalina/ssi/SSIServlet.java 734:java/org/apache/tomcat/util/modeler/BaseAttributeFilter.java 840:java/javax/servlet/jsp/SkipPageException.java 850:java/javax/servlet/jsp/el/ELException.java 867:java/javax/servlet/jsp/JspException.java 870:java/org/apache/catalina/manager/StatusManagerServlet.java 875:java/org/apache/tomcat/util/net/URL.java 877:java/javax/servlet/ServletException.java 893:java/org/apache/catalina/tribes/ChannelException.java 898:java/javax/servlet/jsp/el/ELParseException.java 916:java/org/apache/tomcat/util/modeler/FixedNotificationFilter.java 931:java/org/apache/catalina/util/ResourceSet.java 992:java/org/apache/juli/logging/LogConfigurationException.java 1066:java/org/apache/catalina/tribes/RemoteProcessException.java 1111:java/javax/servlet/jsp/JspTagException.java 1143:java/org/apache/naming/HandlerRef.java 1144:java/org/apache/naming/ServiceRef.java 1165:java/org/apache/naming/JndiPermission.java 1178:java/org/apache/catalina/tribes/util/ExecutorFactory.java 1214:java/javax/servlet/ServletContextEvent.java 1335:java/org/apache/naming/ResourceEnvRef.java 1337:java/org/apache/naming/TransactionRef.java 1393:java/org/apache/naming/ResourceLinkRef.java 1399:java/org/apache/naming/EjbRef.java
554	48837	Bug 48837 Memory leaks protection does not detect leaks triggered by JSP pages code		2010-03-01 18:51:11	1267490000	resolved fixed	ddbbfc1	1290630000	java/org/apache/catalina/loader/WebappClassLoader.java	5:java/org/apache/catalina/loader/WebappClassLoader.java
555	50108	Bug 50108 Add missing setter/getter to AbstractXXXProtocol		2010-10-18 03:22:19	1287390000	resolved fixed	5a84fdb	1290630000	java/org/apache/coyote/ajp/AbstractAjpProtocol.java java/org/apache/coyote/http11/AbstractHttp11Protocol.java	9:java/org/apache/coyote/http11/AbstractHttp11Protocol.java 10:java/org/apache/coyote/ajp/AbstractAjpProtocol.java
556	50207	Bug 50207 CometProcessor async timeout events are not being fired	"This is reproducible using the the default chat example (ie: ChatServlet, /examples/jsp/chat) and the following additional changes: 1) Enabled Http11Nio in conf/server.xml: <Connector address=""0.0.0.0"" port=""8080"" protocol=""org.apache.coyote.http11.Http11NioProtocol"" connectionTimeout=""20000"" enableLookups=""false"" acceptCount=""100"" disableUploadTimeout=""true"" maxThreads=""15"" minSpareThreads=""15"" maxSpareThreads=""15"" RECYCLE_FACADES=""true""/> 2) Enabled the comet valve in conf/context.xml: <Valve className=""org.apache.catalina.valves.CometConnectionManagerValve"" /> The problem is CometEvent.EventType.ERROR (and subtype TIMEOUT) and CometEvent.EventType.END are never being fired. This can be confirmed in the logs; the messages for these events are never printed. This worked on Tomcat 6.0.29. As an aside, what is the most complete/robust way to do async IO in tomcat 7 today, Servlet 3.0 or CometProcessor?"	2010-11-03 14:52:32	1288810000	resolved fixed	46e7d1e	1290530000	java/org/apache/coyote/http11/Http11NioProtocol.java java/org/apache/tomcat/util/net/NioEndpoint.java	9:java/org/apache/coyote/http11/Http11NioProtocol.java 26:java/org/apache/tomcat/util/net/NioEndpoint.java
557	50316	Bug 50316 Minor glitch with display of negative TTL on sessionDetail.jsp		2010-11-22 11:29:24	1290440000	resolved fixed	278a36a	1290460000	java/org/apache/catalina/manager/JspHelper.java java/org/apache/catalina/manager/StatusTransformer.java	76:java/org/apache/catalina/manager/JspHelper.java 209:java/org/apache/catalina/manager/StatusTransformer.java
558	50308	Bug 50308 Call to AsyncContext.dispatch() in the onTimeout callback throws exception	"When dispatch() method is called inside the onTimeout() function of the AsyncListener, the exception is thrown: SEVERE: An exception or error occurred in the container during the request processing java.lang.IllegalStateException: Calling [dispatchAsync()] is not valid for a request with Async state [TIMING_OUT] at org.apache.coyote.AsyncStateMachine.asyncDispatch(AsyncStateMachine.java:220) at org.apache.coyote.http11.Http11NioProcessor.actionInternal(Http11NioProcessor.java:672) at org.apache.coyote.http11.AbstractHttp11Processor.action(AbstractHttp11Processor.java:937) at org.apache.coyote.Request.action(Request.java:348) at org.apache.catalina.core.AsyncContextImpl.dispatch(AsyncContextImpl.java:173) at org.apache.catalina.core.AsyncContextImpl.dispatch(AsyncContextImpl.java:135) at org.apache.catalina.core.AsyncContextImpl.dispatch(AsyncContextImpl.java:130) at com.juriy.snowball.SnowServlet$1.onTimeout(SnowServlet.java:23) at org.apache.catalina.core.AsyncListenerWrapper.fireOnTimeout(AsyncListenerWrapper.java:45) at org.apache.catalina.core.AsyncContextImpl.timeout(AsyncContextImpl.java:109) at org.apache.catalina.connector.CoyoteAdapter.asyncDispatch(CoyoteAdapter.java:270) at org.apache.coyote.http11.Http11NioProcessor.asyncDispatch(Http11NioProcessor.java:232) at org.apache.coyote.http11.Http11NioProtocol$Http11ConnectionHandler.event(Http11NioProtocol.java:305) at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.run(NioEndpoint.java:1526) at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908) at java.lang.Thread.run(Thread.java:619) The sample code is below: protected void service(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException { AsyncContext context = request.startAsync(); context.setTimeout(3000); context.addListener(new AsyncListener() { public void onComplete(AsyncEvent asyncEvent) throws IOException {} public void onTimeout(AsyncEvent asyncEvent) throws IOException { System.out.println(""HITTING TIMEOUT""); asyncEvent.getAsyncContext().dispatch(); } public void onError(AsyncEvent asyncEvent) throws IOException {} public void onStartAsync(AsyncEvent asyncEvent) throws IOException {} }); } It looks like the Servlet 3.0 specification allows to do such call, here's the quotation that explicitly states the flow of the timeouted async contexts (page 18): ""In the event that an asynchronous operation times out, the container must run through the following steps: Invoke the AsyncListener.onTimeout method on all the AsyncListener instances registered with the ServletRequest on which the asynchronous operation was initiated. If none of the listeners called AsyncContext.complete() or any of the AsyncContext.dispatch methods, perform an error dispatch with a status code equal to HttpServletResponse.SC_INTERNAL_SERVER_ERROR. If no matching error page was found, or the error page did not call AsyncContext.complete() or any of the AsyncContext.dispatch methods, the container MUST call AsyncContext.complete()"" Second step assumes that the call to dispatch in onTimeout() is allowed."	2010-11-20 11:00:06	1290270000	resolved fixed	991702c	1290440000	java/org/apache/coyote/AsyncStateMachine.java test/org/apache/catalina/core/TestAsyncContextImpl.java	18:test/org/apache/catalina/core/TestAsyncContextImpl.java 27:java/org/apache/coyote/AsyncStateMachine.java
559	50310	Bug 50310 Manager detailed status page does not display servlets	"To reproduce: 1. Login to the Manager webapp 2. Click ""Server Status"" and then ""Complete Server Status"" links. In TC6 the ""Complete Server Status"" page lists servlets for each deployed application. In the current TC7 it does not list them. Only summary information on each webapp is displayed. Looking at the StatusManagerServlet and StatusTransformer classes, the code to iterate over servlets is still there, but probably the JMX names have changed and are not working any more."	2010-11-21 21:08:35	1290390000	resolved fixed	ade20d2	1290430000	java/org/apache/catalina/core/StandardWrapper.java	19:java/org/apache/catalina/core/StandardWrapper.java
560	50293	Bug 50293 javax.el.CompositeELResolver synchronization issue		2010-11-18 16:58:18	1290120000	resolved fixed	7b89af8	1290190000	java/javax/el/CompositeELResolver.java	1:java/javax/el/CompositeELResolver.java
561	50192	Bug 50192 performance issue after revision 746425		2010-11-01 15:17:42	1288640000	resolved fixed	e075c4b	1289590000	java/org/apache/jasper/el/ELContextImpl.java java/org/apache/jasper/el/ELResolverImpl.java	
562	50230	Bug 50230 Recursive dependency between the tomcat-catalina-ha and tomcat-catalina		2010-11-07 21:04:22	1289180000	resolved fixed	96020cb	1289510000	java/org/apache/catalina/DistributedManager.java java/org/apache/catalina/ha/session/BackupManager.java java/org/apache/catalina/manager/HTMLManagerServlet.java	33:java/org/apache/catalina/manager/HTMLManagerServlet.java 59:java/org/apache/catalina/ha/session/BackupManager.java
563	50252	Bug 50252 ClassCastException occurs if context.xml contains <ResourceLink>.		2010-11-11 01:08:11	1289460000	resolved fixed	7e7283d	1289480000	java/org/apache/naming/NamingContext.java	161:java/org/apache/naming/NamingContext.java
564	50183	Bug 50183 [Tribes] Bio Sender is not scheduling the task to the excecutors		2010-10-29 16:55:40	1288390000	resolved fixed	84efb0a	1289480000	java/org/apache/catalina/tribes/transport/bio/BioReceiver.java java/org/apache/catalina/tribes/transport/bio/BioReplicationTask.java	6:java/org/apache/catalina/tribes/transport/bio/BioReplicationTask.java 8:java/org/apache/catalina/tribes/transport/bio/BioReceiver.java
565	50169	Bug 50169 Trying to register wrapper and welcomeFile to Mapper before context is registered on Mapper.		2010-10-28 03:21:29	1288250000	resolved fixed	476921f	1289480000	java/org/apache/catalina/core/StandardContext.java java/org/apache/catalina/core/StandardWrapper.java	3:java/org/apache/catalina/core/StandardContext.java 7:java/org/apache/catalina/core/StandardWrapper.java
566	50222	Bug 50222 JreMemoryLeakPreventionListener should speculatively cause memory leaks using the system ClassLoader	"JreMemoryLeakPreventionListener intentionally invokes methods known to pin the context ClassLoader in memory in order to avoid having a WebappClassLoader unintentionally pin itself. This may cause undesirable behavior in embedded environments. Instead, JMLPL could use a security context to temporarily set the current context ClassLoader to be the system ClassLoader and solve the embedded situation without the client having to remember to take this care."	2010-11-05 11:00:08	1288970000	resolved fixed	4ca3db3	1289390000	java/org/apache/catalina/core/JreMemoryLeakPreventionListener.java	1:java/org/apache/catalina/core/JreMemoryLeakPreventionListener.java
567	50184	Bug 50184 RpcChannel sends the answer without requesting an ACK		2010-10-29 17:12:34	1288390000	resolved fixed	afdc055	1289320000	java/org/apache/catalina/tribes/group/RpcChannel.java	1:java/org/apache/catalina/tribes/group/RpcChannel.java
568	50232	Bug 50232 org.apache.catalina.session.StoreBase has a hidden dependency on PersistentManager		2010-11-08 05:09:39	1289210000	resolved fixed	b5c24f9	1289320000	java/org/apache/catalina/session/StoreBase.java	1:java/org/apache/catalina/session/StoreBase.java
569	50168	Bug 50168 destory method is called twice while the child is destoryed directly	"While calling the method destory() on the StandardContext directly, it seems that the method destoryInternal() is called twice in the LifecycleMBeanBase, the two stacktraces are below : a. LifecycleMBeanBase.unregister(ObjectName) line: 191 LifecycleMBeanBase.destroyInternal() line: 73 ContainerBase.destroyInternal() line: 1109 StandardContext.destroyInternal() line: 5114 LifecycleBase.destroy() line: 271 ContainerBase.removeChild(Container) line: 963 ContainerBase.destroyInternal() line: 1106 StandardContext.destroyInternal() line: 5114 LifecycleBase.destroy() line: 271 ... b. LifecycleMBeanBase.unregister(ObjectName) line: 191 LifecycleMBeanBase.destroyInternal() line: 73 ContainerBase.destroyInternal() line: 1109 StandardContext.destroyInternal() line: 5114 LifecycleBase.destroy() line: 271 ..."	2010-10-27 22:47:42	1288230000	resolved fixed	6eae969	1288910000	java/org/apache/catalina/Lifecycle.java java/org/apache/catalina/LifecycleState.java java/org/apache/catalina/core/AprLifecycleListener.java java/org/apache/catalina/core/ContainerBase.java java/org/apache/catalina/startup/ContextConfig.java java/org/apache/catalina/util/LifecycleBase.java	1:java/org/apache/catalina/core/ContainerBase.java 3:java/org/apache/catalina/util/LifecycleBase.java 12:java/org/apache/catalina/startup/ContextConfig.java 61:java/org/apache/catalina/core/AprLifecycleListener.java 100:java/org/apache/catalina/Lifecycle.java
570	50127	Bug 50127 Possible NPEs in SimpleTCPCluster		2010-10-20 19:31:02	1287620000	resolved fixed	f77368f	1288900000	java/org/apache/catalina/ha/tcp/SimpleTcpCluster.java	1:java/org/apache/catalina/ha/tcp/SimpleTcpCluster.java
571	49180	Bug 49180 Add option to disable log rotation in FileHandler.	"Small enhancement to FileHandler.java which allow susers to disable log rotation by setting the .rotation attribute to ""false""."	2010-04-24 13:34:58	1272130000	resolved fixed	7184011	1288630000	java/org/apache/juli/FileHandler.java	1:java/org/apache/juli/FileHandler.java
572	50157	Bug 50157 a lot of MapperListener is registered as ContainerListener of StandardContext		2010-10-26 03:28:12	1288080000	resolved fixed	53c5d85	1288130000	java/org/apache/catalina/connector/MapperListener.java java/org/apache/catalina/mbeans/ContainerMBean.java	2:java/org/apache/catalina/connector/MapperListener.java 50:java/org/apache/catalina/mbeans/ContainerMBean.java
573	50129	Bug 50129 ContextConfig - unnecessary null checks		2010-10-20 19:48:00	1287620000	resolved fixed	509ab5d	1287930000	java/org/apache/catalina/startup/ContextConfig.java	1:java/org/apache/catalina/startup/ContextConfig.java
574	50138	Bug 50138 Lack of synchronization in org.apache.catalina.security.SecurityUtil	"Symptom: all processor threads spin madly in: ============== ""tomcat-processor-20"" daemon prio=10 tid=0x09210800 nid=0x51fb runnable [0x61b76000] java.lang.Thread.State: RUNNABLE at java.util.HashMap.getEntry(HashMap.java:347) at java.util.HashMap.containsKey(HashMap.java:335) at org.apache.catalina.security.SecurityUtil.doAsPrivilege(SecurityUtil.java:227) at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:230) at org.apache.catalina.core.ApplicationFilterChain.access$000(ApplicationFilterChain.java:56) at org.apache.catalina.core.ApplicationFilterChain$1.run(ApplicationFilterChain.java:189) at java.security.AccessController.doPrivileged(Native Method) at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:185) ... ============== Cause: org.apache.catalina.security.SecurityUtil.objectCache is a HashMap, but access to it is not synchronized. The javadoc for HashMap says: ============= Note that this implementation is not synchronized. If multiple threads access a hash map concurrently, and at least one of the threads modifies the map structurally, it must be synchronized externally. ============= Proposed solution: change objectCache to ConcurrentHashMap;"	2010-10-21 09:22:56	1287670000	resolved fixed	9d955f4	1287680000	java/org/apache/catalina/security/SecurityUtil.java	2:java/org/apache/catalina/security/SecurityUtil.java
575	50107	Bug 50107 StandardPipeline is destroyed two times.		2010-10-18 03:05:40	1287390000	resolved fixed	44f568f	1287490000	java/org/apache/catalina/mbeans/MBeanFactory.java	41:java/org/apache/catalina/mbeans/MBeanFactory.java
576	50105	Bug 50105 Violation of JSP-EL spec version 2.1 when coerce Enum to String		2010-10-17 05:26:20	1287310000	resolved fixed	e6c1d55	1287490000	java/org/apache/el/parser/AstCompositeExpression.java test/org/apache/el/TestValueExpressionImpl.java test/org/apache/el/TesterEnum.java	1024:java/org/apache/el/parser/AstCompositeExpression.java 1262:test/org/apache/el/TestValueExpressionImpl.java
577	49426	Bug 49426 Manager app wrongly localized		2010-06-11 03:26:07	1276240000	resolved fixed	7357867	1287260000	java/org/apache/catalina/manager/HTMLManagerServlet.java java/org/apache/catalina/manager/ManagerServlet.java java/org/apache/tomcat/util/res/StringManager.java	3:java/org/apache/catalina/manager/ManagerServlet.java 10:java/org/apache/tomcat/util/res/StringManager.java 11:java/org/apache/catalina/manager/HTMLManagerServlet.java
578	50087	"Bug 50087 When metadata-complete=""false"" throw illegal JVM_CONSTANT_Class name"	"When metadata-complete=""false"" and add groovy-all-1.7.2.jar to app lib throw java.lang.reflect.InvocationTargetException at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at java.lang.reflect.Method.invoke(Method.java:597) at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:290) at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:418) Caused by: java.lang.ClassFormatError: groovy/jmx/builder/package-info : illegal JVM_CONSTANT_Class name: groovy/jmx/builder/package-info at java.lang.ClassLoader.defineClass1(Native Method) at java.lang.ClassLoader.defineClassCond(ClassLoader.java:632) at java.lang.ClassLoader.defineClass(ClassLoader.java:616) at java.security.SecureClassLoader.defineClass(SecureClassLoader.java:141) at org.apache.catalina.loader.WebappClassLoader.findClassInternal(WebappClassLoader.java:2804) at org.apache.catalina.loader.WebappClassLoader.findClass(WebappClassLoader.java:1144) at org.apache.catalina.loader.WebappClassLoader.loadClass(WebappClassLoader.java:1639) at org.apache.catalina.loader.WebappClassLoader.loadClass(WebappClassLoader.java:1517) at org.apache.catalina.startup.ContextConfig.checkHandlesTypes(ContextConfig.java:1952) at org.apache.catalina.startup.ContextConfig.processAnnotationsStream(ContextConfig.java:1915) at org.apache.catalina.startup.ContextConfig.processAnnotationsJar(ContextConfig.java:1802) at org.apache.catalina.startup.ContextConfig.processAnnotationsUrl(ContextConfig.java:1761) at org.apache.catalina.startup.ContextConfig.processAnnotations(ContextConfig.java:1747) at org.apache.catalina.startup.ContextConfig.webConfig(ContextConfig.java:1252) at org.apache.catalina.startup.ContextConfig.configureStart(ContextConfig.java:881) at org.apache.catalina.startup.ContextConfig.lifecycleEvent(ContextConfig.java:315) at org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:119) at org.apache.catalina.util.LifecycleBase.fireLifecycleEvent(LifecycleBase.java:89) at org.apache.catalina.core.StandardContext.startInternal(StandardContext.java:4700) at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:140) at org.apache.catalina.core.ContainerBase.startInternal(ContainerBase.java:1028) at org.apache.catalina.core.StandardHost.startInternal(StandardHost.java:773) at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:140) at org.apache.catalina.core.ContainerBase.startInternal(ContainerBase.java:1028) at org.apache.catalina.core.StandardEngine.startInternal(StandardEngine.java:278) at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:140) at org.apache.catalina.core.StandardService.startInternal(StandardService.java:429) at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:140) at org.apache.catalina.core.StandardServer.startInternal(StandardServer.java:662) at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:140) at org.apache.catalina.startup.Catalina.start(Catalina.java:592) ... 6 more"	2010-10-13 09:36:12	1286980000	resolved fixed	9e7ce59	1287070000	java/org/apache/catalina/startup/ContextConfig.java	1:java/org/apache/catalina/startup/ContextConfig.java
579	50066	Bug 50066 Cannot compile recursive tag with ant if it uses a class from the webapp		2010-10-09 09:49:32	1286630000	resolved fixed	79cf689	1286730000	java/org/apache/jasper/compiler/TagFileProcessor.java	2:java/org/apache/jasper/compiler/TagFileProcessor.java
580	50063	Bug 50063 Latest trunck can't configure context when metadata-complete is true and version is 3.0		2010-10-08 22:59:40	1286590000	resolved fixed	4d7f111	1286700000	java/org/apache/catalina/startup/ContextConfig.java	2:java/org/apache/catalina/startup/ContextConfig.java
581	50027	Bug 50027 NullPointerException if context.xml is present with <Resource>	"If you deploy a WAR with contex.xml in META-INF and the context.xml has <Resource> tag, Tomcat don t boot and gives this error: java.lang.NullPointerException at org.apache.catalina.core.StandardContext.getObjectKeyPropertiesNameOnly(StandardContext.java:5570) at org.apache.catalina.core.StandardContext.setNamingResources(StandardContext.java:1757) at org.apache.catalina.core.StandardContext.getNamingResources(StandardContext.java:1735) at org.apache.catalina.startup.SetNextNamingRule.end(SetNextNamingRule.java:99) at org.apache.tomcat.util.digester.Digester.endElement(Digester.java:1058) at com.sun.org.apache.xerces.internal.parsers.AbstractSAXParser.endElement(AbstractSAXParser.java:601) at com.sun.org.apache.xerces.internal.parsers.AbstractXMLDocumentParser.emptyElement(AbstractXMLDocumentParser.java:180) at com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl.scanStartElement(XMLDocumentFragmentScannerImpl.java:1343) at com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl$FragmentContentDriver.next(XMLDocumentFragmentScannerImpl.java:2755) at com.sun.org.apache.xerces.internal.impl.XMLDocumentScannerImpl.next(XMLDocumentScannerImpl.java:648) at com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl.scanDocument(XMLDocumentFragmentScannerImpl.java:511) at com.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse(XML11Configuration.java:808) at com.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse(XML11Configuration.java:737) at com.sun.org.apache.xerces.internal.parsers.XMLParser.parse(XMLParser.java:119) at com.sun.org.apache.xerces.internal.parsers.AbstractSAXParser.parse(AbstractSAXParser.java:1205) at com.sun.org.apache.xerces.internal.jaxp.SAXParserImpl$JAXPSAXParser.parse(SAXParserImpl.java:522) at org.apache.tomcat.util.digester.Digester.parse(Digester.java:1544) at org.apache.catalina.startup.Catalina.load(Catalina.java:524) at org.apache.catalina.startup.Catalina.load(Catalina.java:560) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at java.lang.reflect.Method.invoke(Method.java:597) at org.apache.catalina.startup.Bootstrap.load(Bootstrap.java:260) at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:414) 29/09/2010 13:50:37 org.apache.catalina.startup.Catalina load AVISO: Catalina.start using conf/server.xml: java.lang.NullPointerException at org.apache.tomcat.util.digester.Digester.createSAXException(Digester.java:2688) at org.apache.tomcat.util.digester.Digester.createSAXException(Digester.java:2714) at org.apache.tomcat.util.digester.Digester.endElement(Digester.java:1061) at com.sun.org.apache.xerces.internal.parsers.AbstractSAXParser.endElement(AbstractSAXParser.java:601) at com.sun.org.apache.xerces.internal.parsers.AbstractXMLDocumentParser.emptyElement(AbstractXMLDocumentParser.java:180) at com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl.scanStartElement(XMLDocumentFragmentScannerImpl.java:1343) at com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl$FragmentContentDriver.next(XMLDocumentFragmentScannerImpl.java:2755) at com.sun.org.apache.xerces.internal.impl.XMLDocumentScannerImpl.next(XMLDocumentScannerImpl.java:648) at com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl.scanDocument(XMLDocumentFragmentScannerImpl.java:511) at com.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse(XML11Configuration.java:808) at com.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse(XML11Configuration.java:737) at com.sun.org.apache.xerces.internal.parsers.XMLParser.parse(XMLParser.java:119) at com.sun.org.apache.xerces.internal.parsers.AbstractSAXParser.parse(AbstractSAXParser.java:1205) at com.sun.org.apache.xerces.internal.jaxp.SAXParserImpl$JAXPSAXParser.parse(SAXParserImpl.java:522) at org.apache.tomcat.util.digester.Digester.parse(Digester.java:1544) at org.apache.catalina.startup.Catalina.load(Catalina.java:524) at org.apache.catalina.startup.Catalina.load(Catalina.java:560) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at java.lang.reflect.Method.invoke(Method.java:597) at org.apache.catalina.startup.Bootstrap.load(Bootstrap.java:260) at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:414) Caused by: java.lang.NullPointerException at org.apache.catalina.core.StandardContext.getObjectKeyPropertiesNameOnly(StandardContext.java:5570) at org.apache.catalina.core.StandardContext.setNamingResources(StandardContext.java:1757) at org.apache.catalina.core.StandardContext.getNamingResources(StandardContext.java:1735) at org.apache.catalina.startup.SetNextNamingRule.end(SetNextNamingRule.java:99) at org.apache.tomcat.util.digester.Digester.endElement(Digester.java:1058) ... 20 more 29/09/2010 13:50:37 org.apache.tomcat.util.digester.SetPropertiesRule begin AVISO: [SetPropertiesRule]{Server/Service/Engine/Host/Context} Setting property 'source' to 'org.eclipse.jst.jee.server:bestforkprime' did not find a matching property. 29/09/2010 13:50:37 org.apache.tomcat.util.digester.Digester endElement GRAVE: End event threw exception java.lang.NullPointerException at org.apache.catalina.core.StandardContext.getObjectKeyPropertiesNameOnly(StandardContext.java:5570) at org.apache.catalina.core.StandardContext.setNamingResources(StandardContext.java:1757) at org.apache.catalina.core.StandardContext.getNamingResources(StandardContext.java:1735) at org.apache.catalina.startup.SetNextNamingRule.end(SetNextNamingRule.java:99) at org.apache.tomcat.util.digester.Digester.endElement(Digester.java:1058) at com.sun.org.apache.xerces.internal.parsers.AbstractSAXParser.endElement(AbstractSAXParser.java:601) at com.sun.org.apache.xerces.internal.parsers.AbstractXMLDocumentParser.emptyElement(AbstractXMLDocumentParser.java:180) at com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl.scanStartElement(XMLDocumentFragmentScannerImpl.java:1343) at com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl$FragmentContentDriver.next(XMLDocumentFragmentScannerImpl.java:2755) at com.sun.org.apache.xerces.internal.impl.XMLDocumentScannerImpl.next(XMLDocumentScannerImpl.java:648) at com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl.scanDocument(XMLDocumentFragmentScannerImpl.java:511) at com.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse(XML11Configuration.java:808) at com.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse(XML11Configuration.java:737) at com.sun.org.apache.xerces.internal.parsers.XMLParser.parse(XMLParser.java:119) at com.sun.org.apache.xerces.internal.parsers.AbstractSAXParser.parse(AbstractSAXParser.java:1205) at com.sun.org.apache.xerces.internal.jaxp.SAXParserImpl$JAXPSAXParser.parse(SAXParserImpl.java:522) at org.apache.tomcat.util.digester.Digester.parse(Digester.java:1544) at org.apache.catalina.startup.Catalina.load(Catalina.java:524) at org.apache.catalina.startup.Catalina.start(Catalina.java:573) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at java.lang.reflect.Method.invoke(Method.java:597) at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:288) at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:415) 29/09/2010 13:50:37 org.apache.catalina.startup.Catalina load AVISO: Catalina.start using conf/server.xml: java.lang.NullPointerException at org.apache.tomcat.util.digester.Digester.createSAXException(Digester.java:2688) at org.apache.tomcat.util.digester.Digester.createSAXException(Digester.java:2714) at org.apache.tomcat.util.digester.Digester.endElement(Digester.java:1061) at com.sun.org.apache.xerces.internal.parsers.AbstractSAXParser.endElement(AbstractSAXParser.java:601) at com.sun.org.apache.xerces.internal.parsers.AbstractXMLDocumentParser.emptyElement(AbstractXMLDocumentParser.java:180) at com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl.scanStartElement(XMLDocumentFragmentScannerImpl.java:1343) at com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl$FragmentContentDriver.next(XMLDocumentFragmentScannerImpl.java:2755) at com.sun.org.apache.xerces.internal.impl.XMLDocumentScannerImpl.next(XMLDocumentScannerImpl.java:648) at com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl.scanDocument(XMLDocumentFragmentScannerImpl.java:511) at com.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse(XML11Configuration.java:808) at com.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse(XML11Configuration.java:737) at com.sun.org.apache.xerces.internal.parsers.XMLParser.parse(XMLParser.java:119) at com.sun.org.apache.xerces.internal.parsers.AbstractSAXParser.parse(AbstractSAXParser.java:1205) at com.sun.org.apache.xerces.internal.jaxp.SAXParserImpl$JAXPSAXParser.parse(SAXParserImpl.java:522) at org.apache.tomcat.util.digester.Digester.parse(Digester.java:1544) at org.apache.catalina.startup.Catalina.load(Catalina.java:524) at org.apache.catalina.startup.Catalina.start(Catalina.java:573) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at java.lang.reflect.Method.invoke(Method.java:597) at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:288) at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:415) Caused by: java.lang.NullPointerException at org.apache.catalina.core.StandardContext.getObjectKeyPropertiesNameOnly(StandardContext.java:5570) at org.apache.catalina.core.StandardContext.setNamingResources(StandardContext.java:1757) at org.apache.catalina.core.StandardContext.getNamingResources(StandardContext.java:1735) at org.apache.catalina.startup.SetNextNamingRule.end(SetNextNamingRule.java:99) at org.apache.tomcat.util.digester.Digester.endElement(Digester.java:1058) ... 20 more 29/09/2010 13:50:37 org.apache.catalina.startup.Catalina start GRAVE: Cannot start server. Server instance is not configured. Here is my contex.xml OBS: some values were replaced with XXXX <?xml version=""1.0"" encoding=""UTF-8""?> <Context privileged=""true"" reloadable=""true""> <WatchedResource>WEB-INF/web.xml</WatchedResource> <WatchedResource>META-INF/context.xml</WatchedResource> <Resource name=""jdbc/bestfork"" auth=""Container"" type=""com.mchange.v2.c3p0.ComboPooledDataSource"" factory=""org.apache.naming.factory.BeanFactory"" user=""xxx"" password=""xxxx"" driverClass=""org.postgresql.Driver"" jdbcUrl=""jdbc:postgresql://localhost:5432/xxxxx"" minPoolSize=""5"" maxPoolSize=""30"" acquireIncrement=""5"" idleConnectionTestPeriod=""100"" maxIdleTime=""30""/> <Resource name=""mail/Session"" auth=""Container"" type=""javax.mail.Session"" mail.smtp.host=""xxxx"" mail.smtp.auth=""true"" username=""xxx"" password=""xxx"" mail.user=""xxxx"" mail.password=""xxxx"" mail.smtp.port=""587"" mail.transport.protocol=""smtp"" mail.debug=""true"" /> <Realm className=""org.apache.catalina.realm.JDBCRealm"" driverName=""org.postgresql.Driver"" connectionURL=""jdbc:postgresql://localhost:5432/xxxx"" connectionName=""xxxx"" connectionPassword=""xxxx"" userTable=""usuario"" userNameCol=""usuario_cpf"" userCredCol=""usuario_senha"" userRoleTable=""usuario_papel"" roleNameCol=""papel_nome"" digest=""MD5"" /> </Context>"	2010-09-29 13:02:53	1285780000	resolved fixed	6ce21f4	1286570000	java/org/apache/catalina/core/StandardContext.java	1:java/org/apache/catalina/core/StandardContext.java
582	50059	"Bug 50059 Resources are not served from /WEB-INF/lib/{*.jar}/META-INF/resources if metadata-complete=""true"" is set in web.xml"		2010-10-08 07:57:25	1286540000	resolved fixed	da36bd1	1286570000	java/org/apache/catalina/startup/ContextConfig.java	2:java/org/apache/catalina/startup/ContextConfig.java
583	50017	Bug 50017 Make private immutable fields final		2010-09-27 20:27:07	1285630000	resolved fixed	c4a3427	1286550000	java/javax/el/ValueReference.java java/javax/servlet/AsyncEvent.java java/javax/servlet/HttpConstraintElement.java java/javax/servlet/HttpMethodConstraintElement.java java/javax/servlet/MultipartConfigElement.java java/javax/servlet/ServletContextAttributeEvent.java java/javax/servlet/ServletRequestAttributeEvent.java java/javax/servlet/ServletRequestEvent.java java/javax/servlet/ServletSecurityElement.java java/javax/servlet/UnavailableException.java java/javax/servlet/http/HttpSessionBindingEvent.java java/javax/servlet/jsp/ErrorData.java java/javax/servlet/jsp/tagext/BodyContent.java java/javax/servlet/jsp/tagext/FunctionInfo.java java/javax/servlet/jsp/tagext/TagAttributeInfo.java java/javax/servlet/jsp/tagext/TagData.java java/javax/servlet/jsp/tagext/TagExtraInfo.java java/javax/servlet/jsp/tagext/TagFileInfo.java java/javax/servlet/jsp/tagext/TagVariableInfo.java java/javax/servlet/jsp/tagext/ValidationMessage.java java/javax/servlet/jsp/tagext/VariableInfo.java	18:java/javax/servlet/jsp/tagext/TagVariableInfo.java 197:java/javax/servlet/UnavailableException.java 276:java/javax/servlet/jsp/tagext/FunctionInfo.java 302:java/javax/servlet/jsp/tagext/TagFileInfo.java 407:java/javax/servlet/jsp/tagext/TagAttributeInfo.java 410:java/javax/servlet/jsp/tagext/BodyContent.java 496:java/javax/servlet/HttpConstraintElement.java 635:java/javax/servlet/jsp/tagext/VariableInfo.java 681:java/javax/el/ValueReference.java 832:java/javax/servlet/jsp/ErrorData.java 866:java/javax/servlet/HttpMethodConstraintElement.java 867:java/javax/servlet/ServletContextAttributeEvent.java 915:java/javax/servlet/jsp/tagext/TagExtraInfo.java 938:java/javax/servlet/jsp/tagext/TagData.java 943:java/javax/servlet/ServletRequestAttributeEvent.java 946:java/javax/servlet/AsyncEvent.java 977:java/javax/servlet/ServletRequestEvent.java 1005:java/javax/servlet/jsp/tagext/ValidationMessage.java 1011:java/javax/servlet/ServletSecurityElement.java 1018:java/javax/servlet/MultipartConfigElement.java 1021:java/javax/servlet/http/HttpSessionBindingEvent.java
584	50016	Bug 50016 bad division of responsibility around isUserInRole and new Request login and logout methods		2010-09-27 16:56:39	1285620000	resolved fixed	469a916	1286550000	java/org/apache/catalina/Authenticator.java java/org/apache/catalina/Realm.java java/org/apache/catalina/authenticator/AuthenticatorBase.java java/org/apache/catalina/authenticator/BasicAuthenticator.java java/org/apache/catalina/authenticator/DigestAuthenticator.java java/org/apache/catalina/authenticator/FormAuthenticator.java java/org/apache/catalina/authenticator/NonLoginAuthenticator.java java/org/apache/catalina/authenticator/SSLAuthenticator.java java/org/apache/catalina/connector/Request.java java/org/apache/catalina/realm/RealmBase.java java/org/apache/catalina/realm/UserDatabaseRealm.java	4:java/org/apache/catalina/connector/Request.java 10:java/org/apache/catalina/authenticator/AuthenticatorBase.java 11:java/org/apache/catalina/authenticator/FormAuthenticator.java 38:java/org/apache/catalina/Authenticator.java 47:java/org/apache/catalina/realm/RealmBase.java 60:java/org/apache/catalina/Realm.java 62:java/org/apache/catalina/authenticator/SSLAuthenticator.java 71:java/org/apache/catalina/authenticator/DigestAuthenticator.java 81:java/org/apache/catalina/realm/UserDatabaseRealm.java 110:java/org/apache/catalina/authenticator/NonLoginAuthenticator.java 219:java/org/apache/catalina/authenticator/BasicAuthenticator.java
585	49987	Bug 49987 Data race in ApplicationContext		2010-09-23 10:16:06	1285250000	resolved fixed	2db864e	1286490000	java/org/apache/catalina/core/ApplicationContext.java java/org/apache/catalina/core/StandardContext.java	1:java/org/apache/catalina/core/ApplicationContext.java 2:java/org/apache/catalina/core/StandardContext.java
586	49986	Bug 49986 Double-check locking. Possible data-race in JspServletWrapper		2010-09-23 09:31:03	1285250000	resolved fixed	2570d6ff	1286460000	java/org/apache/jasper/servlet/JspServletWrapper.java	1:java/org/apache/jasper/servlet/JspServletWrapper.java
587	49972	Bug 49972 Double-check idiom. Possible data-race.		2010-09-22 04:44:02	1285150000	resolved fixed	0ae33cb	1286460000	java/org/apache/tomcat/util/http/FastHttpDateFormat.java	
588	50054	"Bug 50054 When the AJP connector is used, minSpareThreads cannot be used."	"I found following warnning messages. == Oct 7, 2010 2:25:27 PM org.apache.catalina.startup.SetAllPropertiesRule begin WARNING: [SetAllPropertiesRule]{Server/Service/Connector} Setting property 'minSpareThreads' to '31' did not find a matching property. == The AJP connector's configs are the following. <Connector port=""8009"" protocol=""AJP/1.3"" redirectPort=""8443"" minSpareThreads=""100""/> When I used the Http connector, minSpareThreads was able to be used. org.apache.coyote.ajp.AjpProtocol doesn't set the minSpareThreads to org.apache.tomcat.util.net.JIoEndpoint. I made a patch. This patch was made based on AbstractHttp11Protocol. Best regards."	2010-10-07 04:22:51	1286440000	resolved fixed	654c964	1286440000	java/org/apache/coyote/ajp/AbstractAjpProtocol.java java/org/apache/coyote/ajp/AjpAprProtocol.java java/org/apache/coyote/ajp/AjpProtocol.java	3:java/org/apache/coyote/ajp/AjpProtocol.java 6:java/org/apache/coyote/ajp/AjpAprProtocol.java
589	49956	Bug 49956 @Resource(name=) Normalization of JNDI Name		2010-09-17 20:15:03	1284770000	resolved fixed	0e71157	1286400000	java/org/apache/catalina/core/DefaultInstanceManager.java	3:java/org/apache/catalina/core/DefaultInstanceManager.java
590	49952	Bug 49952 ServletContainerInitializer can't actually add listeners		2010-09-17 13:49:20	1284750000	resolved fixed	937227a	1286400000	java/org/apache/catalina/core/StandardContext.java test/org/apache/catalina/startup/TestListener.java	1:java/org/apache/catalina/core/StandardContext.java
591	49937	Bug 49937 Problems with AsyncListener and resource injection		2010-09-16 01:49:41	1284620000	resolved fixed	cf4e575	1286140000	java/org/apache/catalina/core/AsyncContextImpl.java	4:java/org/apache/catalina/core/AsyncContextImpl.java
592	49985	"Bug 49985 Lazy initialization without any synchronization - data race in AstInteger, AstFloatingPoint, AstString"		2010-09-23 08:55:42	1285250000	resolved fixed	b893eee	1286050000	java/org/apache/el/parser/AstFloatingPoint.java java/org/apache/el/parser/AstInteger.java java/org/apache/el/parser/AstString.java	1:java/org/apache/el/parser/AstFloatingPoint.java 2:java/org/apache/el/parser/AstInteger.java 3:java/org/apache/el/parser/AstString.java
593	49915	Bug 49915 [Patch] o.a.c.c.StandardServer swallows error on storeConfig.	When o.a.c.c.StandardServer#storeConfig is called all exceptions were getting swallowed. This lead to the impresssion it was working correctly when saved either through the manager application /manager/save or through jconsole. I've removed the catch throwable block and thrown an exception upon not finding the registerd MBean.	2010-09-10 19:35:43	1284160000	resolved fixed	5eb3851	1285950000	java/org/apache/catalina/core/StandardServer.java	1:java/org/apache/catalina/core/StandardServer.java
594	49905	"Bug 49905 In cluster, when using DeltaManager memory leak can occur"		2010-09-09 07:22:00	1284030000	resolved fixed	2c858be	1285950000	java/org/apache/catalina/tribes/group/interceptors/MessageDispatch15Interceptor.java java/org/apache/catalina/tribes/util/TcclThreadFactory.java	661:java/org/apache/catalina/tribes/group/interceptors/MessageDispatch15Interceptor.java
595	49890	Bug 49890 Nio Selector issue on linux platform		2010-09-07 09:17:54	1283870000	resolved wontfix	f4de5ab	1285940000	java/org/apache/tomcat/util/net/NioEndpoint.java	1:java/org/apache/tomcat/util/net/NioEndpoint.java
596	49861	"Bug 49861 Log format of RMI ports can be improved, remove "","""		2010-09-02 04:42:55	1283420000	resolved fixed	00cc8c6	1285930000	java/org/apache/catalina/mbeans/JmxRemoteLifecycleListener.java	1:java/org/apache/catalina/mbeans/JmxRemoteLifecycleListener.java
597	49667	Bug 49667 JdbcLeakPrevention class can register unregistered JCBC Driver		2010-07-29 09:31:33	1280410000	resolved fixed	dc754cc	1285930000	java/org/apache/catalina/loader/JdbcLeakPrevention.java	1:java/org/apache/catalina/loader/JdbcLeakPrevention.java
598	49856	Bug 49856 Connector/ThreadPool link to Executor not exposed via JMX	When viewing either Connector objects or ThreadPool objects via JMX the name of the executor is not shown. It would be helpful if this were exposed via JMX so the links between Connectors/ThreadPools and Executors could be determined.	2010-09-01 03:24:08	1283330000	resolved fixed	167829c	1285880000	java/org/apache/catalina/connector/Connector.java	1:java/org/apache/catalina/connector/Connector.java
599	49730	Bug 49730 Race condition in StandardThreadExecutor : requests are sometimes enqueued instead of creating new threads	"In tomcat 6, I often configure an Executor with minSpareThreads=0 to work around memory leak issues upon redeployment. Sometimes (especially in development), when I refresh a page of my webapp with Safari, Chrome or Firefox, some resources of the page take several seconds (>10s) to be served though they are static resources and should come in less than 50ms. For instance, over 15 requests for a page (1 for html, the others for resources like js, css, images...), I sometimes have 1 or 2 that take >10s. After analysis, I found that in org.apache.catalina.core.StandardThreadExecutor.TaskQueue.offer(Runnable) the statement if (parent.getActiveCount()<(parent.getPoolSize())) is sometimes true unexpectedly. Here is the scenario : - ThreadPoolExecutor is empty - the user refreshes the page (or accesses it with an empty cache) in his web browser for a page that uses a more than 10-15 resources - the browser establishes one TCP connection and a new Thread is created - after the browser receives the response, it decides to load as many resources as possible in parallel. For this it establishes up to 6 TCP connections (in my tests) - The Acceptor thread calls StandardThreadExecutor.execute to process each incoming connection. - For each call, StandardThreadExecutor.TaskQueue.offer(Runnable) is being called - if you study the sources of Java 6 ThreadPoolExecutor, you can see that there's a small delay between the time a new Thread is created (thus increasing poolSize) and the time it starts working on its first task (increasing the activeCount) - Since in my case connections are established in a rapid burst, the calls to TaskQueue.offer() are sometimes faster than this small delay, so that we do have parent.getActiveCount()<parent.getPoolSize() and thus the task is enqueued instead of forcing the creation of a thread to serve it. - Since Keep-Alive is enabled and tomcat 6 threads take care of only one TCP connection at a time, the requests in the queue must wait for the keep-alive timeout so that a Thread is returned to the pool to serve pending tasks. - With 25s keepAliveTimeOut, it means that some requests take more than 25s to be served eventhough the pool was never full and the server quite idle!!! Other facts about this issue : - Although my test case starts with an empty pool, it can occur even on a loaded server. The thing that triggers the issue is the burst of new TCP connections. - The problem is less severe with a lower keepAliveTimeout, or if keepalive is disabled. In any case, it also depends on the time taken to serve current requests. - The issue also affects tomcat 7 but is less severe because tc7 threads are returned to the pool after each http request, even if the TCP connection is kept alive. The impact would the same as with tc6 with keepAlive disabled."	2010-08-09 16:16:04	1281380000	resolved fixed	2bfc300	1285870000	java/org/apache/tomcat/util/threads/TaskQueue.java java/org/apache/tomcat/util/threads/ThreadPoolExecutor.java	2:java/org/apache/tomcat/util/threads/TaskQueue.java 14:java/org/apache/tomcat/util/threads/ThreadPoolExecutor.java
600	50021	Bug 50021 ExceptionUtils class missing from bootstrap.jar	"o.a.c.startup.Bootstrap uses o.a.jasper.util.ExceptionUtils, but this class is not placed in bootstrap.jar, causing rather nasty failures if anything goes wrong during initial bootstrapping. This should be a fairly simple matter of updating build.xml to include it, but I wasn't sure whether including Jasper classes in the bootstrap was the done thing. There's an o.a.tomcat.util.ExceptionUtils that is identical, but that too looks like the wrong thing to grab."	2010-09-29 03:43:11	1285750000	resolved fixed	6c22816	1285760000	java/org/apache/catalina/startup/Bootstrap.java	1:java/org/apache/catalina/startup/Bootstrap.java
601	50018	Bug 50018 Javadoc corrections		2010-09-27 20:47:45	1285630000	resolved fixed	2f8a27c	1285750000	java/org/apache/jasper/compiler/ParserController.java java/org/apache/jasper/compiler/TagFileProcessor.java	126:java/org/apache/jasper/compiler/TagFileProcessor.java 150:java/org/apache/jasper/compiler/ParserController.java
602	49195	"Bug 49195 Using -1 as shutdown port with Windows service works, but prints error message"	"1. Install Tomcat as a service on Windows 2. Specify <Server port=""-1"" in server.xml 3. Start the service, and then stop the service. 4. The following is printed in the catalina.2010-04-27.log: 27.04.2010 17:49:13 org.apache.catalina.startup.Catalina stopServer SEVERE: No shutdown port configured. Shut down server through OS signal. Server not shut down. It is just a message. Tomcat stops regardless of it: After printing the message Catalina#stopServer() performs System.exit(1) which results in Tomcat shutdown. I think that when service launcher stops Tomcat, Catalina#server is not null. That can be used to differentiate the two use cases. There could be improvements on how to stop Tomcat. E.g., to call Catalina.stop(). If that is the case, it would be better to use wait(10000) instead of sleep(10000) in StandardServer.await(), so that it could be woken by a notifyAll() call, or use interrupt() call to wake it up (if we know the thread). System.exit(0) would work regardless of all that. I suppose that jsvc may show the same behaviour, but I have not tried."	2010-04-27 10:22:54	1272380000	resolved fixed	7c6b1a5	1285710000	java/org/apache/catalina/startup/Catalina.java	1:java/org/apache/catalina/startup/Catalina.java
603	49665	Bug 49665 When file not found error occurs it does not tell you which file caused the error.		2010-07-29 05:08:43	1280390000	resolved fixed	7b24ed5	1285690000	java/org/apache/jasper/compiler/Generator.java java/org/apache/jasper/compiler/JspDocumentParser.java java/org/apache/jasper/compiler/Parser.java java/org/apache/jasper/compiler/TagLibraryInfoImpl.java	37:java/org/apache/jasper/compiler/JspDocumentParser.java 44:java/org/apache/jasper/compiler/Parser.java 53:java/org/apache/jasper/compiler/TagLibraryInfoImpl.java 60:java/org/apache/jasper/compiler/Generator.java
604	49625	Bug 49625 Tomcat doesn't send Vary consistently when gzip enabled	"HTTP requires that the Vary response header be sent consistently for all responses if they change based upon different aspects of the request. My pages has both compressed and uncompressed variants available, negotiated by the Accept-Encoding request header, but it sends different Vary headers for each; ""accept-encoding"" when the response is compressed, and """" when it is not. This can cause problems for downstream caches, because they cannot consistently determine what the cache key for a given URI is. My server.xml content: <Service name=""Catalina""> <Connector port=""8080"" proxyPort=""80"" maxHttpHeaderSize=""8192"" protocol=""org.apache.coyote.http11.Http11Protocol"" maxThreads=""200"" minSpareThreads=""25"" maxPostSize=""8"" maxSpareThreads=""75"" enableLookups=""false"" keepAliveTimeout=""3000"" maxKeepAliveRequests=""100"" redirectPort=""8443"" acceptCount=""100"" connectionTimeout=""8000"" disableUploadTimeout=""true"" compression=""on"" compressionMinSize=""2048"" compressableMimeType=""text/html,text/xml,text/javascript,text/css"" /> <Engine name=""Catalina"" defaultHost=""localhost""> <Host name=""localhost"" appBase=""webapps"" unpackWARs=""false"" autoDeploy=""false"" debug=""0"" xmlValidation=""false"" xmlNamespaceAware=""false""> </Host> </Engine> </Service>"	2010-07-21 03:11:07	1279700000	resolved fixed	7435fa9	1285680000	java/org/apache/coyote/http11/AbstractHttp11Processor.java	16:java/org/apache/coyote/http11/AbstractHttp11Processor.java
605	49209	Bug 49209 AccessControlException when undeploying application	"When running Tomcat with a SecurityManager, an AccessControlException is thrown during undeployment. Stack trace: Caused by: java.security.AccessControlException: access denied (java.lang.RuntimePermission getClassLoader) at java.security.AccessControlContext.checkPermission(AccessControlContext.java:323) at java.security.AccessController.checkPermission(AccessController.java:546) at java.lang.SecurityManager.checkPermission(SecurityManager.java:532) at java.lang.Class.getClassLoader(Class.java:594) at org.apache.catalina.loader.JdbcLeakPrevention.clearJdbcDriverRegistrations(JdbcLeakPrevention.java:49) I assume the default catalina.policy should be updated, to take this case into account."	2010-04-28 07:30:12	1272450000	resolved fixed	d0d4c75	1285630000	java/org/apache/catalina/loader/WebappClassLoader.java	1:java/org/apache/catalina/loader/WebappClassLoader.java
606	49102	"Bug 49102 coyote.ajp.Constants - 3 ""constant"" arrays are mutable"	"The class coyote.ajp.Constants contains 3 public static non-empty String[] arrays: methodTransArray responseTransArray headerTransArray responseTransArray only appears to be locally, so could be made private. The others are used in index lookups, so get(index) methods could be used to protect them."	2010-04-12 16:11:37	1271100000	resolved fixed	fb5a3e7	1285240000	java/org/apache/coyote/ajp/AjpAprProcessor.java java/org/apache/coyote/ajp/AjpProcessor.java java/org/apache/coyote/ajp/Constants.java	1:java/org/apache/coyote/ajp/AjpProcessor.java 2:java/org/apache/coyote/ajp/AjpAprProcessor.java 3:java/org/apache/coyote/ajp/Constants.java
607	49909	Bug 49909 jstl 1.2 not support		2010-09-10 06:20:26	1284110000	resolved fixed	8dc0306	1284720000	java/org/apache/catalina/loader/WebappClassLoader.java	29:java/org/apache/catalina/loader/WebappClassLoader.java
608	49924	"Bug 49924 When non-primary node changes into a primary node, isPrimarySession is not changed to true."	"If BackupManager is used, when a primary node is switched, DeltaSession#isPrimarySession is not changed to true. Non-primary node changes into a primary node when a primary node is stopped or we get a non-primary session. If a primary node is stopped, a primary node is switched. In AbstractReplicatedMap, when a primary node is switched, MapOwner(BackupManager)#objectMadePrimay is called. However, isPrimarySession does not change to true in this method. =====BackupManager#objectMadePrimay===== public void objectMadePrimay(Object key, Object value) { if (value!=null && value instanceof DeltaSession) { DeltaSession session = (DeltaSession)value; synchronized (session) { session.access(); session.endAccess(); } } } ===== If we get a non-primary session, a primary node is switched. However, isPrimarySession does not change to true. It is only a change of primary node. I made a patch. It contains the following. isPrimarySession is set to true in BackupManager#objectMadePrimay. When get() is called in non-primary node, MapOwner#objectMadePrimay is called. Best regards."	2010-09-14 03:23:07	1284450000	resolved fixed	b255697	1284450000	java/org/apache/catalina/ha/session/BackupManager.java java/org/apache/catalina/tribes/tipis/AbstractReplicatedMap.java	1:java/org/apache/catalina/ha/session/BackupManager.java 3:java/org/apache/catalina/tribes/tipis/AbstractReplicatedMap.java
609	49234	Bug 49234 JMX Descriptor Modifications		2010-04-30 00:17:34	1272600000	resolved fixed	e0182ef	1284250000	java/org/apache/catalina/Server.java java/org/apache/catalina/Service.java java/org/apache/catalina/core/StandardEngine.java java/org/apache/catalina/core/StandardServer.java java/org/apache/catalina/core/StandardService.java java/org/apache/catalina/mbeans/ContainerMBean.java java/org/apache/catalina/mbeans/ContextMBean.java java/org/apache/catalina/mbeans/ServiceMBean.java java/org/apache/catalina/startup/Catalina.java	31:java/org/apache/catalina/core/StandardService.java 78:java/org/apache/catalina/core/StandardServer.java 100:java/org/apache/catalina/startup/Catalina.java 205:java/org/apache/catalina/core/StandardEngine.java
610	49892	Bug 49892 Wrong JNDI Name for Method Resource Injections	"Method based JNDI env. injections not worked correctly. Patch is attached. See Java EE 6 specification section, EE. 5.2.5 Annotations and Injections. Patch is provided that solves problem."	2010-09-07 10:44:49	1283870000	resolved fixed	94147b2	1283980000	java/org/apache/catalina/core/DefaultInstanceManager.java	12:java/org/apache/catalina/core/DefaultInstanceManager.java
611	49831	Bug 49831 Issue with closing XAConnections on MSSQL	"When using XAConnections with MSSQL it has been noticed that the physical connections are not being closed when DataSourceProxy.close(boolean all) is called. This method invokes org.apache.tomcat.jdbc.pool.PooledConnection.disconnent() which calls connection.close(). However, when used with SQLServer, the connection attribute is a proxy object (type com.microsoft.sqlserver.jdbc.SQLServerConnectionPoolProxy) which wraps the physical connection (of type com.microsoft.sqlserver.jdbc.SQLServerConnection). Calling close() on the proxy object only notifies the pool manager that the Connection is released back to the pool; it does not close the underlying physical connection. This is what the PooledConnection.disconnent() implementation currently reads: private void disconnect(boolean finalize) { if (isDiscarded()) { return; } setDiscarded(true); if (connection != null) { try { connection.close(); }catch (Exception ignore) { if (log.isDebugEnabled()) { log.debug(""Unable to close underlying SQL connection"",ignore); } } } connection = null; xaConnection = null; lastConnected = -1; if (finalize) parent.finalize(this); } If the logic was changed to the following, it would properly closed the XAConnection with the MSSQL. private void disconnect(boolean finalize) { if (isDiscarded()) { return; } setDiscarded(true); if (connection != null) { try { if (xaConnection != null) { xaConnection.close(); } else { connection.close(); } }catch (Exception ignore) { if (log.isDebugEnabled()) { log.debug(""Unable to close underlying SQL connection"",ignore); } } } connection = null; xaConnection = null; lastConnected = -1; if (finalize) parent.finalize(this); }"	2010-08-26 11:08:08	1282840000	resolved fixed	64a8346	1283960000	modules/jdbc-pool/java/org/apache/tomcat/jdbc/pool/PooledConnection.java	1:modules/jdbc-pool/java/org/apache/tomcat/jdbc/pool/PooledConnection.java
612	49883	Bug 49883 java.lang.UnsupportedOperationException: The getName() method should never be called		2010-09-04 22:58:52	1283660000	resolved fixed	a9f0fd5	1283720000	java/org/apache/catalina/realm/CombinedRealm.java	9:java/org/apache/catalina/realm/CombinedRealm.java
613	49802	Bug 49802 Shutdown of AJP Connector do not work		2010-08-23 05:59:48	1282560000	resolved fixed	cd7263e	1283720000	java/org/apache/catalina/connector/Connector.java java/org/apache/catalina/core/StandardService.java java/org/apache/coyote/ProtocolHandler.java java/org/apache/coyote/ajp/AjpAprProcessor.java java/org/apache/coyote/ajp/AjpAprProtocol.java java/org/apache/coyote/ajp/AjpProcessor.java java/org/apache/coyote/ajp/AjpProtocol.java java/org/apache/coyote/http11/AbstractHttp11Protocol.java java/org/apache/coyote/http11/Http11AprProcessor.java java/org/apache/coyote/http11/Http11NioProcessor.java java/org/apache/coyote/http11/Http11Processor.java java/org/apache/tomcat/util/net/AbstractEndpoint.java java/org/apache/tomcat/util/net/AprEndpoint.java java/org/apache/tomcat/util/net/JIoEndpoint.java java/org/apache/tomcat/util/net/NioEndpoint.java	1:java/org/apache/catalina/connector/Connector.java 5:java/org/apache/coyote/ajp/AjpProtocol.java 7:java/org/apache/coyote/ajp/AjpProcessor.java 12:java/org/apache/coyote/ajp/AjpAprProtocol.java 13:java/org/apache/coyote/ajp/AjpAprProcessor.java 22:java/org/apache/tomcat/util/net/AbstractEndpoint.java 25:java/org/apache/catalina/core/StandardService.java 36:java/org/apache/tomcat/util/net/NioEndpoint.java 38:java/org/apache/coyote/http11/Http11Processor.java 48:java/org/apache/tomcat/util/net/JIoEndpoint.java 59:java/org/apache/coyote/http11/Http11AprProcessor.java 66:java/org/apache/tomcat/util/net/AprEndpoint.java 69:java/org/apache/coyote/ProtocolHandler.java 120:java/org/apache/coyote/http11/Http11NioProcessor.java 286:java/org/apache/coyote/http11/AbstractHttp11Protocol.java
614	49876	Bug 49876 correcting generics related compile warning in org/apache/tomcat/util/bcel/classfile files	Explanation: Several files have compile time generics related warnings displayed for org/apache/tomcat/util/bcel/classfile. This patch cleans up several of those warnings.	2010-09-03 08:17:45	1283520000	resolved fixed	6155a8b	1283540000	java/org/apache/tomcat/util/bcel/classfile/AnnotationEntry.java java/org/apache/tomcat/util/bcel/classfile/Attribute.java java/org/apache/tomcat/util/bcel/classfile/JavaClass.java java/org/apache/tomcat/util/bcel/classfile/Unknown.java java/org/apache/tomcat/util/bcel/classfile/Utility.java	87:java/org/apache/tomcat/util/bcel/classfile/Unknown.java 387:java/org/apache/tomcat/util/bcel/classfile/Utility.java 550:java/org/apache/tomcat/util/bcel/classfile/JavaClass.java 1158:java/org/apache/tomcat/util/bcel/classfile/Attribute.java 1360:java/org/apache/tomcat/util/bcel/classfile/AnnotationEntry.java
615	49869	Bug 49869 Javadoc for WebAppClassLoader constructor has copy/paste error	The constructor that takes a parent class loader has a copy of the doc string from the constructor that does not take a parent class loader.	2010-09-02 18:26:13	1283470000	resolved fixed	a6620cb	1283500000	java/org/apache/catalina/loader/WebappClassLoader.java	1:java/org/apache/catalina/loader/WebappClassLoader.java
616	48967	"Bug 48967 Externalize Strings ""catalina.base"" and ""catalina.home"""		2010-03-23 14:19:02	1269370000	resolved fixed	bcb994c	1283440000	java/org/apache/catalina/Globals.java java/org/apache/catalina/connector/Connector.java java/org/apache/catalina/core/StandardContext.java java/org/apache/catalina/ha/deploy/FarmWarDeployer.java java/org/apache/catalina/manager/ManagerServlet.java java/org/apache/catalina/manager/host/HostManagerServlet.java java/org/apache/catalina/realm/JAASMemoryLoginModule.java java/org/apache/catalina/realm/MemoryRealm.java java/org/apache/catalina/startup/Bootstrap.java java/org/apache/catalina/startup/Catalina.java java/org/apache/catalina/startup/CatalinaProperties.java java/org/apache/catalina/startup/Embedded.java java/org/apache/catalina/startup/ExpandWar.java java/org/apache/catalina/startup/HostConfig.java java/org/apache/catalina/startup/Tomcat.java java/org/apache/catalina/startup/Tool.java java/org/apache/catalina/users/MemoryUserDatabase.java java/org/apache/catalina/valves/AccessLogValve.java java/org/apache/jasper/compiler/AntCompiler.java java/org/apache/tomcat/util/net/AbstractEndpoint.java java/org/apache/tomcat/util/net/jsse/JSSESocketFactory.java	1:java/org/apache/catalina/startup/Bootstrap.java 2:java/org/apache/catalina/startup/Embedded.java 3:java/org/apache/catalina/startup/CatalinaProperties.java 5:java/org/apache/catalina/startup/Catalina.java 6:java/org/apache/catalina/core/StandardContext.java 15:java/org/apache/catalina/startup/Tomcat.java 25:java/org/apache/catalina/startup/HostConfig.java 35:java/org/apache/catalina/connector/Connector.java 45:java/org/apache/tomcat/util/net/AbstractEndpoint.java 50:java/org/apache/catalina/users/MemoryUserDatabase.java 51:java/org/apache/catalina/startup/Tool.java 68:java/org/apache/catalina/manager/ManagerServlet.java 93:java/org/apache/catalina/ha/deploy/FarmWarDeployer.java 126:java/org/apache/jasper/compiler/AntCompiler.java 153:java/org/apache/catalina/realm/JAASMemoryLoginModule.java 170:java/org/apache/catalina/valves/AccessLogValve.java 208:java/org/apache/catalina/manager/host/HostManagerServlet.java 212:java/org/apache/catalina/realm/MemoryRealm.java 243:java/org/apache/tomcat/util/net/jsse/JSSESocketFactory.java 286:java/org/apache/catalina/Globals.java 329:java/org/apache/catalina/startup/ExpandWar.java
617	49749	Bug 49749 SSO cookie should be added as HttpOnly	"SSO cookies should be made HttpOnly by default. In org.apache.catalina.authenticator.AuthenticatorBase#register(), 798- response.addCookie(cookie); 798+ response.addCookieInternal(cookie, true);"	2010-08-13 19:18:22	1281740000	resolved fixed	e641f20	1282740000	java/org/apache/catalina/authenticator/AuthenticatorBase.java	1:java/org/apache/catalina/authenticator/AuthenticatorBase.java
618	48738	Bug 48738 [PATCH]Allow GzipOutputFilter to send partial result when flushBuffer() is called		2010-02-13 23:28:26	1266120000	resolved fixed	526f4ac	1282640000	java/org/apache/coyote/http11/AbstractOutputBuffer.java java/org/apache/coyote/http11/filters/FlushableGZIPOutputStream.java java/org/apache/coyote/http11/filters/GzipOutputFilter.java test/org/apache/coyote/http11/TestGzipOutputFilter.java	1:java/org/apache/coyote/http11/filters/GzipOutputFilter.java 22:java/org/apache/coyote/http11/AbstractOutputBuffer.java
619	49670	Bug 49670 org.apache.catalina.authenticator.SingleSignOn valve does not function	"I have two web applications; neither declare a realm in the context.xml and both are configured for authentication in the web.xml using standard tomcat authentication methods. I have enabled the tomcat valve in the host and have added a realm to the host as well. <Host name=""localhost"" appBase=""webapps"" unpackWARs=""true"" autoDeploy=""true""> <Realm className=""org.apache.catalina.realm.JAASRealm"" appName=""SSO"" userClassNames=""a.b.c"" roleClassNames=""a.b.c"" useContextClassLoader=""false""/> <!-- SingleSignOn valve, share authentication between web applications Documentation at: /docs/config/valve.html --> <Valve className=""org.apache.catalina.authenticator.SingleSignOn""/> <!-- Access log processes all example. Documentation at: /docs/config/valve.html --> <!-- <Valve className=""org.apache.catalina.valves.AccessLogValve"" directory=""logs"" prefix=""localhost_access_log."" suffix="".txt"" pattern=""common"" resolveHosts=""false""/> --> I have added a jaas configuration for the SSO app in the jaas.conf file for the server. I am certain that the realm, jaas.conf are all configured properly as the web applications do require a user to authenticate before accessing the application, but if I have authenticated to one application I still am required to authenticate before accessing the other application. I have this exact same configuration working on a tomcat 6 environment, but an identical configuration will not operate on a tomcat 7 server."	2010-07-29 10:43:35	1280410000	resolved fixed	e2f0b9b	1282590000	java/org/apache/catalina/authenticator/AuthenticatorBase.java	2:java/org/apache/catalina/authenticator/AuthenticatorBase.java
620	49721	Bug 49721 Fail to access the resources such as jsp files from a jar file which is supported by servlet 3.0	I put a jsp file in a jar file and test whether tomcat 7 supports it by viewing it from the browser and failed.	2010-08-06 21:52:37	1281150000	resolved fixed	187eed8	1282590000	java/org/apache/catalina/startup/ContextConfig.java	4:java/org/apache/catalina/startup/ContextConfig.java
621	49726	Bug 49726 JSP 2.2 new configuration element <default-content-type> under <jsp-property-group> works incorrectly on tomcat trunk		2010-08-09 02:07:45	1281330000	resolved fixed	42c226f	1282590000	java/org/apache/jasper/compiler/Compiler.java test/org/apache/jasper/compiler/TestCompiler.java	13:java/org/apache/jasper/compiler/Compiler.java
622	49750	Bug 49750 WebappClassLoader.validate(name) does not validate javax.servlet.	"The method does not validate the class name as described in the method documentation. ""Validate a classname. As per SRV.9.7.2, we must restrict loading of classes from J2SE (java.*) and classes of the servlet API (javax.servlet.*) """	2010-08-15 11:06:54	1281880000	resolved fixed	6fce7d7	1282580000	java/org/apache/catalina/loader/WebappClassLoader.java	1:java/org/apache/catalina/loader/WebappClassLoader.java
623	49758	Bug 49758 [Patch] Generics warnings - rawtypes		2010-08-16 13:20:09	1281980000	resolved fixed	c05cb94	1282520000	java/javax/annotation/Resource.java java/javax/ejb/EJB.java java/javax/el/BeanELResolver.java java/javax/el/ELContext.java java/javax/el/ResourceBundleELResolver.java java/javax/servlet/ServletRequestWrapper.java java/javax/servlet/ServletResponseWrapper.java java/javax/servlet/annotation/HandlesTypes.java java/javax/servlet/jsp/el/ExpressionEvaluator.java java/javax/servlet/jsp/el/ImplicitObjectELResolver.java java/javax/servlet/jsp/tagext/TagSupport.java java/javax/xml/ws/WebServiceRef.java java/org/apache/el/lang/EvaluationContext.java java/org/apache/el/parser/AstValue.java java/org/apache/jasper/el/ELContextWrapper.java java/org/apache/jasper/el/ExpressionEvaluatorImpl.java java/org/apache/naming/resources/DirContextURLConnection.java	3:java/javax/el/ELContext.java 7:java/javax/el/ResourceBundleELResolver.java 8:java/javax/el/BeanELResolver.java 10:java/org/apache/jasper/el/ELContextWrapper.java 12:java/org/apache/el/lang/EvaluationContext.java 29:java/javax/servlet/jsp/tagext/TagSupport.java 33:java/org/apache/el/parser/AstValue.java 61:java/org/apache/naming/resources/DirContextURLConnection.java 152:java/javax/servlet/ServletRequestWrapper.java 192:java/javax/servlet/jsp/el/ExpressionEvaluator.java 202:java/javax/servlet/jsp/el/ImplicitObjectELResolver.java 219:java/org/apache/jasper/el/ExpressionEvaluatorImpl.java 227:java/javax/servlet/ServletResponseWrapper.java
624	49757	Bug 49757 correcting some generics related warnings	Patch attached. Thanks	2010-08-16 13:13:12	1281980000	resolved fixed	d446678	1282490000	java/org/apache/catalina/manager/JMXProxyServlet.java java/org/apache/catalina/tribes/tipis/AbstractReplicatedMap.java	9:java/org/apache/catalina/tribes/tipis/AbstractReplicatedMap.java 617:java/org/apache/catalina/manager/JMXProxyServlet.java
625	49714	Bug 49714 The annotation process of Jar should not impact distributable of web.xml.	"Even if < distributable/> is set to web.xml(servlet3.0), distributable is changed from true to false by the annotation process of JAR. ContextConfig#processAnnotations is as follows. ===ContextConfig#processAnnotations protected void processAnnotations(Set<WebXml> fragments) { for(WebXml fragment : fragments) { if (!fragment.isMetadataComplete()) { WebXml annotations = new WebXml(); URL url = fragment.getURL(); processAnnotationsUrl(url, annotations); Set<WebXml> set = new HashSet<WebXml>(); set.add(annotations); // Merge annotations into fragment - fragment takes priority fragment.merge(set); } } } === distributable of ""annotations"" created by new WebXml() is false (default). If ""annotations"" is merged with ""fragment"", distributable of ""fragment"" becomes false. Because ""fragment"" is merged with web.xml of the web application, even if < distributable/> is set to web.xml, distributable is changed from true to false. The following are necessary. annotations.setDistributable(true); Best regards."	2010-08-05 22:06:15	1281060000	resolved fixed	f4a10ec	1281060000	java/org/apache/catalina/startup/ContextConfig.java	1:java/org/apache/catalina/startup/ContextConfig.java
626	49655	Bug 49655 ExpressionFactoryImpl.createMethodExpression() is not EL 2.2 Spec conform		2010-07-27 10:32:48	1280240000	resolved fixed	96a99ce	1280700000	test/org/apache/el/TestMethodExpressionImpl.java	13:test/org/apache/el/TestMethodExpressionImpl.java
627	49407	Bug 49407 backup manager reports too few current sessions	"With 100 sessions shared across 4 nodes (i.e. 25 active sessions per node), the delta manager reports 100 current sessions per node (25 active and the copies of the sessions from the other nodes). The back manager reports 25. For consistency it should report 50. The 25 active sessions plus the 25 (or so) that are backed up on that node."	2010-06-08 15:58:58	1276030000	resolved fixed	d21b105	1280430000	java/org/apache/catalina/session/ManagerBase.java java/org/apache/catalina/tribes/tipis/AbstractReplicatedMap.java	8:java/org/apache/catalina/session/ManagerBase.java 13:java/org/apache/catalina/tribes/tipis/AbstractReplicatedMap.java
628	49613	Bug 49613 Request.getAttributeNames() slows down some applications		2010-07-19 06:23:09	1279530000	resolved fixed	5f1ad13	1279810000	java/org/apache/catalina/connector/Request.java	1:java/org/apache/catalina/connector/Request.java
629	49567	"Bug 49567 when starting a new thread from a startAsync Runnable, an infinite amount of doPosts is generated"		2010-07-07 09:22:22	1278510000	resolved fixed	2357fb5	1279790000	java/org/apache/catalina/connector/CoyoteAdapter.java java/org/apache/catalina/connector/Request.java java/org/apache/catalina/core/AsyncContextImpl.java java/org/apache/coyote/http11/Http11Processor.java test/org/apache/catalina/core/TestAsyncContextImpl.java	1:java/org/apache/catalina/connector/Request.java 12:java/org/apache/catalina/connector/CoyoteAdapter.java 21:java/org/apache/catalina/core/AsyncContextImpl.java 30:test/org/apache/catalina/core/TestAsyncContextImpl.java 54:java/org/apache/coyote/http11/Http11Processor.java
630	49617	Bug 49617 Fix ExpiresFilter docs (remove remaining ExpiresActive reference)	Remove the last references to the removed configuration parameter ExpiresActive.	2010-07-19 17:44:38	1279580000	resolved fixed	dfbd8aa	1279730000	java/org/apache/catalina/filters/ExpiresFilter.java test/org/apache/catalina/filters/TestExpiresFilter.java	1:java/org/apache/catalina/filters/ExpiresFilter.java 2:test/org/apache/catalina/filters/TestExpiresFilter.java
631	48998	Bug 48998 Proposal : port mod_expires in java as ExpiresFilter Servlet Filter		2010-03-26 16:38:18	1269640000	resolved fixed	7963a16	1279150000	java/org/apache/catalina/filters/ExpiresFilter.java test/org/apache/catalina/filters/TestExpiresFilter.java	
632	49127	Bug 49127 SimpleTcpReplicationManager.startInternal() ignores Exception	ha.session.SimpleTcpReplicationManager.startInternal() ignores Exception when invoking Thread.sleep() - it only needs to ignore InterruptedException.	2010-04-14 19:05:06	1271290000	resolved fixed	eca4ed9	1279140000	java/org/apache/catalina/ha/session/SimpleTcpReplicationManager.java	1:java/org/apache/catalina/ha/session/SimpleTcpReplicationManager.java
633	49128	Bug 49128 loader.WebappClassLoader.start() ignores Exception	"catalina.loader.WebappClassLoader.start() ignores Exception. However, it probably only needs to ignore SecurityException"	2010-04-14 19:06:21	1271290000	resolved fixed	e8245ef	1279140000	java/org/apache/catalina/loader/WebappClassLoader.java	1:java/org/apache/catalina/loader/WebappClassLoader.java
634	48960	Bug 48960 SSI Servlet should support safe configuration	"The current configuration of the SSI module is ""All"" or ""None"". The ""ALL"" option will expose all the legacy Apache SSI directive (echo, printenv, if, exec, ...). As documented, allowing SSI will allow execution of arbitrary programs using the ""exec"". As a result, there is no safe way to expose sites/projects containing SSI directive, without taking a security risk, or reviewing of every file. The ""exec"" directive, with the cmd option is a major risk. Even for Apache, you have the option to allowing the ""safe"" include (includeNoExec). The includeNoExec allow pages to be served, even when the content is not reviewed, or when users are allowed to upload content to the site. I have a big site which need to be converted into JSP. I would like to use the SSI servlet to allow for transition over time. The extra risk from ( from exec cmd) make it impossible to deploy the SSI. My request: Modify the configuration of SSI as follow: By default, it will only allow ""safe"" directive (no exec cmd=...). This will eliminate the risk from arbitrary execution of commands (""del *.*""). It will also remove many potentail load problems. The cmd= should only be allowed using a directive like ""allowUnsafeExec"", which will default to false. I think that the change will make it easier to use the SSI feature, without exposing the server to big risk. The risk associated with the ""safer"" version of SSI is similar to the risk from running JSP pages."	2010-03-22 16:37:48	1269290000	resolved fixed	a36b0c0	1279060000	java/org/apache/catalina/ssi/SSIFilter.java java/org/apache/catalina/ssi/SSIProcessor.java java/org/apache/catalina/ssi/SSIServlet.java	1:java/org/apache/catalina/ssi/SSIProcessor.java 54:java/org/apache/catalina/ssi/SSIServlet.java 151:java/org/apache/catalina/ssi/SSIFilter.java
635	49442	Bug 49442 Make StringManager fields final		2010-06-15 05:41:37	1276590000	resolved fixed	4159093	1278800000	java/org/apache/tomcat/util/res/StringManager.java	1:java/org/apache/tomcat/util/res/StringManager.java
636	49478	Bug 49478 Add encoding parameter to AddDefaultCharSetFilter	"AddDefaultCharSetFilter adds a default charset to each request. It assumes ISO-8859-1 as the default charset. The attached patch makes it configurable by introducing an ""encoding"" parameter. This parameter can take one of two special values ""default"" or ""system"". Every other value will be interpreted as a name of an character set, e.g ""utf-8"". The meaning of the two special values are as follows: default: use ISO-8859-1. This value will also be used, if no parameter was specified, or if it is empty system: the jvm will be asked for the default charset. This charset will usually be set by system locale. Together with this functional change, there are two minor changes and one bigger changes hidden. First use of annotation ""Override"" at overriden methods. Second use of keyword ""static"" for the ResponseWrapper, since it has no reference to outer class. The third and somewhat bigger change is use of HttpServletResponse#setCharacterEncoding(encoding) instead of manipulating the content-type."	2010-06-21 05:43:57	1277110000	resolved fixed	d6766f1	1278800000	java/org/apache/catalina/filters/AddDefaultCharsetFilter.java test/org/apache/catalina/filters/TestAddCharSetFilter.java	3:java/org/apache/catalina/filters/AddDefaultCharsetFilter.java
637	49570	Bug 49570 The CompressionFilter example should support HTTP proxies to cache gzipped content better by sending Vary: Accept-Encoding header		2010-07-08 02:11:36	1278570000	resolved fixed	c191152	1278780000	webapps/examples/WEB-INF/classes/compressionFilters/CompressionResponseStream.java	9:webapps/examples/WEB-INF/classes/compressionFilters/CompressionResponseStream.java
638	49503	"Bug 49503 Connectors do not bind to their ports in Catalina.load(), but only later in start()"		2010-06-25 11:22:41	1277480000	resolved fixed	a90b576	1278600000	java/org/apache/catalina/connector/Connector.java	1:java/org/apache/catalina/connector/Connector.java
639	49551	"Bug 49551 When setting absolute path to default context.xml, in ContextConfig.contextConfig() it cannot be found"		2010-07-05 07:41:23	1278330000	resolved fixed	dca6dd1	1278360000	java/org/apache/catalina/startup/ContextConfig.java	1:java/org/apache/catalina/startup/ContextConfig.java
640	49550	Bug 49550 [PATCH] Response class fix isSpace (deprecated) => isWhiteSpace		2010-07-05 07:23:31	1278330000	resolved fixed	7b9630b	1278360000	java/org/apache/catalina/connector/Response.java	2:java/org/apache/catalina/connector/Response.java
641	49530	Bug 49530 Context is not correctly stopped at shutdown		2010-06-30 10:08:43	1277910000	resolved fixed	3bd4bcb	1278090000	java/org/apache/catalina/core/ContainerBase.java	49:java/org/apache/catalina/core/ContainerBase.java
642	49536	"Bug 49536 If no webapps deployed, accessing a URL returns 200 OK with no content instead of 404"		2010-07-01 04:07:11	1277970000	resolved fixed	4e34898	1278020000	java/org/apache/catalina/connector/CoyoteAdapter.java java/org/apache/catalina/connector/MapperListener.java java/org/apache/catalina/connector/Request.java java/org/apache/tomcat/util/http/mapper/Mapper.java	7:java/org/apache/catalina/connector/Request.java 59:java/org/apache/catalina/connector/MapperListener.java 79:java/org/apache/catalina/connector/CoyoteAdapter.java 453:java/org/apache/tomcat/util/http/mapper/Mapper.java
643	49525	Bug 49525 IE8: Unabled to store data in HttpSession (root context)	Environment: Tomcat 7.0.0 Beta IE8 A simplest webapp only have a test.jsp below: <%=request.getSession().getId()%> this app installed as root context the test.jsp works fine in firefox but when using IE8 there is always a different session id where refresh the test page. BTW: the test.jsp works find in Tomcat 6.x	2010-06-29 22:22:03	1277860000	resolved fixed	0b8a9a8	1278010000	java/org/apache/catalina/core/ApplicationSessionCookieConfig.java	118:java/org/apache/catalina/core/ApplicationSessionCookieConfig.java
644	49522	Bug 49522 Complete Server status (status/all) causes stack trace	type Exception report message description The server encountered an internal error () that prevented it from fulfilling this request. exception javax.servlet.ServletException: javax.management.AttributeNotFoundException: Cannot find attribute startTime for org.apache.catalina.deploy.NamingResources@d1c778 org.apache.catalina.manager.StatusManagerServlet.doGet(StatusManagerServlet.java:292) javax.servlet.http.HttpServlet.service(HttpServlet.java:621) javax.servlet.http.HttpServlet.service(HttpServlet.java:722) root cause javax.management.AttributeNotFoundException: Cannot find attribute startTime for org.apache.catalina.deploy.NamingResources@d1c778 org.apache.tomcat.util.modeler.ManagedBean.getGetter(ManagedBean.java:493) org.apache.tomcat.util.modeler.BaseModelMBean.getAttribute(BaseModelMBean.java:180) com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.getAttribute(DefaultMBeanServerInterceptor.java:666) com.sun.jmx.mbeanserver.JmxMBeanServer.getAttribute(JmxMBeanServer.java:638) org.apache.catalina.manager.StatusTransformer.writeContext(StatusTransformer.java:656) org.apache.catalina.manager.StatusTransformer.writeDetailedState(StatusTransformer.java:590) org.apache.catalina.manager.StatusManagerServlet.doGet(StatusManagerServlet.java:287) javax.servlet.http.HttpServlet.service(HttpServlet.java:621) javax.servlet.http.HttpServlet.service(HttpServlet.java:722)	2010-06-29 10:41:51	1277820000	resolved fixed	3c88f07	1278010000	java/org/apache/catalina/core/StandardContext.java	3:java/org/apache/catalina/core/StandardContext.java
645	49476	Bug 49476 Cannot expire selected session in Manager webapp		2010-06-20 11:47:00	1277050000	resolved fixed	a0159a3	1277370000	java/org/apache/catalina/filters/CsrfPreventionFilter.java java/org/apache/catalina/manager/HTMLManagerServlet.java	6:java/org/apache/catalina/manager/HTMLManagerServlet.java 347:java/org/apache/catalina/filters/CsrfPreventionFilter.java
646	49443	Bug 49443 RemoteIpValve : remoteIpHeader vs remoteIPHeader		2010-06-15 07:38:37	1276600000	resolved fixed	27091e7	1276860000	java/org/apache/catalina/filters/RemoteIpFilter.java java/org/apache/catalina/valves/RemoteIpValve.java	1:java/org/apache/catalina/valves/RemoteIpValve.java 2:java/org/apache/catalina/filters/RemoteIpFilter.java
647	49445	"Bug 49445 After session ID is changed on authentication, the session replication does not work."	"After r889716, session ID is changed on authentication. (default of changeSessionIdOnAuthentication is true. ) But DeltaManager doesn't notify other cluster nodes. Therefore, non-primary node keeps having old session ID. And, can not replicate of change of session attribute notified by new session ID. The workaround is ... override changeSessionId method, and notify to change session ID. BackupManager is OK. This problem is DeltaManager only. Best regards."	2010-06-16 05:08:02	1276680000	resolved fixed	4f990f1	1276690000	java/org/apache/catalina/ha/session/DeltaManager.java java/org/apache/catalina/ha/session/SessionMessage.java java/org/apache/catalina/ha/session/SessionMessageImpl.java	1:java/org/apache/catalina/ha/session/DeltaManager.java 81:java/org/apache/catalina/ha/session/SessionMessage.java 104:java/org/apache/catalina/ha/session/SessionMessageImpl.java
648	49376	Bug 49376 Minor corrections to info properties.	The static info properties appear to contain legacy packages.	2010-06-03 07:33:13	1275560000	resolved fixed	e119b5b	1275860000	java/org/apache/catalina/ha/authenticator/ClusterSingleSignOn.java java/org/apache/catalina/ha/authenticator/ClusterSingleSignOnListener.java java/org/apache/catalina/ha/session/ClusterSessionListener.java	140:java/org/apache/catalina/ha/authenticator/ClusterSingleSignOn.java 160:java/org/apache/catalina/ha/session/ClusterSessionListener.java 184:java/org/apache/catalina/ha/authenticator/ClusterSingleSignOnListener.java
649	48971	Bug 48971 memory leak protection : stopping TimeThreads should be optional and disabled by default		2010-03-23 22:56:08	1269400000	resolved fixed	ac8a5ba	1275410000	java/org/apache/catalina/core/StandardContext.java java/org/apache/catalina/loader/WebappClassLoader.java java/org/apache/catalina/loader/WebappLoader.java	5:java/org/apache/catalina/core/StandardContext.java 21:java/org/apache/catalina/loader/WebappClassLoader.java 90:java/org/apache/catalina/loader/WebappLoader.java
650	49360	Bug 49360 Context class reload fails for PersistentManager	On context class reload tomcat fails with LifecycleException: An invalid Lifecycle transition was attempted ([before_start]) for component [org.apache.catalina.session.PersistentManager[/xxx]] in state [DESTROYED]	2010-05-29 17:45:06	1275170000	resolved fixed	ac22dd8	1275330000	java/org/apache/catalina/ha/session/BackupManager.java java/org/apache/catalina/ha/session/DeltaManager.java java/org/apache/catalina/session/PersistentManagerBase.java	3:java/org/apache/catalina/session/PersistentManagerBase.java 12:java/org/apache/catalina/ha/session/DeltaManager.java 16:java/org/apache/catalina/ha/session/BackupManager.java
651	49340	Bug 49340 Webapp unavailable after deploy then stop then start	"Occurs with tomcat 7.0 RC3 but not with 6.0.26 Using the manager/html : - deploy a war - test one of its page, it should be deployed properly - stop the webapp - start the webapp - test one of its page : FAILURE : tomcat returns a 404. Notes : - if using ""reload"" instead of stop/start it's OK, but it does not fix the unavailability - if the webapp is present when tomcat is started, then the stop/start works normally - The work around is to undeploy the webapp and redeploy it."	2010-05-25 17:45:19	1274820000	resolved fixed	0f669e3	1275080000	java/org/apache/catalina/connector/MapperListener.java	283:java/org/apache/catalina/connector/MapperListener.java
652	49299	Bug 49299 Servlet 3.0 ch.7.1.1 says that custom cookie name affects URL rewriting		2010-05-15 17:38:08	1273960000	resolved fixed	9369636	1274050000	java/org/apache/catalina/Globals.java java/org/apache/catalina/connector/CoyoteAdapter.java java/org/apache/catalina/connector/Request.java java/org/apache/catalina/connector/Response.java java/org/apache/catalina/core/ApplicationSessionCookieConfig.java java/org/apache/catalina/realm/RealmBase.java test/org/apache/catalina/connector/TestCoyoteAdaptor.java	2:java/org/apache/catalina/connector/Request.java 15:java/org/apache/catalina/connector/Response.java 28:java/org/apache/catalina/core/ApplicationSessionCookieConfig.java 60:java/org/apache/catalina/connector/CoyoteAdapter.java 82:java/org/apache/catalina/realm/RealmBase.java 399:java/org/apache/catalina/Globals.java
653	49290	Bug 49290 Using a JarScanner with scanAllDirectories=true causes Tomcat 7 not to start		2010-05-14 10:26:11	1273850000	resolved fixed	a7b96d0	1273960000	java/org/apache/catalina/startup/ContextConfig.java	6:java/org/apache/catalina/startup/ContextConfig.java
654	49221	Bug 49221 javax.servlet.http.Cookie.setDomain uses default charset	"javax.servlet.http.Cookie.setDomain(String pattern) has the following code: domain = pattern.toLowerCase(); The result of this depends on the default Locale; it would be safer to use a fixed locale, e.g. Local.ENGLISH."	2010-04-29 09:40:27	1272550000	resolved fixed	05810ee	1273660000	java/javax/servlet/http/Cookie.java	5:java/javax/servlet/http/Cookie.java
655	49224	Bug 49224 NullPointerException in PooledConnection when username or password are null	"I'm using jdbc-pool (version 1.0.8.5) to connect to a DataSource requiring no authentication. Unless I explicitly set the username and password in the PoolProperties object to empty String (as opposed to leaving them null), a NullPointerException is thrown on lines 215 or 216 of PooledConnection.connectUsingDriver()."	2010-04-29 11:15:49	1272550000	resolved fixed	4fff6c0	1273660000	modules/jdbc-pool/java/org/apache/tomcat/jdbc/pool/PooledConnection.java	1:modules/jdbc-pool/java/org/apache/tomcat/jdbc/pool/PooledConnection.java
656	49226	Bug 49226 toLowerCase()/toUpperCase() may not work OK in all Locales		2010-04-29 11:29:18	1272560000	resolved fixed	5ad9ecd	1273610000	java/org/apache/catalina/core/ApplicationPart.java java/org/apache/catalina/core/StandardEngine.java java/org/apache/catalina/core/StandardHost.java java/org/apache/catalina/deploy/FilterMap.java java/org/apache/catalina/manager/HTMLManagerServlet.java java/org/apache/catalina/manager/util/SessionUtils.java java/org/apache/catalina/servlets/CGIServlet.java java/org/apache/catalina/servlets/WebdavServlet.java java/org/apache/catalina/ssi/ResponseIncludeWrapper.java java/org/apache/catalina/ssi/SSIMediator.java java/org/apache/catalina/ssi/SSIProcessor.java java/org/apache/catalina/ssi/SSIServlet.java java/org/apache/catalina/ssi/SSIServletExternalResolver.java java/org/apache/catalina/startup/ClassLoaderFactory.java java/org/apache/catalina/startup/ContextConfig.java java/org/apache/catalina/startup/HostConfig.java java/org/apache/catalina/util/ExtensionValidator.java java/org/apache/catalina/util/MIME2Java.java java/org/apache/tomcat/util/buf/MessageBytes.java java/org/apache/tomcat/util/http/AcceptLanguage.java java/org/apache/tomcat/util/http/fileupload/FileItemHeadersImpl.java java/org/apache/tomcat/util/http/fileupload/FileUploadBase.java java/org/apache/tomcat/util/http/fileupload/ParameterParser.java java/org/apache/tomcat/util/http/fileupload/ServletFileUpload.java java/org/apache/tomcat/util/modeler/OperationInfo.java java/org/apache/tomcat/util/net/URL.java java/org/apache/tomcat/util/net/jsse/JSSESocketFactory.java webapps/examples/WEB-INF/classes/examples/ShowSource.java webapps/examples/WEB-INF/classes/jsp2/examples/el/Functions.java	2:java/org/apache/tomcat/util/buf/MessageBytes.java 7:webapps/examples/WEB-INF/classes/jsp2/examples/el/Functions.java 12:java/org/apache/catalina/ssi/SSIMediator.java 13:java/org/apache/catalina/manager/util/SessionUtils.java 15:java/org/apache/catalina/core/StandardHost.java 16:java/org/apache/catalina/util/ExtensionValidator.java 18:java/org/apache/catalina/startup/HostConfig.java 22:java/org/apache/catalina/startup/ContextConfig.java 26:java/org/apache/tomcat/util/modeler/OperationInfo.java 29:java/org/apache/catalina/manager/HTMLManagerServlet.java 30:java/org/apache/tomcat/util/http/fileupload/ServletFileUpload.java 32:java/org/apache/catalina/deploy/FilterMap.java 33:java/org/apache/catalina/core/StandardEngine.java 34:java/org/apache/catalina/ssi/ResponseIncludeWrapper.java 35:java/org/apache/tomcat/util/http/fileupload/FileItemHeadersImpl.java 36:webapps/examples/WEB-INF/classes/examples/ShowSource.java 41:java/org/apache/catalina/servlets/WebdavServlet.java 46:java/org/apache/catalina/ssi/SSIServlet.java 55:java/org/apache/tomcat/util/http/fileupload/FileUploadBase.java 58:java/org/apache/tomcat/util/http/fileupload/ParameterParser.java 67:java/org/apache/catalina/core/ApplicationPart.java 81:java/org/apache/catalina/startup/ClassLoaderFactory.java 91:java/org/apache/catalina/ssi/SSIServletExternalResolver.java 94:java/org/apache/tomcat/util/net/jsse/JSSESocketFactory.java 96:java/org/apache/catalina/ssi/SSIProcessor.java 120:java/org/apache/tomcat/util/http/AcceptLanguage.java 125:java/org/apache/catalina/servlets/CGIServlet.java 131:java/org/apache/catalina/util/MIME2Java.java 159:java/org/apache/tomcat/util/net/URL.java
657	49227	Bug 49227 toLowerCase()/toUpperCase() may not work OK in all Locales		2010-04-29 11:30:31	1272560000	resolved fixed	09abffb	1273610000	java/org/apache/coyote/http11/Http11AprProcessor.java java/org/apache/coyote/http11/Http11NioProcessor.java java/org/apache/coyote/http11/Http11Processor.java	68:java/org/apache/coyote/http11/Http11AprProcessor.java 69:java/org/apache/coyote/http11/Http11Processor.java 80:java/org/apache/coyote/http11/Http11NioProcessor.java
658	49228	Bug 49228 toLowerCase()/toUpperCase() may not work OK in all Locales		2010-04-29 11:31:40	1272560000	resolved fixed	a954806	1273590000	java/org/apache/jasper/compiler/Validator.java java/org/apache/jasper/tagplugins/jstl/Util.java	4:java/org/apache/jasper/tagplugins/jstl/Util.java 78:java/org/apache/jasper/compiler/Validator.java
659	49235	Bug 49235 ServletContainerInitializer onStartup(Set<Class<?>> classSet is not expect class		2010-04-30 03:08:29	1272610000	resolved fixed	4a581aa	1273590000	java/org/apache/catalina/startup/ContextConfig.java	3:java/org/apache/catalina/startup/ContextConfig.java
660	49240	Bug 49240 Error thrown during detection of ServletContainerInitializer's	"ContextConfig.checkHandlesTypes() throws a NoClassDefFoundError, which isn't caught, when the class being analysed is initialised if the class, or a class that it references(?), is not present in the classpath. E.g. When a mysql connector/j jar (v5.x) is scanned, an attempt to load the following class occurs: com.mchange.v2.c3p0.QueryConnectionTester java.lang.NoClassDefFoundError: com/mchange/v2/c3p0/QueryConnectionTester at java.lang.ClassLoader.defineClass1(Native Method) at java.lang.ClassLoader.defineClass(ClassLoader.java:698) at java.security.SecureClassLoader.defineClass(SecureClassLoader.java:124) at java.net.URLClassLoader.defineClass(URLClassLoader.java:260) at java.net.URLClassLoader.access$000(URLClassLoader.java:56) at java.net.URLClassLoader$1.run(URLClassLoader.java:195) at java.security.AccessController.doPrivileged(Native Method) at java.net.URLClassLoader.findClass(URLClassLoader.java:188) at java.lang.ClassLoader.loadClass(ClassLoader.java:315) at java.lang.ClassLoader.loadClass(ClassLoader.java:250) at java.lang.ClassLoader.loadClassInternal(ClassLoader.java:398) at java.lang.Class.forName0(Native Method) at java.lang.Class.forName(Class.java:247) Also Class.forName is used here, referencing the WebappClassLoader, instead of calling WebappClassLoader.loadClass() directly."	2010-05-01 07:46:16	1272710000	resolved fixed	f24ed2d	1273570000	java/org/apache/catalina/startup/ContextConfig.java	1:java/org/apache/catalina/startup/ContextConfig.java
661	49269	Bug 49269 Shouldn't see maxIdle > maxActive message with default props	"In PoolProperties, the default value for maxIdle is Integer.MAX_VALUE and the default for maxActive is 100. This results in a warning message being logged and the value for maxIdle set to match maxActive on lines 393/394 of ConnectionPool. The default for maxIdle should match that of maxActive."	2010-05-10 14:32:07	1273520000	resolved fixed	27a3909	1273560000	modules/jdbc-pool/java/org/apache/tomcat/jdbc/pool/PoolProperties.java	2:modules/jdbc-pool/java/org/apache/tomcat/jdbc/pool/PoolProperties.java
662	49241	"Bug 49241 DataSourceFactory.parsePoolProperties() doesn't look for ""suspectTimeout"""	"If you call the DataSourceFactory.parsePoolProperties() method, passing in a Properties object with the ""suspectTimeout"" property set, that key/value pair is never passed on to the PoolProperties.setSuspectTimeout() method."	2010-05-01 21:01:46	1272760000	resolved fixed	b75b021	1272910000	modules/jdbc-pool/java/org/apache/tomcat/jdbc/pool/DataSourceFactory.java	2:modules/jdbc-pool/java/org/apache/tomcat/jdbc/pool/DataSourceFactory.java
663	49092	Bug 49092 util.IntrospectionUtils.PATH_SEPARATOR should be final	The field org.apache.tomcat.util.IntrospectionUtils.PATH_SEPARATOR should be final.	2010-04-11 22:37:12	1271040000	resolved fixed	616bd68	1272730000	test/org/apache/catalina/tribes/demos/IntrospectionUtils.java	2:test/org/apache/catalina/tribes/demos/IntrospectionUtils.java
664	49207	Bug 49207 Filter name not set when dynamically added	"When dynamically adding a Filter the name is not set when calling the method ""addMappingForUrlPatterns"" in ApplicationFilterRegistration.java. java.lang.IllegalArgumentException: Filter mapping specifies an unknown filter name null at org.apache.catalina.core.StandardContext.validateFilterMap(StandardContext.java:2650) at org.apache.catalina.core.StandardContext.addFilterMapBefore(StandardContext.java:2622) at org.apache.catalina.core.ApplicationFilterRegistration.addMappingForUrlPatterns(ApplicationFilterRegistration.java:102) at org.pidster.tomcat.test7.dyn.TestDynamicsListener.contextInitialized(TestDynamicsListener.java:105)"	2010-04-28 05:40:52	1272450000	resolved fixed	3396917	1272470000	java/org/apache/catalina/core/ApplicationFilterRegistration.java	2:java/org/apache/catalina/core/ApplicationFilterRegistration.java
665	49184	Bug 49184 Index out of bounds exception thrown when dynamically adding Filter	When dynamically adding a filter to a context an exception is thrown. java.lang.ArrayIndexOutOfBoundsException at java.lang.System.arraycopy(Native Method) at org.apache.catalina.core.StandardContext.addFilterMapBefore(StandardContext.java:2629) at org.apache.catalina.core.ApplicationFilterRegistration.addMappingForServletNames(ApplicationFilterRegistration.java:75)	2010-04-25 08:54:34	1272200000	resolved fixed	3f4a241	1272270000	java/org/apache/catalina/core/StandardContext.java	1:java/org/apache/catalina/core/StandardContext.java
666	48689	Bug 48689 Jar abstraction for Jasper	"Jasper can load TLD files through the ServletContext or from a Jar file. To load TLDs from Jar file, an URL to a Jar file must be passed. However, in some environments (e.g. in OSGi) it might not be easy to provide an URL to a jar file. It would be nice to abstract the way Jasper is looking up the embedded TLDs so that different ways of looking up TLDs within Jar files or Bundles or whatever could be used."	2010-02-05 12:30:40	1265390000	resolved fixed	efd418b	1272200000	java/org/apache/jasper/JspCompilationContext.java java/org/apache/jasper/compiler/ImplicitTagLibraryInfo.java java/org/apache/jasper/compiler/JarResource.java java/org/apache/jasper/compiler/JarURLResource.java java/org/apache/jasper/compiler/JspDocumentParser.java java/org/apache/jasper/compiler/Parser.java java/org/apache/jasper/compiler/ParserController.java java/org/apache/jasper/compiler/TagFileProcessor.java java/org/apache/jasper/compiler/TagLibraryInfoImpl.java java/org/apache/jasper/compiler/TldLocation.java java/org/apache/jasper/compiler/TldLocationsCache.java java/org/apache/jasper/servlet/JspServletWrapper.java	2:java/org/apache/jasper/compiler/TldLocationsCache.java 5:java/org/apache/jasper/JspCompilationContext.java 11:java/org/apache/jasper/servlet/JspServletWrapper.java 20:java/org/apache/jasper/compiler/TagFileProcessor.java 31:java/org/apache/jasper/compiler/TagLibraryInfoImpl.java 36:java/org/apache/jasper/compiler/ParserController.java 66:java/org/apache/jasper/compiler/Parser.java 112:java/org/apache/jasper/compiler/ImplicitTagLibraryInfo.java 240:java/org/apache/jasper/compiler/JspDocumentParser.java
667	49140	Bug 49140 Inefficient use of keySet() iterator in StandardContext.java		2010-04-16 21:14:48	1271470000	resolved fixed	b30fc95	1272040000	java/org/apache/catalina/connector/Request.java java/org/apache/catalina/core/ApplicationHttpRequest.java java/org/apache/catalina/core/StandardContext.java java/org/apache/catalina/ha/authenticator/ClusterSingleSignOnListener.java java/org/apache/catalina/ha/session/ClusterSessionListener.java java/org/apache/catalina/startup/ContextConfig.java	1:java/org/apache/catalina/core/StandardContext.java 3:java/org/apache/catalina/connector/Request.java 26:java/org/apache/catalina/startup/ContextConfig.java 32:java/org/apache/catalina/core/ApplicationHttpRequest.java 86:java/org/apache/catalina/ha/authenticator/ClusterSingleSignOnListener.java 106:java/org/apache/catalina/ha/session/ClusterSessionListener.java
668	49143	Bug 49143 Possible incorrect lazy initialisations	Incorrect lazy initialization of static field: org.apache.catalina.realm.RealmBase.md5Helper org.apache.catalina.session.StandardSession.sessionContext org.apache.catalina.startup.TldConfig.noTldJars org.apache.catalina.util.ExtensionValidator.containerAvailableExtensions org.apache.tomcat.util.modeler.modules.MbeansDescriptorsDigesterSource.digester fields should probably all be made volatile	2010-04-16 21:44:52	1271470000	resolved fixed	a6092d7	1272030000	java/org/apache/catalina/realm/RealmBase.java java/org/apache/catalina/session/StandardSession.java java/org/apache/catalina/startup/TldConfig.java java/org/apache/catalina/util/ExtensionValidator.java java/org/apache/tomcat/util/modeler/modules/MbeansDescriptorsDigesterSource.java	1:java/org/apache/catalina/startup/TldConfig.java 5:java/org/apache/tomcat/util/modeler/modules/MbeansDescriptorsDigesterSource.java 6:java/org/apache/catalina/session/StandardSession.java 7:java/org/apache/catalina/util/ExtensionValidator.java 9:java/org/apache/catalina/realm/RealmBase.java
669	49144	Bug 49144 Incorrect lazy initialization and update of static fields?	"Incorrect lazy initialization and update of static fields: org.apache.catalina.startup.Bootstrap.daemon org.apache.catalina.startup.ContextConfig.contextDigester Findbugs says: This method contains an unsynchronized lazy initialization of a static field. After the field is set, the object stored into that location is further updated or accessed. The setting of the field is visible to other threads as soon as it is set. If the futher accesses in the method that set the field serve to initialize the object, then you have a very serious multithreading bug, unless something else prevents any other thread from accessing the stored object until it is fully initialized. Even if you feel confident that the method is never called by multiple threads, it might be better to not set the static field until the value you are setting it to is fully populated/initialized."	2010-04-16 21:47:20	1271470000	resolved fixed	fd7ed83	1272030000	java/org/apache/catalina/startup/Bootstrap.java	1:java/org/apache/catalina/startup/Bootstrap.java
670	49164	Bug 49164 junit test ignores failures in threads		2010-04-21 14:08:24	1271870000	resolved fixed	aa758d8	1272030000	test/org/apache/catalina/tribes/test/interceptors/TestOrderInterceptor.java	140:test/org/apache/catalina/tribes/test/interceptors/TestOrderInterceptor.java
671	49171	Bug 49171 Avoid raw type warning in TagSupport		2010-04-22 07:10:06	1271930000	resolved fixed	8bd4d7a	1272030000	java/javax/servlet/jsp/tagext/TagSupport.java	1:java/javax/servlet/jsp/tagext/TagSupport.java
672	49170	Bug 49170 Transmission of duplicated session in DeltaManager#handleGET_ALL_SESSIONS.		2010-04-22 06:54:01	1271930000	resolved fixed	f61100d	1271930000	java/org/apache/catalina/ha/session/DeltaManager.java	1:java/org/apache/catalina/ha/session/DeltaManager.java
673	43642	Bug 43642 Add prestartminSpareThreads attribute for Executor	The attached patch adds the boolean attribute prestartminSpareThreads to the Executor element. This allows the admin to prestart minspareThreads for this Executor during the start of Tomcat. The default value is false which is the old behaviour. A documentation patch for executor.xml can be created if there is interest in committing this patch.	2007-10-17 08:00:46	1192620000	resolved fixed	e7fb8fa	1271850000	java/org/apache/catalina/core/StandardThreadExecutor.java	1:java/org/apache/catalina/core/StandardThreadExecutor.java
674	49141	Bug 49141 Impossible cast in naming.factory.SendMailFactory.getObjectInstance	naming.factory.SendMailFactory.getObjectInstance contains an impossible cast from javax.mail.internet.MimeMessage to javax.mail.internet.MimePart [Findbugs]	2010-04-16 21:21:03	1271470000	resolved fixed	7205c74	1271790000	java/javax/mail/internet/MimeMessage.java	3:java/javax/mail/internet/MimeMessage.java
675	49151	Bug 49151 ClassCastException in BackupManager#stopInternal.	"In BackupManager#startInternal, When constructor of LazyReplicatedMap throws exception, sessions is not LazyReplicatedMap. Actually, AbstractReplicatedMap#init has the possibility of throwing RuntimeException. In BackupManager#stopInternal ClassCastException is thrown because AbstractReplicatedMap#breakdown is executed regardless of the type of sessions. should be changed as follows to avoid ClassCastException. === skip. if (sessions instanceof LazyReplicatedMap) { LazyReplicatedMap map = (LazyReplicatedMap)sessions; if ( map!=null ) { map.breakdown(); } } skip. === This problem exists in Tomcat7.0 and 6.0. Best Regards."	2010-04-19 05:02:32	1271670000	resolved fixed	fcb9861	1271670000	java/org/apache/catalina/ha/session/BackupManager.java	1:java/org/apache/catalina/ha/session/BackupManager.java
676	49150	Bug 49150 All primary sessions are deleted at BackupManager#stopInternal.	"BackupManager#stopInternal is as follows. ===== protected synchronized void stopInternal() throws LifecycleException { super.stopInternal(); LazyReplicatedMap map = (LazyReplicatedMap)sessions; if ( map!=null ) { map.breakdown(); } cluster.removeManager(this); } ===== In Tomcat 7.0.0 RC1, super#stopInternal() is called first. In StandardManager#stopInternal() of the super class, The session is stored, and expire all active sessions. Storing session is unnecessary in BackupManager. and When the session expired, the session is deleted from all cluster nodes. As a Result, All primary sessions (of own node has) are deleted from all cluster nodes. For instance, Node1 : sessionA(primary), sessionB(proxy), sessionC(backup) Node2 : sessionA(backup), sessionB(primary), sessionC(proxy) Node3 : sessionA(proxy), sessionB(backup), sessionC(primary) If Node1 is stopped, it becomes the following. Node1 : stopped Node2 : sessionB(primary), sessionC(backup) Node3 : sessionB(backup), sessionC(primary) sessionA is expired. It should be the following. Node1 : stopped Node2 : sessionA(primary), sessionB(primary), sessionC(backup) Node3 : sessionA(backup), sessionB(backup), sessionC(primary) There is no problem in Tomcat6.0.x, because it executes super.stop() after LazyReplicatedMap#breakdown() . I made a patch against trunk. Best Regards."	2010-04-19 03:37:08	1271660000	resolved fixed	09f4e25	1271670000	java/org/apache/catalina/ha/session/BackupManager.java	1:java/org/apache/catalina/ha/session/BackupManager.java
677	49129	Bug 49129 DigestAuthenticator.md5Helper - possible incorrect lazy initialisation	"Findbugs says: ""This method contains an unsynchronized lazy initialization of a non-volatile static field. Because the compiler or processor may reorder instructions, threads are not guaranteed to see a completely initialized object, if the method can be called by multiple threads. You can make the field volatile to correct the problem."""	2010-04-14 19:09:31	1271290000	resolved fixed	867605f	1271290000	java/org/apache/catalina/authenticator/DigestAuthenticator.java	1:java/org/apache/catalina/authenticator/DigestAuthenticator.java
678	49118	Bug 49118 Inefficient use of String concatenation in loop		2010-04-14 05:40:15	1271240000	resolved fixed	95a2eb8	1271290000	java/javax/servlet/http/HttpServlet.java	68:java/javax/servlet/http/HttpServlet.java
679	49110	Bug 49110 runtime.JspFactoryImpl$PageContextPool needs to be static	"Findbugs says: Bug: org.apache.jasper.runtime.JspFactoryImpl$PageContextPool needs to be _static_ to avoid a deadly embrace with org.apache.jasper.runtime.JspFactoryImpl.localPool Pattern id: SIC_THREADLOCAL_DEADLY_EMBRACE, type: SIC, category: CORRECTNESS This class is an inner class, but should probably be a static inner class. As it is, there is a serious danger of a deadly embrace between the inner class and the thread local in the outer class. Because the inner class isn't static, it retains a reference to the outer class. If the thread local contains a reference to an instance of the inner class, the inner and outer instance will both be reachable and not eligible for garbage collection."	2010-04-12 19:50:48	1271120000	resolved fixed	b027259	1271290000	java/org/apache/jasper/runtime/JspFactoryImpl.java	1:java/org/apache/jasper/runtime/JspFactoryImpl.java
680	49109	Bug 49109 RealmBase.authenticate uses toString on byte array	"catalina.realm.RealmBase.authenticate(String username, byte[] credentials) has the following code: return (authenticate(username, credentials.toString())); This looks wrong, as credentials is a byte array. It should probably be: return (authenticate(username, new String(credentials[,charset])));"	2010-04-12 19:36:53	1271120000	resolved fixed	bcf0a01	1271280000	java/org/apache/catalina/Realm.java java/org/apache/catalina/realm/CombinedRealm.java java/org/apache/catalina/realm/LockOutRealm.java java/org/apache/catalina/realm/RealmBase.java	1:java/org/apache/catalina/realm/RealmBase.java 2:java/org/apache/catalina/Realm.java 4:java/org/apache/catalina/realm/CombinedRealm.java 9:java/org/apache/catalina/realm/LockOutRealm.java
681	49106	Bug 49106 Unused imports		2010-04-12 19:01:41	1271110000	resolved fixed	f8d3565	1271280000	java/org/apache/catalina/realm/JNDIRealm.java	116:java/org/apache/catalina/realm/JNDIRealm.java
682	49105	Bug 49105 Javadoc corrections		2010-04-12 19:00:58	1271110000	resolved fixed	ead3997	1271280000	java/javax/el/ExpressionFactory.java java/javax/servlet/HttpConstraintElement.java java/javax/servlet/ServletContext.java java/org/apache/catalina/Context.java java/org/apache/catalina/Host.java java/org/apache/catalina/Lifecycle.java java/org/apache/catalina/Session.java java/org/apache/catalina/authenticator/FormAuthenticator.java java/org/apache/catalina/connector/Request.java java/org/apache/catalina/core/ApplicationSessionCookieConfig.java java/org/apache/catalina/core/ContainerBase.java java/org/apache/catalina/core/StandardContext.java java/org/apache/catalina/session/StandardSession.java java/org/apache/catalina/tribes/ChannelListener.java java/org/apache/catalina/tribes/group/RpcChannel.java java/org/apache/el/parser/AstValue.java java/org/apache/jasper/compiler/Node.java webapps/examples/WEB-INF/classes/chat/ChatServlet.java webapps/examples/WEB-INF/classes/filters/ExampleFilter.java webapps/examples/WEB-INF/classes/filters/SetCharacterEncodingFilter.java	4:java/org/apache/catalina/core/StandardContext.java 28:java/org/apache/catalina/authenticator/FormAuthenticator.java 30:java/javax/servlet/ServletContext.java 61:java/org/apache/catalina/connector/Request.java 63:java/org/apache/catalina/session/StandardSession.java 92:java/org/apache/jasper/compiler/Node.java 134:java/org/apache/el/parser/AstValue.java 151:java/org/apache/catalina/core/ContainerBase.java 347:java/org/apache/catalina/Host.java 363:java/org/apache/catalina/tribes/ChannelListener.java 456:java/org/apache/catalina/tribes/group/RpcChannel.java 515:java/javax/el/ExpressionFactory.java
683	49104	Bug 49104 Fix up some raw types		2010-04-12 18:59:00	1271110000	resolved fixed	5be4f29	1271280000	java/org/apache/coyote/ajp/AjpProtocol.java java/org/apache/coyote/http11/Http11Protocol.java java/org/apache/tomcat/util/net/JIoEndpoint.java	142:java/org/apache/coyote/http11/Http11Protocol.java 240:java/org/apache/coyote/ajp/AjpProtocol.java 248:java/org/apache/tomcat/util/net/JIoEndpoint.java
684	49103	Bug 49103 Missing annotations		2010-04-12 18:57:56	1271110000	resolved fixed	1018cd7	1271280000	java/org/apache/coyote/http11/Http11NioProtocol.java java/org/apache/coyote/http11/Http11Protocol.java java/org/apache/tomcat/util/net/AprEndpoint.java java/org/apache/tomcat/util/net/NioEndpoint.java java/org/apache/tomcat/util/net/jsse/JSSEImplementation.java	108:java/org/apache/tomcat/util/net/NioEndpoint.java 109:java/org/apache/coyote/http11/Http11NioProtocol.java 146:java/org/apache/coyote/http11/Http11Protocol.java 426:java/org/apache/tomcat/util/net/jsse/JSSEImplementation.java 523:java/org/apache/tomcat/util/net/AprEndpoint.java
685	49045	Bug 49045 JMX Enhancement- Provision of MBeanFactory createStandardService	"Currently MBeanFactory doesn't have a method for creating a new StandardService MBean. This would become an issue for future enhancements of JMX support in Tomcat. As per discussions with Mark, this enhancement is suggested as a starting point for possible future enhancements in JMX support."	2010-04-04 05:40:57	1270370000	resolved fixed	32046eb	1271250000	java/org/apache/catalina/mbeans/MBeanFactory.java	1:java/org/apache/catalina/mbeans/MBeanFactory.java
686	49089	Bug 49089 ChannelData.USE_SECURE_RANDOM_FOR_UUID public static mutable field	"catalina.tribes.io.ChannelData.USE_SECURE_RANDOM_FOR_UUID is a mutable public static field. It's only used by an instance method, so there's no need for it to be static. Probably no need for it to be public either; it could be a private field with a setter - or better a final field set by the constructor."	2010-04-11 22:24:38	1271040000	resolved fixed	cb0b029	1271240000	java/org/apache/catalina/tribes/io/ChannelData.java	1:java/org/apache/catalina/tribes/io/ChannelData.java
687	49116	Bug 49116 Memory leak by HttpSession.	"When session is stored in StandardManager#doUnload method, an invalid session is stored. For instance, If HttpSession#invalidate is executed while executing StandardManager#doUnload, session of ""isValid=false"" is stored. The session of isValid=false is restored in StandardManager#doLoad, and it registers in session map (sessions). However, no one can invalidate this session. If isValid is false, StandardSession#invalidate() and StandardSession#isValid() can not expire session. They are throws IllegalStateException or return immediately. Consequently, the session of isValid=false is never deleted from the session map(sessions). I made a patch. If session is already invalid, expire session to prevent memory leak. Best Regards. Keiichi."	2010-04-14 04:43:30	1271230000	resolved fixed	bddfc0a	1271230000	java/org/apache/catalina/session/StandardManager.java	5:java/org/apache/catalina/session/StandardManager.java
688	49086	Bug 49086 Addition of Javadoc for Servlet 3.0 annotations		2010-04-11 16:43:49	1271020000	resolved fixed	6fc4360	1271070000	java/javax/servlet/annotation/HandlesTypes.java java/javax/servlet/annotation/HttpConstraint.java java/javax/servlet/annotation/HttpMethodConstraint.java java/javax/servlet/annotation/MultipartConfig.java java/javax/servlet/annotation/ServletSecurity.java java/javax/servlet/annotation/WebFilter.java java/javax/servlet/annotation/WebInitParam.java java/javax/servlet/annotation/WebListener.java java/javax/servlet/annotation/WebServlet.java	
689	49091	Bug 49091 Util.specialCharactersRepresentation should be private	jasper.tagplugins.jstl.Util.specialCharactersRepresentation is a mutable public static array; it is not used outside the class as far as I can tell and so should be made private	2010-04-11 22:31:35	1271040000	resolved fixed	1ecfaa9	1271070000	java/org/apache/jasper/tagplugins/jstl/Util.java	2:java/org/apache/jasper/tagplugins/jstl/Util.java
690	49075	Bug 49075 protected Class User doesn't check argument roles for null		2010-04-08 18:15:55	1270760000	resolved fixed	e59ba8f	1270810000	java/org/apache/catalina/realm/JNDIRealm.java	19:java/org/apache/catalina/realm/JNDIRealm.java
691	49018	Bug 49018 Timeout argument misprocessed when expiring sessions from Tomcat Manager	"Steps to reproduce: 1. Login to the Tomcat Manager Application 2. Select a web application that has several sessions that are inactive for more than 2 minutes 3. In the text field next to the ""Expire sessions"" button print ""2"" 4. Press ""Expire sessions"" 5. Sample observed result: OK - Session information for application at context path /myapp Default maximum session inactive interval 30 minutes <1 minutes:16 sessions 1 - <2 minutes:2 sessions 2 - <3 minutes:5 sessions 3 - <4 minutes:1 sessions 4 - <5 minutes:2 sessions 5 - <6 minutes:1 sessions 6 - <7 minutes:2 sessions 9 - <10 minutes:1 sessions 8 minutes:expired 0 sessions Actually some sessions were expired (even if the above message prints ""0""). Expected result: All sessions with idle time > 2 minutes had to be expired. The bug is in the following lines of ManagerServlet#sessions(PrintWriter, String, int): Lines 1176-1179 if (idle >= 0 && time >= idle*60) { sessions[i].expire(); idle++; } The patch would be to replace ""idle++"" with ""expired++"", because ""idle"" is the time (in minutes) as submitted from the web form and ""expired"" is the counter."	2010-03-29 15:18:35	1269890000	resolved fixed	155e3f8	1270610000	java/org/apache/catalina/manager/ManagerServlet.java	3:java/org/apache/catalina/manager/ManagerServlet.java
692	48648	Bug 48648 Blank page (dropped connection) when running TC7 with TCnative (APR)		2010-01-31 17:58:11	1264980000	resolved fixed	216352a	1270400000	java/org/apache/tomcat/util/net/AprEndpoint.java	40:java/org/apache/tomcat/util/net/AprEndpoint.java
693	49014	Bug 49014 Add RemoteIpFilter test case		2010-03-29 00:17:51	1269840000	resolved fixed	d9330a9	1270380000	test/org/apache/catalina/filters/TestRemoteIpFilter.java	
694	48983	Bug 48983 Enhance RemoteIpValve and RemoteIpFilter logging		2010-03-24 23:15:14	1269490000	resolved fixed	9a42719	1270380000	java/org/apache/catalina/filters/RemoteIpFilter.java java/org/apache/catalina/valves/RemoteIpValve.java	1:java/org/apache/catalina/filters/RemoteIpFilter.java 2:java/org/apache/catalina/valves/RemoteIpValve.java
695	48895	Bug 48895 WebAppClassLoader.clearThreadLocalMap() concurrency issues	"I think that the memory leak protection of WebAppClassLoader.clearReferencesThreadLocals() which detects and clears ThreadLocals that would prevent GC the WebAppClassLoader instance has issues regarding concurrency : - It enumerates Threads and looks into internal structures of the Thread class, but there are no ""memory barrier"" that would ensure a consistent state of the ThreadLocalMap being examined. So, it is theoretically possible that a ThreadLocal in Thread A was properly cleaned up by the application, but the current thread B (that is undeploying the application) does not see the up to date state because there's no synchronization between those threads. - Much more severe : after detecting such a leak, it invokes java.lang.ThreadLocal.ThreadLocalMap.remove(ThreadLocal) on Thread A's ThreadLocalMap instance but the invocation is done by Thread B (the thread that undeploys the app). The remove() method is not thread safe at all, and nor is the expungeStaleEntries() method which may also be invoked in clearThreadLocalMap(). So, if a webapp is being undeployed while other applications continue to receive a heavy load of requests, this could corrupt the internal structures of the ThreadLocalMap instance ! I propose to keep the detection of leaks as it is, but to make the actual clearing optional (and disabled by default) to avoid encountering big problems in production. Idea to improve the clearing in a safe way : if the thread that is ""provoking"" the leak is one of tomcat's worker threads, we could mark it as ""dirty"", and then have a background task that would end such threads (renew those threads in the pool)."	2010-03-11 22:20:01	1268360000	resolved fixed	ae6fcf5	1269870000	java/org/apache/catalina/core/StandardContext.java java/org/apache/catalina/loader/WebappClassLoader.java java/org/apache/catalina/loader/WebappLoader.java	1:java/org/apache/catalina/loader/WebappClassLoader.java 2:java/org/apache/catalina/core/StandardContext.java 49:java/org/apache/catalina/loader/WebappLoader.java
696	48717	Bug 48717 Session listeners not called on cluster node start		2010-02-09 17:43:14	1265760000	resolved fixed	39d3082	1269800000	java/org/apache/catalina/ha/session/DeltaManager.java	9:java/org/apache/catalina/ha/session/DeltaManager.java
697	48662	Bug 48662 context.xml expansion on deployment improvements	"Two parts: 1. Log a warning/info message if Tomcat ignores a bundled context.xml in favour of one in CATALINA_BASE/<engine name>/<host name> 2. Make the extraction/copying of context.xml configurable, probably via a new attribute extractXml on the host"	2010-02-02 22:44:07	1265170000	resolved fixed	83226d9	1269780000	java/org/apache/catalina/Context.java java/org/apache/catalina/core/StandardContext.java java/org/apache/catalina/core/StandardHost.java java/org/apache/catalina/mbeans/MBeanFactory.java java/org/apache/catalina/startup/ContextConfig.java java/org/apache/catalina/startup/HostConfig.java	1:java/org/apache/catalina/core/StandardContext.java 3:java/org/apache/catalina/startup/HostConfig.java 4:java/org/apache/catalina/core/StandardHost.java 17:java/org/apache/catalina/startup/ContextConfig.java 29:java/org/apache/catalina/Context.java 33:java/org/apache/catalina/mbeans/MBeanFactory.java
698	48934	"Bug 48934 Cluster's regression. When replication fails once, replication can be never done again."		2010-03-18 11:09:23	1268920000	resolved fixed	fc66705	1268920000	java/org/apache/catalina/tribes/transport/ReplicationTransmitter.java java/org/apache/catalina/tribes/transport/nio/PooledParallelSender.java	25:java/org/apache/catalina/tribes/transport/ReplicationTransmitter.java
699	44265	"Bug 44265 Improve JspWriterImpl performance with ""inline"" sub method"	"As you know, the JspWriterImpl.write method was always invoked in JSP file frequently. But I found its performance is poor because too many sub method were invoked as well. After copying two sub method's code to write method, the performance was improved observably."	2008-01-18 02:51:47	1200640000	resolved fixed	9113574	1268330000	java/org/apache/jasper/runtime/JspWriterImpl.java	1:java/org/apache/jasper/runtime/JspWriterImpl.java
700	48760	Bug 48760 Tomcat breaks in serving large files (>=1.8MB) under high load and high threading.		2010-02-17 20:44:37	1266460000	resolved fixed	f1760d8	1268140000	java/org/apache/naming/resources/FileDirContext.java java/org/apache/naming/resources/WARDirContext.java	184:java/org/apache/naming/resources/FileDirContext.java 302:java/org/apache/naming/resources/WARDirContext.java
701	48737	Bug 48737 JspCompilationContext assumes that tagfile with a path starting with META-INF are in jars without checking		2010-02-13 18:19:03	1266100000	resolved fixed	6ac5036	1268140000	java/org/apache/jasper/JspCompilationContext.java	1:java/org/apache/jasper/JspCompilationContext.java
702	48729	Bug 48729 JNDIRealm.java not parsing roles correctly		2010-02-11 17:27:55	1265930000	resolved fixed	4cf35b8	1268140000	java/org/apache/catalina/realm/JNDIRealm.java	1:java/org/apache/catalina/realm/JNDIRealm.java
703	48661	Bug 48661 inconsistent error page behavior	"There seems to be a bug or at least an inconsistency in how tomcat handles the error page. In Tomcat 6.0.20, if I define my error page like this in web.xml: <error-page> <exception-type>java.lang.Exception</exception-type> <location>/unexpectedErrors.jsp</location> </error-page> Then, if the response has already been committed, Tomcat does this on the system console: Feb 1, 2010 5:59:04 PM org.apache.catalina.core.StandardWrapperValve invoke SEVERE: Servlet.service() for servlet jsp threw exception java.lang.NullPointerException at org.apache.jsp.cpe_jsp._jspService(cpe_jsp.java:693) at org.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:70) at javax.servlet.http.HttpServlet.service(HttpServlet.java:717) at org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:374) at org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:342) at org.apache.jasper.servlet.JspServlet.service(JspServlet.java:267) at javax.servlet.http.HttpServlet.service(HttpServlet.java:717) at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:290) at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206) at com.eaglecreektech.expedience.provisioning.web.servletFilters.AuthFilter.doFilter(AuthFilter.java:133) at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235) at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206) at com.eaglecreektech.expedience.provisioning.web.servletFilters.RequestVolumeFilter.doFilter(RequestVolumeFilter.java:141) at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235) at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206) at com.eaglecreektech.expedience.provisioning.web.servletFilters.StartupCheckFilter.doFilter(StartupCheckFilter.java:65) at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235) at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206) at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:233) at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191) at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:128) at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:102) at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:109) at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:293) at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:849) at org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.process(Http11Protocol.java:583) at org.apache.tomcat.util.net.JIoEndpoint$Worker.run(JIoEndpoint.java:454) at java.lang.Thread.run(Thread.java:619) Feb 1, 2010 5:59:04 PM org.apache.catalina.core.StandardHostValve custom SEVERE: Exception Processing ErrorPage[exceptionType=java.lang.Exception, location=/unexpectedErrors.jsp] java.lang.IllegalStateException: Cannot reset buffer after response has been committed at org.apache.catalina.connector.Response.resetBuffer(Response.java:691) at org.apache.catalina.core.StandardHostValve.custom(StandardHostValve.java:409) at org.apache.catalina.core.StandardHostValve.throwable(StandardHostValve.java:271) at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:142) at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:102) at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:109) at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:293) at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:849) at org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.process(Http11Protocol.java:583) at org.apache.tomcat.util.net.JIoEndpoint$Worker.run(JIoEndpoint.java:454) at java.lang.Thread.run(Thread.java:619) And it doesn't put any error text into the broken page - the page just shows how ever far it got before it encountered the error. This behavior doesn't seem correct - it seems like it should at least behave the same way as it does when the error page is defined in a jsp page: <%@ page errorPage=""unexpectedErrors.jsp"" %> If the response has already been committed, then it just appends the error page onto the end of the response (not ideal, but nothing else can be done, as far as I know) If the response has not been committed, it clears the buffer and writes the error page (which looks nice and pretty , like it should) I'd suggest that the error handling code for the error page as defined in web.xml should check if the response has been committed, and not try to clear the buffer if it is already committed - just append to the end, the same way that the jsp error handler does."	2010-02-02 15:07:25	1265140000	resolved fixed	1ec5ca7	1268070000	java/org/apache/catalina/core/StandardHostValve.java	6:java/org/apache/catalina/core/StandardHostValve.java
704	48582	Bug 48582 JspServletWrapper.getServletContext() throws NullPointerException		2010-01-20 13:25:03	1264010000	resolved fixed	7301a10	1266320000	java/org/apache/jasper/servlet/JspServletWrapper.java	1:java/org/apache/jasper/servlet/JspServletWrapper.java
705	48580	Bug 48580 6.0.24: AccessControlException in ProtectedFunctionMapper on first access to certain JSP		2010-01-20 11:54:45	1264010000	resolved fixed	9e55819	1266310000	java/org/apache/jasper/security/SecurityClassLoad.java	7:java/org/apache/jasper/security/SecurityClassLoad.java
706	48498	Bug 48498 6.0.22RC: ArrayIndexOutOfBoundsException from Jasper when compilation error inside a CDATA block		2010-01-06 19:40:54	1262820000	resolved fixed	789ac1e	1266280000	java/org/apache/jasper/compiler/JavacErrorDetail.java	143:java/org/apache/jasper/compiler/JavacErrorDetail.java
707	48384	Bug 48384 globalXsltFile parameter for the DefaultServlet	"When overriding the DefaultServlet for a given application, the globalXsltFile path need to be relative to Tomcat root. for example: <init-param> <param-name>globalXsltFile</param-name> <param-value>webapps/quercus/WEB-INF/listing.xsl</param-value> </init-param> it would be nice if the path could be relative to the application context."	2009-12-13 16:24:30	1260740000	resolved fixed	0e595cf	1266090000	java/org/apache/catalina/servlets/DefaultServlet.java	1:java/org/apache/catalina/servlets/DefaultServlet.java
708	48371	Bug 48371 addWebXmlMappings does not place servlet tags correctly	"If there is a commented-out <security-constraint> or commented-out <servlet> tag and addWebXmlMappings=""true"", the JSP's servlet and servlet-mapping tags are placed incorrectly and Tomcat will not start due to ""--"" being inside a comment. Basically, it seems the web.xml is not parsed correctly when using addWebXmlMappings and you cannot have above tags commented out, or new servlet tags will be placed incorrectly and comment tags not respected."	2009-12-10 18:16:34	1260490000	resolved fixed	563e315	1266090000	java/org/apache/jasper/JspC.java	2:java/org/apache/jasper/JspC.java
709	48318	Bug 48318 WebDAV servlet returns 500 if files not readable	"If a directory contains a file that is not readable by the Tomcat process (eg file permissions, dangling symlink) then Tomcat throws a NullPointerException and returns a 500 Internal Server Error to the client. Throwing NPE in these circumstances is certainly wrong. Returning 500 with no further information is unhelpful behavior and should be fixed. Generally, interfaces of this type at least list inaccessible files (Windows Explorer, UNIX ls(1), BSD FTP client, ...) and only return an error when one attempts to access such a file. markt suggests an alternative of simply ignoring inaccessible files but notes that ""could cause issues if a user tries to upload a file of that name"" and suggests better error reporting. Stack: SEVERE: Servlet.service() for servlet webdav threw exception java.lang.NullPointerException at org.apache.catalina.servlets.WebdavServlet.parseProperties(Unknown Source) at org.apache.catalina.servlets.WebdavServlet.doPropfind(Unknown Source) at org.apache.catalina.servlets.WebdavServlet.service(Unknown Source) at javax.servlet.http.HttpServlet.service(Unknown Source) ... Method parseProperties() is in java/org/apache/catalina/servlets/WebdavServlet.java.org and the NPE happens when cacheEntry.attributes is null (case FIND_BY_PROPERTY in my testing and possibly in other cases too). Following the breadcrumbs via: cacheEntry = resources.lookupCache(path); leads eventually to java/org/apache/naming/resources/FileDirContext.java: public Attributes getAttributes(String name, String[] attrIds) throws NamingException { // Building attribute list File file = file(name); if (file == null) throw new NamingException (sm.getString(""resources.notFound"", name)); ... protected File file(String name) { File file = new File(base, name); if (file.exists() && file.canRead()) { ... // do useful stuff } else { return null; // ouch }"	2009-12-01 07:07:07	1259670000	resolved fixed	da42e44	1266010000	java/org/apache/catalina/servlets/WebdavServlet.java	3:java/org/apache/catalina/servlets/WebdavServlet.java
710	48726	Bug 48726 DeployTask throws OutOfMemoryErrors when deploying large WAR files		2010-02-10 22:46:18	1265860000	resolved fixed	53e0674	1265850000	java/org/apache/catalina/ant/AbstractCatalinaTask.java java/org/apache/catalina/ant/DeployTask.java	1:java/org/apache/catalina/ant/DeployTask.java 61:java/org/apache/catalina/ant/AbstractCatalinaTask.java
711	48170	Bug 48170 Unnecessary synchronization by JspFactory.getDefaultFactory contributes to stability problems	"I have a soak test at constant load that is initially stable. Within the hour, an ever increasing number of blocked threads develops. The vast majority of threads are in JSP rendering, blocked on JspFactory.getDefaultFactory(). The server eventually crashes. We are running Java 6. Upon code inspection, there appears to be no real reason for synchronizing the getDefaultFactory() and setDefaultFactory() as the setter is called only once upon startup when the sub-class loads. Patching the jar, I tried three other experiments: 1) Removing the synchronized keyword entirely. 2) Locking on an inner static class instead of the JspFactory.class. 3) Using volatile for the static member variable. Both experiments #1 and #3 showed vastly better stability. I was able to double the throughput of the server without seeing increasing number of blocked threads. Experiment #2 yielded the same behavior as the original code. Thus, no other code is synchronizing on JspFactory.class. Rather, there seem to be some sort of contention in the java.lang.Class monitor. Using volatile would preserve the multi-threading semantics while avoiding contributing to the instability issue."	2009-11-10 18:04:01	1257890000	resolved fixed	c09753b	1265670000	java/javax/servlet/jsp/JspFactory.java	1:java/javax/servlet/jsp/JspFactory.java
712	48109	Bug 48109 Improve binaryStream processing in WebappClassLoader#findResourceInternal		2009-11-02 19:49:49	1257210000	resolved fixed	dda2cbc	1265670000	java/org/apache/catalina/loader/WebappClassLoader.java	1:java/org/apache/catalina/loader/WebappClassLoader.java
713	48665	"Bug 48665 RemoteIpValve examples refer to ""connector"" package"		2010-02-03 03:38:00	1265190000	resolved fixed	9905155	1265590000	java/org/apache/catalina/valves/RemoteIpValve.java	1:java/org/apache/catalina/valves/RemoteIpValve.java
714	48643	Bug 48643 catalina.session.FileStore.save() and load() - close() bugs	"The code for the save() method reads: try { fos = new FileOutputStream(file.getAbsolutePath()); oos = new ObjectOutputStream(new BufferedOutputStream(fos)); } catch (IOException e) { if (oos != null) { <== oos can only be null here try { oos.close(); } catch (IOException f) { // Ignore } } throw e; } Presumably the catch statement should try to close fos instead? Similarly for the load() method; at line 280/281 there is the code: } catch (IOException e) { if (ois != null) { However, ois is the last object created by the try clause, so must be null. Probably the code should check and close bis and/or fis. At the end of the load() method, the code says: // Close the input stream if (ois != null) { However, ois cannot be null at that point. Note: these bugs were detected by the Eclipse compiler."	2010-01-30 16:53:02	1264890000	resolved fixed	6f48cde	1265580000	java/org/apache/catalina/session/FileStore.java java/org/apache/catalina/session/StandardManager.java	1:java/org/apache/catalina/session/FileStore.java 3:java/org/apache/catalina/session/StandardManager.java
715	48678	Bug 48678 org.apache.catalina.startup.Catalina incorrectly duplicates super class member		2010-02-04 00:09:04	1265260000	resolved fixed	067e0ba	1265490000	java/org/apache/catalina/startup/Catalina.java	2:java/org/apache/catalina/startup/Catalina.java
716	48551	Bug 48551 StringCache: Use entrySet() rather than keySet() + get()		2010-01-14 19:23:43	1263520000	resolved fixed	c85e791	1265130000	java/org/apache/catalina/deploy/WebXml.java java/org/apache/tomcat/util/buf/StringCache.java	1:java/org/apache/tomcat/util/buf/StringCache.java 83:java/org/apache/catalina/deploy/WebXml.java
717	48653	"Bug 48653 RemoteIpValve : request.secure and request.scheme are not forced to ""false"" and ""http"" if X-Forwarded-Proto=http"		2010-02-01 09:26:02	1265030000	resolved fixed	1789bd8	1265120000	java/org/apache/catalina/valves/RemoteIpValve.java test/org/apache/catalina/valves/TestRemoteIpValve.java	1:java/org/apache/catalina/valves/RemoteIpValve.java 2:test/org/apache/catalina/valves/TestRemoteIpValve.java
718	48647	"Bug 48647 RemoteIpFilter : request.secure and request.scheme are not forced to ""false"" and ""http"" if X-Forwarded-Proto=http"		2010-01-31 16:28:21	1264970000	resolved fixed	7aa1206	1265120000	java/org/apache/catalina/filters/RemoteIpFilter.java	1:java/org/apache/catalina/filters/RemoteIpFilter.java
719	48645	"Bug 48645 RequestUtil.URLDecode(byte[] bytes, String enc)"	"the enc is not used in the implementation public static String URLDecode(byte[] bytes, String enc) { return URLDecode(bytes, null, false); }"	2010-01-31 04:36:17	1264930000	resolved fixed	d0f9da2	1264940000	java/org/apache/catalina/util/RequestUtil.java	1:java/org/apache/catalina/util/RequestUtil.java
720	48516	Bug 48516 NullPointerException in JNDIRealm		2010-01-11 05:42:00	1263210000	resolved fixed	62d29b6	1263340000	java/org/apache/catalina/realm/JNDIRealm.java	1:java/org/apache/catalina/realm/JNDIRealm.java
721	48004	"Bug 48004 setHeader() does not replace the previous value for a ""Server"""		2009-10-15 11:16:16	1255620000	resolved fixed	13daf69	1263330000	java/org/apache/coyote/http11/Http11AprProcessor.java java/org/apache/coyote/http11/Http11NioProcessor.java java/org/apache/coyote/http11/Http11Processor.java	16:java/org/apache/coyote/http11/Http11AprProcessor.java 32:java/org/apache/coyote/http11/Http11Processor.java 71:java/org/apache/coyote/http11/Http11NioProcessor.java
722	48421	"Bug 48421 JULI webapp logging files will not closed when webapp is stopped,reloaded or undeployed"	"In Tomcat 6 the JULI logging files which are (can be) declared in webapp/WEB-INF/classes/logging.properties will not closed, when the webapp is reloaded, stopped or even undeployed. The files will at last be closed, when tomcat is shut down or restarted. This is also true for the normally used Handler org.apache.juli.FileHandler, which opens a new File every day and closes the old. On windows this has following effects: A) If the webapp is undeployed the files which are open at this moment are locked and cannot be deleted until tomcat is (someday) stopped or restarted. B) If the webapp is reloaded the file is opened a second time. So the file has two open handles. The next day the FileHandler closes one handle but the file is kept locked through the other handle and cannot be deleted. Every time a webapp is reloaded the associated logfile is opened again (but not closed). This has the consequence that after reloading webapps a few times tomcat must be restarted from time to time. When tomcat is shutdown the unnecessary (and other) open files are closed and will get the shutdown time as modification time. That means any old log files will receive a current modification time, which is irritating. Steps to verify on windows: (for example: undeploy) 1. create in the examples webapp: of tomcat 6.0.20: examples/WEB-INF/classes/logging.properties: handlers = org.apache.juli.FileHandler org.apache.juli.FileHandler.level = FINE org.apache.juli.FileHandler.directory = ${catalina.base}/logs org.apache.juli.FileHandler.prefix = servlet-examples. 2. start tomcat 3. undeploy examples using manager Actual Results: file ${catalina.base}/logs/servlet-examples.<date>.log cannot be deleted (nor at the next day) Expected: file ${catalina.base}/logs/servlet-examples.<date>.log can be deleted very cumbersome Workaround (working for reload): The getHead method of a custom Formatter is extended to track the handlers along with the classloader and webapp. If for a webapp a different (i.e. new) classloader is detected the close method of the handlers assigned to the old classloader is called. So the assigned file is proper closed (and the Formatter.getTail result is appended) I have set severity at minor because tomcat can be used (without webapp logging). But it is a bug because with this logging the same logfile can be useless multiple open (as described above), which should be considered as buggy."	2009-12-20 14:45:51	1261340000	resolved fixed	eeb017a	1263320000	java/org/apache/juli/ClassLoaderLogManager.java java/org/apache/juli/logging/LogFactory.java	94:java/org/apache/juli/ClassLoaderLogManager.java 261:java/org/apache/juli/logging/LogFactory.java
723	48523	Bug 48523 Duplicate property keys in various files	"There are some properties files with non-unique property keys; normally these should be unique. File: java\org\apache\catalina\realm\LocalStrings.properties Duplicate key: 'jaasRealm.userPrincipalSuccess' jaasRealm.userPrincipalSuccess=Principal ""{0}"" is a valid user class. We will use this as the user Principal. jaasRealm.userPrincipalSuccess=Subject for username ""{0}"" returned user Principal ""{1}"" Duplicate key: 'jaasRealm.userPrincipalFailure' jaasRealm.userPrincipalFailure=No valid user Principal found jaasRealm.userPrincipalFailure=Subject for username ""{0}"" did not return a valid user Principal File: java\org\apache\catalina\realm\LocalStrings_es.properties Duplicate key: 'jaasRealm.userPrincipalSuccess' jaasRealm.userPrincipalSuccess = El Principal ""{0}"" es una clase v\u00E1lida de usuario. La vamos a usar como usuario Principal. jaasRealm.userPrincipalSuccess = El asunto para el nombre de usuario ""{0}"" devolvi\u00F3 usuario Principal ""{1}"" Duplicate key: 'jaasRealm.userPrincipalFailure' jaasRealm.userPrincipalFailure = No se ha hallado usuario Principal jaasRealm.userPrincipalFailure = El asunto para el nombre de usuario ""{0}"" no devolvi\u00F3 un usuario Principal v\u00E1lido File: java\org\apache\catalina\startup\LocalStrings.properties Duplicate key: 'contextConfig.jndiUrl' contextConfig.jndiUrl=The connection created for URL [{0}] was not a DirContextURLConnection contextConfig.jndiUrl=Unable to process JNDI URL [{0}] for annotations Duplicate key: 'webXml.mergeConflictFilter' webXml.mergeConflictFilter=The Servlet [{0}] was defined inconsistently in multiple fragments including fragment with name [{1}] located at [{2}] webXml.mergeConflictFilter=The Filter [{0}] was defined inconsistently in multiple fragments including fragment with name [{1}] located at [{2}] File: java\org\apache\jasper\resources\LocalStrings.properties Duplicate key: 'jsp.error.page.invalid.buffer' jsp.error.page.invalid.buffer=Page directive: invalid value for buffer jsp.error.page.invalid.buffer=Page directive: invalid buffer size Duplicate key: 'jsp.error.xml.invalidHighSurrogate' jsp.error.xml.invalidHighSurrogate = High surrogate bits in UTF-8 sequence must not exceed 0x10 but found 0x{0}. jsp.error.xml.invalidHighSurrogate = High surrogate bits in UTF-8 sequence must not exceed 0x10 but found 0x{0}. File: java\org\apache\jasper\resources\LocalStrings_es.properties Duplicate key: 'jsp.error.page.invalid.buffer' jsp.error.page.invalid.buffer = Directiva Page\: valor incorrecto para b\u00FAfer jsp.error.page.invalid.buffer = Directiva Page\: valor incorrecto para buffer Duplicate key: 'jsp.error.xml.invalidHighSurrogate' jsp.error.xml.invalidHighSurrogate = Los bits de surrogaci\u00F3n alta en secuencai UTF-8 no deben de exceder 0x10 pero se hall\u00F3 0x{0}. jsp.error.xml.invalidHighSurrogate = Surrogaci\u00F3n Alta de bits en secuencia UTF-8 no debe de exceder 0x10, pero se hall\u00F3 0x{0}. File: java\org\apache\jasper\resources\LocalStrings_ja.properties Duplicate key: 'jsp.error.page.invalid.buffer' jsp.error.page.invalid.buffer=page\u6307\u793a\u5b50: buffer\u5c5e\u6027\u306e\u5024\u304c\u7121\u52b9\u3067\u3059 jsp.error.page.invalid.buffer=page\u6307\u793a\u5b50: \u7121\u52b9\u306a\u30d0\u30c3\u30d5\u30a1\u30b5\u30a4\u30ba\u3067\u3059 Duplicate key: 'jsp.error.xml.invalidHighSurrogate' jsp.error.xml.invalidHighSurrogate = UTF-8\u30b7\u30fc\u30b1\u30f3\u30b9\u306e\u30cf\u30a4\u30b5\u30ed\u30b2\u30fc\u30c8\u30d3\u30c3\u30c8\u306f0x10\u3092\u8d8a\u3048\u3066\u306f\u3044\u3051\u307e\u305b\u3093\u304c\u30010x{0}\u304c\u898b\u3064\u304b\u308a\u307e\u3057\u305f jsp.error.xml.invalidHighSurrogate = UTF-8\u30b7\u30fc\u30b1\u30f3\u30b9\u306e\u30cf\u30a4\u30b5\u30ed\u30b2\u30fc\u30c8\u30d3\u30c3\u30c8\u306f0x10\u3092\u8d8a\u3048\u3066\u306f\u3044\u3051\u307e\u305b\u3093\u304c\u30010x{0}\u304c\u898b\u3064\u304b\u308a\u307e\u3057\u305f File: java\org\apache\tomcat\util\net\res\LocalStrings.properties Duplicate key: 'endpoint.poll.fail' endpoint.poll.fail=Socket [{0}] poll event: [{1}] {2} endpoint.poll.fail=Critical poller failure (restarting poller): [{0}] {1} File: java\org\apache\tomcat\util\net\res\LocalStrings_es.properties Duplicate key: 'endpoint.poll.fail' endpoint.poll.fail = Conector [{0}] evento de encuesta\: [{1}] {2} endpoint.poll.fail = Fallo cr\u00EDtico de encuestador (reiniciando encuestador)\: [{0}] {1} File: java\org\apache\tomcat\util\net\res\LocalStrings.properties Duplicate key: 'endpoint.poll.fail' endpoint.poll.fail=Socket [{0}] poll event: [{1}] {2} endpoint.poll.fail=Critical poller failure (restarting poller): [{0}] {1} File: java\org\apache\tomcat\util\net\res\LocalStrings_es.properties Duplicate key: 'endpoint.poll.fail' endpoint.poll.fail = Conector [{0}] evento de encuesta\: [{1}] {2} endpoint.poll.fail = Fallo cr\u00EDtico de encuestador (reiniciando encuestador)\: [{0}] {1}"	2010-01-11 12:45:44	1263230000	resolved fixed	f2eea0c	1263290000	java/org/apache/catalina/startup/ContextConfig.java	4:java/org/apache/catalina/startup/ContextConfig.java
724	48517	"Bug 48517 @SuppressWarnings(""unchecked"") - document and reduce scope"		2010-01-11 07:49:28	1263210000	resolved fixed	4df1957	1263290000	java/javax/el/BeanELResolver.java java/javax/el/ELContext.java java/javax/el/ResourceBundleELResolver.java java/org/apache/catalina/loader/WebappClassLoader.java java/org/apache/el/lang/ELSupport.java java/org/apache/el/lang/EvaluationContext.java java/org/apache/el/parser/AstIdentifier.java java/org/apache/el/parser/AstValue.java java/org/apache/el/parser/SimpleNode.java java/org/apache/naming/resources/VirtualDirContext.java	1:java/javax/el/ELContext.java 2:java/org/apache/el/lang/EvaluationContext.java 4:java/org/apache/el/parser/SimpleNode.java 11:java/org/apache/el/parser/AstIdentifier.java 12:java/org/apache/naming/resources/VirtualDirContext.java 14:java/org/apache/el/parser/AstValue.java 19:java/org/apache/catalina/loader/WebappClassLoader.java 37:java/javax/el/ResourceBundleELResolver.java 44:java/org/apache/el/lang/ELSupport.java 97:java/javax/el/BeanELResolver.java
725	48112	Bug 48112 Closing curly brace in literal string incorrectly treated as expression terminator.	"On tomcat 6.0.20 something like the following line in a JSP causes a exception: <c:out value=""${fn:trim('{world}')}""/> After removing the closing curly brace from the literal ('{world}' -> '{world') the JSP works. This behaviour seems specific to 6.0.20, as on 6.0.18 and 6.0.16 the line above works fine. Example of exception: ===================== org.apache.jasper.JasperException: An exception occurred processing JSP page /test.jsp at line 11 8: <meta http-equiv=""Content-Type"" content=""text/html; charset=UTF-8""> 9: </head> 10: <body> 11: <c:out value=""${fn:trim('{world}')}""/> 12: </body> 13: </html> Stacktrace: org.apache.jasper.servlet.JspServletWrapper.handleJspException(JspServletWrapper.java:505) org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:416) org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:342) org.apache.jasper.servlet.JspServlet.service(JspServlet.java:267) javax.servlet.http.HttpServlet.service(HttpServlet.java:717) root cause javax.el.ELException: Error Parsing: ${fn:trim('{world} org.apache.el.lang.ExpressionBuilder.createNodeInternal(ExpressionBuilder.java:125) org.apache.el.lang.ExpressionBuilder.build(ExpressionBuilder.java:150) org.apache.el.lang.ExpressionBuilder.createValueExpression(ExpressionBuilder.java:194) org.apache.el.ExpressionFactoryImpl.createValueExpression(ExpressionFactoryImpl.java:68) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate(PageContextImpl.java:934) org.apache.jsp.test_jsp._jspx_meth_c_005fout_005f0(test_jsp.java:98) org.apache.jsp.test_jsp._jspService(test_jsp.java:72) org.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:70) javax.servlet.http.HttpServlet.service(HttpServlet.java:717) org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:374) org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:342) org.apache.jasper.servlet.JspServlet.service(JspServlet.java:267) javax.servlet.http.HttpServlet.service(HttpServlet.java:717) root cause org.apache.el.parser.ParseException: Encountered "" <ILLEGAL_CHARACTER> ""\' """" at line 1, column 11. Was expecting one of: <INTEGER_LITERAL> ... <FLOATING_POINT_LITERAL> ... <STRING_LITERAL> ... ""true"" ... ""false"" ... ""null"" ... ""("" ... "")"" ... ""!"" ... ""not"" ... ""empty"" ... ""-"" ... <IDENTIFIER> ... org.apache.el.parser.ELParser.generateParseException(ELParser.java:2142) org.apache.el.parser.ELParser.jj_consume_token(ELParser.java:2024) org.apache.el.parser.ELParser.Function(ELParser.java:1207) org.apache.el.parser.ELParser.NonLiteral(ELParser.java:1114) org.apache.el.parser.ELParser.ValuePrefix(ELParser.java:1016) org.apache.el.parser.ELParser.Value(ELParser.java:965) org.apache.el.parser.ELParser.Unary(ELParser.java:947) org.apache.el.parser.ELParser.Multiplication(ELParser.java:711) org.apache.el.parser.ELParser.Math(ELParser.java:631) org.apache.el.parser.ELParser.Compare(ELParser.java:443) org.apache.el.parser.ELParser.Equality(ELParser.java:337) org.apache.el.parser.ELParser.And(ELParser.java:281) org.apache.el.parser.ELParser.Or(ELParser.java:225) org.apache.el.parser.ELParser.Choice(ELParser.java:182) org.apache.el.parser.ELParser.Expression(ELParser.java:174) org.apache.el.parser.ELParser.DynamicExpression(ELParser.java:146) org.apache.el.parser.ELParser.CompositeExpression(ELParser.java:43) org.apache.el.lang.ExpressionBuilder.createNodeInternal(ExpressionBuilder.java:93) org.apache.el.lang.ExpressionBuilder.build(ExpressionBuilder.java:150) org.apache.el.lang.ExpressionBuilder.createValueExpression(ExpressionBuilder.java:194) org.apache.el.ExpressionFactoryImpl.createValueExpression(ExpressionFactoryImpl.java:68) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate(PageContextImpl.java:934) org.apache.jsp.test_jsp._jspx_meth_c_005fout_005f0(test_jsp.java:98) org.apache.jsp.test_jsp._jspService(test_jsp.java:72) org.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:70) javax.servlet.http.HttpServlet.service(HttpServlet.java:717) org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:374) org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:342) org.apache.jasper.servlet.JspServlet.service(JspServlet.java:267) javax.servlet.http.HttpServlet.service(HttpServlet.java:717)"	2009-11-03 07:09:58	1257250000	resolved fixed	11810fb	1262800000	test/org/apache/el/TestELEvaluation.java	28:test/org/apache/el/TestELEvaluation.java
726	48424	Bug 48424 Keep same logic for creating the objectnames for connector mbeans	"Currently, for connector MBeans, they are registered and unregistered by Connector classes themselves. But in the ServerLifecycle and MBeanUtils, there are also codes for unregistering the connector MBeans. Suppose it is used for double check ? The question is that the codes for creating connector object name are not same, in the MBeanUtils, it always assume that address property is of String type, sometimes that a ClassCastException would be thrown."	2009-12-20 23:29:35	1261370000	resolved fixed	da5f249	1262720000	java/org/apache/catalina/connector/Connector.java java/org/apache/catalina/mbeans/MBeanUtils.java	8:java/org/apache/catalina/mbeans/MBeanUtils.java 9:java/org/apache/catalina/connector/Connector.java
727	48006	Bug 48006 Implement the header X-Powered-By suggested by the servlet specification		2009-10-15 11:34:52	1255620000	resolved fixed	3d309a5	1262260000	java/org/apache/catalina/connector/CoyoteAdapter.java	20:java/org/apache/catalina/connector/CoyoteAdapter.java
728	43819	"Bug 43819 Support latest JSR245 proposal to make EL ""self-contained"""		2007-11-08 14:48:53	1194550000	resolved fixed	9a2ae02	1262210000	java/javax/el/ExpressionFactory.java java/org/apache/jasper/compiler/JspUtil.java java/org/apache/jasper/compiler/PageInfo.java java/org/apache/jasper/compiler/Validator.java java/org/apache/jasper/runtime/JspApplicationContextImpl.java	60:java/org/apache/jasper/compiler/Validator.java 86:java/org/apache/jasper/compiler/JspUtil.java 109:java/org/apache/jasper/compiler/PageInfo.java 616:java/org/apache/jasper/runtime/JspApplicationContextImpl.java
729	48345	Bug 48345 Session does time-out shorter than setting in web.xml when PersistentManager is used.	"I am encountering the problem that Session does time-out shorter than setting in web.xml. This is a simple scenario where the problem occurs. I am using PersistentManager by the following configuration. <Context> <Manager className=""org.apache.catalina.session.PersistentManager"" maxIdleSwap=""120""> <Store className=""org.apache.catalina.session.FileStore""/> </Manager> </Context> I am setting the session-timeout at five minutes. <session-config> <session-timeout>5</session-timeout> </session-config> [scenario] 1. Create Session. 2. 120 seconds pass. Session does swapOut. 3. In addition, 120 seconds pass. Get Session. Session does swapIn and access time of session in the memory is updated. 4. In addition, 90 seconds pass. Get Session. Because the access time of the session has been updated in (3), The session should be able to be acquired. However, the session can not be acquired. This cause is StoreBase#processExpires invoked between (3) and (4). StoreBase#processExpire deletes the session saved in Store. StoreBase#processExpires is as follows. =====StoreBase#processExpires===== public void processExpires() { ... for (int i = 0; i < keys.length; i++) { try { StandardSession session = (StandardSession) load(keys[i]); if (session == null) { continue; } if (session.isValid()) { continue; } ... if ( ( (PersistentManagerBase) manager).isLoaded( keys[i] )) { // recycle old backup session session.recycle(); } else { // expire swapped out session session.expire(); } remove(session.getIdInternal()); } catch (Exception e) { ... } } } ====== The session saved in Store is loaded, and StandardSession#isValid() is executed. StandardSession#expire(true) is invoked for the session that passes session time-out in ""StandardSession#isValid()"". StandardSession#expire(true) invokes Manager#remove(Session). As a result, the session is deleted from the session map. In a word, session in memory is deleted by invalidating old session in Store. As a result, session does time-out shorter than setting in web.xml I made a patch against trunk. Best regards."	2009-12-07 02:09:14	1260170000	resolved fixed	d939925	1262170000	java/org/apache/catalina/session/StoreBase.java	1:java/org/apache/catalina/session/StoreBase.java
730	48454	"Bug 48454 ""Bad file descriptor""-IOException in CGIServlet for some programs"		2009-12-29 02:46:52	1262070000	resolved fixed	ae6c3c4	1262170000	java/org/apache/catalina/servlets/CGIServlet.java	1:java/org/apache/catalina/servlets/CGIServlet.java
731	48443	"Bug 48443 when the context path is empty,tomcat will startup with a FileNotFoundException"		2009-12-24 22:34:44	1261710000	resolved fixed	ff22e4a	1262170000	java/org/apache/naming/resources/DirContextURLConnection.java	5:java/org/apache/naming/resources/DirContextURLConnection.java
732	48399	Bug 48399 Lock fields should be final		2009-12-16 19:20:55	1261010000	resolved fixed	e1d1476	1261280000	java/org/apache/catalina/ha/session/DeltaSession.java java/org/apache/catalina/tribes/group/interceptors/OrderInterceptor.java modules/jdbc-pool/java/org/apache/tomcat/jdbc/pool/MultiLockFairBlockingQueue.java	6:java/org/apache/catalina/ha/session/DeltaSession.java 13:modules/jdbc-pool/java/org/apache/tomcat/jdbc/pool/MultiLockFairBlockingQueue.java 53:java/org/apache/catalina/tribes/group/interceptors/OrderInterceptor.java
733	47930	"Bug 47930 PersistentManager (using filestore) can return different session objects linked to the same session ID, when Tomcat is restarted"		2009-10-01 22:42:57	1254450000	resolved fixed	d9f2c99	1261160000	java/org/apache/catalina/session/PersistentManagerBase.java	6:java/org/apache/catalina/session/PersistentManagerBase.java
734	48387	Bug 48387 Make RemoteIpFilter parameters consistent with RemoteIpValve		2009-12-14 10:28:40	1260800000	resolved fixed	803d64d	1260830000	java/org/apache/catalina/filters/RemoteIpFilter.java	1:java/org/apache/catalina/filters/RemoteIpFilter.java
735	47744	Bug 47744 Memory leak when using SSL + Java security manager		2009-08-26 11:01:57	1251300000	resolved fixed	51d5511	1260800000	java/org/apache/tomcat/util/net/jsse/JSSESupport.java	142:java/org/apache/tomcat/util/net/jsse/JSSESupport.java
736	47537	Bug 47537 Empty response when forward to login page fails	"When tomcat receives a POST request on a session that has timedout, it will forward to the form based login page (form-login-page). If this forward fails for some reason (an error in the login page for instance), tomcat will return an empty HTTP response, without any error code. The tomcat log says ""Unexpected error forwarding to login page"" and contains the detailed stacktrace, but i would expect the error to show up in the browser as well (at least a 500 status)"	2009-07-15 10:06:41	1247670000	resolved fixed	88b5d4b	1260540000	java/org/apache/catalina/authenticator/FormAuthenticator.java	2:java/org/apache/catalina/authenticator/FormAuthenticator.java
737	48373	Bug 48373 Can not get clients from TomcatBayeux	"When call the getClients method,there will be a Exception: java.lang.ArrayStoreException: java.util.HashMap$Entry maybe this method should be: public List<Client> getClients() { return java.util.Arrays.asList(clients.values().toArray(new Client[0])); } instead of this: public List<Client> getClients() { return java.util.Arrays.asList(clients.entrySet().toArray(new Client[0])); }"	2009-12-11 00:22:52	1260510000	resolved fixed	b09d817	1260530000	modules/bayeux/java/org/apache/tomcat/bayeux/TomcatBayeux.java	1:modules/bayeux/java/org/apache/tomcat/bayeux/TomcatBayeux.java
738	48370	Bug 48370 PublishRequest.java can not be compiled	"There is a log used in org.apache.tomcat.bayeux.request.PublishRequest,but it was not be defined,so the class can not be complied successfully,there should be something like this? private static final Log log = LogFactory.getLog(PublishRequest.class);"	2009-12-10 17:24:23	1260480000	resolved fixed	9be399f	1260530000	modules/bayeux/java/org/apache/tomcat/bayeux/request/PublishRequest.java	1:modules/bayeux/java/org/apache/tomcat/bayeux/request/PublishRequest.java
739	48324	Bug 48324 Javadoc fixes for connector.Request.java		2009-12-01 16:02:13	1259700000	resolved fixed	549a5d5	1260460000	java/org/apache/catalina/connector/Request.java	1:java/org/apache/catalina/connector/Request.java
740	47502	Bug 47502 clustering fails on serializing javax.security.auth.subject	"Clustering fails on serializing javax.security.auth.subject. See stack below. I looked a little into the Tomcat code. In ./java/org/apache/catalina/connector/Request.java on line 1752 Tomcat puts the 'javax.security.auth.subject' on the session if you use a securitymanager. This is the MemoryUser in my case I think. I must use the securitymanager because I use RMI. Is there a solution possible by making the MemoryUser serializable or by not putting it in the session as an attribute. Mark Thomas <markt_at_apache_dot_org> suggested a note on the session at the Tomcat user-mailinglist. I've never seen notes on sessions. The MemoryUser comes from the security-constraint in my web.xml. Jul 8, 2009 5:53:52 PM org.apache.catalina.ha.session.DeltaSession writeObject SEVERE: Cannot serialize session attribute javax.security.auth.subject for session 9C533E0EB4A79ED5B206B8F5A5DB09AD java.io.NotSerializableException: org.apache.catalina.users.MemoryUser at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1156) at java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:326) at java.util.LinkedList.writeObject(LinkedList.java:943) at sun.reflect.GeneratedMethodAccessor216.invoke(Unknown Source) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at java.lang.reflect.Method.invoke(Method.java:597) at java.io.ObjectStreamClass.invokeWriteObject(ObjectStreamClass.java:945) at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1461) at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1392) at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1150) at java.io.ObjectOutputStream.access$300(ObjectOutputStream.java:143) at java.io.ObjectOutputStream$PutFieldImpl.writeFields(ObjectOutputStream.java:1668) at java.io.ObjectOutputStream.writeFields(ObjectOutputStream.java:454) at javax.security.auth.Subject$SecureSet.writeObject(Subject.java:1281) at sun.reflect.GeneratedMethodAccessor215.invoke(Unknown Source) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at java.lang.reflect.Method.invoke(Method.java:597) at java.io.ObjectStreamClass.invokeWriteObject(ObjectStreamClass.java:945) at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1461) at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1392) at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1150) at java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1509) at java.io.ObjectOutputStream.defaultWriteObject(ObjectOutputStream.java:416) at java.util.Collections$SynchronizedCollection.writeObject(Collections.java:1602) at sun.reflect.GeneratedMethodAccessor214.invoke(Unknown Source) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at java.lang.reflect.Method.invoke(Method.java:597) at java.io.ObjectStreamClass.invokeWriteObject(ObjectStreamClass.java:945) at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1461) at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1392) at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1150) at java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1509) at java.io.ObjectOutputStream.defaultWriteObject(ObjectOutputStream.java:416) at javax.security.auth.Subject.writeObject(Subject.java:919) at sun.reflect.GeneratedMethodAccessor213.invoke(Unknown Source) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at java.lang.reflect.Method.invoke(Method.java:597) at java.io.ObjectStreamClass.invokeWriteObject(ObjectStreamClass.java:945) at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1461) at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1392) at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1150) at java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:326) at org.apache.catalina.ha.session.DeltaSession.writeObject(DeltaSession.java:714) at org.apache.catalina.ha.session.DeltaSession.writeObjectData(DeltaSession.java:475) at org.apache.catalina.ha.session.DeltaSession.writeObjectData(DeltaSession.java:472) at org.apache.catalina.ha.session.DeltaManager.serializeSessions(DeltaManager.java:733) at org.apache.catalina.ha.session.DeltaManager.sendSessions(DeltaManager.java:1513) at org.apache.catalina.ha.session.DeltaManager.handleGET_ALL_SESSIONS(DeltaManager.java:1479) at org.apache.catalina.ha.session.DeltaManager.messageReceived(DeltaManager.java:1310) at org.apache.catalina.ha.session.DeltaManager.messageDataReceived(DeltaManager.java:1093) at org.apache.catalina.ha.session.ClusterSessionListener.messageReceived(ClusterSessionListener.java:87) at org.apache.catalina.ha.tcp.SimpleTcpCluster.messageReceived(SimpleTcpCluster.java:901) at org.apache.catalina.ha.tcp.SimpleTcpCluster.messageReceived(SimpleTcpCluster.java:882) at org.apache.catalina.tribes.group.GroupChannel.messageReceived(GroupChannel.java:269) at org.apache.catalina.tribes.group.ChannelInterceptorBase.messageReceived(ChannelInterceptorBase.java:79) at org.apache.catalina.tribes.group.ChannelInterceptorBase.messageReceived(ChannelInterceptorBase.java:79) at org.apache.catalina.tribes.group.interceptors.TcpFailureDetector.messageReceived(TcpFailureDetector.java:110) at org.apache.catalina.tribes.group.ChannelInterceptorBase.messageReceived(ChannelInterceptorBase.java:79) at org.apache.catalina.tribes.group.ChannelCoordinator.messageReceived(ChannelCoordinator.java:241) at org.apache.catalina.tribes.transport.ReceiverBase.messageDataReceived(ReceiverBase.java:225) at org.apache.catalina.tribes.transport.nio.NioReplicationTask.drainChannel(NioReplicationTask.java:188) at org.apache.catalina.tribes.transport.nio.NioReplicationTask.run(NioReplicationTask.java:91) at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908) at java.lang.Thread.run(Thread.java:619)"	2009-07-09 05:57:29	1247130000	resolved fixed	806200c	1259710000	java/org/apache/catalina/ha/session/DeltaSession.java	1:java/org/apache/catalina/ha/session/DeltaSession.java
741	48296	Bug 48296 Generics fixes		2009-11-28 07:42:38	1259410000	resolved fixed	ed40c2c	1259710000	java/org/apache/catalina/ant/jmx/JMXAccessorTask.java java/org/apache/catalina/tribes/membership/Membership.java java/org/apache/naming/resources/DirContextURLConnection.java	309:java/org/apache/naming/resources/DirContextURLConnection.java 437:java/org/apache/catalina/tribes/membership/Membership.java
742	47342	Bug 47342 ReplicatedContext#start throws NullPointerException.		2009-06-10 02:48:24	1244620000	resolved fixed	9afe6ce	1259360000	java/org/apache/catalina/ha/context/ReplicatedContext.java	1:java/org/apache/catalina/ha/context/ReplicatedContext.java
743	48289	Bug 48289 ElSupport - Javadoc and generics fixes		2009-11-25 16:35:49	1259180000	resolved fixed	b8599a3	1259350000	java/org/apache/el/lang/ELSupport.java test/org/apache/el/TestELEvaluation.java	1:java/org/apache/el/lang/ELSupport.java
744	48288	Bug 48288 Patch to fix generics in javax.el package helpers		2009-11-25 15:43:06	1259180000	resolved fixed	2ac1900	1259350000	java/org/apache/el/lang/EvaluationContext.java java/org/apache/jasper/el/ELContextWrapper.java	380:java/org/apache/el/lang/EvaluationContext.java
745	48287	Bug 48287 ApplicationContextFacade - generics fixes		2009-11-25 15:36:20	1259180000	resolved fixed	ce8d1c5	1259350000	java/org/apache/catalina/core/ApplicationContextFacade.java	1:java/org/apache/catalina/core/ApplicationContextFacade.java
746	48285	Bug 48285 ApplicationFilterFactory.matchDispatcher() fails to check ASYNC	"catalina.core.ApplicationFilterFactory.matchDispatcher(FilterMap filterMap, DispatcherType type) fails to check for type == ASYNC The extra case ought to be added (but I don't know what it should contain, so cannot provide a patch)"	2009-11-25 08:41:12	1259160000	resolved fixed	f0a0aec	1259340000	java/org/apache/catalina/core/ApplicationFilterFactory.java java/org/apache/catalina/deploy/FilterMap.java	1:java/org/apache/catalina/core/ApplicationFilterFactory.java 13:java/org/apache/catalina/deploy/FilterMap.java
747	48282	Bug 48282 Possible NPE in org.apache.tomcat.util.modeler.Registry		2009-11-25 07:42:40	1259150000	resolved fixed	56897be	1259340000	java/org/apache/tomcat/util/modeler/Registry.java	1:java/org/apache/tomcat/util/modeler/Registry.java
748	48267	Bug 48267 Patch to fix generics in javax packages		2009-11-23 13:22:35	1259000000	resolved fixed	632e68c	1259340000	java/javax/annotation/Resource.java java/javax/ejb/EJB.java java/javax/el/BeanELResolver.java java/javax/el/ELContext.java java/javax/el/ListELResolver.java java/javax/el/MapELResolver.java java/javax/el/ResourceBundleELResolver.java java/javax/xml/ws/WebServiceRef.java	
749	48266	Bug 48266 Patch to fix generics in catalina		2009-11-23 13:21:28	1259000000	resolved fixed	21cd308	1259110000	java/org/apache/catalina/ant/jmx/JMXAccessorTask.java java/org/apache/catalina/connector/Request.java java/org/apache/catalina/core/StandardPart.java java/org/apache/catalina/ha/backend/CollectedInfo.java java/org/apache/catalina/ha/session/BackupManager.java java/org/apache/catalina/ha/tcp/ReplicationValve.java java/org/apache/catalina/tribes/tipis/AbstractReplicatedMap.java java/org/apache/catalina/tribes/transport/bio/MultipointBioSender.java	20:java/org/apache/catalina/connector/Request.java 66:java/org/apache/catalina/ha/tcp/ReplicationValve.java 69:java/org/apache/catalina/tribes/tipis/AbstractReplicatedMap.java 263:java/org/apache/catalina/ha/session/BackupManager.java
750	47836	Bug 47836 TldConfig keeps an internal list of ApplicationListeners		2009-09-14 07:03:43	1252930000	resolved fixed	92e53f3	1259030000	java/org/apache/catalina/core/StandardContext.java java/org/apache/catalina/startup/TldConfig.java	1:java/org/apache/catalina/startup/TldConfig.java 2:java/org/apache/catalina/core/StandardContext.java
751	48239	Bug 48239 HexUtils exposes public array		2009-11-19 07:48:12	1258630000	resolved fixed	55e5052	1258940000	java/org/apache/coyote/ajp/AjpAprProcessor.java java/org/apache/coyote/ajp/AjpProcessor.java java/org/apache/coyote/http11/Http11AprProcessor.java java/org/apache/coyote/http11/Http11NioProcessor.java java/org/apache/coyote/http11/Http11Processor.java java/org/apache/coyote/http11/filters/ChunkedInputFilter.java java/org/apache/coyote/http11/filters/ChunkedOutputFilter.java java/org/apache/tomcat/util/buf/HexUtils.java java/org/apache/tomcat/util/buf/MessageBytes.java	1:java/org/apache/tomcat/util/buf/HexUtils.java 3:java/org/apache/coyote/http11/Http11Processor.java 5:java/org/apache/coyote/http11/Http11AprProcessor.java 6:java/org/apache/coyote/http11/Http11NioProcessor.java 7:java/org/apache/coyote/http11/filters/ChunkedOutputFilter.java 12:java/org/apache/coyote/http11/filters/ChunkedInputFilter.java 13:java/org/apache/coyote/ajp/AjpAprProcessor.java 14:java/org/apache/tomcat/util/buf/MessageBytes.java 19:java/org/apache/coyote/ajp/AjpProcessor.java
752	48248	Bug 48248 tribes.group.interceptors.MessageDispatchInterceptor.run should be volatile	"org.apache.catalina.tribes.group.interceptors.MessageDispatchInterceptor.run should be volatile, as it is used to communicate between running threads."	2009-11-20 04:56:14	1258710000	resolved fixed	a524187	1258940000	java/org/apache/catalina/tribes/group/GroupChannel.java java/org/apache/catalina/tribes/group/interceptors/MessageDispatchInterceptor.java java/org/apache/catalina/tribes/group/interceptors/TcpPingInterceptor.java java/org/apache/catalina/tribes/membership/McastServiceImpl.java	1:java/org/apache/catalina/tribes/group/interceptors/MessageDispatchInterceptor.java 2:java/org/apache/catalina/tribes/group/GroupChannel.java 19:java/org/apache/catalina/tribes/membership/McastServiceImpl.java 41:java/org/apache/catalina/tribes/group/interceptors/TcpPingInterceptor.java
753	48249	Bug 48249 org.apache.tomcat.util.net.NioBlockingSelector.BlockPoller.run <= volatile	"org.apache.tomcat.util.net.NioBlockingSelector.BlockPoller.run should be volatile, as it is used to communicate between running threads."	2009-11-20 05:06:47	1258710000	resolved fixed	c7d7ba2	1258940000	java/org/apache/tomcat/util/net/NioBlockingSelector.java	1:java/org/apache/tomcat/util/net/NioBlockingSelector.java
754	48049	"Bug 48049 org.apache.naming.NamingContext's destroySubcontext() method doesn't invoke itself recursively, but invoke unbind() method"	"Below is the original implementation of destroySubcontext(Name name) method: public void destroySubcontext(Name name) throws NamingException { checkWritable(); while ((!name.isEmpty()) && (name.get(0).length() == 0)) name = name.getSuffix(1); if (name.isEmpty()) throw new NamingException (sm.getString(""namingContext.invalidName"")); NamingEntry entry = (NamingEntry) bindings.get(name.get(0)); if (entry == null) { throw new NameNotFoundException (sm.getString(""namingContext.nameNotBound"", name.get(0))); } if (name.size() > 1) { if (entry.type == NamingEntry.CONTEXT) { ((Context) entry.value).unbind(name.getSuffix(1)); } else { throw new NamingException (sm.getString(""namingContext.contextExpected"")); } } else { if (entry.type == NamingEntry.CONTEXT) { ((Context) entry.value).close(); bindings.remove(name.get(0)); } else { throw new NotContextException (sm.getString(""namingContext.contextExpected"")); } } } However, the method invokes 'unbind' method rather than invokes itself recursively. if (name.size() > 1) { if (entry.type == NamingEntry.CONTEXT) { ((Context) entry.value).unbind(name.getSuffix(1)); } else { throw new NamingException (sm.getString(""namingContext.contextExpected"")); } should be: if (name.size() > 1) { if (entry.type == NamingEntry.CONTEXT) { ((Context) entry.value).destroySubcontext(name.getSuffix(1)); } else { throw new NamingException (sm.getString(""namingContext.contextExpected"")); }"	2009-10-25 07:24:55	1256470000	resolved fixed	af8a612	1258930000	java/org/apache/naming/NamingContext.java	1:java/org/apache/naming/NamingContext.java
755	47799	Bug 47799 Domain does not work in Membership and DomainFilterInterceptor.		2009-09-08 02:39:42	1252390000	resolved fixed	94c643b	1258930000	java/org/apache/catalina/tribes/group/interceptors/DomainFilterInterceptor.java java/org/apache/catalina/tribes/membership/McastService.java	1:java/org/apache/catalina/tribes/group/interceptors/DomainFilterInterceptor.java 24:java/org/apache/catalina/tribes/membership/McastService.java
756	47462	"Bug 47462 The annotation doesn't become effective.(metadata-complete=""false"" is not effective.)"		2009-07-01 02:51:39	1246430000	resolved fixed	04b0838	1258920000	java/org/apache/catalina/startup/WebRuleSet.java	46:java/org/apache/catalina/startup/WebRuleSet.java
757	47997	Bug 47997 NamingContextListener fails to add itself as a PropertyChangeListener to all namingResources		2009-10-14 17:45:53	1255560000	resolved fixed	58162ed	1258920000	java/org/apache/catalina/core/NamingContextListener.java	1:java/org/apache/catalina/core/NamingContextListener.java
758	47718	Bug 47718 ManagerBase leaks fd to /dev/urandom when context stopped	"On operating systems where /dev/urandom exists, org.apache.catalina.session.ManagerBase will use it as a source of data for getRandomBytes(). If you stop a context or undeploy a host, the number of file descriptors that have /dev/urandom open tomcat remains constant. For example, if you use the manager application to stop or undeploy a context, the number of file descriptors to /dev/urandom is the same as before the stop. File descriptor use is determined by using lsof or examining the /proc/<pid>/fd directory on Linux. The same issue is seen if you undeploy a virtual host. If you undeploy/deploy a context, or remove/add a virtual host, the # of file descriptors to /dev/urandom will increase each time. This is because ManagerBase does not close the DataInputStream it holds to /dev/urandom. The patch shown below resolves this issue. Stopping a context, or undeploying a virtual host will close the session manager's reference to /dev/urandom. --- apache-tomcat-5.5.28-src/container/catalina/src/share/org/apache/catalina/session/ManagerBase.java 2009-07-24 13:35:00.000000000 -0600 +++ apache-tomcat-5.5.28-gls/container/catalina/src/share/org/apache/catalina/session/ManagerBase.java 2009-08-20 13:38:03.000000000 -0600 @@ -688,10 +688,17 @@ } public void destroy() { if( oname != null ) Registry.getRegistry(null, null).unregisterComponent(oname); + if (randomIS!=null) { + try { + randomIS.close(); + } catch (IOException ioe) { + } + randomIS=null; + } initialized=false; oname = null; // Don't clear log since it is required in case attributes are changed // (eg via JMX) whilst the manager is stopped. }"	2009-08-20 14:48:26	1250790000	resolved fixed	ae5c640	1258920000	java/org/apache/catalina/session/ManagerBase.java	1:java/org/apache/catalina/session/ManagerBase.java
759	48252	Bug 48252 StackOverflowError in NioEndpoint.setProperty when setting jkHome	"- Noticed only when running in debugger with breakpoint set for StackOverflowError. - The error is translated by Java's reflection mechanism to an InvocationTargetException, which is caught and silently ignored by IntrospectionUtils. - Connector.initialize() sets jkHome property on Http11NioProtocol. - Http11NioProtocol sets jkHome property on NioEndpoint. - NioEndpoint recursively invokes its own setProperty method via IntrospectionUtils.setProperty, causing the stack overflow. - Using embedded Tomcat. - Using Nio connector. Does not happen for standard connector. - Happens in 6.0.18 and 6.0.20; haven't tested with earlier versions."	2009-11-20 08:25:45	1258720000	resolved fixed	c0cb61b	1258740000	java/org/apache/tomcat/util/IntrospectionUtils.java java/org/apache/tomcat/util/net/AbstractEndpoint.java	4:java/org/apache/tomcat/util/net/AbstractEndpoint.java 64:java/org/apache/tomcat/util/IntrospectionUtils.java
760	48234	Bug 48234 org.apache.catalina.core.ContainerBase.getLogger() not thread-safe?	"org.apache.catalina.core.ContainerBase.getLogger() is not synchronised, yet all the other methods which access org.apache.catalina.core.ContainerBase.logger are synch. This seems wrong. org.apache.catalina.core.ContainerBase.logger should probably be private to prevent unsynch. access by subclasses. Similar considerations apply to logName and logName() The Javadoc for getLogger() states that it can return null - that does not appear to be possible. [Not sure if the method ever returns the parent logger either.]"	2009-11-18 17:41:42	1258580000	resolved fixed	c53173b	1258600000	java/org/apache/catalina/core/ContainerBase.java	1:java/org/apache/catalina/core/ContainerBase.java
761	48172	Bug 48172 JspRuntimeContext synch. problems.	"JspRuntimeContext.jspReloadCount is synchronised when updated, but not when read by getJspReloadCount(). If the instance is accessed from multiple threads, then the returned value may not be the current value, it could be arbitrarily stale. If this is acceptable, then the Javadoc should say so; otherwise the getter needs to be synch. (or the field needs to be volatile) Or just use AtomicInteger. == Various other fields are neither final nor synchronized, e.g. classpath codeSource etc. As far as I can tell, these could easily be made final as they are only written by the constructor."	2009-11-11 03:23:50	1257930000	resolved fixed	242b6a3	1258590000	java/org/apache/jasper/compiler/JspRuntimeContext.java	1:java/org/apache/jasper/compiler/JspRuntimeContext.java
762	48197	Bug 48197 XByteBuffer: privatize public fields; fix Javadoc		2009-11-14 06:29:45	1258200000	resolved fixed	a1cb0c3	1258590000	java/org/apache/catalina/tribes/io/XByteBuffer.java	1:java/org/apache/catalina/tribes/io/XByteBuffer.java
763	48230	Bug 48230 Unused imports		2009-11-18 14:00:17	1258570000	resolved fixed	84d49a0	1258590000	java/org/apache/catalina/Authenticator.java java/org/apache/catalina/authenticator/FormAuthenticator.java java/org/apache/tomcat/util/net/NioEndpoint.java modules/jdbc-pool/test/org/apache/tomcat/jdbc/test/TestSuspectTimeout.java	104:java/org/apache/catalina/authenticator/FormAuthenticator.java
764	48217	Bug 48217 Loggers should be final		2009-11-17 16:30:07	1258490000	resolved fixed	0d7263a	1258550000	java/org/apache/coyote/http11/AbstractHttp11Protocol.java java/org/apache/coyote/http11/Http11NioProtocol.java java/org/apache/coyote/http11/Http11Protocol.java	605:java/org/apache/coyote/http11/AbstractHttp11Protocol.java
765	48196	Bug 48196 Public arrays that should be private		2009-11-14 06:28:06	1258200000	resolved fixed	38f52b5	1258500000	java/org/apache/catalina/startup/Tomcat.java java/org/apache/catalina/tribes/group/interceptors/TwoPhaseCommitInterceptor.java java/org/apache/catalina/util/HexUtils.java	212:java/org/apache/catalina/startup/Tomcat.java 225:java/org/apache/catalina/util/HexUtils.java 342:java/org/apache/catalina/tribes/group/interceptors/TwoPhaseCommitInterceptor.java
766	48176	Bug 48176 Fields that should be final		2009-11-11 08:01:28	1257940000	resolved fixed	16c4534	1258500000	java/org/apache/catalina/tribes/io/BufferPool.java java/org/apache/jasper/compiler/ServletWriter.java modules/tomcat-lite/java/org/apache/tomcat/util/http/MimeMap.java	656:java/org/apache/catalina/tribes/io/BufferPool.java
767	48175	Bug 48175 Loggers should be final		2009-11-11 07:37:28	1257940000	resolved fixed	799b934	1258500000	java/org/apache/catalina/core/ApplicationFilterConfig.java java/org/apache/catalina/core/ContainerBase.java java/org/apache/catalina/core/StandardHost.java java/org/apache/catalina/core/StandardWrapper.java java/org/apache/catalina/ha/ClusterListener.java java/org/apache/catalina/ha/context/ReplicatedContext.java java/org/apache/catalina/ha/deploy/FarmWarDeployer.java java/org/apache/catalina/ha/deploy/FileMessageFactory.java java/org/apache/catalina/ha/deploy/WarWatcher.java java/org/apache/catalina/ha/session/BackupManager.java java/org/apache/catalina/ha/session/DeltaManager.java java/org/apache/catalina/ha/session/DeltaRequest.java java/org/apache/catalina/ha/session/DeltaSession.java java/org/apache/catalina/ha/session/JvmRouteBinderValve.java java/org/apache/catalina/ha/session/SerializablePrincipal.java java/org/apache/catalina/ha/session/SimpleTcpReplicationManager.java java/org/apache/catalina/ha/tcp/ReplicationValve.java java/org/apache/catalina/loader/WebappClassLoader.java java/org/apache/catalina/loader/WebappLoader.java java/org/apache/catalina/mbeans/MBeanFactory.java java/org/apache/catalina/security/SecurityConfig.java java/org/apache/catalina/security/SecurityUtil.java java/org/apache/catalina/startup/Catalina.java java/org/apache/catalina/startup/CatalinaProperties.java java/org/apache/catalina/startup/ContextConfig.java java/org/apache/catalina/startup/DefaultJarScanner.java java/org/apache/catalina/startup/DigesterFactory.java java/org/apache/catalina/startup/EngineConfig.java java/org/apache/catalina/startup/HostConfig.java java/org/apache/catalina/startup/TldConfig.java java/org/apache/catalina/startup/UserConfig.java java/org/apache/catalina/startup/WebXml.java java/org/apache/catalina/tribes/group/ChannelInterceptorBase.java java/org/apache/catalina/tribes/group/GroupChannel.java java/org/apache/catalina/tribes/group/RpcChannel.java java/org/apache/catalina/tribes/group/interceptors/FragmentationInterceptor.java java/org/apache/catalina/tribes/group/interceptors/MessageDispatchInterceptor.java java/org/apache/catalina/tribes/group/interceptors/TcpFailureDetector.java java/org/apache/catalina/tribes/group/interceptors/TcpPingInterceptor.java java/org/apache/catalina/tribes/group/interceptors/ThroughputInterceptor.java java/org/apache/catalina/tribes/group/interceptors/TwoPhaseCommitInterceptor.java java/org/apache/catalina/tribes/io/ObjectReader.java java/org/apache/catalina/tribes/io/XByteBuffer.java java/org/apache/catalina/tribes/membership/McastService.java java/org/apache/catalina/tribes/membership/McastServiceImpl.java java/org/apache/catalina/tribes/tipis/LazyReplicatedMap.java java/org/apache/catalina/tribes/tipis/ReplicatedMap.java java/org/apache/catalina/tribes/transport/bio/BioReceiver.java java/org/apache/catalina/tribes/transport/bio/BioReplicationTask.java java/org/apache/catalina/tribes/transport/bio/BioSender.java java/org/apache/catalina/tribes/transport/bio/util/FastQueue.java java/org/apache/catalina/tribes/transport/nio/NioReceiver.java java/org/apache/catalina/tribes/transport/nio/NioReplicationTask.java java/org/apache/catalina/tribes/transport/nio/NioSender.java java/org/apache/catalina/tribes/transport/nio/ParallelNioSender.java java/org/apache/catalina/tribes/util/Logs.java java/org/apache/catalina/util/ExtensionValidator.java java/org/apache/coyote/ajp/AjpAprProcessor.java java/org/apache/coyote/ajp/AjpAprProtocol.java java/org/apache/coyote/ajp/AjpMessage.java java/org/apache/coyote/ajp/AjpProcessor.java java/org/apache/coyote/ajp/AjpProtocol.java java/org/apache/coyote/http11/AbstractHttp11Processor.java java/org/apache/coyote/http11/Http11AprProcessor.java java/org/apache/coyote/http11/Http11AprProtocol.java java/org/apache/coyote/http11/Http11NioProtocol.java java/org/apache/coyote/http11/Http11Protocol.java java/org/apache/jasper/JspCompilationContext.java java/org/apache/jasper/compiler/SmapUtil.java java/org/apache/jasper/security/SecurityClassLoad.java java/org/apache/jasper/xmlparser/UCSReader.java java/org/apache/jasper/xmlparser/UTF8Reader.java java/org/apache/naming/NamingContext.java java/org/apache/naming/SelectorContext.java java/org/apache/naming/resources/FileDirContext.java java/org/apache/naming/resources/WARDirContext.java java/org/apache/tomcat/util/DomUtil.java java/org/apache/tomcat/util/IntrospectionUtils.java java/org/apache/tomcat/util/buf/B2CConverter.java java/org/apache/tomcat/util/buf/C2BConverter.java java/org/apache/tomcat/util/buf/StringCache.java java/org/apache/tomcat/util/buf/UEncoder.java java/org/apache/tomcat/util/http/Cookies.java java/org/apache/tomcat/util/http/Parameters.java java/org/apache/tomcat/util/http/mapper/Mapper.java java/org/apache/tomcat/util/net/SSLImplementation.java java/org/apache/tomcat/util/net/jsse/JSSEImplementation.java java/org/apache/tomcat/util/net/jsse/JSSESocketFactory.java java/org/apache/tomcat/util/net/jsse/JSSESupport.java modules/tomcat-lite/java/org/apache/tomcat/util/http/mapper/BaseMapper.java test/org/apache/catalina/tribes/demos/IntrospectionUtils.java	4:java/org/apache/catalina/core/ContainerBase.java 10:java/org/apache/catalina/loader/WebappLoader.java 13:java/org/apache/catalina/tribes/util/Logs.java 15:java/org/apache/catalina/startup/UserConfig.java 16:java/org/apache/catalina/startup/EngineConfig.java 19:java/org/apache/tomcat/util/net/SSLImplementation.java 28:java/org/apache/tomcat/util/http/mapper/Mapper.java 35:java/org/apache/catalina/mbeans/MBeanFactory.java 37:java/org/apache/catalina/core/ApplicationFilterConfig.java 42:java/org/apache/catalina/core/StandardWrapper.java 48:modules/tomcat-lite/java/org/apache/tomcat/util/http/mapper/BaseMapper.java 70:java/org/apache/tomcat/util/net/jsse/JSSEImplementation.java 72:java/org/apache/coyote/http11/Http11AprProcessor.java 75:java/org/apache/catalina/startup/HostConfig.java 97:java/org/apache/catalina/security/SecurityUtil.java 108:java/org/apache/coyote/http11/Http11AprProtocol.java 122:java/org/apache/jasper/JspCompilationContext.java 130:java/org/apache/coyote/ajp/AjpAprProcessor.java 132:java/org/apache/catalina/tribes/membership/McastServiceImpl.java 134:java/org/apache/catalina/tribes/transport/nio/NioReplicationTask.java 135:java/org/apache/catalina/loader/WebappClassLoader.java 137:java/org/apache/catalina/ha/session/DeltaManager.java 141:java/org/apache/catalina/startup/TldConfig.java 154:java/org/apache/coyote/http11/Http11NioProtocol.java 156:java/org/apache/jasper/compiler/SmapUtil.java 165:java/org/apache/coyote/http11/AbstractHttp11Processor.java 185:java/org/apache/catalina/ha/session/DeltaSession.java 187:java/org/apache/coyote/ajp/AjpProcessor.java 202:java/org/apache/tomcat/util/buf/StringCache.java 229:java/org/apache/catalina/ha/context/ReplicatedContext.java 251:java/org/apache/naming/resources/FileDirContext.java 260:java/org/apache/catalina/startup/WebXml.java 262:java/org/apache/tomcat/util/net/jsse/JSSESocketFactory.java 264:java/org/apache/catalina/startup/ContextConfig.java 267:java/org/apache/coyote/ajp/AjpMessage.java 270:java/org/apache/catalina/util/ExtensionValidator.java 271:java/org/apache/catalina/ha/deploy/FarmWarDeployer.java 277:java/org/apache/tomcat/util/http/Parameters.java 353:java/org/apache/catalina/tribes/transport/nio/ParallelNioSender.java 361:java/org/apache/coyote/http11/Http11Protocol.java 366:java/org/apache/catalina/startup/Catalina.java 430:java/org/apache/catalina/tribes/group/ChannelInterceptorBase.java 431:java/org/apache/catalina/tribes/group/RpcChannel.java 435:java/org/apache/catalina/ha/ClusterListener.java 437:java/org/apache/tomcat/util/buf/C2BConverter.java 492:java/org/apache/tomcat/util/http/Cookies.java 499:java/org/apache/jasper/xmlparser/UTF8Reader.java 522:java/org/apache/tomcat/util/IntrospectionUtils.java 523:test/org/apache/catalina/tribes/demos/IntrospectionUtils.java 550:java/org/apache/catalina/security/SecurityConfig.java 551:java/org/apache/catalina/tribes/group/interceptors/TwoPhaseCommitInterceptor.java 554:java/org/apache/catalina/tribes/transport/nio/NioReceiver.java 577:java/org/apache/catalina/ha/session/BackupManager.java 579:java/org/apache/catalina/tribes/group/interceptors/TcpFailureDetector.java 588:java/org/apache/tomcat/util/buf/B2CConverter.java 629:java/org/apache/catalina/tribes/group/interceptors/MessageDispatchInterceptor.java 714:java/org/apache/catalina/ha/session/SerializablePrincipal.java 723:java/org/apache/jasper/security/SecurityClassLoad.java 742:java/org/apache/catalina/tribes/tipis/ReplicatedMap.java 765:java/org/apache/tomcat/util/buf/UEncoder.java 773:java/org/apache/catalina/startup/DefaultJarScanner.java 776:java/org/apache/jasper/xmlparser/UCSReader.java 779:java/org/apache/catalina/tribes/tipis/LazyReplicatedMap.java 785:java/org/apache/naming/SelectorContext.java 792:java/org/apache/naming/NamingContext.java 797:java/org/apache/coyote/ajp/AjpProtocol.java 799:java/org/apache/coyote/ajp/AjpAprProtocol.java
768	48174	Bug 48174 org.apache.tomcat.jni.Address.APR_ANYADDR should be final	org.apache.tomcat.jni.Address.APR_ANYADDR should be final	2009-11-11 07:14:34	1257940000	resolved fixed	57571a7	1258500000	java/org/apache/tomcat/jni/Address.java	1:java/org/apache/tomcat/jni/Address.java
769	48173	Bug 48173 org.apache.catalina.tribes.io.ChannelData.EMPTY_DATA_ARRAY should be final	org.apache.catalina.tribes.io.ChannelData.EMPTY_DATA_ARRAY should be final	2009-11-11 06:59:39	1257940000	resolved fixed	e5ae1bc	1258500000	java/org/apache/catalina/tribes/io/ChannelData.java	1:java/org/apache/catalina/tribes/io/ChannelData.java
770	48151	Bug 48151 Java files that don't have AL headers		2009-11-06 03:06:03	1257490000	resolved fixed	5447621	1258500000	java/org/apache/catalina/startup/DefaultJarScanner.java java/org/apache/tomcat/JarScannerCallback.java modules/jdbc-pool/test/org/apache/tomcat/jdbc/test/TestConcurrency.java modules/jdbc-pool/test/org/apache/tomcat/jdbc/test/TestException.java modules/jdbc-pool/test/org/apache/tomcat/jdbc/test/driver/ResultSet.java modules/tomcat-lite/examples/spring/TomcatSpring.java modules/tomcat-lite/java/org/apache/tomcat/addons/Filesystem.java modules/tomcat-lite/java/org/apache/tomcat/addons/UserAuthentication.java modules/tomcat-lite/java/org/apache/tomcat/addons/UserSessionManager.java modules/tomcat-lite/java/org/apache/tomcat/addons/UserTemplateClassMapper.java modules/tomcat-lite/java/org/apache/tomcat/integration/ObjectManager.java modules/tomcat-lite/java/org/apache/tomcat/integration/jmx/JmxObjectManagerSpi.java modules/tomcat-lite/java/org/apache/tomcat/integration/simple/LocalFilesystem.java modules/tomcat-lite/java/org/apache/tomcat/integration/simple/Main.java modules/tomcat-lite/java/org/apache/tomcat/integration/simple/ServletHelper.java modules/tomcat-lite/java/org/apache/tomcat/integration/simple/SimpleObjectManager.java modules/tomcat-lite/java/org/apache/tomcat/lite/BodyWriter.java modules/tomcat-lite/java/org/apache/tomcat/lite/Connector.java modules/tomcat-lite/java/org/apache/tomcat/lite/ContextPreinitListener.java modules/tomcat-lite/java/org/apache/tomcat/lite/WebappContextMapper.java modules/tomcat-lite/java/org/apache/tomcat/lite/coyote/CoyoteConnector.java modules/tomcat-lite/java/org/apache/tomcat/lite/webxml/ServletContextConfig.java modules/tomcat-lite/java/org/apache/tomcat/lite/webxml/TomcatLiteWebXmlConfig.java modules/tomcat-lite/java/org/apache/tomcat/lite/webxml/WebXml.java modules/tomcat-lite/java/org/apache/tomcat/servlets/file/CopyUtils.java modules/tomcat-lite/java/org/apache/tomcat/servlets/file/FileCopyUtils.java modules/tomcat-lite/java/org/apache/tomcat/servlets/jsp/PreCompileFilter.java modules/tomcat-lite/java/org/apache/tomcat/servlets/jsp/SingleThreadedProxyServlet.java modules/tomcat-lite/java/org/apache/tomcat/servlets/sec/UserDB.java modules/tomcat-lite/java/org/apache/tomcat/servlets/session/RandomGenerator.java modules/tomcat-lite/java/org/apache/tomcat/servlets/util/Range.java modules/tomcat-lite/java/org/apache/tomcat/servlets/util/UrlUtils.java modules/tomcat-lite/java/org/apache/tomcat/util/http/HttpRequest.java modules/tomcat-lite/java/org/apache/tomcat/util/http/HttpResponse.java modules/tomcat-lite/test/org/apache/tomcat/lite/LiteTestHelper.java modules/tomcat-lite/test/org/apache/tomcat/lite/PropertiesSpiTest.java modules/tomcat-lite/test/org/apache/tomcat/lite/SimpleServlet.java modules/tomcat-lite/test/org/apache/tomcat/test/watchdog/WatchdogTest.java modules/tomcat-lite/test/org/apache/tomcat/util/buf/UEncoderTest.java test/org/apache/TestAll.java test/org/apache/catalina/startup/SimpleHttpClient.java test/org/apache/catalina/startup/TestWebXml.java	4:modules/tomcat-lite/java/org/apache/tomcat/util/http/HttpRequest.java 11:modules/tomcat-lite/java/org/apache/tomcat/util/http/HttpResponse.java 36:modules/tomcat-lite/java/org/apache/tomcat/lite/Connector.java 60:test/org/apache/catalina/startup/SimpleHttpClient.java 85:modules/tomcat-lite/test/org/apache/tomcat/lite/SimpleServlet.java 102:modules/tomcat-lite/java/org/apache/tomcat/lite/coyote/CoyoteConnector.java 108:modules/tomcat-lite/java/org/apache/tomcat/servlets/util/Range.java 122:modules/tomcat-lite/java/org/apache/tomcat/lite/BodyWriter.java 127:modules/tomcat-lite/java/org/apache/tomcat/addons/UserAuthentication.java 296:modules/tomcat-lite/java/org/apache/tomcat/lite/webxml/TomcatLiteWebXmlConfig.java 299:modules/tomcat-lite/java/org/apache/tomcat/lite/WebappContextMapper.java 303:modules/tomcat-lite/java/org/apache/tomcat/integration/simple/ServletHelper.java 304:modules/tomcat-lite/java/org/apache/tomcat/lite/ContextPreinitListener.java 305:modules/tomcat-lite/java/org/apache/tomcat/addons/UserSessionManager.java 352:java/org/apache/catalina/startup/DefaultJarScanner.java 410:modules/tomcat-lite/test/org/apache/tomcat/lite/LiteTestHelper.java 417:modules/tomcat-lite/java/org/apache/tomcat/addons/UserTemplateClassMapper.java 436:modules/tomcat-lite/java/org/apache/tomcat/servlets/jsp/SingleThreadedProxyServlet.java 524:modules/tomcat-lite/java/org/apache/tomcat/servlets/session/RandomGenerator.java 585:modules/tomcat-lite/java/org/apache/tomcat/servlets/file/FileCopyUtils.java 586:modules/tomcat-lite/java/org/apache/tomcat/servlets/file/CopyUtils.java 706:modules/jdbc-pool/test/org/apache/tomcat/jdbc/test/driver/ResultSet.java 730:modules/jdbc-pool/test/org/apache/tomcat/jdbc/test/TestConcurrency.java 764:java/org/apache/tomcat/JarScannerCallback.java 772:modules/tomcat-lite/java/org/apache/tomcat/addons/Filesystem.java 778:modules/tomcat-lite/java/org/apache/tomcat/lite/webxml/WebXml.java 824:modules/tomcat-lite/java/org/apache/tomcat/integration/simple/LocalFilesystem.java 868:modules/tomcat-lite/java/org/apache/tomcat/servlets/jsp/PreCompileFilter.java 928:modules/tomcat-lite/java/org/apache/tomcat/integration/simple/SimpleObjectManager.java 955:modules/tomcat-lite/java/org/apache/tomcat/integration/simple/Main.java 1049:modules/tomcat-lite/test/org/apache/tomcat/test/watchdog/WatchdogTest.java 1201:modules/tomcat-lite/java/org/apache/tomcat/lite/webxml/ServletContextConfig.java 1223:modules/tomcat-lite/java/org/apache/tomcat/integration/ObjectManager.java
771	48150	"Bug 48150 some misspellings I found in the ""javax.servlet"" package"		2009-11-06 01:46:29	1257490000	resolved fixed	7849435	1258500000	java/javax/servlet/GenericServlet.java java/javax/servlet/http/HttpServlet.java java/javax/servlet/jsp/JspWriter.java java/javax/servlet/jsp/PageContext.java java/javax/servlet/jsp/SkipPageException.java java/javax/servlet/jsp/tagext/JspFragment.java java/javax/servlet/jsp/tagext/PageData.java java/javax/servlet/jsp/tagext/SimpleTagSupport.java java/javax/servlet/jsp/tagext/TagLibraryInfo.java java/javax/servlet/jsp/tagext/TagLibraryValidator.java java/javax/servlet/jsp/tagext/TagSupport.java	6:java/javax/servlet/jsp/PageContext.java 11:java/javax/servlet/http/HttpServlet.java 29:java/javax/servlet/jsp/tagext/TagLibraryInfo.java 72:java/javax/servlet/jsp/tagext/JspFragment.java 79:java/javax/servlet/GenericServlet.java 94:java/javax/servlet/jsp/tagext/SimpleTagSupport.java 130:java/javax/servlet/jsp/SkipPageException.java 506:java/javax/servlet/jsp/JspWriter.java
772	48149	"Bug 48149 some misspellings I found in the ""org.apache.coyote"" package and ""org.apache.el"" package"		2009-11-06 01:14:34	1257490000	resolved fixed	39a78f4	1258500000	java/org/apache/coyote/ActionCode.java java/org/apache/coyote/ProtocolHandler.java java/org/apache/coyote/Request.java java/org/apache/coyote/RequestGroupInfo.java java/org/apache/coyote/RequestInfo.java java/org/apache/coyote/Response.java java/org/apache/coyote/ajp/AjpAprProcessor.java java/org/apache/coyote/ajp/AjpAprProtocol.java java/org/apache/coyote/ajp/AjpProcessor.java java/org/apache/coyote/ajp/AjpProtocol.java java/org/apache/coyote/http11/AbstractHttp11Processor.java java/org/apache/coyote/http11/AbstractInputBuffer.java java/org/apache/coyote/http11/AbstractOutputBuffer.java java/org/apache/coyote/http11/Http11AprProcessor.java java/org/apache/coyote/http11/Http11NioProcessor.java java/org/apache/coyote/http11/Http11Processor.java java/org/apache/coyote/http11/InternalAprInputBuffer.java java/org/apache/coyote/http11/InternalAprOutputBuffer.java java/org/apache/coyote/http11/InternalInputBuffer.java java/org/apache/coyote/http11/InternalNioInputBuffer.java java/org/apache/coyote/http11/InternalNioOutputBuffer.java java/org/apache/coyote/http11/InternalOutputBuffer.java java/org/apache/coyote/http11/filters/VoidInputFilter.java java/org/apache/el/parser/AstValue.java java/org/apache/el/parser/ParseException.java	36:java/org/apache/coyote/Request.java 37:java/org/apache/coyote/RequestInfo.java 44:java/org/apache/coyote/http11/Http11AprProcessor.java 49:java/org/apache/coyote/ProtocolHandler.java 54:java/org/apache/coyote/http11/AbstractOutputBuffer.java 56:java/org/apache/coyote/http11/InternalAprOutputBuffer.java 63:java/org/apache/coyote/ajp/AjpAprProcessor.java 66:java/org/apache/coyote/ajp/AjpProcessor.java 75:java/org/apache/coyote/http11/AbstractInputBuffer.java 78:java/org/apache/coyote/http11/Http11NioProcessor.java 79:java/org/apache/coyote/http11/Http11Processor.java 92:java/org/apache/coyote/http11/AbstractHttp11Processor.java 116:java/org/apache/coyote/http11/InternalAprInputBuffer.java 132:java/org/apache/coyote/ActionCode.java 214:java/org/apache/coyote/ajp/AjpProtocol.java 219:java/org/apache/coyote/ajp/AjpAprProtocol.java 288:java/org/apache/el/parser/AstValue.java 378:java/org/apache/coyote/http11/InternalNioInputBuffer.java 397:java/org/apache/coyote/Response.java 427:java/org/apache/coyote/http11/InternalInputBuffer.java 475:java/org/apache/coyote/http11/filters/VoidInputFilter.java 1053:java/org/apache/coyote/http11/InternalOutputBuffer.java 1119:java/org/apache/coyote/RequestGroupInfo.java 1134:java/org/apache/coyote/http11/InternalNioOutputBuffer.java
773	48148	"Bug 48148 some misspellings I found in the ""org.apache.jasper"" package and ""org.apache.juli"" package"		2009-11-06 00:32:48	1257490000	resolved fixed	6ce7032	1258500000	java/org/apache/jasper/Constants.java java/org/apache/jasper/EmbeddedServletOptions.java java/org/apache/jasper/JasperException.java java/org/apache/jasper/JspC.java java/org/apache/jasper/JspCompilationContext.java java/org/apache/jasper/Options.java java/org/apache/jasper/compiler/Collector.java java/org/apache/jasper/compiler/Compiler.java java/org/apache/jasper/compiler/ELFunctionMapper.java java/org/apache/jasper/compiler/Generator.java java/org/apache/jasper/compiler/JarScannerFactory.java java/org/apache/jasper/compiler/JspConfig.java java/org/apache/jasper/compiler/JspDocumentParser.java java/org/apache/jasper/compiler/JspReader.java java/org/apache/jasper/compiler/JspRuntimeContext.java java/org/apache/jasper/compiler/JspUtil.java java/org/apache/jasper/compiler/Node.java java/org/apache/jasper/compiler/TagFileProcessor.java java/org/apache/jasper/compiler/TagLibraryInfoImpl.java java/org/apache/jasper/compiler/TextOptimizer.java java/org/apache/jasper/compiler/TldLocationsCache.java java/org/apache/jasper/compiler/Validator.java java/org/apache/jasper/compiler/tagplugin/TagPluginContext.java java/org/apache/jasper/runtime/BodyContentImpl.java java/org/apache/jasper/runtime/JspContextWrapper.java java/org/apache/jasper/servlet/JspServlet.java java/org/apache/jasper/servlet/JspServletWrapper.java java/org/apache/jasper/tagplugins/jstl/core/Import.java java/org/apache/jasper/util/Enumerator.java java/org/apache/jasper/xmlparser/UTF8Reader.java java/org/apache/jasper/xmlparser/XMLEncodingDetector.java java/org/apache/juli/ClassLoaderLogManager.java java/org/apache/juli/OneLineFormatter.java java/org/apache/juli/logging/DirectJDKLog.java java/org/apache/juli/logging/Log.java java/org/apache/juli/logging/LogFactory.java	2:java/org/apache/jasper/JasperException.java 3:java/org/apache/jasper/compiler/Compiler.java 12:java/org/apache/jasper/JspCompilationContext.java 13:java/org/apache/jasper/Options.java 16:java/org/apache/jasper/compiler/Node.java 17:java/org/apache/jasper/JspC.java 28:java/org/apache/jasper/compiler/TldLocationsCache.java 29:java/org/apache/jasper/servlet/JspServletWrapper.java 34:java/org/apache/jasper/EmbeddedServletOptions.java 35:java/org/apache/jasper/compiler/JspUtil.java 36:java/org/apache/jasper/compiler/JspReader.java 40:java/org/apache/jasper/compiler/Generator.java 44:java/org/apache/jasper/Constants.java 48:java/org/apache/jasper/compiler/tagplugin/TagPluginContext.java 58:java/org/apache/jasper/compiler/Validator.java 59:java/org/apache/jasper/compiler/TagFileProcessor.java 67:java/org/apache/jasper/servlet/JspServlet.java 68:java/org/apache/jasper/compiler/JspRuntimeContext.java 73:java/org/apache/jasper/xmlparser/XMLEncodingDetector.java 77:java/org/apache/jasper/compiler/JarScannerFactory.java 78:java/org/apache/jasper/compiler/ELFunctionMapper.java 80:java/org/apache/jasper/compiler/TagLibraryInfoImpl.java 81:java/org/apache/jasper/compiler/Collector.java 82:java/org/apache/jasper/compiler/TextOptimizer.java 86:java/org/apache/jasper/compiler/JspDocumentParser.java 105:java/org/apache/jasper/compiler/JspConfig.java 176:java/org/apache/jasper/tagplugins/jstl/core/Import.java 185:java/org/apache/juli/ClassLoaderLogManager.java 261:java/org/apache/juli/logging/LogFactory.java 281:java/org/apache/jasper/runtime/BodyContentImpl.java 389:java/org/apache/jasper/xmlparser/UTF8Reader.java 510:java/org/apache/jasper/runtime/JspContextWrapper.java 814:java/org/apache/jasper/util/Enumerator.java 1016:java/org/apache/juli/logging/Log.java 1096:java/org/apache/juli/logging/DirectJDKLog.java 1115:java/org/apache/juli/OneLineFormatter.java
774	48147	"Bug 48147 some misspellings I can find in the ""org.apache.naming"" package"		2009-11-05 23:26:42	1257480000	resolved fixed	21e86e6	1258500000	java/org/apache/naming/NamingEntry.java java/org/apache/naming/NamingService.java java/org/apache/naming/NamingServiceMBean.java java/org/apache/naming/ResourceRef.java java/org/apache/naming/factory/EjbFactory.java java/org/apache/naming/factory/OpenEjbFactory.java java/org/apache/naming/factory/ResourceEnvFactory.java java/org/apache/naming/factory/TransactionFactory.java java/org/apache/naming/resources/BaseDirContext.java java/org/apache/naming/resources/DirContextURLConnection.java java/org/apache/naming/resources/FileDirContext.java java/org/apache/naming/resources/ProxyDirContext.java java/org/apache/naming/resources/Resource.java java/org/apache/naming/resources/ResourceCache.java java/org/apache/naming/resources/WARDirContext.java	137:java/org/apache/naming/resources/ResourceCache.java 190:java/org/apache/naming/resources/BaseDirContext.java 256:java/org/apache/naming/NamingService.java 293:java/org/apache/naming/NamingEntry.java 314:java/org/apache/naming/resources/FileDirContext.java 334:java/org/apache/naming/resources/WARDirContext.java 397:java/org/apache/naming/resources/ProxyDirContext.java 476:java/org/apache/naming/NamingServiceMBean.java 506:java/org/apache/naming/resources/DirContextURLConnection.java 545:java/org/apache/naming/ResourceRef.java 645:java/org/apache/naming/factory/ResourceEnvFactory.java 647:java/org/apache/naming/factory/TransactionFactory.java 668:java/org/apache/naming/factory/EjbFactory.java 795:java/org/apache/naming/factory/OpenEjbFactory.java 1061:java/org/apache/naming/resources/Resource.java
775	48146	"Bug 48146 some misspellings I can find in the ""org.apache.tomcat"" package"		2009-11-05 23:05:31	1257480000	resolved fixed	ed97da7	1258500000	java/org/apache/tomcat/jni/BIOCallback.java java/org/apache/tomcat/jni/Directory.java java/org/apache/tomcat/jni/File.java java/org/apache/tomcat/jni/Local.java java/org/apache/tomcat/jni/OS.java java/org/apache/tomcat/jni/Poll.java java/org/apache/tomcat/jni/Pool.java java/org/apache/tomcat/jni/Proc.java java/org/apache/tomcat/jni/SSL.java java/org/apache/tomcat/jni/SSLContext.java java/org/apache/tomcat/jni/Shm.java java/org/apache/tomcat/jni/Socket.java java/org/apache/tomcat/jni/Time.java java/org/apache/tomcat/jni/User.java java/org/apache/tomcat/util/DomUtil.java java/org/apache/tomcat/util/IntrospectionUtils.java java/org/apache/tomcat/util/buf/B2CConverter.java java/org/apache/tomcat/util/buf/ByteChunk.java java/org/apache/tomcat/util/buf/C2BConverter.java java/org/apache/tomcat/util/buf/CharChunk.java java/org/apache/tomcat/util/buf/MessageBytes.java java/org/apache/tomcat/util/buf/StringCache.java java/org/apache/tomcat/util/buf/UDecoder.java java/org/apache/tomcat/util/buf/UEncoder.java java/org/apache/tomcat/util/collections/MultiMap.java java/org/apache/tomcat/util/collections/MultiMapNamesEnumeration.java java/org/apache/tomcat/util/digester/AbstractRulesImpl.java java/org/apache/tomcat/util/digester/CallMethodRule.java java/org/apache/tomcat/util/digester/Digester.java java/org/apache/tomcat/util/digester/FactoryCreateRule.java java/org/apache/tomcat/util/digester/GenericParser.java java/org/apache/tomcat/util/digester/NodeCreateRule.java java/org/apache/tomcat/util/digester/RuleSet.java java/org/apache/tomcat/util/digester/RulesBase.java java/org/apache/tomcat/util/digester/SetNextRule.java java/org/apache/tomcat/util/digester/SetPropertiesRule.java java/org/apache/tomcat/util/digester/SetPropertyRule.java java/org/apache/tomcat/util/digester/SetRootRule.java java/org/apache/tomcat/util/digester/SetTopRule.java java/org/apache/tomcat/util/digester/WithDefaultsRulesWrapper.java java/org/apache/tomcat/util/http/ContentType.java java/org/apache/tomcat/util/http/Cookies.java java/org/apache/tomcat/util/http/MimeHeaders.java java/org/apache/tomcat/util/http/fileupload/FileItem.java java/org/apache/tomcat/util/http/fileupload/MultipartStream.java java/org/apache/tomcat/util/http/mapper/Mapper.java java/org/apache/tomcat/util/modeler/AttributeInfo.java java/org/apache/tomcat/util/modeler/BaseModelMBean.java java/org/apache/tomcat/util/modeler/Registry.java java/org/apache/tomcat/util/modeler/modules/MbeansDescriptorsIntrospectionSource.java java/org/apache/tomcat/util/net/AprEndpoint.java java/org/apache/tomcat/util/net/DefaultServerSocketFactory.java java/org/apache/tomcat/util/net/NioEndpoint.java java/org/apache/tomcat/util/net/ServerSocketFactory.java java/org/apache/tomcat/util/net/jsse/JSSESocketFactory.java	54:java/org/apache/tomcat/util/buf/StringCache.java 79:java/org/apache/tomcat/util/buf/ByteChunk.java 87:java/org/apache/tomcat/util/modeler/Registry.java 96:java/org/apache/tomcat/util/http/mapper/Mapper.java 109:java/org/apache/tomcat/util/collections/MultiMap.java 114:java/org/apache/tomcat/util/digester/Digester.java 119:java/org/apache/tomcat/util/collections/MultiMapNamesEnumeration.java 121:java/org/apache/tomcat/jni/Local.java 125:java/org/apache/tomcat/jni/Socket.java 128:java/org/apache/tomcat/util/IntrospectionUtils.java 136:java/org/apache/tomcat/util/http/MimeHeaders.java 138:java/org/apache/tomcat/util/http/fileupload/MultipartStream.java 155:java/org/apache/tomcat/util/http/Cookies.java 304:java/org/apache/tomcat/util/modeler/BaseModelMBean.java 305:java/org/apache/tomcat/jni/Directory.java 311:java/org/apache/tomcat/util/net/jsse/JSSESocketFactory.java 372:java/org/apache/tomcat/util/DomUtil.java 376:java/org/apache/tomcat/util/net/AprEndpoint.java 379:java/org/apache/tomcat/util/digester/RulesBase.java 396:java/org/apache/tomcat/util/net/NioEndpoint.java 458:java/org/apache/tomcat/util/modeler/modules/MbeansDescriptorsIntrospectionSource.java 477:java/org/apache/tomcat/util/buf/UDecoder.java 480:java/org/apache/tomcat/jni/Proc.java 523:java/org/apache/tomcat/util/http/ContentType.java 669:java/org/apache/tomcat/jni/BIOCallback.java 793:java/org/apache/tomcat/util/digester/RuleSet.java 908:java/org/apache/tomcat/util/digester/GenericParser.java 909:java/org/apache/tomcat/util/net/DefaultServerSocketFactory.java 934:java/org/apache/tomcat/jni/Time.java 963:java/org/apache/tomcat/util/digester/AbstractRulesImpl.java 1016:java/org/apache/tomcat/util/buf/B2CConverter.java 1027:java/org/apache/tomcat/jni/User.java 1050:java/org/apache/tomcat/util/digester/WithDefaultsRulesWrapper.java 1063:java/org/apache/tomcat/util/modeler/AttributeInfo.java 1078:java/org/apache/tomcat/util/http/fileupload/FileItem.java 1081:java/org/apache/tomcat/jni/Shm.java 1098:java/org/apache/tomcat/jni/OS.java 1100:java/org/apache/tomcat/util/digester/FactoryCreateRule.java 1108:java/org/apache/tomcat/util/buf/UEncoder.java 1126:java/org/apache/tomcat/jni/Pool.java 1132:java/org/apache/tomcat/util/buf/C2BConverter.java 1133:java/org/apache/tomcat/util/net/ServerSocketFactory.java 1134:java/org/apache/tomcat/jni/Poll.java 1160:java/org/apache/tomcat/util/digester/CallMethodRule.java 1180:java/org/apache/tomcat/util/buf/MessageBytes.java 1181:java/org/apache/tomcat/util/digester/NodeCreateRule.java 1188:java/org/apache/tomcat/util/buf/CharChunk.java 1192:java/org/apache/tomcat/jni/SSLContext.java 1203:java/org/apache/tomcat/jni/SSL.java 1205:java/org/apache/tomcat/jni/File.java
776	48143	Bug 48143 Javadoc fixes		2009-11-05 13:04:26	1257440000	resolved fixed	c52b1ba	1258500000	java/javax/servlet/SessionCookieConfig.java java/org/apache/catalina/ant/jmx/JMXAccessorCreateTask.java java/org/apache/catalina/core/ApplicationFilterChain.java java/org/apache/catalina/core/StandardContextValve.java java/org/apache/catalina/core/StandardEngineValve.java java/org/apache/catalina/core/StandardHostValve.java java/org/apache/catalina/core/StandardWrapperValve.java java/org/apache/catalina/ha/ClusterManager.java java/org/apache/catalina/ha/session/DeltaSession.java java/org/apache/catalina/ha/tcp/SimpleTcpCluster.java java/org/apache/catalina/manager/StatusTransformer.java java/org/apache/catalina/realm/CombinedRealm.java java/org/apache/catalina/realm/LockOutRealm.java java/org/apache/catalina/startup/Embedded.java java/org/apache/catalina/startup/WebRuleSet.java java/org/apache/catalina/tribes/group/ChannelCoordinator.java java/org/apache/catalina/tribes/io/ChannelData.java java/org/apache/catalina/tribes/io/ObjectReader.java java/org/apache/catalina/tribes/io/ReplicationStream.java java/org/apache/catalina/tribes/io/XByteBuffer.java java/org/apache/catalina/tribes/membership/McastServiceImpl.java java/org/apache/catalina/tribes/membership/MemberImpl.java java/org/apache/catalina/tribes/membership/Membership.java java/org/apache/catalina/tribes/transport/bio/util/LinkObject.java java/org/apache/catalina/tribes/transport/nio/NioReceiver.java java/org/apache/catalina/users/MemoryUserDatabase.java java/org/apache/catalina/valves/RemoteIpValve.java java/org/apache/coyote/http11/Http11Processor.java java/org/apache/jasper/compiler/ParserController.java java/org/apache/jasper/compiler/TagFileProcessor.java java/org/apache/jasper/compiler/TldLocationsCache.java java/org/apache/naming/HandlerRef.java java/org/apache/naming/ServiceRef.java java/org/apache/naming/resources/BaseDirContext.java java/org/apache/tomcat/buildutil/Txt2Html.java java/org/apache/tomcat/util/digester/SetPropertiesRule.java java/org/apache/tomcat/util/digester/SetPropertyRule.java java/org/apache/tomcat/util/modeler/BaseModelMBean.java java/org/apache/tomcat/util/net/NioBlockingSelector.java java/org/apache/tomcat/util/net/SSLSessionManager.java	30:java/org/apache/jasper/compiler/TldLocationsCache.java 36:java/org/apache/tomcat/util/modeler/BaseModelMBean.java 60:java/org/apache/catalina/tribes/transport/nio/NioReceiver.java 64:java/org/apache/catalina/tribes/group/ChannelCoordinator.java 66:java/org/apache/coyote/http11/Http11Processor.java 68:java/org/apache/jasper/compiler/TagFileProcessor.java 89:java/org/apache/catalina/core/ApplicationFilterChain.java 90:java/org/apache/jasper/compiler/ParserController.java 101:java/org/apache/catalina/core/StandardHostValve.java 104:java/org/apache/catalina/core/StandardContextValve.java
777	48139	Bug 48139 Tomcat Javadoc and unthrown exception fixes		2009-11-05 08:10:54	1257430000	resolved fixed	ab3620c	1257450000	java/org/apache/catalina/startup/Tomcat.java	1:java/org/apache/catalina/startup/Tomcat.java
778	48137	"Bug 48137 some misspellings I can find in the ""org.apache.catalina"" package"		2009-11-05 06:13:59	1257420000	resolved fixed	18c0edc	1257450000	java/org/apache/catalina/Cluster.java java/org/apache/catalina/CometEvent.java java/org/apache/catalina/CometProcessor.java java/org/apache/catalina/Context.java java/org/apache/catalina/Host.java java/org/apache/catalina/Pipeline.java java/org/apache/catalina/ant/BaseRedirectorHelperTask.java java/org/apache/catalina/ant/JKStatusUpdateTask.java java/org/apache/catalina/ant/jmx/JMXAccessorQueryTask.java java/org/apache/catalina/ant/jmx/JMXAccessorSetTask.java java/org/apache/catalina/ant/jmx/JMXAccessorTask.java java/org/apache/catalina/authenticator/AuthenticatorBase.java java/org/apache/catalina/authenticator/FormAuthenticator.java java/org/apache/catalina/authenticator/SingleSignOn.java java/org/apache/catalina/connector/Connector.java java/org/apache/catalina/connector/CoyoteAdapter.java java/org/apache/catalina/connector/CoyoteInputStream.java java/org/apache/catalina/connector/CoyoteReader.java java/org/apache/catalina/connector/OutputBuffer.java java/org/apache/catalina/connector/Request.java java/org/apache/catalina/connector/RequestFacade.java java/org/apache/catalina/connector/Response.java java/org/apache/catalina/deploy/ContextService.java java/org/apache/catalina/filters/WebdavFixFilter.java java/org/apache/catalina/ha/authenticator/ClusterSingleSignOn.java java/org/apache/catalina/ha/backend/CollectedInfo.java java/org/apache/catalina/ha/backend/HeartbeatListener.java java/org/apache/catalina/ha/deploy/FarmWarDeployer.java java/org/apache/catalina/ha/deploy/FileMessageFactory.java java/org/apache/catalina/ha/deploy/WarWatcher.java java/org/apache/catalina/ha/session/DeltaManager.java java/org/apache/catalina/ha/session/DeltaRequest.java java/org/apache/catalina/ha/session/DeltaSession.java java/org/apache/catalina/ha/session/JvmRouteBinderValve.java java/org/apache/catalina/ha/session/SessionMessageImpl.java java/org/apache/catalina/ha/tcp/ReplicationValve.java java/org/apache/catalina/ha/tcp/SimpleTcpCluster.java java/org/apache/catalina/loader/WebappClassLoader.java java/org/apache/catalina/manager/HTMLManagerServlet.java java/org/apache/catalina/manager/JMXProxyServlet.java java/org/apache/catalina/manager/ManagerServlet.java java/org/apache/catalina/manager/host/HTMLHostManagerServlet.java java/org/apache/catalina/manager/util/SessionUtils.java java/org/apache/catalina/mbeans/ContextEnvironmentMBean.java java/org/apache/catalina/mbeans/ContextResourceLinkMBean.java java/org/apache/catalina/mbeans/ContextResourceMBean.java java/org/apache/catalina/mbeans/MBeanFactory.java java/org/apache/catalina/mbeans/ServerLifecycleListener.java java/org/apache/catalina/realm/DataSourceRealm.java java/org/apache/catalina/realm/JAASCallbackHandler.java java/org/apache/catalina/realm/JAASMemoryLoginModule.java java/org/apache/catalina/realm/JAASRealm.java java/org/apache/catalina/realm/JDBCRealm.java java/org/apache/catalina/realm/JNDIRealm.java java/org/apache/catalina/realm/LockOutRealm.java java/org/apache/catalina/realm/RealmBase.java java/org/apache/catalina/security/SecurityUtil.java java/org/apache/catalina/servlets/CGIServlet.java java/org/apache/catalina/servlets/DefaultServlet.java java/org/apache/catalina/servlets/WebdavServlet.java java/org/apache/catalina/session/JDBCStore.java java/org/apache/catalina/session/PersistentManagerBase.java java/org/apache/catalina/session/StandardManager.java java/org/apache/catalina/ssi/ExpressionParseTree.java java/org/apache/catalina/ssi/SSIFsize.java java/org/apache/catalina/ssi/SSIServletExternalResolver.java java/org/apache/catalina/ssi/SSIStopProcessingException.java java/org/apache/catalina/tribes/Channel.java java/org/apache/catalina/tribes/ChannelListener.java java/org/apache/catalina/tribes/Heartbeat.java java/org/apache/catalina/tribes/Member.java java/org/apache/catalina/tribes/UniqueId.java java/org/apache/catalina/tribes/group/GroupChannel.java java/org/apache/catalina/tribes/group/interceptors/MessageDispatch15Interceptor.java java/org/apache/catalina/tribes/io/ObjectReader.java java/org/apache/catalina/tribes/membership/McastServiceImpl.java java/org/apache/catalina/tribes/transport/PooledSender.java java/org/apache/catalina/tribes/transport/bio/BioReplicationTask.java java/org/apache/catalina/tribes/transport/bio/BioSender.java java/org/apache/catalina/tribes/transport/bio/util/FastQueue.java java/org/apache/catalina/tribes/transport/nio/NioSender.java java/org/apache/catalina/tribes/transport/nio/ParallelNioSender.java java/org/apache/catalina/users/MemoryUserDatabase.java java/org/apache/catalina/util/Base64.java java/org/apache/catalina/util/DateTool.java java/org/apache/catalina/util/ExtensionValidator.java java/org/apache/catalina/util/IOTools.java java/org/apache/catalina/util/ManifestResource.java java/org/apache/catalina/util/ParameterMap.java java/org/apache/catalina/util/RequestUtil.java java/org/apache/catalina/util/SchemaResolver.java java/org/apache/catalina/util/Strftime.java java/org/apache/catalina/valves/AccessLogValve.java java/org/apache/catalina/valves/CometConnectionManagerValve.java	21:java/org/apache/catalina/tribes/io/ObjectReader.java 27:java/org/apache/catalina/Context.java 29:java/org/apache/catalina/mbeans/MBeanFactory.java 31:java/org/apache/catalina/loader/WebappClassLoader.java 34:java/org/apache/catalina/valves/AccessLogValve.java 35:java/org/apache/catalina/connector/Request.java 42:java/org/apache/catalina/realm/RealmBase.java 45:java/org/apache/catalina/security/SecurityUtil.java 46:java/org/apache/catalina/session/StandardManager.java 47:java/org/apache/catalina/authenticator/AuthenticatorBase.java 48:java/org/apache/catalina/ha/session/DeltaManager.java 49:java/org/apache/catalina/connector/Connector.java 55:java/org/apache/catalina/Host.java 56:java/org/apache/catalina/connector/Response.java 57:java/org/apache/catalina/authenticator/SingleSignOn.java 64:java/org/apache/catalina/session/PersistentManagerBase.java 65:java/org/apache/catalina/valves/CometConnectionManagerValve.java 73:java/org/apache/catalina/users/MemoryUserDatabase.java 78:java/org/apache/catalina/tribes/membership/McastServiceImpl.java 104:java/org/apache/catalina/tribes/UniqueId.java 116:java/org/apache/catalina/ha/session/JvmRouteBinderValve.java 117:java/org/apache/catalina/ha/tcp/ReplicationValve.java 118:java/org/apache/catalina/servlets/DefaultServlet.java 120:java/org/apache/catalina/ha/deploy/FarmWarDeployer.java 127:java/org/apache/catalina/ha/authenticator/ClusterSingleSignOn.java 130:java/org/apache/catalina/mbeans/ServerLifecycleListener.java 149:java/org/apache/catalina/realm/JAASMemoryLoginModule.java 152:java/org/apache/catalina/tribes/transport/nio/NioSender.java 158:java/org/apache/catalina/manager/ManagerServlet.java 162:java/org/apache/catalina/servlets/CGIServlet.java 192:java/org/apache/catalina/connector/RequestFacade.java 199:java/org/apache/catalina/tribes/group/GroupChannel.java 219:java/org/apache/catalina/connector/CoyoteInputStream.java 223:java/org/apache/catalina/manager/HTMLManagerServlet.java 224:java/org/apache/catalina/tribes/transport/bio/BioSender.java 229:java/org/apache/catalina/mbeans/ContextResourceMBean.java 237:java/org/apache/catalina/manager/util/SessionUtils.java 243:java/org/apache/catalina/realm/JDBCRealm.java 246:java/org/apache/catalina/ha/tcp/SimpleTcpCluster.java 253:java/org/apache/catalina/util/ExtensionValidator.java 256:java/org/apache/catalina/tribes/transport/nio/ParallelNioSender.java 258:java/org/apache/catalina/tribes/transport/bio/util/FastQueue.java 291:java/org/apache/catalina/realm/DataSourceRealm.java 299:java/org/apache/catalina/ssi/SSIServletExternalResolver.java 303:java/org/apache/catalina/servlets/WebdavServlet.java 305:java/org/apache/catalina/realm/JNDIRealm.java 310:java/org/apache/catalina/connector/CoyoteReader.java 318:java/org/apache/catalina/realm/JAASCallbackHandler.java 331:java/org/apache/catalina/ant/BaseRedirectorHelperTask.java 336:java/org/apache/catalina/util/Strftime.java 347:java/org/apache/catalina/manager/host/HTMLHostManagerServlet.java 353:java/org/apache/catalina/authenticator/FormAuthenticator.java 358:java/org/apache/catalina/util/ParameterMap.java 368:java/org/apache/catalina/realm/JAASRealm.java 376:java/org/apache/catalina/ha/backend/CollectedInfo.java 379:java/org/apache/catalina/mbeans/ContextEnvironmentMBean.java 382:java/org/apache/catalina/mbeans/ContextResourceLinkMBean.java 386:java/org/apache/catalina/util/ManifestResource.java 395:java/org/apache/catalina/connector/CoyoteAdapter.java 416:java/org/apache/catalina/ha/session/DeltaRequest.java 421:java/org/apache/catalina/ant/jmx/JMXAccessorSetTask.java 425:java/org/apache/catalina/tribes/transport/bio/BioReplicationTask.java 435:java/org/apache/catalina/ant/jmx/JMXAccessorQueryTask.java 450:java/org/apache/catalina/tribes/Channel.java 452:java/org/apache/catalina/ant/JKStatusUpdateTask.java 462:java/org/apache/catalina/session/JDBCStore.java 499:java/org/apache/catalina/util/RequestUtil.java 520:java/org/apache/catalina/ha/backend/HeartbeatListener.java 534:java/org/apache/catalina/ha/deploy/FileMessageFactory.java 597:java/org/apache/catalina/tribes/Heartbeat.java 623:java/org/apache/catalina/ssi/SSIStopProcessingException.java 641:java/org/apache/catalina/CometProcessor.java 772:java/org/apache/catalina/tribes/ChannelListener.java 857:java/org/apache/catalina/util/IOTools.java 942:java/org/apache/catalina/Pipeline.java 1010:java/org/apache/catalina/util/SchemaResolver.java 1011:java/org/apache/catalina/manager/JMXProxyServlet.java 1043:java/org/apache/catalina/tribes/Member.java 1054:java/org/apache/catalina/ha/session/SessionMessageImpl.java 1064:java/org/apache/catalina/CometEvent.java 1073:java/org/apache/catalina/tribes/group/interceptors/MessageDispatch15Interceptor.java 1077:java/org/apache/catalina/ssi/SSIFsize.java 1085:java/org/apache/catalina/ha/deploy/WarWatcher.java 1088:java/org/apache/catalina/util/DateTool.java 1090:java/org/apache/catalina/tribes/transport/PooledSender.java 1123:java/org/apache/catalina/deploy/ContextService.java 1131:java/org/apache/catalina/connector/OutputBuffer.java 1140:java/org/apache/catalina/filters/WebdavFixFilter.java 1159:java/org/apache/catalina/ssi/ExpressionParseTree.java 1164:java/org/apache/catalina/realm/LockOutRealm.java 1167:java/org/apache/catalina/util/Base64.java
779	48135	Bug 48135 ServiceRefFactory: impossible null check of serviceInterfaceClass	"The ServiceRefFactory class performs an impossible null check of serviceInterfaceClass at line 238: 237: Class[] serviceInterfaces = serviceInterfaceClass.getInterfaces(); 238: if (serviceInterfaceClass != null) { If it were null, line 237 would generate an NPE."	2009-11-05 03:34:18	1257410000	resolved fixed	97ccffd	1257450000	java/org/apache/naming/factory/webservices/ServiceProxy.java java/org/apache/naming/factory/webservices/ServiceRefFactory.java	1:java/org/apache/naming/factory/webservices/ServiceRefFactory.java 20:java/org/apache/naming/factory/webservices/ServiceProxy.java
780	48133	"Bug 48133 misspellings in the javadoc and comment of the various classes in the package of ""org.apache.core"""		2009-11-04 19:05:17	1257380000	resolved fixed	9204e4d	1257450000	java/org/apache/catalina/core/ApplicationDispatcher.java java/org/apache/catalina/core/ApplicationFilterFactory.java java/org/apache/catalina/core/ApplicationHttpRequest.java java/org/apache/catalina/core/ContainerBase.java java/org/apache/catalina/core/StandardContext.java java/org/apache/catalina/core/StandardEngine.java java/org/apache/catalina/core/StandardHost.java java/org/apache/catalina/core/StandardPipeline.java java/org/apache/catalina/core/StandardService.java java/org/apache/catalina/core/StandardWrapperFacade.java java/org/apache/catalina/core/StandardWrapperValve.java	14:java/org/apache/catalina/core/StandardContext.java 107:java/org/apache/catalina/core/ApplicationDispatcher.java 111:java/org/apache/catalina/core/StandardPipeline.java 141:java/org/apache/catalina/core/StandardService.java 144:java/org/apache/catalina/core/ApplicationHttpRequest.java 200:java/org/apache/catalina/core/StandardWrapperValve.java 206:java/org/apache/catalina/core/ContainerBase.java 213:java/org/apache/catalina/core/StandardEngine.java 221:java/org/apache/catalina/core/StandardHost.java 285:java/org/apache/catalina/core/ApplicationFilterFactory.java 827:java/org/apache/catalina/core/StandardWrapperFacade.java
781	48131	Bug 48131 Add @deprecated annotations to deprecated elements		2009-11-04 13:30:07	1257360000	resolved fixed	a3fa5d3	1257380000	java/javax/servlet/ServletContext.java java/javax/servlet/ServletRequest.java java/javax/servlet/ServletRequestWrapper.java java/javax/servlet/SingleThreadModel.java java/javax/servlet/UnavailableException.java java/javax/servlet/http/HttpServletRequest.java java/javax/servlet/http/HttpServletRequestWrapper.java java/javax/servlet/http/HttpServletResponse.java java/javax/servlet/http/HttpServletResponseWrapper.java java/javax/servlet/http/HttpSession.java java/javax/servlet/http/HttpSessionContext.java java/javax/servlet/http/HttpUtils.java java/javax/servlet/jsp/JspException.java java/javax/servlet/jsp/el/ELException.java java/javax/servlet/jsp/el/ELParseException.java java/javax/servlet/jsp/el/Expression.java java/javax/servlet/jsp/el/ExpressionEvaluator.java java/javax/servlet/jsp/el/FunctionMapper.java java/javax/servlet/jsp/el/VariableResolver.java java/javax/servlet/jsp/tagext/BodyTag.java java/org/apache/catalina/Cluster.java java/org/apache/catalina/Manager.java java/org/apache/catalina/connector/Request.java java/org/apache/catalina/connector/Response.java java/org/apache/catalina/core/ApplicationContext.java java/org/apache/catalina/core/ApplicationContextFacade.java java/org/apache/catalina/core/ApplicationHttpResponse.java java/org/apache/catalina/core/DummyRequest.java java/org/apache/catalina/core/DummyResponse.java java/org/apache/catalina/ha/session/DeltaSession.java java/org/apache/catalina/ha/tcp/SimpleTcpCluster.java java/org/apache/catalina/realm/JAASRealm.java java/org/apache/catalina/session/ManagerBase.java java/org/apache/catalina/session/StandardSession.java java/org/apache/catalina/session/StandardSessionFacade.java java/org/apache/catalina/startup/Catalina.java java/org/apache/catalina/tribes/io/XByteBuffer.java java/org/apache/catalina/tribes/membership/McastService.java java/org/apache/catalina/tribes/transport/ReceiverBase.java java/org/apache/el/parser/SimpleCharStream.java java/org/apache/jasper/servlet/JspCServletContext.java java/org/apache/naming/resources/ResourceAttributes.java java/org/apache/tomcat/util/digester/Rule.java java/org/apache/tomcat/util/digester/SetNextRule.java java/org/apache/tomcat/util/digester/SetPropertiesRule.java java/org/apache/tomcat/util/digester/SetPropertyRule.java java/org/apache/tomcat/util/digester/SetRootRule.java java/org/apache/tomcat/util/digester/SetTopRule.java	5:java/org/apache/jasper/servlet/JspCServletContext.java 8:java/org/apache/tomcat/util/digester/Rule.java 9:java/org/apache/catalina/Cluster.java 11:java/org/apache/catalina/core/ApplicationContext.java 12:java/javax/servlet/http/HttpSession.java 14:java/org/apache/catalina/session/StandardSession.java 15:java/org/apache/catalina/core/DummyRequest.java 16:java/org/apache/catalina/session/StandardSessionFacade.java 17:java/javax/servlet/ServletRequest.java 18:java/org/apache/catalina/core/DummyResponse.java 19:java/javax/servlet/http/HttpServletResponse.java 20:java/javax/servlet/ServletContext.java 21:java/javax/servlet/http/HttpServletRequest.java 22:java/javax/servlet/http/HttpSessionContext.java 23:java/javax/servlet/UnavailableException.java 24:java/javax/servlet/ServletRequestWrapper.java 26:java/javax/servlet/jsp/JspException.java 27:java/org/apache/catalina/ha/tcp/SimpleTcpCluster.java 28:java/org/apache/catalina/tribes/io/XByteBuffer.java 29:java/org/apache/catalina/core/ApplicationContextFacade.java 30:java/org/apache/catalina/tribes/transport/ReceiverBase.java 31:java/org/apache/catalina/Manager.java 35:java/javax/servlet/http/HttpServletResponseWrapper.java 36:java/org/apache/tomcat/util/digester/SetPropertiesRule.java 37:java/org/apache/tomcat/util/digester/SetPropertyRule.java 38:java/org/apache/catalina/session/ManagerBase.java 39:java/javax/servlet/http/HttpServletRequestWrapper.java 40:java/org/apache/catalina/realm/JAASRealm.java 41:java/org/apache/naming/resources/ResourceAttributes.java 43:java/org/apache/catalina/tribes/membership/McastService.java 44:java/org/apache/tomcat/util/digester/SetNextRule.java 45:java/org/apache/catalina/core/ApplicationHttpResponse.java 46:java/org/apache/tomcat/util/digester/SetRootRule.java 47:java/javax/servlet/jsp/el/ELParseException.java 48:java/org/apache/tomcat/util/digester/SetTopRule.java 49:java/org/apache/catalina/connector/Response.java 50:java/javax/servlet/jsp/el/FunctionMapper.java 52:java/org/apache/el/parser/SimpleCharStream.java 53:java/org/apache/catalina/connector/Request.java 54:java/org/apache/catalina/startup/Catalina.java 55:java/javax/servlet/jsp/el/VariableResolver.java 56:java/javax/servlet/SingleThreadModel.java 59:java/javax/servlet/jsp/el/ELException.java 60:java/javax/servlet/jsp/el/Expression.java 80:java/javax/servlet/jsp/tagext/BodyTag.java 86:java/javax/servlet/jsp/el/ExpressionEvaluator.java 126:java/javax/servlet/http/HttpUtils.java 157:java/org/apache/catalina/ha/session/DeltaSession.java
782	48123	"Bug 48123 4 misspellings in the javadoc of class ""org.apache.catalina.startup.WebRuleSet"""	No.1 Line: 99 /** * Construct an instance of this <code>RuleSet</code> with the default * matching pattern prefix and default fargment setting. */ public WebRuleSet() { 'fragment' was misspelled as 'fargment' No.2 Line: 614 /** * Rule to check that the <code>login-config</code> is occuring * only 1 time within the web.xml */ final class SetLoginConfig extends Rule { 'occurring' was misspelled as 'occuring' No.3 Line 635 /** * Rule to check that the <code>jsp-config</code> is occuring * only 1 time within the web.xml */ final class SetJspConfig extends Rule { 'occurring' was misspelled as 'occuring' No.4 Line 656 /** * Rule to check that the <code>session-config</code> is occuring * only 1 time within the web.xml */ final class SetSessionConfig extends Rule { 'occurring' was misspelled as 'occuring'	2009-11-04 02:02:40	1257320000	resolved fixed	363b79a	1257380000	java/org/apache/catalina/startup/WebRuleSet.java	1:java/org/apache/catalina/startup/WebRuleSet.java
783	48121	"Bug 48121 2 misspellings in the javadoc of class ""org.apache.catalina.startup.TldConfig"""	No.1 Line 194: /** * Attribute value used to turn on/off TLD namespace awarenes. */ private boolean tldNamespaceAware = false; 'awareness' was misspelled as 'awarenes' No.2 Line 261 /** * Get the server.xml &lt;host&gt; attribute's xmlNamespaceAware. * @return true if namespace awarenes is enabled. * */ public boolean getTldNamespaceAware(){ return this.tldNamespaceAware; } 'awareness' was misspelled as 'awarenes'	2009-11-04 01:48:39	1257320000	resolved fixed	5d9f68b	1257380000	java/org/apache/catalina/startup/TldConfig.java	1:java/org/apache/catalina/startup/TldConfig.java
784	48120	"Bug 48120 one misspelling in the javadoc of class ""org.apache.catalina.startup.SetNextNamingRule"""	"Line 50: /** * Construct a ""set next"" rule with the specified method name. * * @param methodName Method name of the parent method to call * @param paramType Java class of the parent method's argument * (if you wish to use a primitive type, specify the corresonding * Java wrapper class instead, such as <code>java.lang.Boolean</code> * for a <code>boolean</code> parameter) */ public SetNextNamingRule(String methodName, String paramType) { 'corresponding' was misspelled as 'corresonding'"	2009-11-04 01:45:46	1257320000	resolved fixed	7508847	1257380000	java/org/apache/catalina/startup/SetNextNamingRule.java	1:java/org/apache/catalina/startup/SetNextNamingRule.java
785	48117	"Bug 48117 two misspellings in the javadoc of class ""org.apache.catalina.startup.ContextConfig"""	"in protected synchronized void stop(): (Line: 1059) // Removing sercurity role 'security' is misspelled to 'sercurity' in protected InputSource getWebXmlSource(String filename, String path): (Line: 1354) /** * * @param filename Name of the file (possibly with one or more leading path * segemnts) to read * @param path Location that filename is relative to * @return */ 'segments' is misspelled to 'segemnts'."	2009-11-04 01:26:19	1257320000	resolved fixed	b6df018	1257380000	java/org/apache/catalina/startup/ContextConfig.java	1:java/org/apache/catalina/startup/ContextConfig.java
786	48119	"Bug 48119 5 misspellings in the javadoc of class ""org.apache.catalina.startup.HostConfig'"	"No.1 Line 146: /** * Attribute value used to turn on/off XML namespace awarenes. */ protected boolean xmlNamespaceAware = false; 'awareness' was misspelled as 'awarenes' No.2 Line 268: /** * Get the server.xml &lt;host&gt; attribute's xmlNamespaceAware. * @return true if namespace awarenes is enabled. * */ public boolean getXmlNamespaceAware(){ return xmlNamespaceAware; } 'awareness' was misspelled as 'awarenes' No.3 Line 366: /** * Has the specified application been deployed? Note applications defined * in server.xml will not have been deployed. * @return <code>true</code> if the application has been deployed and * <code>false</code> if the applciation has not been deployed or does not * exist */ public boolean isDeployed(String name) { 'application' was misspelled as 'applciation' No.4 Line 1328: /** * Add a new Context to be managed by us. * Entry point for the admin webapp, and other JMX Context controlers. */ public void manageApp(Context context) { 'controllers' was misspelled as 'controlers' Line 1382: /** * Remove a webapp from our control. * Entry point for the admin webapp, and other JMX Context controlers. */ public void unmanageApp(String contextPath) { 'controllers' was misspelled as 'controlers'"	2009-11-04 01:42:30	1257320000	resolved fixed	07e5982	1257340000	java/org/apache/catalina/startup/HostConfig.java	1:java/org/apache/catalina/startup/HostConfig.java
787	48118	"Bug 48118 two misspellings in the javadoc of class ""org.apache.catalina.startup.Embeded"""	"Line: 230 /** * Return true if redirction of standard streams is enabled. */ public boolean isRedirectStreams() { return (this.redirectStreams); } 'redirection' was misspelled to 'redirction' Line: 875 /** Initialize naming - this should only enable java:env and root naming. * If tomcat is embeded in an application that already defines those - * it shouldn't do it. * * XXX The 2 should be separated, you may want to enable java: but not * the initial context and the reverse * XXX Can we ""guess"" - i.e. lookup java: and if something is returned assume * false ? * XXX We have a major problem with the current setting for java: url */ protected void initNaming() { 'embedded' was mispelled to 'embeded'"	2009-11-04 01:33:03	1257320000	resolved fixed	ae16eb2	1257340000	java/org/apache/catalina/startup/Embedded.java	1:java/org/apache/catalina/startup/Embedded.java
788	46947	Bug 46947 Code cleanup patch that removes some obsolete null checks		2009-03-31 13:00:32	1238520000	resolved fixed	6908b18	1257300000	java/org/apache/catalina/ant/jmx/JMXAccessorTask.java java/org/apache/catalina/tribes/transport/bio/BioReceiver.java java/org/apache/catalina/valves/JDBCAccessLogValve.java java/org/apache/tomcat/util/net/NioBlockingSelector.java	134:java/org/apache/catalina/valves/JDBCAccessLogValve.java 508:java/org/apache/catalina/ant/jmx/JMXAccessorTask.java 579:java/org/apache/tomcat/util/net/NioBlockingSelector.java 1012:java/org/apache/catalina/tribes/transport/bio/BioReceiver.java
789	48102	Bug 48102 'Bootstrap' is misspelled as 'Boostrap' in the javadoc of the class of 'org.apache.catalina.startup.Bootstrap'	"Below is the javadoc of the class of 'org.apache.catalina.startup.Bootstrap': /** * Boostrap loader for Catalina. This application constructs a class loader * for use in loading the Catalina internal classes (by accumulating all of the * JAR files found in the ""server"" directory under ""catalina.home""), and * starts the regular execution of the container. The purpose of this * roundabout approach is to keep the Catalina internal classes (and any * other classes they depend on, such as an XML parser) out of the system * class path and therefore not visible to application level classes. * * @author Craig R. McClanahan * @author Remy Maucherat * @version $Revision: 831860 $ $Date: 2009-11-02 19:00:01 +0800 (Mon, 02 Nov 2009) $ */ the first word ommits a 't' letter. It sould be 'Bootstrap', not 'Boostrap'."	2009-11-02 03:11:25	1257150000	resolved fixed	c060034	1257210000	java/org/apache/catalina/startup/Bootstrap.java	1:java/org/apache/catalina/startup/Bootstrap.java
790	48104	"Bug 48104 the javadoc of class 'org.apache.catalina.startup.Catalina' is not complete, as in the usage() method"	"Below is the javadoc of class 'org.apache.catalina.startup.Catalina': /** * Startup/Shutdown shell program for Catalina. The following command line * options are recognized: * <ul> * <li><b>-config {pathname}</b> - Set the pathname of the configuration file * to be processed. If a relative path is specified, it will be * interpreted as relative to the directory pathname specified by the * ""catalina.base"" system property. [conf/server.xml] * <li><b>-help</b> - Display usage information. * <li><b>-stop</b> - Stop the currently running instance of Catalina. * </u> * * Should do the same thing as Embedded, but using a server.xml file. * * @author Craig R. McClanahan * @author Remy Maucherat * @version $Revision: 752323 $ $Date: 2009-03-11 08:46:54 +0800 (Wed, 11 Mar 2009) $ */ However, it doesn't allude the '-nonmaing' option, and 'start' option. Below is the usage() method of the same class: /** * Print usage information for this application. */ protected void usage() { System.out.println (""usage: java org.apache.catalina.startup.Catalina"" + "" [ -config {pathname} ]"" + "" [ -nonaming ] { start | stop }""); } It is not complete either. It lacks the '-help' option."	2009-11-02 03:20:57	1257150000	resolved fixed	481cfe9	1257210000	java/org/apache/catalina/startup/Catalina.java	1:java/org/apache/catalina/startup/Catalina.java
791	47881	Bug 47881 org.apache.catalina.startup.Bootstrap's main method handles 'startd' or 'stopd' wrongly	"String command = ""start""; if (args.length > 0) { command = args[args.length - 1]; } if (command.equals(""startd"")) { args[0] = ""start""; daemon.load(args); daemon.start(); } else if (command.equals(""stopd"")) { args[0] = ""stop""; daemon.stop(); } ... ... should be: String command = ""start""; if (args.length > 0) { command = args[args.length - 1]; } if (command.equals(""startd"")) { args[args.length - 1] = ""start""; daemon.load(args); daemon.start(); } else if (command.equals(""stopd"")) { args[args.length - 1] = ""stop""; daemon.stop(); } ... ... Please refer to the following usage method of org.apache.catalina.startup.Catalina: protected void usage() { System.out.println (""usage: java org.apache.catalina.startup.Catalina"" + "" [ -config {pathname} ]"" + "" [ -nonaming ] { start | stop }""); }"	2009-09-20 19:14:04	1253490000	resolved fixed	3ef0f21	1257160000	java/org/apache/catalina/startup/Bootstrap.java	1:java/org/apache/catalina/startup/Bootstrap.java
792	47331	Bug 47331 No translation error messag when using #{...} in template text		2009-06-08 02:22:52	1244440000	resolved fixed	f3b04b4	1257120000	java/org/apache/jasper/compiler/Validator.java	69:java/org/apache/jasper/compiler/Validator.java
793	47451	Bug 47451 NPE if response contains null content-encoding header		2009-06-29 14:53:48	1246300000	resolved fixed	14084ac	1257120000	java/org/apache/catalina/connector/Response.java	6:java/org/apache/catalina/connector/Response.java
794	47364	Bug 47364 HttpServletRequest.getAttributeNames() does not return the names of all attributes	"In an email exchange that involved Ranier (see attachment), he suggested I log this in Bugzilla, so I am. I was using Tomcat 6.0.20 on Windows XP SP3 with the latest Java 6 JVM. In the doGet method of a servlet, I was trying to see all request attributes to see if the ""sendfile supported"" attribute was set (specifically the request attribute org.apache.tomcat.sendfile.support). On my first pass at this I just used HttpServletRequest.getAttributeNames() to dump all the names of the attributes expecting to see this one listed, but I got no attributes listed at all. Then I actually got the attribute via getAttribute(""org.apache.tomcat.sendfile.support"") which worked. So getAttributeNames is not returning the names of all attributes. So either: 1. getAttributeNames needs to be fixed to return the names of all attributes (i.e., a code change); or 2. The Tomcat doc needs to be updated in some way as to say thatgetAttributeNames only returns certain attributes and blah blah (i.e., a doc change). Again my original email and Ranier's reply is attached. Thanks!"	2009-06-12 13:44:21	1244830000	resolved fixed	7fc56b4	1257100000	java/org/apache/catalina/connector/Request.java	6:java/org/apache/catalina/connector/Request.java
795	48009	Bug 48009 Editing context.xml may cause unwanted undeploy of a webapp	"Tomcat polls context.xml files for changes. If a previously-existing context.xml is missing at the instant Tomcat polls, then the application is undeployed. Some text editors (notably vi and its derivatives) create backup files by: 1) Renaming the original file, then 2) creating a new file and writing the edited contents to that file. Therefore there is a race condition. There is a small but non-zero probability that a user editing and saving context.xml using such an editor will see their webapp undeployed. Messages on tomcat-users indicate that such a situation has occurred on a production server at least once. It's undoubtedly rare. Suggested fixes: - Examine the directory for the presence of backup files for context.xml, and do not undeploy if one is found even if context.xml is missing. This is horribly ugly and makes the semantics of ""a backup file"" very peculiar, but is actually the only way to *prevent* the race - anything else only makes it less likely, as on a heavily loaded system (or one where context.xml is being edited via a network file share) the interval between the old context.xml being renamed and the new one being created may be arbitrarily long. - Only undeploy if the file is missing for a period of time. The discussion is then around that period. On tomcat-users, Mark Thomas suggested polling again after 500ms; I suggested remembering the state between polls and only undeploying if the file was missing for two successive polls. This is a cleaner fix to explain, but is not a complete solution as it does not remove the possibility of such a race. --- As an aside, there may well be a similar issue where Tomcat polls for context.xml as it is being written, finds it has changed, and reads a part-written version. In mitigation, the files involved are typically small and may well be written in one or very few operations; however, Tomcat should probably not assume that any file change is atomic."	2009-10-16 01:52:21	1255670000	resolved fixed	d55f1d9	1256160000	java/org/apache/catalina/startup/HostConfig.java	2:java/org/apache/catalina/startup/HostConfig.java
796	48019	"Bug 48019 StackOverflowError on ""include"""	"JSP file name: /common/headers.jsp It's cotent: <% // example: <%@ include file=""/common/headers.jsp"" % > %> <meta http-equiv=""Content-Type"" content=""text/html;charset=utf-8"" /> <meta http-equiv=""Cache-Control"" content=""no-store"" /> <meta http-equiv=""Pragma"" content=""no-cache"" /> <meta http-equiv=""Expires"" content=""0"" /> <link href=""../css/css.css"" rel=""stylesheet"" type=""text/css""> Console output: java.lang.StackOverflowError at java.text.DateFormat.format(DateFormat.java:275) at java.text.Format.format(Format.java:140) at java.text.MessageFormat.subformat(MessageFormat.java:1288) at java.text.MessageFormat.format(MessageFormat.java:795) at java.util.logging.SimpleFormatter.format(SimpleFormatter.java:50) at java.util.logging.StreamHandler.publish(StreamHandler.java:179) at java.util.logging.ConsoleHandler.publish(ConsoleHandler.java:88) at java.util.logging.Logger.log(Logger.java:458) at java.util.logging.Logger.doLog(Logger.java:480) at java.util.logging.Logger.logp(Logger.java:680) at org.apache.juli.logging.DirectJDKLog.log(DirectJDKLog.java:167) at org.apache.juli.logging.DirectJDKLog.error(DirectJDKLog.java:135) at org.apache.jasper.compiler.JspReader.pushFile(JspReader.java:606) at org.apache.jasper.compiler.JspReader.<init>(JspReader.java:141) at org.apache.jasper.compiler.JspReader.<init>(JspReader.java:119) at org.apache.jasper.compiler.ParserController.determineSyntaxAndEncoding(ParserController.java:399) at org.apache.jasper.compiler.ParserController.doParse(ParserController.java:207) at org.apache.jasper.compiler.ParserController.parse(ParserController.java:137) at org.apache.jasper.compiler.Parser.processIncludeDirective(Parser.java:339) at org.apache.jasper.compiler.Parser.parseIncludeDirective(Parser.java:376) at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:484) at org.apache.jasper.compiler.Parser.parseTagFileDirectives(Parser.java:1784) at org.apache.jasper.compiler.Parser.parse(Parser.java:127) This not exist in ""6.0.18""."	2009-10-17 07:18:47	1255780000	resolved fixed	deac657	1256160000	java/org/apache/jasper/compiler/Parser.java	2:java/org/apache/jasper/compiler/Parser.java
797	40001	Bug 40001 HTML pages should not use GET to restart web-apps.		2006-07-10 14:32:20	1152560000	resolved fixed	99f01fd	1255210000	java/org/apache/catalina/manager/Constants.java java/org/apache/catalina/manager/HTMLManagerServlet.java	3:java/org/apache/catalina/manager/HTMLManagerServlet.java 245:java/org/apache/catalina/manager/Constants.java
798	47320	Bug 47320 Decoding jsessionid bug on z/os	"If you receive a rewritten URL on z/os with uss (unix on a mainframe), Tomcat does not properly decode the jsessionid portion of the URL. The problem is in org.apache.catalina.connector.CoyoteAdapter in the parseSessionId method. The two instantiations of a String object do not specify the encdoding to use. e.g. String sid = new String(uriBC.getBuffer(), start + sessionIdStart, semicolon2 - sessionIdStart); ...as well as the second String instantiation in this method. Consequently z/os uses its default encoding which (I think) is EBCDIC. If I recompile with a hardcoded ""UTF-8"" for the encoding then the jsessionid decodes properly. Not that I am suggesting this literally for the official fix. e.g. String sid = new String(uriBC.getBuffer(), start + sessionIdStart, semicolon2 - sessionIdStart, ""UTF-8"");"	2009-06-05 08:37:24	1244210000	resolved fixed	0f99904	1254070000	java/org/apache/catalina/connector/CoyoteAdapter.java	1:java/org/apache/catalina/connector/CoyoteAdapter.java
799	47499	Bug 47499 provide better insight on BindException: Cannot assign requested address	1) cite the address you attempt to listen (not just the port) 2) proper exception chaining the following info is currently lost: <<java.net.BindException: Cannot assign requested address at java.net.PlainSocketImpl.socketBind(Native Method) at java.net.PlainSocketImpl.bind(PlainSocketImpl.java:359) at java.net.ServerSocket.bind(ServerSocket.java:319) at java.net.ServerSocket.<init>(ServerSocket.java:185) at javax.net.ssl.SSLServerSocket.<init>(SSLServerSocket.java:106) at com.privasphere.net.ssl.SSLServerSocketImpl.<init>(SSLServerSocketImpl.java:106) at com.privasphere.net.ssl.SSLServerSocketFactoryImpl.createServerSocket(SSLServerSocketFactoryImpl.java:71) at org.apache.tomcat.util.net.jsse.JSSESocketFactory.createSocket(JSSESocketFactory.java:100) at org.apache.tomcat.util.net.PoolTcpEndpoint.initEndpoint(PoolTcpEndpoint.java:295) at org.apache.coyote.http11.Http11BaseProtocol.init(Http11BaseProtocol.java:139) at org.apache.catalina.connector.Connector.initialize(Connector.java:1017) at org.apache.catalina.core.StandardService.initialize(StandardService.java:578)>>	2009-07-08 22:05:03	1247110000	resolved fixed	73bb9e4	1253650000	java/org/apache/tomcat/util/net/JIoEndpoint.java	2:java/org/apache/tomcat/util/net/JIoEndpoint.java
800	47866	Bug 47866 NullPointerException in embedded tomcat	"It seems that the WebappClassLoader was stopped? {noformat} Caused by: java.lang.NullPointerException at org.apache.catalina.loader.WebappClassLoader.findResources(WebappClassLoader.java:994) at java.lang.ClassLoader.getResources(ClassLoader.java:1016) {noformat} All I did was launch a server add a context and then ask it to load a resource from its classpath. It's a bit more complicated than that, so I'll try and narrow it down if needed."	2009-09-18 00:23:03	1253250000	resolved wontfix	189181a	1253530000	test/org/apache/catalina/startup/TestTomcat.java	27:test/org/apache/catalina/startup/TestTomcat.java
801	47225	Bug 47225 Wrong argument in redirectPath.setChars in Mapper.internalMapWrapper()		2009-05-19 21:52:39	1242780000	resolved fixed	a31d52f	1253140000	java/org/apache/tomcat/util/http/mapper/Mapper.java	5:java/org/apache/tomcat/util/http/mapper/Mapper.java
802	47161	Bug 47161 Manager ignores executors on status pages	"When displaying the thread pools, the StatusManagerServlet ignores executors and uses the 'standard' ThreadPool information for each connector. This causes incorrect information to be displayed when a connector is configured to use an executor. On a related topic, it appears that the connector<->executor link is not exposed via JMX (which it will need to be to fix this)."	2009-05-06 07:20:31	1241610000	resolved fixed	aaf7b5d	1253050000	java/org/apache/tomcat/util/net/AbstractEndpoint.java java/org/apache/tomcat/util/threads/ResizableExecutor.java	10:java/org/apache/tomcat/util/net/AbstractEndpoint.java 16:java/org/apache/tomcat/util/threads/ResizableExecutor.java
803	46950	Bug 46950 SSL renegotiation does not occur when resource with CLIENT-CERT auth is requested	"When a part of a webapp requires an SSL connection with a client certificate there should be an SSL renegotiation to request a client certificate from the browser. This is the configuration I added to an webapp that already uses an SSL connector: <login-config id=""LoginConfig_1""> <auth-method>CLIENT-CERT</auth-method> <realm-name>WPS</realm-name> </login-config> <security-constraint id=""SecurityConstraint_1""> <web-resource-collection id=""WebResourceCollection_1""> <web-resource-name/> <url-pattern>/LoginWithCert.do</url-pattern> <http-method>DELETE</http-method> <http-method>GET</http-method> <http-method>POST</http-method> <http-method>PUT</http-method> <http-method>HEAD</http-method> </web-resource-collection> <user-data-constraint id=""UserDataConstraint_4""> <transport-guarantee>CONFIDENTIAL</transport-guarantee> </user-data-constraint> </security-constraint> Requests to /LoginWithCert.do require an SSL connection, if there isn't one, but no client certificate is requested."	2009-04-01 06:33:02	1238580000	resolved fixed	e9248d7	1253040000	java/org/apache/catalina/core/AprLifecycleListener.java java/org/apache/coyote/http11/Http11AprProcessor.java java/org/apache/tomcat/jni/SSLSocket.java	23:java/org/apache/coyote/http11/Http11AprProcessor.java 40:java/org/apache/tomcat/jni/SSLSocket.java 409:java/org/apache/catalina/core/AprLifecycleListener.java
804	47828	Bug 47828 Change Tomcat.setSilent() to setSilent(boolean)	"Change Tomcat.setSilent() to setSilent(boolean). It's nicer for clients to have a JavaBean type setter, and it doesn't seem to make sense that you can set something but not unset it."	2009-09-12 00:37:54	1252730000	resolved fixed	59e88f1	1253010000	java/org/apache/catalina/startup/Tomcat.java	1:java/org/apache/catalina/startup/Tomcat.java
805	47820	Bug 47820 Static utility methods in Tomcat should be instance methods	"Why are the static addServlet() methods in Tomcat static? I can see they don't use any state from the instance, but isn't it cleaner to use an instance method, so that the API is uniform (everything I want to do to a tomcat instance goes through the instance)? It would be more consistent to follow the pattern of addServlet(String,String,String), and search for the context by name instead of requiring the instance to be passed in to a static method."	2009-09-11 02:09:00	1252650000	resolved fixed	6cce550	1253010000	java/org/apache/catalina/startup/Tomcat.java	4:java/org/apache/catalina/startup/Tomcat.java
806	47826	Bug 47826 a logging statement error in org.apache.catalina.startup.Bootstrap.java	"// Local repository boolean replace = false; String before = repository; while ((i=repository.indexOf(CATALINA_HOME_TOKEN))>=0) { replace=true; if (i>0) { repository = repository.substring(0,i) + getCatalinaHome() + repository.substring(i+CATALINA_HOME_TOKEN.length()); } else { repository = getCatalinaHome() + repository.substring(CATALINA_HOME_TOKEN.length()); } } while ((i=repository.indexOf(CATALINA_BASE_TOKEN))>=0) { replace=true; if (i>0) { repository = repository.substring(0,i) + getCatalinaBase() + repository.substring(i+CATALINA_BASE_TOKEN.length()); } else { repository = getCatalinaBase() + repository.substring(CATALINA_BASE_TOKEN.length()); } } if (replace && log.isDebugEnabled()) log.debug(""Expanded "" + before + "" to "" + replace); The last line should be: ""log.debug(""Expanded "" + before + "" to "" + repository);"""	2009-09-11 17:39:34	1252710000	resolved fixed	720de5e	1252770000	java/org/apache/catalina/startup/Bootstrap.java	1:java/org/apache/catalina/startup/Bootstrap.java
807	47705	Bug 47705 ArithmeticException: / by zero when expiring sessions via manager	"Received ArithmeticException: / by zero when expiring sessions via Tomcat manager webapp. This exception was thrown only if session-timeout is set as -1 on webapp web.xml. Moreover, the exception was also thrown regardless of the idle parameter value (/expire?path=/xxx&idle=mm) as long as session-timeout = -1. Result: Exception stacktrace: ERROR: 19/08/2009 00:18:22 [http-80-exec-33] (org.apache.catalina.core.ApplicationContext:669) HTMLManager: ManagerServlet.sessions[/contextpath] java.lang.ArithmeticException: / by zero at org.apache.catalina.manager.ManagerServlet.sessions(ManagerServlet.java:1133) at org.apache.catalina.manager.HTMLManagerServlet.sessions(HTMLManagerServlet.java:573) at org.apache.catalina.manager.HTMLManagerServlet.expireSessions(HTMLManagerServlet.java:660) at org.apache.catalina.manager.HTMLManagerServlet.doGet(HTMLManagerServlet.java:118) at org.apache.catalina.manager.HTMLManagerServlet.doPost(HTMLManagerServlet.java:157) at javax.servlet.http.HttpServlet.service(HttpServlet.java:637) at javax.servlet.http.HttpServlet.service(HttpServlet.java:717) at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:290) at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206) at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:233) at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191) at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:525) at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:128) at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:102) at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:109) at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:286) at org.apache.coyote.http11.Http11NioProcessor.process(Http11NioProcessor.java:880) at org.apache.coyote.http11.Http11NioProtocol$Http11ConnectionHandler.process(Http11NioProtocol.java:719) at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.run(NioEndpoint.java:2081) at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908) at java.lang.Thread.run(Thread.java:619)"	2009-08-19 00:12:52	1250660000	resolved fixed	6ab874a	1251730000	java/org/apache/catalina/manager/ManagerServlet.java	8:java/org/apache/catalina/manager/ManagerServlet.java
808	47378	Bug 47378 welcome-file ignores servlet mapping	"Web applications that use a servlet mapping for their welcome-file are ignored and the server returns either a directory listing or a 404 if the listing is disabled. I have JSF servlet defined and a servlet-mapping for *.jsf to go to the FacesServlet. I have ""index.jsf"" listed as by welcome-file and I get a 404 with directory listing disabled. I also have a custom servlet defined with its mapping and set the welcome-file to its mapping and get a 404 as well."	2009-06-16 12:52:31	1245170000	resolved fixed	fe53ca9	1251730000	java/org/apache/tomcat/util/http/mapper/Mapper.java	3:java/org/apache/tomcat/util/http/mapper/Mapper.java
809	47612	Bug 47612 [PATCH] fix unsafe public string array in AbstractCreateStatementInterceptor		2009-07-30 18:21:37	1248990000	resolved fixed	4f5a5e4	1249490000	modules/jdbc-pool/java/org/apache/tomcat/jdbc/pool/interceptor/AbstractCreateStatementInterceptor.java modules/jdbc-pool/java/org/apache/tomcat/jdbc/pool/interceptor/AbstractQueryReport.java	1:modules/jdbc-pool/java/org/apache/tomcat/jdbc/pool/interceptor/AbstractCreateStatementInterceptor.java 3:modules/jdbc-pool/java/org/apache/tomcat/jdbc/pool/interceptor/AbstractQueryReport.java
810	47583	Bug 47583 Fix occasional test failure in TestConcurrency		2009-07-26 06:43:28	1248610000	resolved fixed	278dedc	1248980000	modules/jdbc-pool/test/org/apache/tomcat/jdbc/test/TestConcurrency.java	1:modules/jdbc-pool/test/org/apache/tomcat/jdbc/test/TestConcurrency.java
811	47576	Bug 47576 Javadoc errors - Exception name misspelt	The files FairBlockingQueue.java MultiLockFairBlockingQueue.java use * @throws UnsupportedOperation This should be * @throws UnsupportedOperationException	2009-07-24 17:27:54	1248470000	resolved fixed	abbb922	1248980000	modules/jdbc-pool/java/org/apache/tomcat/jdbc/pool/FairBlockingQueue.java modules/jdbc-pool/java/org/apache/tomcat/jdbc/pool/MultiLockFairBlockingQueue.java	1:modules/jdbc-pool/java/org/apache/tomcat/jdbc/pool/MultiLockFairBlockingQueue.java 2:modules/jdbc-pool/java/org/apache/tomcat/jdbc/pool/FairBlockingQueue.java
812	47569	Bug 47569 Test cases do not clear up afterwards	"Some of the test cases (e.g. TestTomcat) start a Tomcat server, This creates the directory tree tomcat.8080/work... which is not deleted when the test finishes."	2009-07-23 13:08:38	1248370000	resolved fixed	a9e00d5	1248980000	test/org/apache/catalina/connector/TestRequest.java test/org/apache/catalina/startup/TestTomcat.java	1:test/org/apache/catalina/startup/TestTomcat.java 420:test/org/apache/catalina/connector/TestRequest.java
813	47568	Bug 47568 TestTomcat fails to delete work directory	"TestTomcat.setUp() creates a work directory, but does not delete it in tearDown()"	2009-07-23 12:56:58	1248370000	resolved fixed	cfb18a0	1248940000	test/org/apache/catalina/startup/TestTomcat.java	1:test/org/apache/catalina/startup/TestTomcat.java
814	41824	Bug 41824 Unable to use nested type in TLD		2007-03-12 10:40:25	1173710000	resolved fixed	768af9f	1248460000	java/org/apache/jasper/compiler/JspUtil.java	6:java/org/apache/jasper/compiler/JspUtil.java
815	46907	Bug 46907 Jasper with log4j in web-app classpath and debug level enabled prevents reading HTTP POST stream from JSP	"This is on Tomcat 5.5.x (don't remember the last rev. number, not my current machine). When log4j is in the classpath of the web-app and is configured to log at debug level, Jasper dumps the whole HTTP POST request body as debug traces. This consumes the HttpServletRequest input stream which then arrives unusable for the user at the beginning of the JSP code (using HttpServletRequest.getInputStream(), the stream is already at its end). A workaround is to disable debug traces for Japser class in log4j.properties, but Jasper should not consume the HttpServletRequest input stream whatever mode it runs into."	2009-03-24 15:20:17	1237920000	resolved fixed	50d0e6e	1248370000	java/org/apache/jasper/servlet/JspServlet.java	40:java/org/apache/jasper/servlet/JspServlet.java
816	47518	Bug 47518 Valve Interface Javadocs for invoke method references non-existent method	"It appears that the Valve interface javadoc hasn't been updated since around TC 5.5. Here is a snip of what it currently available from TC's website (6.0.20 I would guess): "" # If the corresponding Response was not generated (and control was not returned, call the next Valve in the pipeline (if there is one) by executing context.invokeNext(). . . . # Modify the HTTP headers included with the Response after the invokeNext() method has returned. # Perform any actions on the output stream associated with the specified Response after the invokeNext() method has returned. "" The invokeNext method has not existed in the Valve interface in many versions. I believe the replacement is: this.getNext().invoke(request, response) I'm happy to provide a doc patch if getNext().invoke(request, response) is the expected replacement for invokeNext(request, response). Note that the docs for 5.5 also have the same problem. Please let me know if I should log that separately."	2009-07-13 06:40:01	1247480000	resolved fixed	9dc93f5	1248160000	java/org/apache/catalina/Valve.java	1:java/org/apache/catalina/Valve.java
817	41059	Bug 41059 WebAppClassLoader clearReferences code break running threads	When the WebAppClassLoader stops it manually sets all static and final variables to null in the clearReferences method. This results in NPEs for any thread that was not stopped and not expecting its final or static variables to be null. This is particularly a problem with hot deploys since the unload fails and terminating the deploy.	2006-11-28 11:53:02	1164730000	resolved fixed	a9f0239	1247850000	java/org/apache/catalina/loader/WebappClassLoader.java	1:java/org/apache/catalina/loader/WebappClassLoader.java
818	40551	Bug 40551 Sticky sessions using PersistentManager enter indeterminate state on node failover	"If a cluster of nodes is being load balanced with sticky sessions, and a particular node becomes unavailable, any sessions bound to that node must be redistributed. Particularly in the case of mod_jk these sessions will not be bound to whichever node the failover occurred on because the jessionid will still contain the JVM route of the original failed node, thus placing the session in an indeterminate state and losing sticky properties. I am attaching a patch that will trigger a session to rebind itself to a new node if the jvmroutes don't match and replace the jessionid in the browser's cookie."	2006-09-20 01:33:41	1158730000	resolved fixed	f0d447d	1247770000	java/org/apache/catalina/ha/session/JvmRouteBinderValve.java	1:java/org/apache/catalina/ha/session/JvmRouteBinderValve.java
819	47515	Bug 47515 Tomcat can't replicate session when it is started.		2009-07-12 23:08:36	1247450000	resolved fixed	83e98da	1247750000	java/org/apache/catalina/ha/session/DeltaManager.java	5:java/org/apache/catalina/ha/session/DeltaManager.java
820	40380	Bug 40380 Potential syncro problem in StandardSession.expire(boolean)	"public void expire(boolean notify) { // Mark this session as ""being expired"" if needed if (expiring) return; // No man's land here synchronized (this) { if (manager == null) return; expiring = true;"	2006-08-31 18:57:30	1157070000	resolved fixed	6f3e56e	1247590000	java/org/apache/catalina/session/StandardSession.java	1:java/org/apache/catalina/session/StandardSession.java
821	47524	Bug 47524 McastServiceImpl executor is not dispatching events.		2009-07-14 06:20:02	1247570000	resolved fixed	aa8a2d3	1247580000	java/org/apache/catalina/tribes/membership/McastServiceImpl.java java/org/apache/catalina/tribes/transport/ReceiverBase.java java/org/apache/catalina/tribes/util/ExecutorFactory.java	1:java/org/apache/catalina/tribes/membership/McastServiceImpl.java 7:java/org/apache/catalina/tribes/transport/ReceiverBase.java
822	39231	Bug 39231 The JAAS contract for LoginModule is broken	"The issue is that the custom JAAS's LoginModule.logout() method is never called. I guess this has been never implemented correctly (at least since Tomcat 5.5.9). The thing is that according to the JAAS spec, the LoginContext.logout() is supposed to invoke the logout method for each LoginModule configured for this LoginContext. So, somebody should be sure to call LoginContext.logout() method. The caller for this method could be either a server or a client. So, either Tomcat should provide some means to access the LoginContext to the clients, or Tomcat should take the responsibility to call this method by itself. I guess the solution could be for Tomcat to associate the instance of LoginContext with the user's session, and then Tomcat could invoke LoginContext.logout() when the session is being invalidated (both when the session times out or invalidated explicitely). I hope that I am correctly interpreting the JAAS spec."	2006-04-06 21:19:49	1144370000	resolved fixed	80f8ec6	1246980000	java/org/apache/catalina/realm/GenericPrincipal.java java/org/apache/catalina/realm/JAASRealm.java java/org/apache/catalina/session/StandardSession.java	2:java/org/apache/catalina/realm/JAASRealm.java 40:java/org/apache/catalina/session/StandardSession.java 372:java/org/apache/catalina/realm/GenericPrincipal.java
823	47478	Bug 47478 DeltaSession ignores notifyListenersOnReplication when BackupManager is used.		2009-07-06 03:05:17	1246860000	resolved fixed	c1099f7	1246900000	java/org/apache/catalina/ha/session/DeltaSession.java	3:java/org/apache/catalina/ha/session/DeltaSession.java
824	37933	Bug 37933 Bugs in Tomcat		2005-12-16 07:00:20	1134730000	resolved fixed	202a33e	1246790000	java/org/apache/jasper/compiler/Generator.java java/org/apache/jasper/compiler/PageInfo.java	19:java/org/apache/jasper/compiler/Generator.java
825	37984	Bug 37984 JNDIRealm.java not able to handle MD5 password	"I'm using JNDIRealm to authenticate to OpenLDAP 2.2.28. Within OpenLDAP I've configured the userPassword attribute for each user to contain the MD5 digest, and each is prefixed with the string ""{MD5}"". I am not an LDAP expert by any means but I believe this prefix is a standard convention. Anyway assuming this is a convention then JNDIRealm needs to strip off the ""{MD5}"" portion much like it does with ""{SHA1}"". See attached patch which accomplishes this and I verified it works in my environment."	2005-12-21 05:51:20	1135160000	resolved fixed	c6818a0	1246490000	java/org/apache/catalina/realm/JNDIRealm.java	1:java/org/apache/catalina/realm/JNDIRealm.java
826	47440	Bug 47440 Remove DB-specific SQL statements from test cases (SELECT 1)	"Some of the test cases assume that the JDBC provider supports ""SELECT 1"" as a valid SQL statement; however this is not always the case, e.g. Derby requires a table name to select from. The solution provided in the patches is to use the validation query defined in the properties set up for the test, rather than always using ""SELECT 1""."	2009-06-27 05:17:55	1246090000	resolved fixed	d92da6e	1246290000	modules/jdbc-pool/test/org/apache/tomcat/jdbc/test/CheckOutThreadTest.java modules/jdbc-pool/test/org/apache/tomcat/jdbc/test/DefaultProperties.java modules/jdbc-pool/test/org/apache/tomcat/jdbc/test/TestSlowQueryReport.java	7:modules/jdbc-pool/test/org/apache/tomcat/jdbc/test/TestSlowQueryReport.java 51:modules/jdbc-pool/test/org/apache/tomcat/jdbc/test/DefaultProperties.java 109:modules/jdbc-pool/test/org/apache/tomcat/jdbc/test/CheckOutThreadTest.java
827	47439	Bug 47439 PooledConnection.connect() fails to check for null connection	PooledConnection.connect() fails to check for null return from java.sql.Driver.connect() method. This can result in an NPE when the connection is used later.	2009-06-27 05:01:35	1246090000	resolved fixed	ef96fa2	1246200000	modules/jdbc-pool/java/org/apache/tomcat/jdbc/pool/PooledConnection.java	1:modules/jdbc-pool/java/org/apache/tomcat/jdbc/pool/PooledConnection.java
828	38352	Bug 38352 Additional Entries for Default catalina.policy file.	"This patch adds additional entries to the catalina.policy file. Specifically: The catalina.base/shared directory is added and given equal permissions to catalina.home/common java.io.tmpdir is now readable. javax.servlet.context.tempdir is now readable. I think to be compliant with the spec, this must be allowed. Directory specified by java.io.tmpdir (which is what tomcat points javax.servlet.context.tempdir to) is now read, write, delete. Again, I think the spec requires this."	2006-01-22 20:27:46	1137980000	resolved fixed	76a4eb3	1245420000	java/org/apache/jasper/compiler/JspRuntimeContext.java	33:java/org/apache/jasper/compiler/JspRuntimeContext.java
829	47308	Bug 47308 Cannot join in the cluster membership.		2009-06-03 03:39:06	1244010000	resolved fixed	51fd68b	1245340000	java/org/apache/catalina/tribes/membership/McastService.java java/org/apache/catalina/tribes/membership/McastServiceImpl.java	21:java/org/apache/catalina/tribes/membership/McastService.java 53:java/org/apache/catalina/tribes/membership/McastServiceImpl.java
830	47389	Bug 47389 DeltaManager doesn't do the session replication. (notifySessionListenersOnReplication=false)		2009-06-18 03:39:55	1245310000	resolved fixed	c768090	1245340000	java/org/apache/catalina/ha/session/DeltaManager.java	1:java/org/apache/catalina/ha/session/DeltaManager.java
831	47369	Bug 47369 DeltaRequest is never reset. (use BackupManager)		2009-06-15 03:34:59	1245050000	resolved fixed	b3e2be4	1245090000	java/org/apache/catalina/tribes/tipis/AbstractReplicatedMap.java	8:java/org/apache/catalina/tribes/tipis/AbstractReplicatedMap.java
832	47343	"Bug 47343 Fails re-deploying, when we update context.xml."		2009-06-10 03:54:19	1244620000	resolved fixed	cc1f0dd	1244730000	java/org/apache/catalina/startup/HostConfig.java	2:java/org/apache/catalina/startup/HostConfig.java
833	47299	Bug 47299 Cannot override StandardContext in embedding case because of StandardSession.fireContainerEvent	StandardSession.fireContainerEvent checks for the String class name! Why not just use an instanceof check here?	2009-06-02 07:19:36	1243940000	resolved fixed	468f370	1244240000	java/org/apache/catalina/session/StandardSession.java	2:java/org/apache/catalina/session/StandardSession.java
834	47158	Bug 47158 I think AccessLogValve has race condition problem		2009-05-05 15:12:45	1241550000	resolved fixed	f00029e	1244130000	java/org/apache/catalina/valves/AccessLogValve.java	1:java/org/apache/catalina/valves/AccessLogValve.java
835	47216	Bug 47216 Possible NPE in Http11Processor.action()	"The code at around line 1075: } else if (actionCode == ActionCode.ACTION_REQ_LOCAL_ADDR_ATTRIBUTE) { if (localAddr == null) localAddr = socket.getLocalAddress().getHostAddress(); fails to check if ""socket != null"". Since this is checked everywhere else in the method this is probably a bug. The method Http11Processor.parseHost() also references ""socket"" without checking for null. Within the class, it is only called by process(Socket), which guarantees that it won't be null. However once process() returns normally, socket will be set to null. The parseHost() method is public, so it may be called when socket == null. Perhaps the parseHost() method should be private?"	2009-05-18 18:13:50	1242680000	resolved wontfix	36feee0	1243250000	java/org/apache/coyote/http11/Http11Processor.java	1:java/org/apache/coyote/http11/Http11Processor.java
836	47234	Bug 47234 serviceStartTime is different in MemberImpl from McastServiceImpl	"Hi, I'm using the tribes cluster module in my own application (which has nothing to do with tomcat) and I'm using the member alive time value to sort all the cluster members. This bug produces the following: I have 2 nodes that were started almost at the same time and both nodes claim that the other node was started before them NODE1: Remote members: (-52.63.57.110:4001 ready=true suspect=false failing=false aliveTime=1526) Local member: (-52.63.57.109:4000 ready=true suspect=false failing=false aliveTime=1236) NODE2: Remote members: (-52.63.57.109:4000 ready=true suspect=false failing=false aliveTime=2021) Local member: (-52.63.57.110:4001 ready=true suspect=false failing=false aliveTime=1069) My code do the following: Member[] members = groupChannel.getMembers(); printRemote(members); Member localMember = groupChannel.getLocalMember(true); printLocal(localMember); In that code (due to timing issues) it should possible the other way around (that every node claim to be started before the other) but not that case. The issue occurs because when the McastService is started, it assigns a start time to the local member. public class McastService .... { public void start(int level) { .... localMember.setServiceStartTime(System.currentTimeMillis()); .... impl = new McastServiceImpl(localMember, ....); impl.start(level); } } But, then it creates and starts a McastServiceImpl which also stores a new serviceStartTime :-( public class McastServiceImpl { protected long serviceStartTime; public void start(int level) { .... serviceStartTime = System.currentTimeMillis(); .... } } So, we have 2 different start times. Unfortunately both times are used: To get the local member, the impl.getServiceStartTime() is used: public class McastService .... { public Member getLocalMember(boolean alive) { if ( alive && localMember != null && impl != null) localMember.setMemberAliveTime(System.currentTimeMillis()-impl.getServiceStartTime()); return localMember; } } But, when the member is transmited throw the network, the MemberImpl.getServiceStartTime() is used. public class MemberImpl .... { public byte[] getData(boolean getalive, boolean reset) { if ( reset ) dataPkg = null; //look in cache first if ( dataPkg!=null ) { if ( getalive ) { //you'd be surprised, but System.currentTimeMillis //shows up on the profiler long alive=System.currentTimeMillis()-getServiceStartTime(); XByteBuffer.toBytes( (long) alive, dataPkg, TRIBES_MBR_BEGIN.length+4); } return dataPkg; } ...... } That produces that weird behaviour. IMHO, the fix should be setting the same ""serviceStartTime"" to both components. This issue is affecting seriously my code. I would appreciate if you could fix it asap. I've verified that the same code is present in trunk repository. Regards, Ariel"	2009-05-21 07:32:52	1242910000	resolved fixed	9fa7640	1242930000	java/org/apache/catalina/tribes/membership/McastServiceImpl.java	2:java/org/apache/catalina/tribes/membership/McastServiceImpl.java
837	47111	Bug 47111 do caching the resources like the docu say it (StringManager)		2009-04-28 08:54:49	1240920000	resolved wontfix	96167ed	1241310000	java/org/apache/tomcat/util/res/StringManager.java	1:java/org/apache/tomcat/util/res/StringManager.java
838	47050	Bug 47050 StandardHostValve.status unnecessarily HTML-escapes the error message		2009-04-19 01:59:15	1240120000	resolved fixed	1ad0501	1241190000	java/org/apache/catalina/core/StandardHostValve.java	1:java/org/apache/catalina/core/StandardHostValve.java
839	47046	Bug 47046 Shutdown does not unregister all MBeans		2009-04-17 07:59:51	1239970000	resolved fixed	54b9da9	1241050000	java/org/apache/catalina/connector/MapperListener.java java/org/apache/catalina/mbeans/MBeanUtils.java java/org/apache/catalina/mbeans/ServerLifecycleListener.java	6:java/org/apache/catalina/mbeans/ServerLifecycleListener.java 14:java/org/apache/catalina/mbeans/MBeanUtils.java 21:java/org/apache/catalina/connector/MapperListener.java
840	46925	Bug 46925 Nested groups in JNDI realm with non-recursive implementation		2009-03-27 03:58:28	1238140000	resolved fixed	d04dd88	1240860000	java/org/apache/catalina/realm/JNDIRealm.java	2:java/org/apache/catalina/realm/JNDIRealm.java
841	37929	Bug 37929 invalidated session causes pageContext methods to fail	"javax.servlet.http.HttpSession methods such as getAttribute(), getValue(), getAttributeNames(), getValueNames(), etc, throw an IllegalStateException if called on a session that has been invalidated. So, with the following code in a JSP page: <% session.invalidate(); Object obj = pageContext.findAttribute(""foo""); %> An IllegalStateException is thrown because pageContext.findAttribute() eventually calls session.getAttribute() on a session that has been invalidated. The session that has been invalidated should simply be ignored when a method needs to process the various scopes (page, request, session, application). This impacts the following methods in PageContextImpl: public int getAttributesScope(final String name) which calls -> private int doGetAttributeScope(String name); public Object findAttribute(final String name) which calls -> private Object doFindAttribute(String name); public void removeAttribute(final String name) which calls -> private void doRemoveAttribute(String name); The fix is to catch IllegalStateException and ignore it when processing the attribute in session scope. The code then simply follows through to process application scope. No need to worry about setAttribute() because it is always invoked on a specific scope, and the spec already states that java.lang.IllegalStateException must be thrown when called on an invalidated session. pageContext.setAttribute(""foo"", ""value of foo"", PageContext.SESSION_SCOPE); java.lang.IllegalStateException - if the scope is PageContext.SESSION_SCOPE but the page that was requested does not participate in a session or the session has been invalidated. --------------------------------------------------------------------------- At the same time, a fix should be done to method ""doRemoveAttribute(String name)"" where a try/catch block for Exception appears unnecessary. private void doRemoveAttribute(String name){ try { removeAttribute(name, PAGE_SCOPE); removeAttribute(name, REQUEST_SCOPE); if( session != null ) { try { removeAttribute(name, SESSION_SCOPE); } catch (IllegalStateException ex) { // Session has been invalidated. // Ignore and fall through to application scope. } } removeAttribute(name, APPLICATION_SCOPE); } catch (Exception ex) { // we remove as much as we can, and // simply ignore possible exceptions } } Here is a full analysis: Starting with 'removeAttribute(final String name)' - we check for null and throw NPE if necessary - we call doRemoveAttribute(name) doRemoveAttribute(name) - we call removeAttribute(name, scope) for each scope removeAttribute(final String name, final int scope) - this calls doRemoveAttribute(name, scope) doRemoveAttribute(name, scope) - page scope: attributes.remove -> won't throw an Exception - request scope: request.removeAttribute -> no documented Exception thrown - session scope: throws IllegalStateException if session is null - app scope: context.removeAttribute -> no documented Exception thrown A null value for name is already checked in removeAttribute(final String name) and we throw NPE. So this situation (removing an attr from page or request scope throwing an NPE) won't happen. In doRemoveAttribute(name), we already check on session != null before calling removeAttribute(name, SESSION_SCOPE). So there normally is no IllegalStateException thrown (except for the invalidated case). When removing an attribute from application (i.e., ServletContext) scope, any registered listeners will be notified, but the code that does that (see appserv-webtier/src/java/org/apache/catalina/core/ApplicationContext. removeAttribute()) already catches any Throwable that a listener may throw. The try/catch block is therefore unnecessary. Moreover, if any of the removal actions from the different scopes could have thrown an exception, each of them would have needed to be wrapped inside their own try/catch, so as to ensure that an exception in one scope does not cause any of the subsequent removals to be bypassed. doRemoveAttribute(String name) has therefore been modified as follows: private void doRemoveAttribute(String name){ removeAttribute(name, PAGE_SCOPE); removeAttribute(name, REQUEST_SCOPE); if( session != null ) { try { removeAttribute(name, SESSION_SCOPE); } catch (IllegalStateException ex) { // Session has been invalidated. // Ignore and fall through to application scope. } } removeAttribute(name, APPLICATION_SCOPE); } -------------------------- Changes done on glassfish. ymmv on jasper for the diffs. --- PageContextImpl.java 9 Dec 2005 18:54:30 -0000 1.7 +++ PageContextImpl.java 16 Dec 2005 00:11:21 -0000 1.8 @@ -452,8 +452,13 @@ return REQUEST_SCOPE; if (session != null) { + try { if (session.getAttribute(name) != null) return SESSION_SCOPE; + } catch (IllegalStateException ex) { + // Session has been invalidated. + // Ignore and fall through to application scope. + } } if (context.getAttribute(name) != null) @@ -495,9 +500,14 @@ return o; if (session != null) { + try { o = session.getAttribute(name); - if (o != null) - return o; + } catch (IllegalStateException ex) { + // Session has been invalidated. + // Ignore and fall through to application scope. + } + + if (o != null) return o; } return context.getAttribute(name); @@ -559,19 +569,18 @@ } } - private void doRemoveAttribute(String name){ - try { removeAttribute(name, PAGE_SCOPE); removeAttribute(name, REQUEST_SCOPE); if( session != null ) { + try { removeAttribute(name, SESSION_SCOPE); + } catch (IllegalStateException ex) { + // Session has been invalidated. + // Ignore and fall through to application scope. } - removeAttribute(name, APPLICATION_SCOPE); - } catch (Exception ex) { - // we remove as much as we can, and - // simply ignore possible exceptions } + removeAttribute(name, APPLICATION_SCOPE); } public JspWriter getOut() {"	2005-12-16 01:58:15	1134720000	resolved fixed	04cacaf	1239900000	java/org/apache/jasper/runtime/PageContextImpl.java	1:java/org/apache/jasper/runtime/PageContextImpl.java
842	47013	Bug 47013 JSP not compiled at startup when used as a servlet		2009-04-10 09:26:22	1239370000	resolved fixed	c8cbc28	1239750000	java/org/apache/catalina/core/Constants.java java/org/apache/catalina/core/StandardWrapper.java	13:java/org/apache/catalina/core/StandardWrapper.java 57:java/org/apache/catalina/core/Constants.java
843	42579	Bug 42579 [Patch] JNDIRealm fails to parse absolute names	"Active Directory can respond to a query with SearchResult's that are not relative. We discovered this happening with a directory hosted across many servers when the userBase was not sufficient to identify a single server. In getUserBySearch, JNDIRealm assumes that the SearchResult is relative and goes about creating a DN for the user by appending together the various bits of names it gets back. This is definitely wrong for absolute names which are URL's of the form: ldap://server/encoded_user_dn I discovered this issue in Tomcat 5.5 and a cursory look at the SVN repo for Tomcat 6.0 reveals that this bug is also present there. I have a patch for this issue which I will attach."	2007-06-04 14:13:14	1180980000	resolved fixed	90e8d0d	1239290000	java/org/apache/catalina/realm/JNDIRealm.java	1:java/org/apache/catalina/realm/JNDIRealm.java
844	46354	Bug 46354 LIMIT_BUFFER setting causes arraycopy errors		2008-12-05 09:01:51	1228490000	resolved fixed	78a994a	1239290000	java/org/apache/jasper/runtime/BodyContentImpl.java	54:java/org/apache/jasper/runtime/BodyContentImpl.java
845	46984	Bug 46984 Server incorrectly reports a 501 error on bad method name. Should report 400 error.		2009-04-07 07:44:46	1239100000	resolved fixed	42a093b	1239290000	java/org/apache/coyote/http11/Http11AprProcessor.java java/org/apache/coyote/http11/Http11NioProcessor.java java/org/apache/coyote/http11/Http11Processor.java java/org/apache/coyote/http11/InternalAprInputBuffer.java java/org/apache/coyote/http11/InternalInputBuffer.java java/org/apache/coyote/http11/InternalNioInputBuffer.java	30:java/org/apache/coyote/http11/Http11AprProcessor.java 31:java/org/apache/coyote/http11/Http11NioProcessor.java 47:java/org/apache/coyote/http11/Http11Processor.java 307:java/org/apache/coyote/http11/InternalNioInputBuffer.java 434:java/org/apache/coyote/http11/InternalInputBuffer.java 441:java/org/apache/coyote/http11/InternalAprInputBuffer.java
846	46961	Bug 46961 org.apache.catalina.loader.WebappClassLoader throws exception related to Java 6 Bug 6434149		2009-04-03 07:15:39	1238760000	resolved fixed	f109fb9	1239280000	java/org/apache/catalina/loader/WebappClassLoader.java	1:java/org/apache/catalina/loader/WebappClassLoader.java
847	46909	Bug 46909 <jsp:plugin> error	"<jsp:plugin type=""applet""> generates type=""application/x-java-applet;"" instead of type = ""application/x-java-applet"". Firefox with Java-plugin cannot display Java applets because "";"" is added."	2009-03-25 03:07:44	1237960000	resolved fixed	80b90ee	1239280000	java/org/apache/jasper/compiler/Generator.java	9:java/org/apache/jasper/compiler/Generator.java
848	46562	Bug 46562 Reader not closed	SHTML files are locked when using windows. Closing the reader solves the problem.	2009-01-19 08:17:14	1232370000	resolved fixed	6ecc35d	1239280000	java/org/apache/catalina/ssi/SSIServlet.java	60:java/org/apache/catalina/ssi/SSIServlet.java
849	46998	Bug 46998 small fix to TaskThreadFactory		2009-04-08 11:35:20	1239200000	resolved fixed	0c48c98	1239270000	java/org/apache/tomcat/util/threads/TaskThreadFactory.java	1:java/org/apache/tomcat/util/threads/TaskThreadFactory.java
850	46997	Bug 46997 small fix to TaskQueue		2009-04-08 11:30:59	1239200000	resolved fixed	4e1c4b2	1239270000	java/org/apache/tomcat/util/threads/TaskQueue.java	1:java/org/apache/tomcat/util/threads/TaskQueue.java
851	46991	"Bug 46991 ""Bytes received "" problem"	"use jk module submit some data with post method ,but ""Bytes received"" always show zero see source file ,JkCoyoteHandler.java ,in ""inovke"" method public int invoke( Msg msg, MsgContext ep ) throws IOException { if( ep.isLogTimeEnabled() ) ep.setLong( MsgContext.TIMER_PRE_REQUEST, System.currentTimeMillis()); Request req=ep.getRequest(); Response res=req.getResponse(); if( log.isDebugEnabled() ) log.debug( ""Invoke "" + req + "" "" + res + "" "" + req.requestURI().toString()); res.setNote( epNote, ep ); ep.setStatus( MsgContext.JK_STATUS_HEAD ); RequestInfo rp = req.getRequestProcessor(); rp.setStage(Constants.STAGE_SERVICE); try { adapter.service( req, res ); } catch( Exception ex ) { log.info(""Error servicing request "" + req,ex); } if(ep.getStatus() != MsgContext.JK_STATUS_CLOSED) { res.finish(); } req.recycle(); req.updateCounters(); //see this line res.recycle(); ep.recycle(); if( ep.getStatus() == MsgContext.JK_STATUS_ERROR ) { return ERROR; } ep.setStatus( MsgContext.JK_STATUS_NEW ); rp.setStage(Constants.STAGE_KEEPALIVE); return OK; } the request object recycled,the ""byteRead"" property must be set to zero ,but at the next line ,begin to ""updateCounters"",this may be a bug"	2009-04-08 01:37:54	1239170000	resolved fixed	a228c06	1239210000	java/org/apache/jk/server/JkCoyoteHandler.java	1:java/org/apache/jk/server/JkCoyoteHandler.java
852	46990	Bug 46990 Synchronize target can be changed midway		2009-04-07 18:52:10	1239140000	resolved fixed	f1fd999	1239210000	java/org/apache/catalina/core/StandardContext.java java/org/apache/catalina/core/StandardHost.java java/org/apache/catalina/tribes/membership/Membership.java java/org/apache/catalina/util/InstanceSupport.java java/org/apache/catalina/util/LifecycleSupport.java	14:java/org/apache/catalina/core/StandardContext.java 69:java/org/apache/catalina/util/LifecycleSupport.java 114:java/org/apache/catalina/tribes/membership/Membership.java 119:java/org/apache/catalina/util/InstanceSupport.java 177:java/org/apache/catalina/core/StandardHost.java
853	46988	Bug 46988 JMXAccessorTask String constants should be final		2009-04-07 17:18:48	1239140000	resolved fixed	81ebe8f	1239200000	java/org/apache/catalina/ant/jmx/JMXAccessorTask.java	1:java/org/apache/catalina/ant/jmx/JMXAccessorTask.java
854	46986	Bug 46986 org.apache.jasper.Constants public arrays are mutable	"There are various public String arrays in org.apache.jasper.Constants. Although the array variables are final, any code can change any of the array constants."	2009-04-07 17:14:51	1239140000	resolved fixed	f497f12	1239200000	java/org/apache/jasper/Constants.java java/org/apache/jasper/compiler/PageInfo.java java/org/apache/jasper/xmlparser/ParserUtils.java	30:java/org/apache/jasper/xmlparser/ParserUtils.java 31:java/org/apache/jasper/compiler/PageInfo.java 127:java/org/apache/jasper/Constants.java
855	46967	Bug 46967 ManagerBase.setRandomFile error handling fix	"On some platforms (z/OS for sure), the device file /dev/urandom can pass the ""f.exists()"" test, but throws an IOException of some kind when trying to open it. The current code in ManagerBase.setRandomFile() doesn't handle this, which results in EVERY call to getRandom() to try again and log the error ""Failed to close randomIS"". The following changes to the method will add proper error handling to correct this (my changes marked ""// kjw"") public void setRandomFile( String s ) { // as a hack, you can use a static file - and genarate the same // session ids ( good for strange debugging ) if (Globals.IS_SECURITY_ENABLED){ randomIS = (DataInputStream)AccessController.doPrivileged(new PrivilegedSetRandomFile()); } else { try{ devRandomSource=s; File f=new File( devRandomSource ); if( ! f.exists() ) return; randomIS= new DataInputStream( new FileInputStream(f)); randomIS.readLong(); if( log.isDebugEnabled() ) log.debug( ""Opening "" + devRandomSource ); } catch( IOException ex ) { log.debug(""Error reading "" + devRandomSource, ex); //kjw if (randomIS != null) { // kjw: if opened try { randomIS.close(); } catch (Exception e) { log.warn(""Failed to close randomIS.""); } } // kjw devRandomSource = null; // kjw: don't try again automatically randomIS=null; } } }"	2009-04-03 18:57:28	1238800000	resolved fixed	243aa86	1239200000	java/org/apache/catalina/session/ManagerBase.java	1:java/org/apache/catalina/session/ManagerBase.java
856	46958	Bug 46958 manager XML interface hard-coded path in XSL transformation		2009-04-02 16:55:36	1238710000	resolved fixed	a9a58fb	1239190000	java/org/apache/catalina/manager/Constants.java	58:java/org/apache/catalina/manager/Constants.java
857	46933	Bug 46933 Using Java 1.5 in StringManager		2009-03-27 15:34:14	1238180000	resolved fixed	23c47da	1239190000	java/org/apache/tomcat/util/res/StringManager.java test/org/apache/tomcat/util/res/TestStringManager.java	1:java/org/apache/tomcat/util/res/StringManager.java
858	46982	Bug 46982 AccessLogValve reports correct time but incorrect offset following Spring DST transition.	"This is a problem with AccessLogValve for tc5.5 as well as tc6.0 on all platforms. With the system clock on my linux machine (Ubuntu in my case) to just before the US time change on March 8, I started Tomcat 5.5 and see the following messages in my Tomcat access log after accessing Tomcat JSP example pages at the time of DST transition: -: - [08/Mar/2009:01:56:20 -0700] GET /jsp-examples/jsp2/simpletag/book.jsp HTTP/1.1 200 1738 1 - {http-8080-Processor24} -: - [08/Mar/2009:03:01:22 -0700] GET /jsp-examples/jsp2/tagfiles/hello.jsp HTTP/1.1 200 2213 68 - {http-8080-Processor25} Note the offset of ""-0700"" both before and after DST transition. Following a Tomcat restart the offset is correct: -: - [08/Mar/2009:03:19:42 -0600] GET /jsp-examples/jsp2/jspx/basic.jspx HTTP/1.1 200 1919 780 - {http-8080-Processor25} -: - [08/Mar/2009:03:19:59 -0600] GET /jsp-examples/jsp2/jspx/svgexample.html HTTP/1.1 200 2239 4 - {http-8080-Processor25} -: - [08/Mar/2009:03:19:59 -0600] GET /jsp-examples/jsp2/jspx/textRotate.jpg HTTP/1.1 200 26729 3 - {http-8080-Processor25} BTW, I ran the tzupdater before my tests: linwin01-512> java -jar tzupdater.jar -V tzupdater version 1.3.12-b01 JRE time zone data version: tzdata2009a Embedded time zone data version: tzdata2009a The problem is in the org.apache.catalina.valves.AccessLogValve which contains the following in its start method: // Initialize the timeZone, Date formatters, and currentDate timezone = TimeZone.getDefault(); timeZoneNoDST = calculateTimeZoneOffset(timezone.getRawOffset()); Calendar calendar = Calendar.getInstance(timezone); int offset = calendar.get(Calendar.DST_OFFSET); timeZoneDST = calculateTimeZoneOffset(timezone.getRawOffset()+offset); Based on what Ive seen, int offset = calendar.get(Calendar.DST_OFFSET); returns 0 when the current time is not in Daylight savings time and (for my timezone) 3600000 (60 * 60 * 1000) when the current time is in Daylight Savings. It looks like the code assumes this is always the offset for Daylight Savings for the current timezone. I have no idea if there are some locations/timezones where Daylight Savings Time does not have a 1 hour offset. Because of this, if in a non-DST time period, timeZoneDST and timeZoneNoDST are set to the same value. If in a DST time period, I believe they are set correctly so that the transition in Autumn works correctly. I think the only problem is when moving ahead in Springtime (unless the software has been running for 6 months or so which caused the offset to be set correctly)."	2009-04-07 07:32:55	1239100000	resolved fixed	360f8eb	1239190000	java/org/apache/catalina/valves/AccessLogValve.java	1:java/org/apache/catalina/valves/AccessLogValve.java
859	41606	Bug 41606 The jspInit method is called twice.	"The problem is: The jspInit method is called twice. The definition is: -The JSP background compilations are enable. (In default web.xml, define checkInterval and define development false.) -Define the JSP with <servlet> and <load-on-startup> tag in web.xml. The proposing: org/apache/jasper/compiler/Compiler.java ---- public void compile(boolean compileClass, boolean jspcMode) throws FileNotFoundException, JasperException, Exception { .... if( compileClass ) { File targetFile = new File(ctxt.getClassFileName()); if (targetFile.exists()) { long targetLastModified = targetFile.lastModified(); if (jsw != null) { jsw.setServletClassLastModifiedTime(targetLastModified); } } } }// last of the method. ---- Regards, Yuichiro"	2007-02-13 20:46:54	1171420000	resolved fixed	f36a2c4	1238150000	java/org/apache/jasper/compiler/Compiler.java	1:java/org/apache/jasper/compiler/Compiler.java
860	46822	Bug 46822 Avoid redundant instantiations in StandardContext		2009-03-08 22:56:01	1236570000	resolved fixed	b10d9da	1238070000	java/org/apache/catalina/core/StandardContext.java	1:java/org/apache/catalina/core/StandardContext.java
861	46866	Bug 46866 Seed from current time is useless	"fgrep -r 'new Random(System.currentTimeMillis())' . Gives 7 places where Random initialized with seed = currentTimeMillis. This is unnecessary, because better seed initialization happens in the default Random constructor."	2009-03-16 21:34:33	1237250000	resolved fixed	fae26ce	1238070000	java/org/apache/catalina/core/StandardServer.java java/org/apache/catalina/tribes/util/UUIDGenerator.java test/org/apache/catalina/tribes/demos/LoadTest.java test/org/apache/catalina/tribes/demos/MapDemo.java test/org/apache/catalina/tribes/test/channel/TestDataIntegrity.java test/org/apache/catalina/tribes/test/channel/TestMulticastPackages.java test/org/apache/catalina/tribes/test/channel/TestRemoteProcessException.java test/org/apache/catalina/tribes/test/channel/TestUdpPackages.java test/org/apache/catalina/tribes/test/io/TestSenderConnections.java	6:java/org/apache/catalina/tribes/util/UUIDGenerator.java 16:test/org/apache/catalina/tribes/test/channel/TestDataIntegrity.java 17:test/org/apache/catalina/tribes/test/channel/TestUdpPackages.java 18:test/org/apache/catalina/tribes/test/channel/TestMulticastPackages.java 30:java/org/apache/catalina/core/StandardServer.java 47:test/org/apache/catalina/tribes/demos/LoadTest.java 61:test/org/apache/catalina/tribes/test/channel/TestRemoteProcessException.java 63:test/org/apache/catalina/tribes/test/io/TestSenderConnections.java 92:test/org/apache/catalina/tribes/demos/MapDemo.java
862	46875	Bug 46875 CometConnectionManagerValve: concurrent access on session object when calling HttpSession.invalidate()	"When calling invalidate() on an valid HttpSession object CometConnectionManagerValve methods sessionDestroy(HttpSessionEvent se) and event(Request request, Response response, CometEvent event) are called concurrently. So either a CometEvent with EventType.END and EventSubType.SESSION_END is never signaled via sessionDestroyed(...) or the HttpSession object has become invalid and the attribute holding comet requests can not be set or removed via event(...). I have configured CometConnectionManagerValve as a Valve element in context.xml and also as a Listener element in my applications web.xml. see this stacktrace 'sessionDestroy() was a bit faster': An exception or error occurred in the container during the request processing java.lang.IllegalStateException: removeAttribute: Session already invalidated at org.apache.catalina.session.StandardSession.removeAttribute(StandardSession.java:1206) at org.apache.catalina.session.StandardSession.removeAttribute(StandardSession.java:1181) at org.apache.catalina.session.StandardSessionFacade.removeAttribute(StandardSessionFacade.java:140) at org.apache.catalina.valves.CometConnectionManagerValve.event(CometConnectionManagerValve.java:335) at org.apache.catalina.core.StandardHostValve.event(StandardHostValve.java:179) at org.apache.catalina.valves.ValveBase.event(ValveBase.java:200) at org.apache.catalina.core.StandardEngineValve.event(StandardEngineValve.java:128) at org.apache.catalina.connector.CoyoteAdapter.event(CoyoteAdapter.java:198) at org.apache.coyote.http11.Http11NioProcessor.event(Http11NioProcessor.java:750) at org.apache.coyote.http11.Http11NioProtocol$Http11ConnectionHandler.event(Http11NioProtocol.java:653) at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.run(NioEndpoint.java:2081) at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:885) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:907) at java.lang.Thread.run(Thread.java:637)"	2009-03-19 02:15:04	1237440000	resolved wontfix	08f7a5f	1238010000	java/org/apache/catalina/valves/CometConnectionManagerValve.java	1:java/org/apache/catalina/valves/CometConnectionManagerValve.java
863	46666	Bug 46666 Why is disableUploadTimeout and KeepAliveTimeout correlated in Http11 Connector?	"In Http11Processor.java while (started && !error && keepAlive) { // Parsing the request header try { if (!disableUploadTimeout && keptAlive) { if (keepAliveTimeout > 0) { socket.setSoTimeout(keepAliveTimeout); } else if (soTimeout > 0) { socket.setSoTimeout(soTimeout); } } inputBuffer.parseRequestLine(); request.setStartTime(System.currentTimeMillis()); keptAlive = true; if (!disableUploadTimeout) { socket.setSoTimeout(timeout); } disableUploadTimeout - This flag allows the servlet container to use a different, longer connection timeout while a servlet is being executed, which in the end allows either the servlet a longer amount of time to complete its execution, or a longer timeout during data upload. If not specified, this attribute is set to ""true"". The code above is waiting on a new Http Request and precedes the servlet processing logic. It seems odd to me that I must set disableTimeout to false to get my keepAliveTimeout set. To set keepalivetimout, I must implicitely enable upload timeout whether I need it or not. It seems to me that the disableTimeout is unneccessary in the following line if (!disableUploadTimeout && keptAlive) { Do you agree with this? Thanks for the insight"	2009-02-04 08:28:34	1233750000	resolved fixed	ac6369a	1234540000	java/org/apache/coyote/http11/Http11Processor.java	1:java/org/apache/coyote/http11/Http11Processor.java
864	46696	Bug 46696 Missing AL headers	"The following files in tomcat-trunk don't have AL headers; as far as I can tell, they should: modules/jdbc-pool/sign.sh modules/jdbc-pool/test/org/apache/tomcat/jdbc/test/StarvationTest.java"	2009-02-11 09:41:23	1234360000	resolved fixed	3b1b7b3	1234450000	modules/jdbc-pool/test/org/apache/tomcat/jdbc/test/StarvationTest.java	1:modules/jdbc-pool/test/org/apache/tomcat/jdbc/test/StarvationTest.java
865	39396	Bug 39396 OPTIONS request on directory with no default file reports an incorrect list of allowed HTTP verbs	"When an ""options"" http request is made to Tomcat to a directory that has no default file (like index.jsp) in it, Tomcat reports a full list of allowed verbs, when in fact, most of them are NOT allowed. For example, a request to a generic img directory: OPTIONS /img/ HTTP/1.0 Cookie: JSESSIONID=C46C2E18BE95AD91828C9370CBDF0AF2 Content-Length: 0 Accept: */* Accept-Language: en-us Connection: Keep-Alive User-Agent: Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; .NET CLR 1.1 4322; InfoPath.1) Returns: HTTP/1.1 200 OK Server: Apache-Coyote/1.1 Allow: GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS Content-Length: 0 Date: Mon, 24 Apr 2006 15:11:16 GMT Connection: close Which shows several destructive options available (PUT, DELETE). But a request to DELETE or PUT (correctly) returns a 403 FORBIDDEN result: DELETE /img/ HTTP/1.0 Cookie: JSESSIONID=C46C2E18BE95AD91828C9370CBDF0AF2 Content-Length: 0 Accept: */* Accept-Language: en-us Connection: Keep-Alive User-Agent: Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; .NET CLR 1.1 4322; InfoPath.1) Returns: HTTP/1.1 403 Forbidden Server: Apache-Coyote/1.1 Content-Type: text/html;charset=utf-8 Content-Length: 964 Date: Mon, 24 Apr 2006 15:12:31 GMT Connection: close Because the initial OPTIONS request returns a list containing dangerous verbs, the directory will be flagged as a serious security vulnerability by most scanners (a false positive). The issue DOES NOT occur when the directory HAS a default file in it: OPTIONS /user_management/ HTTP/1.0 Cookie: JSESSIONID=C46C2E18BE95AD91828C9370CBDF0AF2 Content-Length: 0 Accept: */* Accept-Language: en-us Connection: Keep-Alive User-Agent: Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; .NET CLR 1.1 4322; InfoPath.1) Returns: HTTP/1.1 200 OK Server: Apache-Coyote/1.1 Set-Cookie: JSESSIONID=BC992F0C86E2BCBD0A2E5F1B3A12C50C; Path=/ Content-Type: text/html;charset=ISO-8859-1 Date: Mon, 24 Apr 2006 15:14:27 GMT Connection: close"	2006-04-24 15:15:57	1145910000	resolved fixed	9752018	1234210000	java/org/apache/catalina/connector/RequestFacade.java java/org/apache/catalina/servlets/DefaultServlet.java	2:java/org/apache/catalina/servlets/DefaultServlet.java 194:java/org/apache/catalina/connector/RequestFacade.java
866	38570	"Bug 38570 if docBase path contains ""webapps"", a backslash is inserted"		2006-02-08 15:46:45	1139430000	resolved fixed	8d2b8ff	1234210000	java/org/apache/catalina/startup/ContextConfig.java	9:java/org/apache/catalina/startup/ContextConfig.java
867	38553	Bug 38553 Wrong HTTP code for failed CLIENT-CERT authentication	"server.xml: =========== I set clientAuth to ""want"" tomcat-user.xml: ================ I create a role and an user with the ssl certificate metadata web.xml: ======== For a private URL on my webseite, I create a security constraint like this one: <security-constraint> <web-resource-collection> <web-resource-name>App</web-resource-name> <url-pattern>/protected.jsp</url-pattern> </web-resource-collection> <auth-constraint> <role-name>tomcat</role-name> </auth-constraint> <user-data-constraint> <transport-guarantee>CONFIDENTIAL</transport-guarantee> </user-data-constraint> </security-constraint> <login-config> <auth-method>CLIENT-CERT</auth-method> </login-config> <security-role> <role-name>tomcat</role-name> </security-role> My results: (I try to access the restricted JSP-Page) =========== 1) When there is the RIGHT client certificate in the browser keystore: it works :-) 2) When there is the WRONG client certificate I get: HTTP Status 401 - Cannot authenticate with the provided credentials (this is ok, too) 3) When there is NO client certificate I get: HTTP Status 400 - No client certificate chain in this request 400 usually stands for a bad request or bad syntax. The Bug: ======== In case 3 I expect to get HTTP Status 401."	2006-02-07 16:54:17	1139350000	resolved fixed	156f1ca	1233740000	java/org/apache/catalina/authenticator/SSLAuthenticator.java	12:java/org/apache/catalina/authenticator/SSLAuthenticator.java
868	38197	Bug 38197 taglib pool bug when tag is used with jsp:attribute		2006-01-09 15:53:09	1136840000	resolved fixed	2824a70	1233740000	java/org/apache/jasper/compiler/Generator.java	10:java/org/apache/jasper/compiler/Generator.java
869	46606	Bug 46606 WebdavServlet		2009-01-26 07:18:21	1232970000	resolved fixed	f0bd732	1233730000	java/org/apache/catalina/servlets/WebdavServlet.java	1:java/org/apache/catalina/servlets/WebdavServlet.java
870	46564	Bug 46564 .tagx files don't compile if the document and page encoding casing differs		2009-01-20 00:34:11	1232430000	resolved fixed	7d7f757	1233290000	java/org/apache/jasper/compiler/Validator.java	2:java/org/apache/jasper/compiler/Validator.java
871	46471	Bug 46471 Compiled tag files from different tag libraries share the same package		2009-01-04 16:12:40	1231100000	resolved fixed	3aaac85	1231180000	java/org/apache/jasper/compiler/ImplicitTagLibraryInfo.java java/org/apache/jasper/compiler/JspUtil.java java/org/apache/jasper/compiler/ParserController.java java/org/apache/jasper/compiler/TagFileProcessor.java java/org/apache/jasper/compiler/TagLibraryInfoImpl.java	4:java/org/apache/jasper/compiler/TagLibraryInfoImpl.java 8:java/org/apache/jasper/compiler/ParserController.java 13:java/org/apache/jasper/compiler/ImplicitTagLibraryInfo.java 18:java/org/apache/jasper/compiler/TagFileProcessor.java 64:java/org/apache/jasper/compiler/JspUtil.java
872	46462	Bug 46462 JSPWiki JSP compilation prevented by org.apache.jasper.Constants.JSP_PACKAGE_NAME		2009-01-01 20:29:15	1230860000	resolved fixed	1ca03ff	1230890000	java/org/apache/jasper/servlet/JasperLoader.java	72:java/org/apache/jasper/servlet/JasperLoader.java
873	46298	Bug 46298 JDBCRealm.open() throws NullPointerException if the specified driver doesn't handle the specified JDBC URL		2008-11-25 23:25:56	1227670000	resolved fixed	e31998a	1230510000	java/org/apache/catalina/realm/JDBCRealm.java	1:java/org/apache/catalina/realm/JDBCRealm.java
874	46261	Bug 46261 Context with %2F in name causes tomcat crash on shutdown	"Context with %2F in name causes tomcat crash on shutdown Several years ago I worked on integrating tomcat 5.5 into our web application management infrastructure. During the process I fixed several tomcat 5.5 bugs, but apparently never sent the fixes upstream. Oops. Our application needs to be deployed to create a URL that looks like this: /product/customername/servlet I worked with several people on IRC to get tomcat5.5 to do this. We had previously been using the path= parameter in the context xml file element with tomcat 4.1. Unfortunately, it appears this feature was removed from tomcat5.5, and tomcat5.5 does not recurse into subdirectories when reading .xml context files. The recommendation on IRC (after several suggestions which would not work for our environment) was to put %2F in the context xml file's name. Such as this product%2Fcustomername.xml This does work, however when you try to shutdown tomcat 6.0.18, you will get this crash: Nov 9, 2008 10:56:17 PM org.apache.coyote.http11.Http11Protocol pause INFO: Pausing Coyote HTTP/1.1 on http-8180 Nov 9, 2008 10:56:18 PM org.apache.catalina.core.StandardService stop INFO: Stopping service Catalina Nov 9, 2008 10:56:18 PM org.apache.catalina.startup.HostConfig undeployApps WARNING: Error while removing context [/product%2Fcustomername] java.lang.NullPointerException at org.apache.catalina.core.ContainerBase.removeChild(ContainerBase.java:915) at org.apache.catalina.startup.HostConfig.undeployApps(HostConfig.java:1191) at org.apache.catalina.startup.HostConfig.stop(HostConfig.java:1162) at org.apache.catalina.startup.HostConfig.lifecycleEvent(HostConfig.java:313) at org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:117) at org.apache.catalina.core.ContainerBase.stop(ContainerBase.java:1086) at org.apache.catalina.core.ContainerBase.stop(ContainerBase.java:1098) at org.apache.catalina.core.StandardEngine.stop(StandardEngine.java:448) at org.apache.catalina.core.StandardService.stop(StandardService.java:584) at org.apache.catalina.core.StandardServer.stop(StandardServer.java:744) at org.apache.catalina.startup.Catalina.stop(Catalina.java:628) at org.apache.catalina.startup.Catalina$CatalinaShutdownHook.run(Catalina.java:671) Nov 9, 2008 10:56:18 PM org.apache.coyote.http11.Http11Protocol destroy INFO: Stopping Coyote HTTP/1.1 on http-8180"	2008-11-21 08:34:21	1227270000	resolved fixed	85fc30c	1230340000	java/org/apache/catalina/core/StandardContext.java java/org/apache/catalina/manager/HTMLManagerServlet.java	2:java/org/apache/catalina/core/StandardContext.java 8:java/org/apache/catalina/manager/HTMLManagerServlet.java
875	46381	Bug 46381 Coerce EL expression to java.lang.Object breaks expression concatenation		2008-12-11 07:13:00	1229000000	resolved fixed	24bcb47	1230330000	java/org/apache/jasper/compiler/Generator.java	79:java/org/apache/jasper/compiler/Generator.java
876	46357	Bug 46357 FarmWarDeployer has nonsense condition	FarmWarDeployer has the following code at line 152: if(econtainer == null && econtainer instanceof Engine) { There's clearly something wrong with that condition.	2008-12-06 05:48:33	1228560000	resolved fixed	7e6a2ec	1230330000	java/org/apache/catalina/ha/deploy/FarmWarDeployer.java	1:java/org/apache/catalina/ha/deploy/FarmWarDeployer.java
877	46397	Bug 46397 Potential memory leak with TagHandlers and JspIdConsumer		2008-12-15 00:43:53	1229320000	resolved fixed	5277185	1230060000	java/org/apache/jasper/compiler/Generator.java	2:java/org/apache/jasper/compiler/Generator.java
878	46403	Bug 46403 Persistent cookies written by 6.0.18 do not work in Internet Explorer or Safari		2008-12-15 13:46:47	1229370000	resolved fixed	99c5ca6	1230040000	java/org/apache/tomcat/util/http/ServerCookie.java	26:java/org/apache/tomcat/util/http/ServerCookie.java
879	46408	Bug 46408 Invalid cast in SecurityUtil	"In case of PrivilegedActionException thrown in: private static void execute(final Method method, final Object targetObject, final Object[] targetArguments, Principal principal) method, there is a false assumption in catch block, that PrivilegedActionException.getException() will return InvocationTargetException. It could be also IllegalAccessException and possibly other types of exceptions as well. Here is the stack trace provoked on catalina shutdown when enabled security manager: java.lang.ClassCastException: java.lang.IllegalAccessException cannot be cast to java.lang.reflect.InvocationTargetException at org.apache.catalina.security.SecurityUtil.execute(SecurityUtil.java:278) at org.apache.catalina.security.SecurityUtil.doAsPrivilege(SecurityUtil.java:218) at org.apache.catalina.security.SecurityUtil.doAsPrivilege(SecurityUtil.java:178) at org.apache.catalina.core.ApplicationFilterConfig.release(ApplicationFilterConfig.java:326) at org.apache.catalina.core.StandardContext.filterStop(StandardContext.java:3744) at org.apache.catalina.core.StandardContext.stop(StandardContext.java:4513) at org.apache.catalina.core.ContainerBase.removeChild(ContainerBase.java:924) at org.apache.catalina.startup.HostConfig.undeployApps(HostConfig.java:1191) at org.apache.catalina.startup.HostConfig.stop(HostConfig.java:1162) at org.apache.catalina.startup.HostConfig.lifecycleEvent(HostConfig.java:313) at org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:117) at org.apache.catalina.core.ContainerBase.stop(ContainerBase.java:1086) at org.apache.catalina.core.ContainerBase.stop(ContainerBase.java:1098) at org.apache.catalina.core.StandardEngine.stop(StandardEngine.java:448) at org.apache.catalina.core.StandardService.stop(StandardService.java:584) at org.apache.catalina.core.StandardServer.stop(StandardServer.java:744) at org.apache.catalina.startup.Catalina.stop(Catalina.java:628) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at java.lang.reflect.Method.invoke(Method.java:597) at org.apache.catalina.startup.Bootstrap.stop(Bootstrap.java:300) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at java.lang.reflect.Method.invoke(Method.java:597) at org.apache.commons.daemon.support.DaemonLoader.stop(DaemonLoader.java:200)"	2008-12-16 15:22:51	1229460000	resolved fixed	a1e4c86	1229700000	java/org/apache/catalina/security/SecurityUtil.java	4:java/org/apache/catalina/security/SecurityUtil.java
880	46247	Bug 46247 SVN property patches		2008-11-19 18:16:54	1227140000	resolved fixed	408175f	1228490000	modules/bayeux/java/org/apache/cometd/bayeux/Bayeux.java modules/bayeux/java/org/apache/cometd/bayeux/Channel.java modules/bayeux/java/org/apache/cometd/bayeux/Client.java modules/bayeux/java/org/apache/cometd/bayeux/DataFilter.java modules/bayeux/java/org/apache/cometd/bayeux/Listener.java modules/bayeux/java/org/apache/cometd/bayeux/Message.java modules/bayeux/java/org/apache/cometd/bayeux/SecurityPolicy.java modules/bayeux/java/org/apache/tomcat/bayeux/BayeuxException.java modules/bayeux/java/org/apache/tomcat/bayeux/BayeuxRequest.java modules/bayeux/java/org/apache/tomcat/bayeux/BayeuxServlet.java modules/bayeux/java/org/apache/tomcat/bayeux/ChannelImpl.java modules/bayeux/java/org/apache/tomcat/bayeux/ClientImpl.java modules/bayeux/java/org/apache/tomcat/bayeux/HttpError.java modules/bayeux/java/org/apache/tomcat/bayeux/MessageImpl.java modules/bayeux/java/org/apache/tomcat/bayeux/RequestBase.java modules/bayeux/java/org/apache/tomcat/bayeux/RequestFactory.java modules/bayeux/java/org/apache/tomcat/bayeux/TomcatBayeux.java modules/bayeux/java/org/apache/tomcat/bayeux/request/MetaConnectRequest.java modules/bayeux/java/org/apache/tomcat/bayeux/request/MetaDisconnectRequest.java modules/bayeux/java/org/apache/tomcat/bayeux/request/MetaHandshakeRequest.java modules/bayeux/java/org/apache/tomcat/bayeux/request/MetaSubscribeRequest.java modules/bayeux/java/org/apache/tomcat/bayeux/request/MetaUnsubscribeRequest.java modules/bayeux/java/org/apache/tomcat/bayeux/request/PublishRequest.java modules/bayeux/test/org/apache/cometd/bayeux/samples/BayeuxStockTicker.java modules/bayeux/test/org/apache/cometd/bayeux/samples/EchoChatClient.java modules/jdbc-pool/java/org/apache/tomcat/jdbc/pool/interceptor/ConnectionState.java modules/jdbc-pool/java/org/apache/tomcat/jdbc/pool/interceptor/SlowQueryReport.java	83:modules/jdbc-pool/java/org/apache/tomcat/jdbc/pool/interceptor/ConnectionState.java 264:modules/jdbc-pool/java/org/apache/tomcat/jdbc/pool/interceptor/SlowQueryReport.java 524:modules/bayeux/java/org/apache/tomcat/bayeux/RequestBase.java
881	42077	Bug 42077 the iterator from javax.el.CompositeELResolver#getFeatureDescriptor() must not return null values		2007-04-10 03:03:51	1176190000	resolved fixed	8d5db6f	1227480000	java/javax/el/CompositeELResolver.java	1:java/javax/el/CompositeELResolver.java
882	42693	Bug 42693 JSP-Generation error with recursive tagfile structure	"addendum: it's Version 6.13 (not available in combobox above) scenario: ========= a menu is decribed by a tree structure; rendering the menu is done by a tagfile 'render_menuitem', which renders the current item either as a leaf item (clicking on it causes an action) or as a node item (clicking on it opens another next-level submenu); rendering the submenu is done by calling the tagfile again from within its body; this worked fine with tomcat 5.0.x and 5.5.x to make it clear see the following pseudo code (the original code is to voluminous): tagfile 'render_menuitem.tagx': <jsp:root ...> <jsp:directive.attribute name=""menu_item""/> <c:choose> <c:when test=""${menu_item.isNode} <div>node: ${menu_item.label}</div> <c:forEach var=""sub_item"" items=""menu_item.children""> <!-- THIS IS GOING TO CAUSE THE PROBLEM WITH TOMCAT6: --> <tags:render_menuitem menu_item=""${sub_item}""/> </c:forEach> <c:when> <c:otherwise> <div>leaf: ${menu_item.label}</div> </c:otherwise> </c:choose> </jsp:root> faulty behaviour: ================ with tomcat 6.0.13, the generated Java-Source for the tagfile reveals, that the body of the doTag() method is empty and therefore emits no html; the compilation itself was silently done, no error or warning was shown in the logfiles."	2007-06-18 10:10:02	1182180000	resolved fixed	b5a5094	1227480000	java/org/apache/jasper/compiler/Compiler.java	19:java/org/apache/jasper/compiler/Compiler.java
883	42707	Bug 42707 add host alias using jmx doesn't take affect until restart		2007-06-20 14:46:49	1182370000	resolved fixed	23a8ba0	1226200000	java/org/apache/catalina/connector/MapperListener.java java/org/apache/tomcat/util/http/mapper/Mapper.java	15:java/org/apache/catalina/connector/MapperListener.java 17:java/org/apache/tomcat/util/http/mapper/Mapper.java
884	42673	Bug 42673 SSI virtual include broken for context path with slashes	"If the context path of an application contains slashes (e.g. ""a/b"") the method getPathWithoutContext of class org.apache.catalina.ssi.SSIServletExternalResolver simply cuts from the second slash, so for url ""/a/b/do?.."" it tries to include ""b/do?.."" instead of ""do?.."". The patch is to include the context path and strip the path off: Line 419 String noContext = getPathWithoutContext(normContext.getContextPath(), normalized); Line 356ff protected String getPathWithoutContext(final String contextPath, final String servletPath) { if (servletPath.startsWith(contextPath)) { return servletPath.substring(contextPath.length()); } return servletPath; }"	2007-06-15 05:08:34	1181900000	resolved fixed	4d5cca1	1226190000	java/org/apache/catalina/ssi/SSIServletExternalResolver.java	1:java/org/apache/catalina/ssi/SSIServletExternalResolver.java
885	46011	Bug 46011 Cannot access to Principal via Subject.getSubject(AccessController.getContext())	"Cannot access to Principal via Subject.getSubject(AccessController.getContext()). Problem is that in method internalDoFilter of ApplicationFilterChain in call of filter chain the code determinate the Principal but don't use it: if( Globals.IS_SECURITY_ENABLED ) { final ServletRequest req = request; final ServletResponse res = response; Principal principal = ((HttpServletRequest) req).getUserPrincipal(); Object[] args = new Object[]{req, res, this}; SecurityUtil.doAsPrivilege (""doFilter"", filter, classType, args); args = null; } else { In this manner a SecurityUtil.doAsPrivilege will be called with Principal == null and method execute create a Subject with no Principals. Then call a Subject.doAsPrivileged(subject, pea, null); and this do not propagate Principals. I obtain a Subject without Principals calling Subject.getSubject(AccessController.getContext()). In attachment we send our solution"	2008-10-15 02:56:56	1224050000	resolved fixed	e148369	1225900000	java/org/apache/catalina/core/ApplicationFilterChain.java java/org/apache/catalina/security/SecurityUtil.java	1:java/org/apache/catalina/core/ApplicationFilterChain.java 2:java/org/apache/catalina/security/SecurityUtil.java
886	46047	Bug 46047 Issue when using include directive inside tag files that are inside jar files		2008-10-21 02:20:44	1224570000	resolved fixed	38ef38d	1225750000	java/org/apache/jasper/compiler/ParserController.java	6:java/org/apache/jasper/compiler/ParserController.java
887	42409	Bug 42409 Extra response headers not sent when using custom error page	"If I create a servlet that does the following: response.setHeader(""X-BUG"", ""Value""); response.sendError(HttpServletResponse.SC_BAD_REQUEST); If I use the tomcat default error page for 400 responses, the response will contain the header ""X-BUG"" with value ""Value"". However, if I create a custom error page, the response headers do NOT contain the ""X-BUG"" header in the response. Here is my web.xml, for example: <error-page> <error-code>400</error-code> <location>/400.jsp</location> </error-page> 400.jsp contains plain html: <html> <body> <h3>Custom 400 error page</h3> </body> </html>"	2007-05-14 09:03:17	1179150000	resolved fixed	e0489c8	1225720000	java/org/apache/catalina/core/StandardHostValve.java	13:java/org/apache/catalina/core/StandardHostValve.java
888	46051	Bug 46051 Servlet response writer does not respect line.separator system property		2008-10-21 10:54:42	1224600000	resolved fixed	f4bef20	1225590000	java/org/apache/catalina/connector/CoyoteWriter.java	18:java/org/apache/catalina/connector/CoyoteWriter.java
889	46105	Bug 46105 URIEncoding doesn't affect after form-authentication redirect	"How to reproduce bug. Configure tomcat connector with URIEncoding=UTF-8 attribute. Make a simple page that write out any request parameter. Configure this page as protected with form-based authentication. Try to access page, e.g. /site/page.jsp?q=%xx%yy%zz%tt where q=%xx%yy%zz is value in UTF-8 charset. When page is being accessed for the first time, then after authentication, parameter ""q"" is incorrectly interpreted (it seems as it was in ISO8859-1 or anything else, but not UTF-8). But subsequent access to the _same_ URI, i.e. /site/page.jsp?q=%xx%yy%zz%tt gives perfect result. I also tried useBobyEncodingForURI=true and request.setCharacterEncoding(""UTF-8"") - nothing is changed."	2008-10-27 23:37:52	1225170000	resolved fixed	d9def07	1225410000	java/org/apache/catalina/authenticator/FormAuthenticator.java	1:java/org/apache/catalina/authenticator/FormAuthenticator.java
890	46075	Bug 46075 FileUpload memory usage	"The DefaultFileItem class in pacakge org.apache.tomcat.util.http.fileupload creates a ByteArrayOutputStream of the full threshold size for every control on the submitted form. I have a form with 63 controls (checkboxes, text boxes and one File input), and I set the threshold to 20 Meg to allow upload of large image files into memory. I get an OutOfMemory exception since it tries to allocate 63 lots of 20M, although only 1 control requires the requested size. I think it would be much more sensible to create the ByteArrayOutputStream with an initial size of only a few kilobytes size it automatically increases its size as data is written to it."	2008-10-23 03:35:53	1224750000	resolved fixed	85e71cf	1225150000	java/org/apache/tomcat/util/http/fileupload/DeferredFileOutputStream.java	10:java/org/apache/tomcat/util/http/fileupload/DeferredFileOutputStream.java
891	46085	Bug 46085 Session are incorrectly expired due to thread unsafe code		2008-10-24 12:53:09	1224870000	resolved fixed	6344b96	1225130000	java/org/apache/catalina/session/StandardSession.java	2:java/org/apache/catalina/session/StandardSession.java
892	46096	Bug 46096 DefaultAnnotationProcessor.processAnnotations should use doPrivileged to call getDeclaredFields	"If tomcat is running with a SecurityManager, and a JSP uses PageContext.forward, DefaultAnnotationProcessor code can be called with untristed code on the call stack. The processAnnotations method contains the line: Field[] fields = instance.getClass().getDeclaredFields(); getDeclaredFields() is subject to security checks so this throws a java.security.AccessControlException. DefaultAnnotationProcessor is part of the code in the catlina lib directory, which is granted AllPermissions in the standard policy file. However, because there is untrusted JSP code on the stack, these permissions are not used. The call to getDeclaredFields() should be wrapped in an AccessController.doPrivileged call to avoid the exception."	2008-10-27 05:44:55	1225100000	resolved fixed	428c03b	1225130000	java/org/apache/catalina/core/DefaultInstanceManager.java	1:java/org/apache/catalina/core/DefaultInstanceManager.java
893	45735	Bug 45735 Updated ResourceAttributes.getETag	"After looking at a user's list post, I noticed the implementation was not consistent with the other getters (like getName). I propose changing it to: public String getETag(boolean strong) { if (strong) { // The strong ETag must always be calculated by the resources if (strongETag != null) return strongETag; if (attributes != null) { Attribute attribute = attributes.get(ETAG); if (attribute != null) { try { strongETag = attribute.get().toString(); } catch (NamingException e) { ; // No value for the attribute } } } return strongETag; } else { // The weakETag is contentLenght + lastModified if (weakETag == null) { weakETag = ""W/\"""" + getContentLength() + ""-"" + getLastModified() + ""\""""; } return weakETag; } }"	2008-09-03 10:48:23	1220450000	resolved fixed	e40c910	1224880000	java/org/apache/naming/resources/ResourceAttributes.java	1:java/org/apache/naming/resources/ResourceAttributes.java
894	45977	Bug 45977 Duplicate comment in code - CoyoteAdapter.java	"The XXX comments below seem to say the same thing. Not sure what the XXX represents. /** * Parse additional request parameters. */ protected boolean postParseRequest(org.apache.coyote.Request req, Request request, org.apache.coyote.Response res, Response response) throws Exception { // XXX the processor needs to set a correct scheme and port prior to this point, // in ajp13 protocols dont make sense to get the port from the connector.. // XXX the processor may have set a correct scheme and port prior to this point, // in ajp13 protocols dont make sense to get the port from the connector... // otherwise, use connector configuration if (! req.scheme().isNull()) { // use processor specified scheme to determine secure state request.setSecure(req.scheme().equals(""https""));"	2008-10-09 08:28:02	1223560000	resolved fixed	e277f6c	1223590000	java/org/apache/catalina/connector/CoyoteAdapter.java	1:java/org/apache/catalina/connector/CoyoteAdapter.java
895	45951	Bug 45951 Provide support for renaming JSESSIONID		2008-10-05 15:15:52	1223230000	resolved fixed	e85ed8c	1223320000	java/org/apache/catalina/Globals.java java/org/apache/catalina/authenticator/Constants.java java/org/apache/jasper/Constants.java	16:java/org/apache/catalina/Globals.java 17:java/org/apache/jasper/Constants.java 480:java/org/apache/catalina/authenticator/Constants.java
896	45933	Bug 45933 Error processing TLD file in webapp with XML parser		2008-10-01 23:51:18	1222920000	resolved fixed	f69637f	1223030000	java/org/apache/catalina/core/StandardContext.java java/org/apache/catalina/startup/TldConfig.java	1:java/org/apache/catalina/startup/TldConfig.java 3:java/org/apache/catalina/core/StandardContext.java
897	45851	Bug 45851 FarmWarDeployer fails to properly unpack copied war on target node		2008-09-19 22:17:57	1221880000	resolved fixed	c340c69	1222450000	java/org/apache/catalina/ha/deploy/FarmWarDeployer.java java/org/apache/catalina/ha/deploy/FileMessageFactory.java	1:java/org/apache/catalina/ha/deploy/FarmWarDeployer.java 215:java/org/apache/catalina/ha/deploy/FileMessageFactory.java
898	45026	Bug 45026 Custom HTTP-Error codes get remapped to 500er codes	We use Apache 2.2.8 with mod_JK 1.2.26 as a load-balancer for a Tomcat 5.5 cluster. We use Custom HTTP-Error codes like 450 for authentication-purposes. Those codes get remapped to 500. The Error-Code 450 is in the RFC2616 described as valid return code so this is a bug. The custom error-codes worked fine in Apache 1.3.41 with MOD_JK/1.2.25. You can easily reproduce this bug by writing a simple jsp-page with the following line: <%response.setStatus(450);%>	2008-05-18 04:16:12	1211100000	resolved fixed	03097fa	1221850000	java/org/apache/jk/common/JkInputStream.java	76:java/org/apache/jk/common/JkInputStream.java
899	45419	Bug 45419 Return Accept-Ranges from DefaultServlet	"Currently the DefaultServlet accepts the ""Ranges"" request header, but doesn't indicate this in its response by returning ""Accept-Ranges: bytes"". Although this is not required in HTTP/1.1, setting the header is required in order for the Adobe Acrobat plugin to correctly handle Linearized PDF's (which can speed download by allowing random access to a PDF file). Although it's not strictly necessary according to the specification I can't think of any reason why this header is not safe to set in a response from DefaultServlet, which is always dealing with static files, and not doing so has a negative impact on serving large PDF files - so I'm filing it as a bug rather than an RFE."	2008-07-17 07:38:07	1216290000	resolved fixed	633545f	1221680000	java/org/apache/catalina/servlets/DefaultServlet.java	1:java/org/apache/catalina/servlets/DefaultServlet.java
900	45441	Bug 45441 Matching of relevant servlet filters fails when request is forwarded...	"I ran into a situation where Tomcat will not execute appropriate filters on a request that has been forwarded. I'm using the handy URLRewriteFilter implementation (from tuckey.org). When I forwarded a request internally, filters that had a matching url-pattern (in the web.xml file) and with a dispatcher setting of both REQUEST and FORWARD were not invoked. On tracing the code (hours later), I found that the problem lies inside the ApplicationDispatcher code. It set the DISPATCHER_REQUEST_PATH_ATTR state attribue to be the servletPath. That meant that only matches using the servlet path would match, but longer (more exact) urls would fail to match. For example, using the following filter mapping: <filter-mapping> <filter-name>my-filter</filter-name> <url-pattern>/app/level/mycode.do</url-pattern> <dispatcher>REQUEST</dispatcher> <dispatcher>FORWARD</dispatcher> </filter-mapping> would not match a request that was forwarded to /app/level/mycode.do, which it should! Changing the url pattern to be ""/app/*"" would match, but ""/app/level/*"" would not, since the servletPath was /app in this example. The fix for this is quite simple. In the ApplicationDispatcher.java code, in the method processRequest() (which is only called for forwards), change the following statement: state.outerRequest.setAttribute (ApplicationFilterFactory.DISPATCHER_REQUEST_PATH_ATTR, servletPath); to use requestURI instead as follows: state.outerRequest.setAttribute (ApplicationFilterFactory.DISPATCHER_REQUEST_PATH_ATTR, requestURI ); This resolves the problem and let all the examples above correctly match and run the filter on a forward. I believe includes will also be broken in the same manner. Similar changes to the doInclude() method in ApplicationDispatcher.java will likely resolve that issue as well, though I have not tested this personally. Be nice to see this resolved in 6.0.17+. Thanks! ....Andrzej"	2008-07-20 10:54:40	1216570000	resolved fixed	2c0fffe	1221650000	java/org/apache/catalina/core/ApplicationDispatcher.java	1:java/org/apache/catalina/core/ApplicationDispatcher.java
901	45823	Bug 45823 AccessLogValve doesn't correctly handles combined log format (with patch)		2008-09-17 02:20:05	1221630000	resolved fixed	678b516	1221650000	java/org/apache/catalina/valves/AccessLogValve.java	1:java/org/apache/catalina/valves/AccessLogValve.java
902	45618	Bug 45618 Selector is not closed.		2008-08-11 22:45:15	1218510000	resolved fixed	d69b378	1220390000	java/org/apache/catalina/tribes/transport/nio/ParallelNioSender.java	11:java/org/apache/catalina/tribes/transport/nio/ParallelNioSender.java
903	45413	Bug 45413 Contribution of Bayeux implementation for Tomcat		2008-07-16 17:49:44	1216240000	resolved fixed	83fe69a	1220390000	java/org/apache/cometd/bayeux/Bayeux.java java/org/apache/cometd/bayeux/Channel.java java/org/apache/cometd/bayeux/Client.java java/org/apache/cometd/bayeux/DataFilter.java java/org/apache/cometd/bayeux/Listener.java java/org/apache/cometd/bayeux/Message.java java/org/apache/cometd/bayeux/SecurityPolicy.java java/org/apache/tomcat/bayeux/BayeuxException.java java/org/apache/tomcat/bayeux/BayeuxRequest.java java/org/apache/tomcat/bayeux/BayeuxServlet.java java/org/apache/tomcat/bayeux/ChannelImpl.java java/org/apache/tomcat/bayeux/ClientImpl.java java/org/apache/tomcat/bayeux/HttpError.java java/org/apache/tomcat/bayeux/MessageImpl.java java/org/apache/tomcat/bayeux/RequestBase.java java/org/apache/tomcat/bayeux/RequestFactory.java java/org/apache/tomcat/bayeux/TomcatBayeux.java java/org/apache/tomcat/bayeux/request/MetaConnectRequest.java java/org/apache/tomcat/bayeux/request/MetaDisconnectRequest.java java/org/apache/tomcat/bayeux/request/MetaHandshakeRequest.java java/org/apache/tomcat/bayeux/request/MetaSubscribeRequest.java java/org/apache/tomcat/bayeux/request/MetaUnsubscribeRequest.java java/org/apache/tomcat/bayeux/request/PublishRequest.java test/org/apache/cometd/bayeux/samples/EchoChatClient.java	
904	45628	Bug 45628 ExtensionValidator doesn't handle wrapped lines in MANIFEST.MF		2008-08-13 12:47:56	1218650000	resolved fixed	3773ec4	1220370000	java/org/apache/catalina/util/ManifestResource.java	2:java/org/apache/catalina/util/ManifestResource.java
905	45666	"Bug 45666 JspContextWrapper contains infinite loop in include(String relativeUrlPath, boolean flush)"	"public void include(String relativeUrlPath, boolean flush) throws ServletException, IOException { include(relativeUrlPath, false); // XXX } just calls itself it seems. Perhaps this should be (just a guess): public void include(String relativeUrlPath, boolean flush) throws ServletException, IOException { invokingJspCtxt.include(relativeUrlPath, false); // XXX } This came up for me when I had a .tag file that had an include in it. I was using Tomcat 5.5 but looking at the source of JspContextWrapper.java it looks like this issue is in 5.5 as well as 6 (and the svn trunk)."	2008-08-21 06:47:17	1219320000	resolved fixed	ccc1014	1220220000	java/org/apache/jasper/runtime/JspContextWrapper.java	1:java/org/apache/jasper/runtime/JspContextWrapper.java
906	45648	Bug 45648 Function 'f:length' not found		2008-08-18 19:54:44	1219100000	resolved fixed	6d40691	1220210000	java/org/apache/el/parser/ELParser.java	123:java/org/apache/el/parser/ELParser.java
907	45691	Bug 45691 Jasper creates duplicate variable names	"Sometimes a JSP's Java code, which have been generated by Jasper, has duplicate variable names. Therefore the JSP cannot be compiled and tomcat delivers an HTTP status code 500. You get an error message like this org.apache.jasper.JasperException: Unable to compile class for JSP: An error occurred at line: 10 in the jsp file: /test1.jsp Duplicate local variable _jspx_temp0 7: <c:set var=""a""> 8: <jsp:attribute name=""value""><%= new java.util.Date().toString() %></jsp:attribute> 9: </c:set> 10: <c:set var=""b""> 11: <jsp:attribute name=""value""><%= new java.util.Date().toString() %></jsp:attribute> 12: </c:set> 13: <h1>Test 1</h1> The reason of this error is the generation of variable names like _jspx_temp0, which are created for <jsp:attribute> tags. At the beginning of parsing a JSP file a counter is reset to 0. Every time an <jsp:attribute> tag occurs, the counter is used to build a variable name _jspx_temp<counter>. Thereafter the counter will be incremented. Unfortunately the counter is a static member of the JspUtil class. Suppose there's a thread 1, which created _jspx_temp4. The counter is 5. Now a second thread (thread 2) starts and resets the counter. Afterwards thread 2 creates _jspx_temp0 to _jspx_temp3. The counter is 4 by now. Then thread 2 stops and thread 1 continues. The next variable's name in thread 1 will be _jspx_temp4, which already exists. Therefore the generated java class cannot be compiled."	2008-08-26 07:23:33	1219750000	resolved fixed	337d6a6	1220190000	java/org/apache/jasper/compiler/Compiler.java java/org/apache/jasper/compiler/JspUtil.java java/org/apache/jasper/compiler/Node.java java/org/apache/jasper/compiler/TagPluginManager.java	1:java/org/apache/jasper/compiler/Compiler.java 9:java/org/apache/jasper/compiler/JspUtil.java 17:java/org/apache/jasper/compiler/Node.java 42:java/org/apache/jasper/compiler/TagPluginManager.java
908	45074	Bug 45074 Add configuration parameters for finer tuning of Http11AprProtocol thread usage		2008-05-23 15:44:19	1211570000	resolved fixed	6a1f316	1219820000	java/org/apache/coyote/http11/Http11AprProtocol.java	1:java/org/apache/coyote/http11/Http11AprProtocol.java
909	44809	Bug 44809 Improve AprLifecycleListener Error Messages		2008-04-11 10:18:59	1207920000	resolved fixed	46055c5	1219820000	java/org/apache/catalina/core/AprLifecycleListener.java	1:java/org/apache/catalina/core/AprLifecycleListener.java
910	43327	Bug 43327 Socket bind fails on tomcat startup when using apr	"I'm running debian sid, kernel 2.6.22 and use tomcat 6.0.14 together with apr 1.2.11. no special tomcat configuration (out of the box). On start up of tomcat I get the following error log: Debugging apr revealed a problem with IPV6: apr_socket_create() assigns a AF_INET6 socket, apr_socket_bind tries to bind a AF_INET address which fails. INFO: Loaded Apache Tomcat Native library 1.1.10. Sep 7, 2007 6:05:16 PM org.apache.catalina.core.AprLifecycleListener init INFO: APR capabilities: IPv6 [true], sendfile [true], accept filters [false], random [true]. Sep 7, 2007 6:05:16 PM org.apache.coyote.http11.Http11AprProtocol init SEVERE: Error initializing endpoint java.lang.Exception: Socket bind failed: [22] Invalid argument at org.apache.tomcat.util.net.AprEndpoint.init(AprEndpoint.java:612) at org.apache.coyote.http11.Http11AprProtocol.init(Http11AprProtocol.java:121) at org.apache.catalina.connector.Connector.initialize(Connector.java:1059) regards erik"	2007-09-07 07:22:31	1189160000	resolved fixed	fea7658	1219330000	java/org/apache/tomcat/util/net/AprEndpoint.java	2:java/org/apache/tomcat/util/net/AprEndpoint.java
911	45655	Bug 45655 check permisson		2008-08-19 14:13:35	1219170000	resolved fixed	b266836	1219280000	java/org/apache/juli/ClassLoaderLogManager.java	98:java/org/apache/juli/ClassLoaderLogManager.java
912	45608	Bug 45608 Race conditions on field countAllocated of class org.apache.catalina.core.StandardWrapper	"We found field countAllocated are accessed by allocate() and deallocate() without any protections by locks. Here is a trace log, Thread http-8081-1 id: 23 : READ [org.apache.catalina.core.StandardWrapper : allocate : 820] [org.apache.catalina.core.StandardWrapperValve : invoke : 129] [org.apache.catalina.core.StandardContextValve : invoke : 175] [org.apache.catalina.core.StandardHostValve : invoke : 128] [org.apache.catalina.valves.ErrorReportValve : invoke : 104] [org.apache.catalina.core.StandardEngineValve : invoke : 109] [org.apache.catalina.connector.CoyoteAdapter : service : 261] [org.apache.coyote.http11.Http11Processor : process : 844] [org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler : process : 581] [org.apache.tomcat.util.net.JIoEndpoint$Worker : run : 447] [java.lang.Thread : run : 735] Thread http-8081-4 id: 26 : WRITE [org.apache.catalina.core.StandardWrapper : deallocate : 871] [org.apache.catalina.core.StandardWrapperValve : invoke : 298] [org.apache.catalina.core.StandardContextValve : invoke : 175] [org.apache.catalina.core.StandardHostValve : invoke : 128] [org.apache.catalina.valves.ErrorReportValve : invoke : 104] [org.apache.catalina.core.StandardEngineValve : invoke : 109] [org.apache.catalina.connector.CoyoteAdapter : service : 261] [org.apache.coyote.http11.Http11Processor : process : 844] [org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler : process : 581] [org.apache.tomcat.util.net.JIoEndpoint$Worker : run : 447] [java.lang.Thread : run : 735] Thread http-8081-4 and http-8081-1 will access countAllocated in parallel. Since increment and decrement is *NOT* atomic, we think it is a potential race condition."	2008-08-10 21:27:37	1218420000	resolved fixed	816ecb8	1218550000	java/org/apache/catalina/core/StandardWrapper.java	1:java/org/apache/catalina/core/StandardWrapper.java
913	41407	Bug 41407 CLIENT-CERT Authentication with JAASRealm not working	"I tried to config my webapp to authenticate user by CLIENT-CERT auth method. I verified my JAAS LoginModule by using ""BASIC"" to auth method and successfully authenticated user login. After studying Tomcat 5.5.20 source, I found that the problem is caused by the RealmBase.java and JAASRealm.java. if CLIENT-CERT auth method is used, SSLAuthenticator will call the : JAASRealm.authenticate(X509Certificate certs[]) As JAASRealm didn't override authenticate(X509Certificate certs[]), RealmBase's authenticate will be used and it will only validate the certs and then call getPrincipal(X509Certificate) and then getPrincipal(String) is being called to get the Principal. However, in JAASRealm, this function always return null. That means Tomcat can't use JAASRealm with CLIENT-CERT auth method. Thanks Butler"	2007-01-18 18:33:49	1169160000	resolved fixed	6d78232	1218290000	java/org/apache/catalina/realm/JAASCallbackHandler.java java/org/apache/catalina/realm/JAASMemoryLoginModule.java java/org/apache/catalina/realm/JAASRealm.java	1:java/org/apache/catalina/realm/JAASRealm.java 4:java/org/apache/catalina/realm/JAASMemoryLoginModule.java 6:java/org/apache/catalina/realm/JAASCallbackHandler.java
914	45576	Bug 45576 JAASRealm not working with DigestAuthenticator		2008-08-06 02:12:34	1218000000	resolved fixed	c984c6a	1218280000	java/org/apache/catalina/realm/JAASCallbackHandler.java java/org/apache/catalina/realm/JAASMemoryLoginModule.java java/org/apache/catalina/realm/JAASRealm.java	2:java/org/apache/catalina/realm/JAASRealm.java 3:java/org/apache/catalina/realm/JAASCallbackHandler.java 15:java/org/apache/catalina/realm/JAASMemoryLoginModule.java
915	45591	Bug 45591 NullPointerException during shutdown in JKMain.pause()	"On startup, if Tomcat discovers that the main port is already bound to another process, it fails and tries to execute the shutdown code. In some situations (I'm not sure which), the org.apache.jk.server.JKMain instance variable wEnv is null at this point, which causes a NullPointerException when JKMain.pause() is called (see stacktrace below). Since this is occurring within a shutdown hook thread, it can result in a dirty shutdown of the JVM. I've observed this with Tomcat 5.5.20, but I looked over the code in 5.5.26 and it looks like the same problem is still present. Fortunately, the solution is very simple. Just add the following if test at the beginning of JKMain.pause(): if (wEnv == null) { return; } Stacktrace: SEVERE: StandardServer.await: create[8006]: java.net.BindException: Address already in use: JVM_Bind at java.net.PlainSocketImpl.socketBind(Native Method) at java.net.PlainSocketImpl.bind(PlainSocketImpl.java:359) at java.net.ServerSocket.bind(ServerSocket.java:319) at java.net.ServerSocket.<init>(ServerSocket.java:185) at org.apache.catalina.core.StandardServer.await(StandardServer.java:372) at org.apache.catalina.startup.Catalina.await(Catalina.java:615) at org.apache.catalina.startup.Catalina.start(Catalina.java:575) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at java.lang.reflect.Method.invoke(Method.java:585) at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:294) at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:432) Aug 7, 2008 3:25:34 PM org.apache.coyote.http11.Http11BaseProtocol pause INFO: Pausing Coyote HTTP/1.1 on http-8000 Aug 7, 2008 3:25:34 PM org.apache.catalina.connector.Connector pause SEVERE: Protocol handler pause failed java.lang.NullPointerException at org.apache.jk.server.JkMain.pause(JkMain.java:678) at org.apache.jk.server.JkCoyoteHandler.pause(JkCoyoteHandler.java:162) at org.apache.catalina.connector.Connector.pause(Connector.java:1031) at org.apache.catalina.core.StandardService.stop(StandardService.java:491) at org.apache.catalina.core.StandardServer.stop(StandardServer.java:743) at org.apache.catalina.startup.Catalina.stop(Catalina.java:601) at org.apache.catalina.startup.Catalina$CatalinaShutdownHook.run(Catalina.java:644)"	2008-08-07 12:35:38	1218130000	resolved fixed	38a62a6	1218210000	java/org/apache/jk/server/JkMain.java	2:java/org/apache/jk/server/JkMain.java
916	45453	Bug 45453 JDBCRealm.getRoles bad synchronization causes hangs w/ DIGEST authentication	"JDBCRealm.getRoles bad synchronization causes hangs w/ DIGEST authentication JDBCRealm caches PreparedStatement preparedRoles. That, and missing synchronization in JDBCRealm and/or DigestAuthenticator allow two threads to call getRoles simultaneously so that T1 will do stmt.executeQuery() while T2 does stmt.setString(1, userName) plus another .executeQuery() on the same PreparedStatement object. In the worst case, the JDBC driver gets confused by this, and blocks forever waiting for server response, causing all other threads that try to access DB hang. (This was observed with PostgreSQL 8.3-603-jdbc4 JDBC driver) org.postgresql.jdbc2.AbstractJdbc2Statement.execute(AbstractJdbc2Statement.java:451) org.postgresql.jdbc2.AbstractJdbc2Statement.executeWithFlags(AbstractJdbc2Statement.java:350) org.postgresql.jdbc2.AbstractJdbc2Statement.executeQuery(AbstractJdbc2Statement.java:254) org.apache.catalina.realm.JDBCRealm.getRoles(JDBCRealm.java:631) org.apache.catalina.realm.JDBCRealm.getPrincipal(JDBCRealm.java:596) org.apache.catalina.realm.RealmBase.authenticate(RealmBase.java:399) org.apache.catalina.authenticator.DigestAuthenticator.findPrincipal(DigestAuthenticator.java:283) org.apache.catalina.authenticator.DigestAuthenticator.authenticate(DigestAuthenticator.java:176)"	2008-07-22 02:25:02	1216710000	resolved fixed	9d3cad7	1217340000	java/org/apache/catalina/realm/JDBCRealm.java	1:java/org/apache/catalina/realm/JDBCRealm.java
917	45459	Bug 45459 Startup Listener error message unhelpful		2008-07-22 08:44:55	1216730000	resolved wontfix	4cab5f3	1217340000	java/org/apache/catalina/core/StandardContext.java	1:java/org/apache/catalina/core/StandardContext.java
918	42727	Bug 42727 CoyoteReader readLine returns null for some post request bodies that are a multiple of MAX_LINE_LENGTH in size		2007-06-23 06:29:58	1182590000	resolved fixed	92f847d	1216330000	java/org/apache/catalina/connector/CoyoteReader.java	1:java/org/apache/catalina/connector/CoyoteReader.java
919	42722	Bug 42722 Potential NullPointerException in org.apache.catalina.servlets.CGIServlet		2007-06-22 05:21:27	1182500000	resolved fixed	d41f610	1215720000	java/org/apache/catalina/servlets/CGIServlet.java	1:java/org/apache/catalina/servlets/CGIServlet.java
920	42678	Bug 42678 docBase ignored even if its not a subdir of appBase	"I use latest 6.0 SVN snapshot. I store deployable WARs in ""webapps-dist"" (aside ""webapps""). This is my setup: bash-3.2$ ls $CATALINA_BASE conf logs temp tomcat-dist webapps webapps-dist work bash-3.2$ ls webapps-dist sample.war bash-3.2$ cat conf/Catalina/localhost/sample.xml <Context docBase=""${catalina.base}/webapps-dist/sample.war""/> this ends up in: WARNUNG: A docBase /home/juergen/java/tomcat/webapps-dist/sample.war inside the host appBase has been specified, and will be ignored"	2007-06-15 15:07:50	1181930000	resolved fixed	252fca1	1215710000	java/org/apache/catalina/startup/HostConfig.java	3:java/org/apache/catalina/startup/HostConfig.java
921	45317	Bug 45317 DeltaManager always reports default timeout value for receiving session state on startup	"Hi there, If I override the state transfer timeout: <Manager className=""org.apache.catalina.ha.session.DeltaManager"" stateTransferTimeout=""10"" expireSessionsOnShutdown=""false"" notifyListenersOnReplication=""true""/> DeltaManager continues to log the default timeout value (ie: ""This operation will timeout if no session state has been received within 60 seconds.""): 2008-07-01 14:31:30,419 WARN [org.apache.catalina.ha.session.DeltaManager] - Manager [localhost#/manager], requesting session state from org.apache.catalina.tribes.membership.MemberImpl[tcp://{10, -64, 104, -55}:15000,{10, -64, 104, -55},15000, alive=18586,id={-62 91 -70 -63 -111 50 70 -33 -104 41 -48 -32 91 34 -83 -55 }, payload={}, command={}, domain={}, ]. This operation will timeout if no session state has been received within 60 seconds. 2008-07-01 14:31:35,310 WARN [org.apache.catalina.ha.ClusterListener] - Context manager doesn't exist:localhost#/host-manager But it actually uses the correct timeout value (ie: ""timing out after 10,100 ms""): 2008-07-01 14:31:40,518 ERROR [org.apache.catalina.ha.session.DeltaManager] - Manager [localhost#/manager]: No session state send at 01/07/08 14:31 received, timing out after 10,100 ms. This is only an incorrect message, but it is quite annoying especially coupled with the fact that the above configuration is only documented for tomcat 5 (where syntax is subtly different)."	2008-07-01 07:50:35	1214910000	resolved fixed	36bb5d9	1215030000	java/org/apache/catalina/ha/session/DeltaManager.java	1:java/org/apache/catalina/ha/session/DeltaManager.java
922	36155	Bug 36155 tomcat chooses wrong host if using mod_jk		2005-08-12 05:08:52	1123840000	resolved fixed	f23907d	1214620000	java/org/apache/coyote/ajp/AjpMessage.java	1051:java/org/apache/coyote/ajp/AjpMessage.java
923	45279	Bug 45279 McastServiceImpl leaks sockets.	"McastServiceImpl does not close its socket in stop() as it claims. It merely calls leaveGroup(), which is sufficient to stop receiving messages, but does not close the socket. This causes a file descriptor leak each time the service is stopped. add; socket.close(); after leaveGroup();"	2008-06-25 12:21:15	1214410000	resolved fixed	a2a7714	1214430000	java/org/apache/catalina/tribes/membership/McastServiceImpl.java	1:java/org/apache/catalina/tribes/membership/McastServiceImpl.java
924	45101	Bug 45101 DirContextURLConnection - Format Date Header Values per HTTP spec		2008-05-29 13:42:51	1212080000	resolved fixed	e0200b0	1212100000	java/org/apache/naming/resources/DirContextURLConnection.java	1:java/org/apache/naming/resources/DirContextURLConnection.java
925	42750	"Bug 42750 Http Post requests not handled correctly if there is more than one space between the ""POST"" and the URL"		2007-06-26 16:57:13	1182890000	resolved fixed	f93376d	1211230000	java/org/apache/coyote/http11/InternalAprInputBuffer.java java/org/apache/coyote/http11/InternalInputBuffer.java java/org/apache/coyote/http11/InternalNioInputBuffer.java	113:java/org/apache/coyote/http11/InternalInputBuffer.java 126:java/org/apache/coyote/http11/InternalAprInputBuffer.java 175:java/org/apache/coyote/http11/InternalNioInputBuffer.java
926	44986	"Bug 44986 JSP compilation exception with pageEncoding=""utf-8"" and file with byte order marks"	"JSP-File has byte order marks. If the attribute is set to ""UTF-8"" (upper case) or the file has no byte order marks, the compilation workes fine. {code} 12:32:16,946 ERROR [[jsp]] Servlet.service() for servlet jsp threw exception org.apache.jasper.JasperException: /dialog.jsp(2,0) Page-encoding specified in XML prolog (UTF-8) is different from that specified in page directive (utf-8) at org.apache.jasper.compiler.DefaultErrorHandler.jspError(DefaultErrorHandler.java:40) at org.apache.jasper.compiler.ErrorDispatcher.dispatch(ErrorDispatcher.java:407) at org.apache.jasper.compiler.ErrorDispatcher.jspError(ErrorDispatcher.java:236) at org.apache.jasper.compiler.Validator$DirectiveVisitor.comparePageEncodings(Validator.java:362) at org.apache.jasper.compiler.Validator$DirectiveVisitor.visit(Validator.java:197) at org.apache.jasper.compiler.Node$PageDirective.accept(Node.java:590) at org.apache.jasper.compiler.Node$Nodes.visit(Node.java:2338) at org.apache.jasper.compiler.Node$Visitor.visitBody(Node.java:2388) at org.apache.jasper.compiler.Node$Visitor.visit(Node.java:2394) at org.apache.jasper.compiler.Node$Root.accept(Node.java:489) at org.apache.jasper.compiler.Node$Nodes.visit(Node.java:2338) at org.apache.jasper.compiler.Validator.validate(Validator.java:1700) at org.apache.jasper.compiler.Compiler.generateJava(Compiler.java:178) at org.apache.jasper.compiler.Compiler.compile(Compiler.java:306) at org.apache.jasper.compiler.Compiler.compile(Compiler.java:286) at org.apache.jasper.compiler.Compiler.compile(Compiler.java:273) at org.apache.jasper.JspCompilationContext.compile(JspCompilationContext.java:566) at org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:316) at org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:336) at org.apache.jasper.servlet.JspServlet.service(JspServlet.java:265) at javax.servlet.http.HttpServlet.service(HttpServlet.java:803) at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:290) at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206) at org.apache.catalina.core.ApplicationDispatcher.invoke(ApplicationDispatcher.java:654) at org.apache.catalina.core.ApplicationDispatcher.processRequest(ApplicationDispatcher.java:445) at org.apache.catalina.core.ApplicationDispatcher.doForward(ApplicationDispatcher.java:379) at org.apache.catalina.core.ApplicationDispatcher.forward(ApplicationDispatcher.java:292) at de.cit.jsp.control.DispatchServlet.forward(DispatchServlet.java:286) at de.cit.jsp.control.DispatchServlet.doGet(DispatchServlet.java:272) at javax.servlet.http.HttpServlet.service(HttpServlet.java:690) at javax.servlet.http.HttpServlet.service(HttpServlet.java:803) at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:290) at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206) at de.cit.util.javax.servlet.ValidationFilter.doFilter(ValidationFilter.java:108) at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235) at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206) at de.cit.util.javax.servlet.jsp.XHtmlContentTypeFilter.doFilter(XHtmlContentTypeFilter.java:36) at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235) at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206) at org.jboss.web.tomcat.filters.ReplyHeaderFilter.doFilter(ReplyHeaderFilter.java:96) at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235) at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206) at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:230) at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:175) at org.jboss.web.tomcat.security.SecurityAssociationValve.invoke(SecurityAssociationValve.java:179) at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:432) at org.jboss.web.tomcat.security.JaccContextValve.invoke(JaccContextValve.java:84) at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:127) at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:102) at org.jboss.web.tomcat.service.jca.CachedConnectionValve.invoke(CachedConnectionValve.java:157) at org.apache.catalina.authenticator.SingleSignOn.invoke(SingleSignOn.java:420) at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:109) at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:262) at org.apache.coyote.ajp.AjpProcessor.process(AjpProcessor.java:437) at org.apache.coyote.ajp.AjpProtocol$AjpConnectionHandler.process(AjpProtocol.java:366) at org.apache.tomcat.util.net.JIoEndpoint$Worker.run(JIoEndpoint.java:446) at java.lang.Thread.run(Thread.java:619) {code} Case insensitive camparison in org.apache.jasper.compiler.Validator.comparePageEncodings(...) seems to fix the problem: {code} /* * Compares page encodings specified in various places, and throws * exception in case of page encoding mismatch. * * @param pageDirEnc The value of the pageEncoding attribute of the page * directive @param pageDir The page directive node * * @throws JasperException in case of page encoding mismatch */ private String comparePageEncodings(String pageDirEnc, Node.PageDirective pageDir) throws JasperException { Node.Root root = pageDir.getRoot(); String configEnc = root.getJspConfigPageEncoding(); /* * Compare the 'pageEncoding' attribute of the page directive with * the encoding specified in the JSP config element whose URL * pattern matches this page. Treat ""UTF-16"", ""UTF-16BE"", and * ""UTF-16LE"" as identical. */ if (configEnc != null) { if (!pageDirEnc.equalsIgnoreCase(configEnc) && (!pageDirEnc.toUpperCase().startsWith(""UTF-16"") || !configEnc .toUpperCase().startsWith(""UTF-16""))) { err.jspError(pageDir, ""jsp.error.config_pagedir_encoding_mismatch"", configEnc, pageDirEnc); } else { return configEnc; } } /* * Compare the 'pageEncoding' attribute of the page directive with * the encoding specified in the XML prolog (only for XML syntax, * and only if JSP document contains XML prolog with encoding * declaration). Treat ""UTF-16"", ""UTF-16BE"", and ""UTF-16LE"" as * identical. */ if ((root.isXmlSyntax() && root.isEncodingSpecifiedInProlog()) || root.isBomPresent()) { String pageEnc = root.getPageEncoding(); if (!pageDirEnc.equalsIgnoreCase(pageEnc) && (!pageDirEnc.toUpperCase().startsWith(""UTF-16"") || !pageEnc .toUpperCase().startsWith(""UTF-16""))) { err.jspError(pageDir, ""jsp.error.prolog_pagedir_encoding_mismatch"", pageEnc, pageDirEnc); } else { return pageEnc; } } return pageDirEnc; } {code}"	2008-05-13 04:42:11	1210670000	resolved fixed	3c84dcf	1210710000	java/org/apache/jasper/compiler/Validator.java	1:java/org/apache/jasper/compiler/Validator.java
927	42934	Bug 42934 sessionDidActivate() called before contextInitialized()	I'm using Seam and a Seam app depends upon the Seam application being initialized before you can do much of anything in Seam. That said Seam puts some hooks into the sessionDidActivate() and sessionDidPassivate() events. Because of that when I start up my app I'm getting a Seam IllegalStateException because the contextInitialized() event is fired after sessionDidActivate() so Seam is not yet initialized it's Session hooks are being fired. What makes me think this is a bug is that sessionWillPassivate() is being correctly called before contextDestroyed() so it would seem that sessionDidActivate() being called before contextInitialized() would be inconsistent behavior. So to sum up I think tomcat should fire context and session events in the following order: contextInitialized sessionDidActivate sessionWillPassivate contextDestroyed As a side note Tomcat 5 follows what I think is the completely wrong but consistent order by firing events in this order: sessionDidActivate contextInitialized contextDestroyed sessionWillPassivate	2007-07-18 14:40:10	1184780000	resolved fixed	a9cb6a6	1210360000	java/org/apache/catalina/core/StandardContext.java	25:java/org/apache/catalina/core/StandardContext.java
928	42943	Bug 42943 jsp:text gets confused with other *:text elements in a JSP tag file		2007-07-20 03:46:22	1184920000	resolved fixed	17b4436	1210280000	java/org/apache/jasper/compiler/JspDocumentParser.java	95:java/org/apache/jasper/compiler/JspDocumentParser.java
929	43080	Bug 43080 Suspicious url pattern warning logged to wrong webapp	"""Suspicious url pattern"" warnings are logged to the wrong webapp, not the one actually using them. These log events are coming from SecurityCollection.java."	2007-08-09 15:18:42	1186690000	resolved fixed	332d0f0	1209900000	java/org/apache/catalina/core/StandardContext.java java/org/apache/catalina/deploy/SecurityCollection.java	1:java/org/apache/catalina/deploy/SecurityCollection.java 6:java/org/apache/catalina/core/StandardContext.java
930	43191	Bug 43191 compressableMimeType attribute ignored	"I have set compression=""on"" and compressableMimeType=""text/html"" in server.xml. It appears that the value of compressableMimeType is being ignored. My XML responses are all coming back gzipped. If I switch to compression=""off"" the responses are not gzipped, but as soon as I turn it on, regardless of the value of compressableMimeType, the XML responses are coming back gzipped. A full Connector tag follows. Note that this is just an example -- I have tried many values for compressableMimeType (that do NOT include text/xml) and the responses are still compressed. <Connector port=""7630"" address=""${jboss.bind.address}"" maxThreads=""20"" minSpareThreads=""4"" maxSpareThreads=""10"" strategy=""ms"" maxHttpHeaderSize=""8192"" emptySessionPath=""true"" enableLookups=""false"" redirectPort=""7643"" acceptCount=""16"" connectionTimeout=""20000"" disableUploadTimeout=""true"" compression=""off"" compressableMimeType=""text/html,text/javascript,application/x-javascript,application/javascript"" />"	2007-08-22 15:02:44	1187810000	resolved fixed	e2524a8	1209810000	java/org/apache/coyote/http11/Http11AprProcessor.java java/org/apache/coyote/http11/Http11NioProcessor.java java/org/apache/coyote/http11/Http11Processor.java	3:java/org/apache/coyote/http11/Http11Processor.java 5:java/org/apache/coyote/http11/Http11AprProcessor.java 6:java/org/apache/coyote/http11/Http11NioProcessor.java
931	43150	Bug 43150 Tomcat and path with pound sign (#) -> ClassNotFoundException	"Tomcat will not start if it's located and launched from a path with a # (pound) character somewhere. You'll find all informations in the given mail-thread on tomcat-user, including some developer specific informations. One part of the problem is the usage of File.toURL in URLClassloader... I'd really appreciate it if this problem could be fixed/worked around (see mail-thread for hints). btw. the same applies to version 5.5 and probably earlier versions too. thanks!"	2007-08-16 14:35:07	1187290000	resolved fixed	fa91954	1209680000	java/org/apache/catalina/startup/ClassLoaderFactory.java java/org/apache/jasper/JspCompilationContext.java	2:java/org/apache/jasper/JspCompilationContext.java 33:java/org/apache/catalina/startup/ClassLoaderFactory.java
932	43142	Bug 43142 webapp expanded in a FOLDER named webapps/xxx.war is loaded TWICE	reproduce: copy the expanded of file xxx.war file in a FOLDER tomcat/webapps/xxx.war bug: tomcat will load the app TWICE	2007-08-16 06:24:52	1187260000	resolved fixed	6a8b1bb	1209630000	java/org/apache/catalina/startup/HostConfig.java	2:java/org/apache/catalina/startup/HostConfig.java
933	43366	"Bug 43366 Session Statistics command in manager fails with ""Unknown command /sessions"""		2007-09-12 08:15:55	1189600000	resolved fixed	f4a7632	1209320000	java/org/apache/catalina/manager/ManagerServlet.java	12:java/org/apache/catalina/manager/ManagerServlet.java
934	44877	Bug 44877 ClassCastException due to bad TagHandlerPool name generation of two different tags		2008-04-25 13:43:26	1209150000	resolved fixed	dfa25f4	1209320000	java/org/apache/jasper/compiler/Generator.java	3:java/org/apache/jasper/compiler/Generator.java
935	43425	Bug 43425 Non-compliant annotations		2007-09-18 21:33:56	1190170000	resolved fixed	48131cd	1209160000	java/javax/annotation/security/DenyAll.java java/javax/ejb/EJB.java java/javax/persistence/PersistenceContext.java java/javax/persistence/PersistenceProperty.java	
936	31257	Bug 31257 java.endorsed.dirs is not used when JSP compilation is forked	"When the JSP compiler forks a javac process, it should check to see what the currently endorsed directories are (check the system property ""java.endorsed.dirs"" - otherwise, classes end up missing and JSP pages do not properly compile. We experienced a problem when we explicitly set the java.endorsed.dirs property on the command line, and the JSP compiler did not use it when javac was forked. I have patched org.apache.jasper.compiler.Compiler to support this: *** src.original\jakarta-tomcat-jasper\jasper2 \src\share\org\apache\jasper\compiler\Compiler.java Tue Jun 15 17:30:35 2004 --- src\org\apache\jasper\compiler\Compiler.java Thu Sep 16 00:05:14 2004 *************** *** 349,358 **** --- 349,369 ---- extdirs.setPath(exts); javac.setExtdirs(extdirs); info.append("" extension dir="" + exts + ""\n""); } + // Add endorsed directories + String endorsed = System.getProperty(""java.endorsed.dirs""); + if(endorsed != null) { + Javac.ImplementationSpecificArgument endorsedArg = javac.createCompilerArg(); + endorsedArg.setLine(""-J-Djava.endorsed.dirs=""+endorsed); + info.append("" endorsed dir="" + endorsed + ""\n""); + } + else { + info.append("" no endorsed dirs specified\n""); + } + // Configure the compiler object javac.setEncoding(javaEncoding); javac.setClasspath(path); javac.setDebug(ctxt.getOptions().getClassDebugInfo()); true, i should probably check ctxt.getOptions().getFork() in the if() as well, but since i always fork it doesn't matter to me."	2004-09-16 05:10:06	1095330000	resolved fixed	0ea3e15	1208730000	java/org/apache/jasper/compiler/AntCompiler.java	1:java/org/apache/jasper/compiler/AntCompiler.java
937	29936	Bug 29936 XML parser loading problems by container	"I'm trying to use JSTL 1.1 with this version of tomcat and have both saxon and crimson in my web-app. If we have crimson and saxon in our webapp lib then tomcat tries to use crimson as the xml parser when reading the web.xml and compiling the jsp and we get the prefix error: org.apache.jasper.JasperException: <h3>Validation error messages from TagLibraryValidator for c</h3><p>null: java.lang.IllegalStateException: can't declare any more prefixes in this context</p><h3>Validation error messages from TagLibraryValidator for fmt</h3><p>null: java.lang.IllegalStateException: can't declare any more prefixes in this context</p> If we remove crimson, tomcat uses saxon (aelfred parser) and this fails on reading the web.xml (javax.xml.parsers.ParserConfigurationException: AElfred parser is namespace-aware) If we remove saxon and crimson then we are okay (defaults to xerces in the tomcat endorsed directory?) It seems to me that tomcat is using the parser in my web-app to read the web.xml rather than using xerces from the endorsed directory. The same web-app runs without problems in version 5.0.16. Tomcat seems to be using the service provider mechanism in 5.0.25 as I have property files in C:\Java\jakarta-tomcat-5.0.25 \work\Catalina\localhost\diabetes\loader\META-INF\services (can't find any documents on this). If I'm using more than one parser won't this cause problems as tomcat is setting only one parser and xslt processor here? Any comments are gratefully received. Thanks, Peter Neville"	2004-07-06 15:18:51	1089140000	resolved fixed	06c23d8	1208720000	java/org/apache/catalina/startup/ContextConfig.java	10:java/org/apache/catalina/startup/ContextConfig.java
938	44380	Bug 44380 TldConfig / Scan of URL that are not files	"The TldConfig class (org.apache.catalina.startup) is asking ClassLoader and all parent ClassLoader in order to get the URLs and then assume that the URLs are using ""file"" protocol. But when Tomcat is embedded, sometimes the URL are not always using ""file"" protocol and then new File() will fail. The given patch is to skip the URLs that are not using file protocol (that avoids ugly NPE in the ""new File(urls[i].toURI());"" call"	2008-02-08 05:29:21	1202470000	resolved fixed	2edf51e	1207960000	java/org/apache/catalina/startup/TldConfig.java	1:java/org/apache/catalina/startup/TldConfig.java
939	44389	Bug 44389 Cleanup of org.apache.naming.resources.CacheEntry resources (memory leak)	"Hi, I am memory profiling a webapp for my company because we suspect it has memory leaks when redeploying. This webapp has to be redeployed several times a week for security reasons (most of the time it is undeployed) and the memory leaks forced us to shutdown tomcat once a week to avoid OOM exception. I'm using jvm1.5 and tomcat 6.0.13 (also tried with 6.0.14 and today with 6.0.16), and Yourkit as the profiling tool. I have made the test in both linux and windows. I have created a JMeter test to deploy the app using the manager, make some request to the app and then undeploy it using again the manager app in a loop. After some redeployments, I got my OutOfMemoryException. Then I checked with my profiling tool and found that my own classes were correctly destroyed, and the classes retaining more memory were these ones (listed as a heirarchy): org.apache.catalina.core.ApplicationContext$DispatchData org.apache.catalina.core.ApplicationContext mapper of org.apache.catalina.core.StandardContext context of org.apache.tomcat.util.http.mapper.Mapper resources of org.apache.tomcat.util.http.mapper.Mapper$Context cache of org.apache.naming.resources.ProxyDirContext cache of org.apache.naming.resources.ResourceCache org.apache.naming.resources.CacheEntry[] The number of objects of each class were exactly the number of times I had redeployed the webapp. I have checked the contents of CacheEntry inside CacheEntry[] and it has an attribute ""name"" and the contents are the jsps and tld files of my app. There are as many CacheEntry with the same jsp attribute as times the webapp has been reloaded, so I guess there is no cleaning of CacheEntry resources at context shutdown. To reproduce this, a simple webapp with 2 jsp and a taglibrary can be used. Deploy and undeploy it many times so you can see how the count of these objects grows in memory."	2008-02-11 02:03:09	1202710000	resolved fixed	6723b35	1207950000	java/org/apache/catalina/core/ApplicationContext.java	5:java/org/apache/catalina/core/ApplicationContext.java
940	44391	Bug 44391 SSI handling of escaped characters broken	"In org.apache.catalina.ssi.SSIProcessor the method parseParamNames is broken. If I have a SSI directive like <!--#set var=""test"" value=""blubb\""\"""" --> the method detects three parameters instead of two. This is because there are two consecutive escaped characters. Although the first one \"" is detected correctly the next one isn't because the flag escaped is still set to true, although this character isn't escaped anymore. You have to replace boolean escaped = false; for (; bIdx < cmd.length() && quotes != 2; bIdx++) { char c = cmd.charAt(bIdx); // Need to skip escaped characters if (c == '\\' && !escaped) { escaped = true; bIdx++; continue; } escaped = false; if (c == '""') quotes++; } by for (; bIdx < cmd.length() && quotes != 2; bIdx++) { char c = cmd.charAt(bIdx); // Need to skip escaped characters if (c == '\\') { bIdx++; continue; } if (c == '""') quotes++; } Just removing the flag escaped is sufficient, because you don't have to remember whether the last character was escaped and that should have no influence to consecutive characters. The bug still exists in the HEAD revision of the repository."	2008-02-11 04:37:40	1202720000	resolved fixed	df75937	1207950000	java/org/apache/catalina/ssi/SSIProcessor.java	1:java/org/apache/catalina/ssi/SSIProcessor.java
941	44392	Bug 44392 HTML entities not resolved in SSI filter	"HTML entities which are contained in an SSI set directive aren't resolved by the SSI filter (in contrary to what is done by mod_include of Apaches HTTP). mod_include resolves all HTML entities in most of the attribute values of ssi directives. It also resolves \"" to "" and \$ to $. The ssi filter of tomcat resolves all escaped character which are escaped with a backslash, but no HTML entities at all. Apart from that, giving encoding ""entity"" should be different from giving encoding=""none"" to the SSI echo directive. One should replace all invalid HTML characters by valid HTML entities and the other one should do nothing. The encoding is especially important if you wan't to store a HTML-Comment within a SSI variable. If I want to store a variable test with the value ""<!-- testvalue ""x"" -->"" <!--#set var=""test"" value=""<!-- testvalue ""x"" -->""--> for mod_include you must write: <!--#set var=""test"" value=""<!&#45;&#45; testvalue \""x\"" &#45;&#45;>"" --> for Tomcats SSI you must write: <!--#set var=""test"" value=""<!\-\- testvalue \""x\"" \-\->"" --> And there should be a difference whether I output this variable with <!--#echo var=""test"" encoding=""none"" --> which should lead to <!-- testvalue ""x"" -->, or <!--#echo var=""test"" encoding=""entity"" --> which should lead to &lt;!-- testvalue &quot;x&quot; --&gt;"	2008-02-11 05:37:37	1202730000	resolved fixed	75fbd91	1207940000	java/org/apache/catalina/ssi/SSIEcho.java java/org/apache/catalina/ssi/SSIMediator.java	2:java/org/apache/catalina/ssi/SSIEcho.java 6:java/org/apache/catalina/ssi/SSIMediator.java
942	44408	Bug 44408 EL-expression evaluation slow due to synchronization caused by JspFactory.getDefaultFactory		2008-02-13 03:36:02	1202890000	resolved fixed	1f41c3d	1207850000	java/org/apache/jasper/runtime/PageContextImpl.java	6:java/org/apache/jasper/runtime/PageContextImpl.java
943	44428	Bug 44428 FunctionMapperImpl.Function throws a NPE in certain circumstances	"In FunctionMapperImpl.Function it is possible for writeExternal to fail if the class has just been de-serialised and is then serialised again. If you look at writeExternal: public void writeExternal(ObjectOutput out) throws IOException { out.writeUTF((this.prefix != null) ? this.prefix : """"); out.writeUTF(this.localName); out.writeUTF(this.m.getDeclaringClass().getName()); out.writeUTF(this.m.getName()); out.writeObject(ReflectionUtil.toTypeNameArray( this.m.getParameterTypes())); } you can see that it externalises the function to be invoked by using the reference to the Method itself. If you look at readExternal however: public void readExternal(ObjectInput in) throws IOException, ClassNotFoundException { this.prefix = in.readUTF(); if ("""".equals(this.prefix)) this.prefix = null; this.localName = in.readUTF(); this.owner = in.readUTF(); this.name = in.readUTF(); this.types = (String[]) in.readObject(); } You can see that it doesn't restore the Method after deserialisation. The method is restored if it is accessed, however if it's not and then serialisation is performed writeExternal will throw a NPE (as m is still null). The fix is to either get the method to be reconstructed as soon as deserialisation completes - or perhaps to be a bit more efficient, in writeExternal change it such that if m is null it externalises using the components of the method: public void writeExternal(ObjectOutput out) throws IOException { out.writeUTF((this.prefix != null) ? this.prefix : """"); out.writeUTF(this.localName); if (m == null) { out.writeUTF(this.owner); out.writeUTF(this.name); out.writeObject(this.types); } else if (this.m != null) { out.writeUTF(this.m.getDeclaringClass().getName()); out.writeUTF(this.m.getName()); out.writeObject(ReflectionUtil.toTypeNameArray( this.m.getParameterTypes())); } }"	2008-02-15 02:36:16	1203060000	resolved fixed	0035fd4	1207780000	java/org/apache/el/lang/FunctionMapperImpl.java	1:java/org/apache/el/lang/FunctionMapperImpl.java
944	44595	Bug 44595 Add possibility to request the QueueSize of an executor via JMX		2008-03-13 01:34:50	1205390000	resolved fixed	c3c525b	1207560000	java/org/apache/catalina/core/StandardThreadExecutor.java	16:java/org/apache/catalina/core/StandardThreadExecutor.java
945	44529	Bug 44529 RealmBase authorization via hasResourcePermission not fully servlet spec compliant	"The authorization implementation in RealmBase, in the hasResourcePermission method is not fully servlet specification compliant. The spec (both 2.4 and 2.5) states: ""... A security constraint that does not contain an authorization constraint shall combine with authorization constraints that name or imply roles to allow unauthenticated access. The special case of an authorization constraint that names no roles shall combine with any other constraints to override their affects and cause access to be precluded. ..."" In Tomcat this works fine as long as there aren't weird (but legal!) combinations or security-constraints on the same URLs. Example: <security-constraint> <web-resource-collection> <url-pattern>/someUrl/*</url-pattern> <http-method>POST</http-method> </web-resource-collection> <!-- no auth-constraint, to allow everyone --> </security-constraint> <security-constraint> <web-resource-collection> <url-pattern>/someUrl/*</url-pattern> <http-method>POST</http-method> </web-resource-collection> <!-- no roles, to allow noone --> <auth-constraint /> </security-constraint> (if we ignore that this kind of configuration is pretty pointless,) the spec dictates that a POST to /someUrl/index.html should be denied access. Tomcat grants it. (both 5.5.23 and 6.0.14 do) Example 2: <security-constraint> <web-resource-collection> <url-pattern>/someUrl/*</url-pattern> <http-method>POST</http-method> </web-resource-collection> <!-- no roles, to allow noone --> <auth-constraint /> </security-constraint> <security-constraint> <web-resource-collection> <url-pattern>/someUrl/*</url-pattern> <http-method>POST</http-method> </web-resource-collection> <auth-constraint> <role-name>*</role-name> </auth-constraint> </security-constraint> Now it gets interesting. In ""strict"" mode, access to /someUrl/index.html is denied (regardless of the web.xml-configured security roles and the roles the user has). In ""auth-only"" mode, access is always granted, and in ""strict auth-only"" mode access is granted if there are no web.xml-configured security roles. Now these modes are a Tomcat addition to the spec, but I feel access should have been denied in all modes, both to stay in line with the spec and to keep the behaviour predictable."	2008-03-04 08:04:54	1204640000	resolved fixed	7be2374	1206800000	java/org/apache/catalina/realm/RealmBase.java	1:java/org/apache/catalina/realm/RealmBase.java
946	44673	Bug 44673 ServletInputStream still readable even when closed		2008-03-25 15:32:18	1206470000	resolved fixed	ca41a27	1206490000	java/org/apache/catalina/connector/InputBuffer.java	16:java/org/apache/catalina/connector/InputBuffer.java
947	44646	Bug 44646 IllegalStateException when using CometConnectionManagerValve	"We're writing an application that processes requests using both a normal servlet and a CometProcessor. The normal servlet handles user authentication and logout (among other things). Once the user has been authenticated, the client makes a Comet request, which is open until the server has something to push to the client. When the user decides to log out, we need to stop processing Comet events for that client. I enabled the CometConnectionManagerValve in context.xml, hoping I would get an END event when the session goes away. Instead, I get an IllegalStateException: Mar 10, 2008 2:05:41 PM org.apache.catalina.connector.CoyoteAdapter event SEVERE: An exception or error occurred in the container during the request processing java.lang.IllegalStateException: Cannot create a session after the response has been committed at org.apache.catalina.connector.Request.doGetSession(Request.java:2301) at org.apache.catalina.connector.Request.getSession(Request.java:2075) at org.apache.catalina.valves.CometConnectionManagerValve.event(CometConnectionManagerValve.java:311) at org.apache.catalina.core.StandardHostValve.event(StandardHostValve.java:179) at org.apache.catalina.valves.ValveBase.event(ValveBase.java:200) at org.apache.catalina.core.StandardEngineValve.event(StandardEngineValve.java:128) at org.apache.catalina.connector.CoyoteAdapter.event(CoyoteAdapter.java:198) at org.apache.coyote.http11.Http11NioProcessor.event(Http11NioProcessor.java:749) at org.apache.coyote.http11.Http11NioProtocol$Http11ConnectionHandler.event(Http11NioProtocol.java:653) at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.run(NioEndpoint.java:2080) at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:885) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:907) at java.lang.Thread.run(Thread.java:619) Presumably my servlet handles the ""logout"" request, and after sending a response to the client, calls invalidate() on the HttpSession. Subsequently, CometConnectionManagerValue.event() calls request.getSession(true), resulting in the IllegalStateException."	2008-03-20 09:33:14	1206020000	resolved fixed	fdac1d6	1206310000	java/org/apache/catalina/valves/CometConnectionManagerValve.java	1:java/org/apache/catalina/valves/CometConnectionManagerValve.java
948	44558	"Bug 44558 cite attempted address when throwing ""Cannot assign requested address"""	SEVERE: Error starting endpoint java.net.BindException: Cannot assign requested address:2217 at org.apache.tomcat.util.net.JIoEndpoint.init(JIoEndpoint.java:501) at org.apache.tomcat.util.net.JIoEndpoint.start(JIoEndpoint.java:515) at org.apache.coyote.http11.Http11Protocol.start(Http11Protocol.java:203) at org.apache.catalina.connector.Connector.start(Connector.java:1131) at org.apache.catalina.core.StandardService.start(StandardService.java:531) at org.apache.catalina.core.StandardServer.start(StandardServer.java:710) at org.apache.catalina.startup.Catalina.start(Catalina.java:578) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) saying which address a bind was attempted for would accelerate the error resolution quite a bit!	2008-03-07 07:41:10	1204890000	resolved fixed	7bd915c	1205080000	java/org/apache/tomcat/util/net/JIoEndpoint.java	1:java/org/apache/tomcat/util/net/JIoEndpoint.java
949	44562	Bug 44562 HEAD requests cannot go through request dispatch include.		2008-03-07 13:19:40	1204910000	resolved fixed	288b2ae	1205080000	java/javax/servlet/http/HttpServlet.java	14:java/javax/servlet/http/HttpServlet.java
950	44337	Bug 44337 Dir listing crashes if no readme-file present	"DefaultServlet docu 6.0 says about attibute readmeFile: If a directory listing is presented, a readme file *may* also be presented with the listing. This file is inserted ..... This was true for 5.5.x. 6.0.14 crashes if the file is absent in the listed directory. javax.servlet.ServletException: Error opening readme resource at org.apache.catalina.servlets.DefaultServlet.getReadme(DefaultServlet.java:1418) This new behaviour blocks the listing of big directory trees managed by others, where the work-around is nor feasible. Work around 1: readme file in *every* subdir, empty (length=0) if none wanted (and subsequent changes in the used XSL-Transformers) Work around 2: Change ""may"" to ""must"" in docu. Repair: fix DefaultServlet From web.xml: <servlet> <servlet-name>default</servlet-name> <servlet-class>org.apache.catalina.servlets.DefaultServlet</servlet-class> <init-param> <param-name>listings</param-name> <param-value>true</param-value> </init-param> <init-param> <param-name>globalXsltFile</param-name> <param-value>D:\www\serv-intra\meva-dir-li.xsl</param-value> </init-param> <init-param> <param-name>readmeFile</param-name> <param-value>readme.htm</param-value> </init-param> <load-on-startup>1</load-on-startup> </servlet>"	2008-02-01 01:54:32	1201850000	resolved fixed	8a3b14b	1202090000	java/org/apache/catalina/servlets/DefaultServlet.java	1:java/org/apache/catalina/servlets/DefaultServlet.java
951	43701	Bug 43701 Error while starting tomcat	"this is my NIO Connector configuration in server.xml <Connector acceptCount=""100"" enableLookups=""false"" port=""80"" protocol=""org.apache.coyote.http11.Http11NioProtocol"" acceptorThreadCount=""2"" socket.bufferPool=""-1"" connectionTimeout=""60000"" maxKeepAliveRequests=""-1"" maxThreads=""200"" minSpareThreads=""25"" redirectPort=""8443"" /> when I am starting my tomcat it is giving following error in the console several time SEVERE: java.lang.NullPointerException at org.apache.tomcat.util.net.NioEndpoint.setSocketOptions(NioEndpoint.java:985) at org.apache.tomcat.util.net.NioEndpoint$Acceptor.run(NioEndpoint.java:1169) at java.lang.Thread.run(Thread.java:595)"	2007-10-26 03:01:21	1193380000	resolved fixed	bf6ce6f	1202070000	java/org/apache/tomcat/util/net/NioEndpoint.java	1:java/org/apache/tomcat/util/net/NioEndpoint.java
952	44282	Bug 44282 WebappClassLoader.findClass calls getClassLoader without privileges	"When logging is in TRACE mode or lower, org.apache.catalina.loader.WebappClassLoader.findClass(String) calls getClassLoader() without a privileged block. With security enabled, this will cause a SecurityException if the RuntimePermission to getClassLoader is not granted."	2008-01-22 23:50:47	1201060000	resolved fixed	948598d	1201740000	java/org/apache/catalina/loader/WebappClassLoader.java	1:java/org/apache/catalina/loader/WebappClassLoader.java
953	44268	Bug 44268 Multiple registrations of same ServletContextListener class not possible	"When I register the same class implementing ServletContextListener twice or more its' contextInitialized methods only gets called once. The servlet specifications (2.4 and 2.5) say the conforming container has to call the listeners in the same order they are registered in the deployment descriptor. The case that one listener class is registered twice is not mentioned explicitly in the specification, though. Example: <listener> <listener-class>test.ServletContextListener1</listener-class> </listener> <listener> <listener-class>test.ServletContextListener2</listener-class> </listener> <listener> <listener-class>test.ServletContextListener1</listener-class> </listener> test.ServletContextListener1 and test.ServletContextListener2 get called, but test.ServletContextListener1 does not get called again. Apache Tomcat 5.5.25 has the same bug."	2008-01-18 08:42:18	1200660000	resolved fixed	cdff09f	1200950000	java/org/apache/catalina/core/StandardContext.java	6:java/org/apache/catalina/core/StandardContext.java
954	44223	"Bug 44223 Tomcat ignores the ""javax.net.ssl.trustStoreType"" system property"	"Set up a SSL Connector with a keystore in JKS format: <Connector ... SSLEnabled=""true"" keystoreFile=""tomcat.keystore"" keystoreType=""JKS""> Let's say you need a custom truststore (e.g. for authenticating self-signed client certificates), and that this truststore is also needed by some of your webapps, not only Tomcat. The natural thing to do then is to configure this truststore globally for the whole JVM, not in server.xml. Let's also assume this truststore is in a different format (e.g. PKCS#12). So before starting Tomcat, you do this: export JAVA_OPTS=""-Djavax.net.ssl.trustStore=trusted.keystore - Djavax.net.ssl.trustStoreType=PKCS12"" Well, it doesn't work. If you look at tomcat/logs/catalina.out, you will see a keystore-related exception. Upon further debugging, you will discover the problem is that Tomcat is trying to open the truststore as if it were in JKS format, even though it is clearly specified as type PKCS12 in JAVA_OPTS above."	2008-01-14 04:24:16	1200300000	resolved fixed	f9e41b8	1200690000	java/org/apache/tomcat/util/net/jsse/JSSESocketFactory.java	2:java/org/apache/tomcat/util/net/jsse/JSSESocketFactory.java
955	43468	Bug 43468 HTMLManagerServlet NullPointerException listing context	"Obtained the following NullPointerException, stack trace below java.lang.NullPointerException org.apache.catalina.manager.HTMLManagerServlet.list(HTMLManagerServlet.java:437) org.apache.catalina.manager.HTMLManagerServlet.doGet(HTMLManagerServlet.java:136) Code is: args[11] = new Integer(context.getManager().getMaxInactiveInterval()/60); Seemingly the getManager() is returning null."	2007-09-24 18:46:12	1190670000	resolved fixed	e14afee	1200530000	java/org/apache/catalina/manager/HTMLManagerServlet.java	1:java/org/apache/catalina/manager/HTMLManagerServlet.java
956	11117	Bug 11117 Coyote connector does not correctly deal with large PUT when using chunked transfer encoding	"I've built a small test servlet (included below) that shows this behaviour. If I upload data to tomcat (configured to use the HTTP/1.1 Coyote connector) using a chunked transfer-encoding on a PUT, then the result (i.e. what I read using the servlet's request.getInputStream() is corrupted. This _only_ happens on large PUTs (it happens every time I tried it (about 10) on a large PUT - I was testing with something around 700 kB, and another thing of about 1 MB, but does NOT always corrupt it in the same way. I did not see any corruption on small files (~50 kB and smaller), though I didn't test this extensively. The total length of the data read is exactly correct (712080 bytes in my first test). At the first point of corruption in the file, a chunk header appears in the output (""\r\n1000\r\n"") followed by correct data from about 700 bytes later on, then a second copy (in the correct place, I think) of the corrupt data (i.e. correct data, followed by the chunk header, followed by some data repeated, the second instance of which is in the correct place - so the first instance is being produced _instead_ of the correct data for that point in the input). Test servlet follows: import java.io.*; import javax.servlet.*; import javax.servlet.http.*; public class Test extends HttpServlet { public void doPut(HttpServletRequest req, HttpServletResponse res) throws ServletException, IOException { FileOutputStream fos = new FileOutputStream(""/tmp/servlet-out""); InputStream is = req.getInputStream(); byte buf[] = new byte[2000]; int ret; while((ret = is.read(buf)) > 0) { fos.write(buf, 0, ret); } fos.close(); is.close(); PrintWriter pw = res.getWriter(); pw.println(""Done""); pw.flush(); pw.close(); } }"	2002-07-24 07:44:57	1027510000	resolved fixed	1cc6641	1199830000	java/org/apache/coyote/http11/filters/ChunkedInputFilter.java	107:java/org/apache/coyote/http11/filters/ChunkedInputFilter.java
957	43743	Bug 43743 Cannot jspc precompile jsps with nested .tag files	"myjsp.jsp: HELLO <tag1/> tag1.tag: <tag2> tag2.tag: WORLD Crashes (null pointer) while trying to load tag2.class, called by TagFileProcessor.loadTagFile. Very Initial analysis:- TagFileProcessor.loadTagFile creates wrapper, but ctxt.getTagFileJarUrl (tagFilePath) returns null for nested .tag. Thus in JspCompilationContext.Compile JspCCtx.isPackagedFile == false, so outDated test is wrong So tag2.tag not compiled, thus class cannot be loaded. But problem also appears if tags not packaged in a .jar, so there is more going on. Work around is to create dummy.jsp that calls the .tags in leaf first order so .class files are created."	2007-10-30 21:25:38	1193790000	resolved fixed	98b8ba2	1199750000	java/org/apache/jasper/compiler/Parser.java	41:java/org/apache/jasper/compiler/Parser.java
958	43758	Bug 43758 java.lang.NullPointerException from org.apache.jasper.compiler.ServletWriter.printMultiLn() on validation of JSPX with empty <jsp:scriptlet> element		2007-10-31 11:58:06	1193850000	resolved fixed	61ce1a3	1199220000	java/org/apache/jasper/compiler/Node.java	184:java/org/apache/jasper/compiler/Node.java
959	43868	Bug 43868 MBeanServer invoke issue	"Impossible to invoke ""removeRole"" or other MBean methods and ""setAttribute"" by MBeanServer cause of the same bug in ManagedBean.java at both lines 545 (getSetter method) and 604 (getInvoke method): object = this; Must be replace by: object = bean; Fortunately getGetter method is correct."	2007-11-15 01:26:51	1195110000	resolved fixed	ccadbbc	1198970000	java/org/apache/tomcat/util/modeler/ManagedBean.java	1:java/org/apache/tomcat/util/modeler/ManagedBean.java
960	43285	Bug 43285 Missing EL Coercion causes argument type mismatch	"I'll attach a sample web application reproducing the error. Note that this error only occurs when using Tomcat 6.0.x (i.e. it works with Jetty as it uses Sun's EL RI). Moreover it doesn't matter which JSF implementation you're using to reproduce the error (I just wanted to mention that as it's definitely no bug in MyFaces even though the following stack trace shows a FacesException). The exception stack trace: javax.faces.FacesException: Exception while calling broadcast on component : {Component-Path : [Class: javax.faces.component.UIViewRoot,ViewId: /home.jsp][ Class: javax.faces.component.html.HtmlForm,Id: j_id_jsp_923754602_1][Class: javax.faces.component.html.HtmlCommandButton,Id: j_id_jsp_923754602_3]} at javax.faces.component.UIComponentBase.broadcast(UIComponentBase.java:494) at javax.faces.component.UICommand.broadcast(UICommand.java:105) at javax.faces.component.UIViewRoot._broadcastForPhase(UIViewRoot.java:292) at javax.faces.component.UIViewRoot.process(UIViewRoot.java:209) at javax.faces.component.UIViewRoot.processApplication(UIViewRoot.java:117) at org.apache.myfaces.lifecycle.InvokeApplicationExecutor.execute(InvokeApplicationExecutor.java:32) at org.apache.myfaces.lifecycle.LifecycleImpl.executePhase(LifecycleImpl.java:95) at org.apache.myfaces.lifecycle.LifecycleImpl.execute(LifecycleImpl.java:70) at javax.faces.webapp.FacesServlet.service(FacesServlet.java:144) at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:290) at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206) at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:233) at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:175) at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:128) at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:102) at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:109) at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:263) at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:844) at org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.process(Http11Protocol.java:584) at org.apache.tomcat.util.net.JIoEndpoint$Worker.run(JIoEndpoint.java:447) at java.lang.Thread.run(Thread.java:619) Caused by: org.apache.jasper.el.JspELException: /home.jsp(12,3) '#{numberBean.number}' java.lang.IllegalArgumentException: argument type mismatch at org.apache.jasper.el.JspValueExpression.setValue(JspValueExpression.java:94) at org.apache.myfaces.event.SetPropertyActionListener.processAction(SetPropertyActionListener.java:72) at javax.faces.event.ActionEvent.processListener(ActionEvent.java:48) at javax.faces.component.UIComponentBase.broadcast(UIComponentBase.java:489) ... 20 more Caused by: java.lang.IllegalArgumentException: argument type mismatch at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at java.lang.reflect.Method.invoke(Method.java:597) at javax.el.BeanELResolver.setValue(BeanELResolver.java:108) at javax.el.CompositeELResolver.setValue(CompositeELResolver.java:68) at org.apache.myfaces.el.unified.resolver.FacesCompositeELResolver.access$501(FacesCompositeELResolver.java:46) at org.apache.myfaces.el.unified.resolver.FacesCompositeELResolver$6.invoke(FacesCompositeELResolver.java:132) at org.apache.myfaces.el.unified.resolver.FacesCompositeELResolver.invoke(FacesCompositeELResolver.java:148) at org.apache.myfaces.el.unified.resolver.FacesCompositeELResolver.setValue(FacesCompositeELResolver.java:128) at org.apache.el.parser.AstValue.setValue(AstValue.java:114) at org.apache.el.ValueExpressionImpl.setValue(ValueExpressionImpl.java:249) at org.apache.jasper.el.JspValueExpression.setValue(JspValueExpression.java:85) ... 23 more"	2007-09-02 13:14:26	1188750000	resolved fixed	c5bcc98	1198720000	java/org/apache/el/parser/AstValue.java	14:java/org/apache/el/parser/AstValue.java
961	42503	Bug 42503 ServletContext.getResourceAsStream returns stale data	"Under certain conditions, the resource cache implementation used by the servlet/JSP engine (in org.apache.naming.resource) does not detect that a file in its cache has been modified and therefore returns the previous contents of the file. This happens only * when the file contents are modified but the file length doesn't change * until the time the first change in the file is detected after server startup To reproduce the problem, put the attached test.jsp and test.txt into the ROOT web app and then do the following. (I used Tomcat 6's trunk for the test) % cat test.txt abcd % telnet . 9080 Trying 0.0.0.0... Connected to .. Escape character is '^]'. GET /test.jsp HTTP/1.0 HTTP/1.1 200 OK Server: Apache-Coyote/1.1 Set-Cookie: JSESSIONID=706D6FE8B06687509D42E79DBEE266EF; Path=/ Content-Type: text/html Content-Length: 26 Date: Wed, 23 May 2007 23:03:05 GMT Connection: close File contents=[ abcd ] Connection to . closed by foreign host. % cat test.txt (change the contents but not the size) efgh % telnet . 9080 Trying 0.0.0.0... Connected to .. Escape character is '^]'. GET /test.jsp HTTP/1.0 HTTP/1.1 200 OK Server: Apache-Coyote/1.1 Set-Cookie: JSESSIONID=2B144247B747F54184114FA82869DE14; Path=/ Content-Type: text/html Content-Length: 26 Date: Wed, 23 May 2007 23:04:24 GMT Connection: close File contents=[ abcd ]"	2007-05-23 16:52:35	1179950000	resolved fixed	2441155	1198720000	java/org/apache/naming/resources/FileDirContext.java	186:java/org/apache/naming/resources/FileDirContext.java
962	43914	Bug 43914 HTTP spec violation when generating HTTP redirects for folders without trailing slash		2007-11-20 05:53:53	1195560000	resolved fixed	e452200	1198700000	java/org/apache/catalina/connector/CoyoteAdapter.java	95:java/org/apache/catalina/connector/CoyoteAdapter.java
963	43909	Bug 43909 EL EvaluationContext wrapper hides locale	org.apache.el.lang.EvaluationContext doesn't pass locale to the wrapped ELContext as does org.apache.jasper.el.ELContextWrapper. This prohibits using of the locale for it's original purpose.	2007-11-19 23:06:25	1195530000	resolved fixed	fdb170e	1198520000	java/org/apache/el/lang/EvaluationContext.java	2:java/org/apache/el/lang/EvaluationContext.java
964	43944	Bug 43944 org.apache.el.lang.ELArithmetic.coerce throws MissingResourceException for key el.convert	"The class org.apache.el.lang.ELArithmetic has the following code snippet: throw new IllegalArgumentException(MessageFactory.get(""el.convert"", obj, objType)); But the key ""el.convert"" doesn't exist in ""org.apache.el.Messages"". As a result, I'm receiving the exception: java.util.MissingResourceException: Can't find resource for bundle java.util.PropertyResourceBundle, key el.convert at java.util.ResourceBundle.getObject(ResourceBundle.java:325) at java.util.ResourceBundle.getString(ResourceBundle.java:285) at org.apache.el.util.MessageFactory.getArray(MessageFactory.java:67) at org.apache.el.util.MessageFactory.get(MessageFactory.java:47) at org.apache.el.lang.ELArithmetic.coerce(ELArithmetic.java:367) at org.apache.el.lang.ELArithmetic.add(ELArithmetic.java:238) at org.apache.el.parser.AstPlus.getValue(AstPlus.java:24) at org.apache.el.ValueExpressionImpl.getValue (ValueExpressionImpl.java:186)"	2007-11-22 19:23:45	1195780000	resolved fixed	c228054	1198510000	java/org/apache/el/lang/ELArithmetic.java	1:java/org/apache/el/lang/ELArithmetic.java
965	44088	Bug 44088 Cannot expire session via html manager webapp	"The html manager webapp done not work correctly when clicking the expire sessions button. The idle param is missing from the form. The following html shows this bug... <form method=""POST"" action=""/manager/html/expire?path=/""> <small> &nbsp;<input type=""submit"" value=""Expire sessions"">&nbsp;with idle &ge;&nbsp;<input type=""text"" name=""expire"" size=""5"" value=""30"">&nbsp;minutes&nbsp; </small> </form> The name of the text input should be idle."	2007-12-17 15:14:23	1197920000	resolved fixed	df2b1e6	1198450000	java/org/apache/catalina/manager/HTMLManagerServlet.java	1:java/org/apache/catalina/manager/HTMLManagerServlet.java
966	44084	Bug 44084 JAASRealm useContextClassLoader has problems	"The useContextClassLoader config option doesn't work right. - it is ignored when setting userClassNames and roleClassNames - it's respected when the LoginContext is created, but that is insufficient, because all the needed classes are not necessarily loaded until loginContext.login() is called Patch to follow. With it I'm able to keep everything related to the JAASRealm in my webapp."	2007-12-15 14:27:25	1197750000	resolved fixed	46721e4	1198450000	java/org/apache/catalina/realm/JAASRealm.java	1:java/org/apache/catalina/realm/JAASRealm.java
967	43236	Bug 43236 Response.setCharacterEncoding() fails after Response.getWriter() and Response.reset()	"The class org.apache.catalina.connector.Response resets the internal hold coyoteResponse and outputBuffer during reset(): public void reset() { if (included) return; // Ignore any call from an included servlet coyoteResponse.reset(); outputBuffer.reset(); } but if anyone has already set the characterEncoding (e.g. to UTF-8) and already got the writer, than all following invocations of request.setCharacterEncoding() will do nothing, because the internal save flag for usingWriter is not reseted. This is very annoying, because the coyoteResponse.reset(), resets the characterEncoding to iso8859-1. So I have no change to change/reset the charaterEncoding to UTF-8. I'll think if you reset the response, you should also reset the usingWriter flag or add another special flag, that works with this circumstances."	2007-08-29 03:56:43	1188370000	resolved fixed	71bd193	1198020000	java/org/apache/catalina/connector/Response.java	1:java/org/apache/catalina/connector/Response.java
968	43241	Bug 43241 ServletContext.getResourceAsStream() does not follow API specs for Path		2007-08-29 12:54:18	1188410000	resolved fixed	8f91433	1198020000	java/org/apache/catalina/core/ApplicationContext.java	7:java/org/apache/catalina/core/ApplicationContext.java
969	43611	"Bug 43611 autodeployment with unpackWARs=""true"" does not work, when a context for that war file exists in server.xml"	"if a context for the war file exists in server.xml, the manager uploads the new .war file, but does not expand it, if the necessary directory does not exist, and if the directory exists, it is not overwritten, so you see the old application. see server.xml <Host name=""xxx"" appBase=""webapps"" unpackWARs=""true""> <Context path=""/yyy""> ... if I don't have a context for yyy in server.xml, autodeploy works as expected. Even if you say, remove context from the manager application, it is always there in the application view, you can't remove it. And finally, it never cleans up the work directory for the application yyy, which I guess, is just a subsequent error of the above behaviour."	2007-10-12 05:15:52	1192180000	resolved fixed	ffbbe88	1196530000	java/org/apache/catalina/manager/HTMLManagerServlet.java	7:java/org/apache/catalina/manager/HTMLManagerServlet.java
970	43622	Bug 43622 compression / minCompressionSize attribute not properly implemented	"2 of the compression related attributes for the http connector are: compression = on | off | force | <integer val> The documentation states that integer val will be implemented as: compression=""on"" and minCompressionSize = <integer val> minCompressionSize = <integer val> (The documentation for 5.5.12 doesnt mention this at all, but read this in the server.xml) The problem is that the documenation gives the impression that only setting compression=""some integer val"" is sufficient, however the way the code is written, the value of ""minCompressionSize"" always overrides the value specified in the ""compression"" field. Even if minCompressionSize isnt set, it will still get the default value of 2048 and override whatever value was there in the ""compression"" field. I looked at the implementation of the http11 connector and found the following code that might be the culprit: In org.apache.coyote.http11.Http11BaseProtocol.Http11ConnectionHandler.init processor.setCompression( proto.compression ); processor.setCompressionMinSize( proto.compressionMinSize); since the ""setCompressionMinSize"" is called after compressionMinSize, its value will override the value read from compression atttribute. I have looked at the code for Tomcat 6.0 also, and the problems appears to still be present."	2007-10-15 03:51:24	1192430000	resolved fixed	d1d0619	1196450000	java/org/apache/coyote/http11/Http11AprProtocol.java java/org/apache/coyote/http11/Http11NioProtocol.java java/org/apache/coyote/http11/Http11Protocol.java	4:java/org/apache/coyote/http11/Http11NioProtocol.java 5:java/org/apache/coyote/http11/Http11Protocol.java 6:java/org/apache/coyote/http11/Http11AprProtocol.java
971	43757	Bug 43757 Improper parsing of response.sendRedirect() in JSP source	"Tomcat is throwing a java.lang.illegalStateException due to an attempted response.sendRedirect() after the time for such matters has come and gone... But, this appears to be a symptom of bad .jsp parsing at runtime. ========================== org.apache.jasper.JasperException: Exception in JSP: /buslog.jsp:42 39: // if (session.getAttribute(""isAuth"") == null) { 40: // session.setAttribute(""messageToUser"",""Authentication failed.""); 41: // you.shouldNotParseThis(); 42: // response.sendRedirect(""./index.jsp""); 43: // } 44: 45: // if (session.getAttribute(""isAuth"") != null) { ============================== These lines are commented out in the source, and should not conceivably cause a runtime error. Changing ""response.sendRedirect(...)"" to ""response.sendAbendOMG(...)"" suppresses the error. I am willing to provide the complete source if necessary. Build and execution environments are NetBeans 5.5.1 with bundled Tomcat 5.5.17."	2007-10-31 11:55:53	1193850000	resolved fixed	eb87635	1196380000	java/org/apache/jasper/compiler/ErrorDispatcher.java	14:java/org/apache/jasper/compiler/ErrorDispatcher.java
972	43706	Bug 43706 Fix a litmus warning for WebdavServlet		2007-10-26 07:03:28	1193400000	resolved fixed	324387d	1196200000	java/org/apache/catalina/servlets/WebdavServlet.java	1:java/org/apache/catalina/servlets/WebdavServlet.java
973	43887	Bug 43887 StandardWrapper.registerJMX() doesn't log exceptions correctly	"I was getting some rather unhelpful error messages when trying to deploy a web.xml that included illegal servlet names. I tracked them down to this part of /org/apache/catalina/core/StandardWrapper.java: } catch( Exception ex ) { log.info(""Error registering servlet with jmx "" + this); } This should probably be changed to: log.info(""Error registering servlet with jmx "" + ex); Same thing for the catch block ten lines below this one. I first noticed this in 5.5.23, but this code is still present in 6.0 trunk."	2007-11-16 15:31:21	1195250000	resolved fixed	9314e5b	1195850000	java/org/apache/catalina/core/StandardWrapper.java	1:java/org/apache/catalina/core/StandardWrapper.java
974	43893	"Bug 43893 WebdavServlet returns incorrect values for the ""href"" property when it is mapped with / url prefix, instead of /*"		2007-11-18 00:04:05	1195360000	resolved wontfix	3c61f9b	1195840000	java/org/apache/catalina/servlets/WebdavServlet.java	1:java/org/apache/catalina/servlets/WebdavServlet.java
975	43479	Bug 43479 APR sendfile thread leaks memory	The APR sendfile thread leaks memory by adding SendfileData objects to its HashMap and failing to remove them.	2007-09-25 19:49:30	1190760000	resolved fixed	16464d6	1192060000	java/org/apache/tomcat/util/net/AprEndpoint.java	2:java/org/apache/tomcat/util/net/AprEndpoint.java
976	43453	Bug 43453 ClassCastException at org.apache.catalina.core.StandardContext.findStatusPage(int)	"StandardContext.java reads public String findStatusPage(int status) { return ((String) statusPages.get(new Integer(status))); } This is wrong and it should be public String findStatusPage(int status) { return ((ErrorPage) statusPages.get(new Integer(status))).getLocation(); } Regards, lg"	2007-09-23 13:50:20	1190570000	resolved fixed	73b5e41	1190590000	java/org/apache/catalina/core/StandardContext.java	1:java/org/apache/catalina/core/StandardContext.java
977	43435	Bug 43435 AbstractReplicatedMap.memberDisappeared is executed more than the necessity.		2007-09-20 04:51:07	1190280000	resolved fixed	5aed2f5	1190400000	java/org/apache/catalina/tribes/tipis/AbstractReplicatedMap.java	1:java/org/apache/catalina/tribes/tipis/AbstractReplicatedMap.java
978	43356	"Bug 43356 keystoreFile parameter, when specified as relative, is not treated relative to $CATALINA_BASE or catalina.base property for NioEndPoint"		2007-09-11 11:42:39	1189530000	resolved fixed	28da141	1189810000	java/org/apache/coyote/http11/Http11NioProtocol.java java/org/apache/tomcat/util/net/NioEndpoint.java	1:java/org/apache/tomcat/util/net/NioEndpoint.java 3:java/org/apache/coyote/http11/Http11NioProtocol.java
979	30949	"Bug 30949 After Failed Include, Request and Response not Unwrapped"	"In org.apache.catalina.core.ApplicationDispatcher.doInclude(ServletRequest request, ServletResponse response), after invoke() is called to perform the include, the request and response objects are normally unwrapped. However, if a ServletException or IOException is thrown, the unwrapping does not take place. This leads to problems in environments in which cross context includes are being performed. For example, 1. Web App A performs an include to a Servlet in Web App B 2. The Servlet in Web App B throws a ServletException 3. Web App A catches the ServletException and attempts to forward to an error jsp. Step 3 above will fail due to the fact that the request has not been unwrapped. The active request will contain the ServletContext of web app B and the jsp file will not be found."	2004-08-30 23:54:36	1093920000	resolved fixed	4dd22a5	1188960000	java/org/apache/catalina/core/ApplicationDispatcher.java	1:java/org/apache/catalina/core/ApplicationDispatcher.java
980	43216	Bug 43216 ACTIVITY_CHECK does not work correctly when Tomcat is restarted		2007-08-26 09:28:12	1188130000	resolved fixed	9c37a01	1188310000	java/org/apache/catalina/session/StandardManager.java	8:java/org/apache/catalina/session/StandardManager.java
981	42944	Bug 42944 plus sign in url-pattern in servlet-mapping does not work	"Hi all, I had servlet-mappings that contain plus signs (they were created by JspC), e.g.: <servlet-mapping> <servlet-name>org.apache.jsp.suchergebnis_005fbu_002bbb_jsp</servlet-name> <url-pattern>/suchergebnis_bu+bb.jsp</url-pattern> </servlet-mapping> This mapping does not work (the referred class is present)! When I change the original file names of the JSPs such that the plus signs are replaced by a minus signs the following mapping results: <servlet-mapping> <servlet-name>org.apache.jsp.suchergebnis_005fbu_002dbb_jsp</servlet-name> <url-pattern>/suchergebnis_bu-bb.jsp</url-pattern> </servlet-mapping> Now the mapping works. Therefore I assume that there is a bug in handling servlet mappings with plus signs in their url pattern."	2007-07-20 09:32:19	1184940000	resolved fixed	44e36ea	1186240000	java/org/apache/catalina/util/RequestUtil.java	241:java/org/apache/catalina/util/RequestUtil.java
982	39212	Bug 39212 a bug in example code DummyCart.java		2006-04-05 10:20:19	1144250000	resolved fixed	8aa247e	1185820000	webapps/examples/WEB-INF/classes/sessions/DummyCart.java	1:webapps/examples/WEB-INF/classes/sessions/DummyCart.java
983	42753	Bug 42753 Race condition when using available() or reading in CometProcessor.event()	"Tomcat version: 6.0.13 (no 6.0.13 available in the version field) When trying to process data in CometProcessor.event() either during the BEGIN event or during the READ event, it is impossible to guarantee that all data has been read before returning (since new data may arrive between the last statement before the return, and the return statement itself). However, the CoyoteProcessor does this check: } else if (!error && read && request.getAvailable()) { // If this was a read and not all bytes have been read, or if no data // was read from the connector, then it is an error error = true; log.error(sm.getString(""coyoteAdapter.read"")); } causing a severe error and the Comet request to break when this race condition manifests itself. I am using the following code according to the aio.html description to read data in my comet event handler: while (request.getInputStream().available() > 0) { // read some data } // ***** NO MORE DATA AVAILABLE return; And I am experiencing the error as described in certain conditions (rapid arrival of fragmented data): SEVERE: The servlet did not read all available bytes during the processing of the read event"	2007-06-27 05:21:53	1182940000	resolved fixed	a6ea14d	1183120000	java/org/apache/catalina/core/ApplicationFilterFactory.java	161:java/org/apache/catalina/core/ApplicationFilterFactory.java
984	41722	Bug 41722 role-link tag in web.xml can not be omitted.	"The application with follwing web.xml can not be deployed. --- <servlet> <servlet-name>sample</servlet-name> <servlet-class>sample.TheServlet</servlet-class> <security-role-ref> <role-name>users</role-name> </security-role-ref> </servlet> <servlet-mapping> .... </servlet-mapping> <security-role> <role-name>users</role-name> </security-role> --- ""java.lang.IllegalArgumentException: Can't convert argument: null"" occurred. The Specification says: --- The security-role-ref element declares the security role reference in a components or in a deployment components code. It consists of an optional description, the security role name used in the code(role-name), and an optional link to a security role(role-link). --- <role-link> is optional."	2007-02-28 01:00:41	1172640000	resolved fixed	ba25bfb	1182710000	java/org/apache/catalina/deploy/SecurityRoleRef.java java/org/apache/catalina/startup/WebRuleSet.java	35:java/org/apache/catalina/startup/WebRuleSet.java
985	42314	Bug 42314 Jasper output no details with compilation error in specific case.	"Jasper output no details when Jasper cannot find mappings between generated servlet code (with mistakes) and former JSP. One example JSP is the following. (The imported class in the JSP is not found.) --- <%@ page import = ""not.exist.class"" %> ---"	2007-05-02 01:13:16	1178080000	resolved fixed	6c6ad83	1182690000	java/org/apache/jasper/compiler/JavacErrorDetail.java	19:java/org/apache/jasper/compiler/JavacErrorDetail.java
986	42547	Bug 42547 Same env-entry (web.xml) and ResourceLink (context) names causes NPE	"Having the following in web.xml: <env-entry> <env-entry-name>testIt</env-entry-name> <env-entry-type>java.lang.String</env-entry-type> <env-entry-value>test</env-entry-value> </env-entry> and the following in your context descriptor: <ResourceLink name=""testIt"" global=""testIt"" type=""java.lang.String""/> causes an NPE on context load. java.lang.NullPointerException at org.apache.catalina.deploy.NamingResources.addEnvironment(NamingResources.java:188) This assumes you have an entry for 'testIt' in the <GlobalNamingResources> section of server.xml to link to. This worked in 5.5.20. No longer works in 5.5.23."	2007-05-30 11:29:37	1180540000	resolved fixed	53add24	1182610000	java/org/apache/catalina/deploy/NamingResources.java	1:java/org/apache/catalina/deploy/NamingResources.java
987	42643	Bug 42643 Duplicate JSP function mapper variables	"When we deploy ~20 or so web apps at a time, we invariably end up with an app or two on each server that has compilation errors due to code generated like this: static private org.apache.jasper.runtime.ProtectedFunctionMapper _jspx_fnmap_0; static private org.apache.jasper.runtime.ProtectedFunctionMapper _jspx_fnmap_1; static private org.apache.jasper.runtime.ProtectedFunctionMapper _jspx_fnmap_2; static private org.apache.jasper.runtime.ProtectedFunctionMapper _jspx_fnmap_3; static private org.apache.jasper.runtime.ProtectedFunctionMapper _jspx_fnmap_4; static private org.apache.jasper.runtime.ProtectedFunctionMapper _jspx_fnmap_5; static private org.apache.jasper.runtime.ProtectedFunctionMapper _jspx_fnmap_6; static private org.apache.jasper.runtime.ProtectedFunctionMapper _jspx_fnmap_7; static private org.apache.jasper.runtime.ProtectedFunctionMapper _jspx_fnmap_0; static private org.apache.jasper.runtime.ProtectedFunctionMapper _jspx_fnmap_1; static private org.apache.jasper.runtime.ProtectedFunctionMapper _jspx_fnmap_2; static private org.apache.jasper.runtime.ProtectedFunctionMapper _jspx_fnmap_3; static private org.apache.jasper.runtime.ProtectedFunctionMapper _jspx_fnmap_4; static private org.apache.jasper.runtime.ProtectedFunctionMapper _jspx_fnmap_5; static private org.apache.jasper.runtime.ProtectedFunctionMapper _jspx_fnmap_6; static private org.apache.jasper.runtime.ProtectedFunctionMapper _jspx_fnmap_7; This looks like it might be as simple as unsynchronized access to the static 'currFunc' in ELFunctionMapper, but I'm far from an expert on this code and unfortunately lack the time to become one. :) This only appears to happen when we mass-deploy apps, and we can resolve it by deleting the generated .java file and manually restarting the affected app."	2007-06-12 07:34:16	1181650000	resolved fixed	5b65cf4	1182010000	java/org/apache/jasper/compiler/ELFunctionMapper.java	2:java/org/apache/jasper/compiler/ELFunctionMapper.java
988	42497	Bug 42497 304 response should consistently include ETag header		2007-05-23 09:00:19	1179930000	resolved fixed	0114b2d	1180740000	java/org/apache/catalina/servlets/DefaultServlet.java	5:java/org/apache/catalina/servlets/DefaultServlet.java
989	42559	Bug 42559 ErrorReportValve does not provide an error report	"rev 535915 changed the behavior of ErrorReportValve in tomcat6 to not produce an error report when response.sendError() is called. For example, using this code in a servlet's service() does not produce an error report: response.sendError(HttpServletResponse.SC_GONE, ""error occurred""); The underlying cause is that the valve's check for response.isCommitted() was replaced with response.isAppCommitted(). The latter returns true, which causes the Valve's invoke() method to immediately return instead of producing the report."	2007-05-31 09:09:05	1180620000	resolved fixed	71eccb3	1180650000	java/org/apache/catalina/valves/ErrorReportValve.java	1:java/org/apache/catalina/valves/ErrorReportValve.java
990	39875	Bug 39875 RealmBase#init() needs cleanup		2006-06-23 11:15:08	1151080000	resolved fixed	0ea4c7c	1179890000	java/org/apache/catalina/realm/RealmBase.java	1:java/org/apache/catalina/realm/RealmBase.java
991	42438	Bug 42438 Duplicate JSP temp variable declaration when jsp:attribute used in conjunction with custom tags		2007-05-16 17:43:51	1179350000	resolved fixed	5e188bc	1179890000	java/org/apache/jasper/compiler/Node.java	
992	42459	Bug 42459 Tomcat Web Application Manager table error	html table -> tr wrong formating when stop (not last) in Tomcat Web Application Manager.	2007-05-19 13:32:58	1179600000	resolved fixed	33c9949	1179680000	java/org/apache/catalina/manager/HTMLManagerServlet.java	
993	42444	Bug 42444 Potential NullPointerException in org.apache.catalina.valves.AccessLogValve		2007-05-17 08:15:53	1179400000	resolved fixed	776736f	1179600000	java/org/apache/catalina/valves/AccessLogValve.java	
994	42361	Bug 42361 POST content type incorrect for multipart forms after login	"When using a form with a custom encoding (e.g. ""multipart/form-data""), the content type is not restored after a redirect to a login page (auth-method = FORM). To reproduce: - A page that POSTs using multipart/form-data encoding (or anything other than application/x-www-form-urlencoded) to a result page that is protected by a login page (auth-method=FORM) is invoked. - Even though the multipart POST data exists (verified by reading input stream of request from result page) the content type of the request is always ""application/x-www-form-urlencoded"". - This only happens when redirected to the login page first. It does not happen if already logged in."	2007-05-08 16:06:35	1178650000	resolved fixed	637acc5	1178670000	java/org/apache/catalina/authenticator/FormAuthenticator.java java/org/apache/catalina/authenticator/SavedRequest.java	
995	42309	Bug 42309 Request: support for NIO in Embedded Tomcat	in org.apache.catalina.startup.Embedded there is no direct API to create an NIO connector. This would be very helpful for all applications which use tomcat in embedded mode and require the CometProcessor.	2007-05-01 02:03:28	1178000000	resolved fixed	9546005	1178210000	java/org/apache/catalina/startup/Embedded.java	
996	42308	Bug 42308 with APR bytessent bytesreceived performance data is not collected	with APR bytes received and bytes sent are always 0.	2007-05-01 01:57:57	1178000000	resolved fixed	4a04722	1178020000	java/org/apache/coyote/http11/Http11AprProcessor.java java/org/apache/coyote/http11/Http11AprProtocol.java java/org/apache/coyote/http11/Http11NioProcessor.java java/org/apache/coyote/http11/InternalNioInputBuffer.java	
997	42202	Bug 42202 if you install tomcat in a directory with spaces it ignores TLD files inside jar files	"if you install tomcat or a web application in a directory with spaces in the name, for example ""C:\Program Files\vds\tomcat"" for tomcat or ""C:\Program Files\vds\console"" for a web application. the TLD files that are inside the META-INF directory of the jar files will not be loaded. the problem is is the file treatment inside the TldConfig class ... I have attached a patch with the correction. this bug is found in Tomcat 6 too"	2007-04-23 14:07:38	1177350000	resolved fixed	f9ddaba	1177420000	java/org/apache/catalina/startup/TldConfig.java	
998	42071	"Bug 42071 If a JSP throws an UnavailableException twice, an IllegalStateException occurs."	"If a JSP throws an UnavailableException twice, an IllegalStateException occurs. first access: JSP throws UnavailableException. second access: If the JSP throws an UnavailableException again then an IllegalStateException occurs and Tomcat returns status code:500 to the client. The problem is not that the IllegalStateException occurs. The problem is that the JSP can be called even though it cannot be used."	2007-04-08 17:49:37	1176070000	resolved fixed	508f513	1176950000	java/org/apache/jasper/servlet/JspServletWrapper.java	
999	42039	Bug 42039 Tomcat doesn't output the stack trace of UnavailableException.	"When UnavailableException is thrown from the Servlet:init, Tomcat doesn't output the stack trace of UnavailableException. The cause of problem is lost. Tomcat should output the stack trace at the ""invoke"" method of StandardWrapperValue."	2007-04-03 16:54:58	1175630000	resolved fixed	c3d2ce4	1176660000	java/org/apache/catalina/core/StandardWrapperValve.java	
1000	42119	Bug 42119 request.getCharacterEncoding misparses charset=UTF-8; xyz=3	"(This bug is also present in Coyote source 6.0.10.) If there is an HTTP header Content-Type: text/abc; charset=UTF-8; xyz=3 request.getCharacterEncoding() returns ""UTF-8; xyz=3"" but Tomcat 4.1.24 returns ""UTF-8"". In Tomcat 4.1.24, request.getCharacterEncoding uses parseCharacterEncoding defined in jakarta-tomcat-4.1.24-src/catalina/src/share/org/apache/catalina/util/RequestUtil.java and it correctly handles the case of other Content-Type parameters. In Tomcat 5.5.23, however, request.getCharacterEncoding uses getCharsetFromContentType defined in from apache-tomcat-5.5.23-src/connectors/util/java/org/apache/tomcat/util/http/ContentType.java which does not search for a possible terminating semicolon in the charset, thus erroneously including additional characters in the charset. The code in 5.5.23 has a comment begins // Basically return everything after "";charset="" Please consider using the code from 4.1.24 This problem showed up when Content-Type was multipart/mixed and a client specified a charset parameter to Content-Type; however, it will occur in any Content-Type where charset is specified and is not the last parameter."	2007-04-13 12:01:02	1176480000	resolved fixed	4cf171a	1176600000	java/org/apache/tomcat/util/http/ContentType.java	
1001	42085	Bug 42085 java.util.Logging duplicated since 5.5.23. 5.5.20 is OK	"We use the followwing logging.properties in our WebApplication: ----------%<--------------------%<---------------- handlers = 1tivoli.java.util.logging.FileHandler, 2product.java.util.logging.FileHandler # Handlers for the root logger .handlers = 1tivoli.java.util.logging.FileHandler, 2product.java.util.logging.FileHandler 1tivoli.java.util.logging.FileHandler.level = INFO 1tivoli.java.util.logging.FileHandler.pattern = /var/log/product/tivoli%g.log # limit Output to 1MB 1tivoli.java.util.logging.FileHandler.limit=1048576 # Limit rotation to 10 Logs ... 1tivoli.java.util.logging.FileHandler.count=10 1tivoli.java.util.logging.FileHandler.append=true 1tivoli.java.util.logging.FileHandler.formatter=de.customer.product.tivoli.TivoliFormatter 2product.java.util.logging.FileHandler.level = FINEST 2product.java.util.logging.FileHandler.pattern = /var/log/product/product%g.log # limit Output to 1MB 2product.java.util.logging.FileHandler.limit=1048576 # Limit rotation to 5 Logs ... 2product.java.util.logging.FileHandler.count=5 2product.java.util.logging.FileHandler.append=true 2product.java.util.logging.FileHandler.formatter=java.util.logging.SimpleFormatter ----------%<--------------------%<---------------- When using apache-tomcat-5.5.23 every Line in the Logfiles is duplicated. Debugging I found that the TivoliFormatter is actually created twice. And the root-logger has actually 4 Handlers and not two as intended. This does not allow us an upgrade beyond 5.5.20. Found on Linux64Bit and Windows-XP, both with JDK 1.5_R11"	2007-04-10 23:13:02	1176260000	resolved fixed	fa2b746	1176390000	java/org/apache/juli/ClassLoaderLogManager.java	
1002	42072	"Bug 42072 The call of the jspDestroy method violates it about the Java Servlet Specification 2.4, SRV.2.3.2.1."	"When a JSP is accessed for a second time, the jspDestroy method is called even if a ServletException is thrown from the init method of the class that extends HttpJspPage. This violates the Java Servlet Specification 2.4, SRV.2.3.2.1."	2007-04-08 18:07:02	1176070000	resolved fixed	3d27771	1176160000	java/org/apache/jasper/servlet/JspServletWrapper.java	
1003	41289	Bug 41289 Error when deploying XML Configuration file URL	I tried to deploy a webapp using a context.xml file under manager webapp and received this error: java.io.FileNotFoundException: /opt/apache-tomcat-6.0.2/conf/Catalina/localhost/mywebapp3.xml (No such file or directory) at java.io.FileOutputStream.open(Native Method) at java.io.FileOutputStream.<init>(FileOutputStream.java:179) at java.io.FileOutputStream.<init>(FileOutputStream.java:131) at org.apache.catalina.manager.ManagerServlet.copyInternal(ManagerServlet.java:1570) at org.apache.catalina.manager.ManagerServlet.copy(ManagerServlet.java:1530) at org.apache.catalina.manager.ManagerServlet.deploy(ManagerServlet.java:803) at org.apache.catalina.manager.HTMLManagerServlet.deployInternal(HTMLManagerServlet.java:249) at org.apache.catalina.manager.HTMLManagerServlet.doGet(HTMLManagerServlet.java:96) at javax.servlet.http.HttpServlet.service(HttpServlet.java:690) at javax.servlet.http.HttpServlet.service(HttpServlet.java:803) at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:290) at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206) at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:228) at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:175) at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:525) at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:128) at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:105) at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:109) at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:212) at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:818) at org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.process(Http11Protocol.java:624) at org.apache.tomcat.util.net.JIoEndpoint$Worker.run(JIoEndpoint.java:445) at java.lang.Thread.run(Thread.java:613) I did checked and noticed apache-tomcat-6.0.2/conf/Catalina directory no longer exists in version 6. Did something changed?	2007-01-04 07:42:41	1167910000	resolved fixed	d721522	1175780000	java/org/apache/catalina/manager/ManagerServlet.java	
1004	41703	Bug 41703 Variable assigned with it's own value.		2007-02-26 02:18:39	1172470000	resolved fixed	2049b78	1174980000	java/org/apache/catalina/ha/authenticator/SingleSignOnMessage.java	
1005	41682	Bug 41682 ClassCastException with BackupManager + debug logging	"(Still happening in 6.0.9, though that isn't an option in Bugzilla) If I use the BackupManager for session replication AND turn on debug logging, I get this exception when I try to invalidate the session: java.lang.ClassCastException: org.apache.catalina.ha.session.BackupManager cannot be cast to org.apache.catalina.ha.session.DeltaManager at org.apache.catalina.ha.session.DeltaSession.expire(DeltaSession.java:361) at org.apache.catalina.ha.session.DeltaSession.expire(DeltaSession.java:352) at org.apache.catalina.session.StandardSession.expire(StandardSession.java:660) at org.apache.catalina.session.StandardSession.invalidate(StandardSession.java:1112) at org.apache.catalina.session.StandardSessionFacade.invalidate(StandardSessionFacade.java:150) The bug is easy to find in the source. If debug logging is enabled, it tries to cast manager to DeltaManager without an instanceof, even though it is doing an instanceof immediately after: public void expire(boolean notify, boolean notifyCluster) { String expiredId = getIdInternal(); super.expire(notify); if (notifyCluster) { if (log.isDebugEnabled()) log.debug(sm.getString(""deltaSession.notifying"", ((DeltaManager)manager).getName(), new Boolean(isPrimarySession()), expiredId)); if ( manager instanceof DeltaManager ) { ( (DeltaManager) manager).sessionExpired(expiredId); } } }"	2007-02-22 13:05:50	1172170000	resolved fixed	12d912d	1174980000	java/org/apache/catalina/ha/session/DeltaSession.java	
1006	41166	Bug 41166 Unable to start ReplicatedContext	"I try to test the Cluster function. I got a problem: something like following apears in the $CATALINA_HOME/logs/catalina.out SEVERE: Unable to start ReplicatedContext java.lang.ClassCastException: org.apache.naming.resources.ProxyDirContext cannot be cast to java.io.Serializable at org.apache.catalina.tribes.tipis.AbstractReplicatedMap$MapEntry.setValue (AbstractReplicatedMap.java:1060) I didn't change any file in $CATALINA_HOME except server.xml, the any thing I changed in server.xml is uncomment the line: <Cluster className=""org.apache.catalina.ha.tcp.SimpleTcpCluster""/>. and I add a context configuration file test.xml to $CATALINA_HOME/conf/Catalina/localhost with the flolling content [Aray@BONC-01 conf]$ cat Catalina/localhost/test.xml <Context className=""org.apache.catalina.ha.context.ReplicatedContext"" path=""/test"" docBase=""/var/www/ClusterTest"" debug=""0"" privileged=""true"" reloadable=""true"" > the web.xml file in /var/www/ClusterTest has no <distributable/> element I am worrying about I can't explain the problem clearly with my poor English. So I paste the stepes I do as following: [Aray@BONC-01 apache-tomcat-6.0.2]$ which java /usr/java/jdk1.6.0/bin/java [Aray@BONC-01 apache-tomcat-6.0.2]$ java -version java version ""1.6.0-rc"" Java(TM) SE Runtime Environment (build 1.6.0-rc-b104) Java HotSpot(TM) Client VM (build 1.6.0-rc-b104, mixed mode, sharing) [Aray@BONC-01 apache-tomcat-6.0.2]$ echo $JAVA_HOME /usr/java/jdk1.6.0 [Aray@BONC-01 apache-tomcat-6.0.2]$ echo $CLASSPATH [Aray@BONC-01 apache-tomcat-6.0.2]$ uname -a Linux BONC-01 2.6.9-34.EL #1 Wed Mar 8 00:07:35 CST 2006 i686 i686 i386 GNU/Linux [root@BONC-01 local]# cat /etc/redhat-release CentOS release 4.3 (Final) [Aray@BONC-01 apache-tomcat-6.0.2]$ cd conf [Aray@BONC-01 conf]$ cat server.xml <!-- Note: A ""Server"" is not itself a ""Container"", so you may not define subcomponents such as ""Valves"" at this level. Documentation at /docs/config/server.html --> <Server port=""8005"" shutdown=""SHUTDOWN""> <!--APR library loader. Documentation at /docs/apr.html --> <Listener className=""org.apache.catalina.core.AprLifecycleListener"" SSLEngine=""on"" /> <!--Initialize Jasper prior to webapps are loaded. Documentation at /docs/jasper-howto.html --> <Listener className=""org.apache.catalina.core.JasperListener"" /> <!-- JMX Support for the Tomcat server. Documentation at /docs/non- existent.html --> <Listener className=""org.apache.catalina.mbeans.ServerLifecycleListener"" /> <Listener className=""org.apache.catalina.mbeans.GlobalResourcesLifecycleListener"" /> <!-- Global JNDI resources Documentation at /docs/jndi-resources-howto.html --> <GlobalNamingResources> <!-- Editable user database that can also be used by UserDatabaseRealm to authenticate users --> <Resource name=""UserDatabase"" auth=""Container"" type=""org.apache.catalina.UserDatabase"" description=""User database that can be updated and saved"" factory=""org.apache.catalina.users.MemoryUserDatabaseFactory"" pathname=""conf/tomcat-users.xml"" /> </GlobalNamingResources> <!-- A ""Service"" is a collection of one or more ""Connectors"" that share a single ""Container"" Note: A ""Service"" is not itself a ""Container"", so you may not define subcomponents such as ""Valves"" at this level. Documentation at /docs/config/service.html --> <Service name=""Catalina""> <!-- A ""Connector"" represents an endpoint by which requests are received and responses are returned. Documentation at : Java HTTP Connector: /docs/config/http.html (blocking & non-blocking) Java AJP Connector: /docs/config/ajp.html APR (HTTP/AJP) Connector: /docs/apr.html Define a non-SSL HTTP/1.1 Connector on port 8080 --> <Connector port=""8080"" protocol=""HTTP/1.1"" maxThreads=""150"" connectionTimeout=""20000"" redirectPort=""8443"" /> <!-- Define a SSL HTTP/1.1 Connector on port 8443 This connector uses the JSSE configuration, when using APR, the connector should be using the OpenSSL style configuration described in the APR documentation --> <!-- <Connector port=""8443"" protocol=""HTTP/1.1"" maxThreads=""150"" scheme=""https"" secure=""true"" clientAuth=""false"" sslProtocol=""TLS"" /> --> <!-- Define an AJP 1.3 Connector on port 8009 --> <Connector port=""8009"" protocol=""AJP/1.3"" redirectPort=""8443"" /> <!-- An Engine represents the entry point (within Catalina) that processes every request. The Engine implementation for Tomcat stand alone analyzes the HTTP headers included with the request, and passes them on to the appropriate Host (virtual host). Documentation at /docs/config/engine.html --> <!-- You should set jvmRoute to support load-balancing via AJP ie : <Engine name=""Standalone"" defaultHost=""localhost"" jvmRoute=""jvm1""> --> <Engine name=""Catalina"" defaultHost=""localhost""> <!--For clustering, please take a look at documentation at: /docs/cluster-howto.html (simple how to) /docs/config/cluster.html (reference documentation) --> <Cluster className=""org.apache.catalina.ha.tcp.SimpleTcpCluster""/> <!-- The request dumper valve dumps useful debugging information about the request and response data received and sent by Tomcat. Documentation at: /docs/config/valve.html --> <!-- <Valve className=""org.apache.catalina.valves.RequestDumperValve""/> --> <!-- This Realm uses the UserDatabase configured in the global JNDI resources under the key ""UserDatabase"". Any edits that are performed against this UserDatabase are immediately available for use by the Realm. --> <Realm className=""org.apache.catalina.realm.UserDatabaseRealm"" resourceName=""UserDatabase""/> <!-- Define the default virtual host Note: XML Schema validation will not work with Xerces 2.2. --> <Host name=""localhost"" appBase=""webapps"" unpackWARs=""true"" autoDeploy=""true"" xmlValidation=""false"" xmlNamespaceAware=""false""> <!-- SingleSignOn valve, share authentication between web applications Documentation at: /docs/config/valve.html --> <!-- <Valve className=""org.apache.catalina.authenticator.SingleSignOn"" /> --> <!-- Access log processes all example. Documentation at: /docs/config/valve.html --> <!-- <Valve className=""org.apache.catalina.valves.FastCommonAccessLogValve"" directory=""logs"" prefix=""localhost_access_log."" suffix="".txt"" pattern=""common"" resolveHosts=""false""/> --> </Host> </Engine> </Service> </Server> [Aray@BONC-01 conf]$ mkdir Catalina [Aray@BONC-01 conf]$ ln -s /usr/local/tomcatConf/localhost/ Catalina/localhost [Aray@BONC-01 conf]$ cat Catalina/localhost/test.xml <Context className=""org.apache.catalina.ha.context.ReplicatedContext"" path=""/test"" docBase=""/var/www/ClusterTest"" debug=""0"" privileged=""true"" reloadable=""true"" > </Context> [Aray@BONC-01 conf]$ cd .. [Aray@BONC-01 apache-tomcat-6.0.2]$ ls bin conf lib LICENSE logs NOTICE RELEASE-NOTES RUNNING.txt temp webapps work [Aray@BONC-01 apache-tomcat-6.0.2]$ rm logs/* [Aray@BONC-01 apache-tomcat-6.0.2]$ bin/catalina.sh version Using CATALINA_BASE: /home/Aray/download/apache-tomcat-6.0.2 Using CATALINA_HOME: /home/Aray/download/apache-tomcat-6.0.2 Using CATALINA_TMPDIR: /home/Aray/download/apache-tomcat-6.0.2/temp Using JRE_HOME: /usr/java/jdk1.6.0 Server version: Apache Tomcat/6.0.2 Server built: Nov 16 2006 12:31:06 Server number: 6.0.2.0 OS Name: Linux OS Version: 2.6.9-34.EL Architecture: i386 JVM Version: 1.6.0-rc-b104 JVM Vendor: Sun Microsystems Inc. [Aray@BONC-01 apache-tomcat-6.0.2]$ bin/startup.sh Using CATALINA_BASE: /home/Aray/download/apache-tomcat-6.0.2 Using CATALINA_HOME: /home/Aray/download/apache-tomcat-6.0.2 Using CATALINA_TMPDIR: /home/Aray/download/apache-tomcat-6.0.2/temp Using JRE_HOME: /usr/java/jdk1.6.0 [Aray@BONC-01 apache-tomcat-6.0.2]$ cat logs/catalina.out INFO: Initializing Coyote HTTP/1.1 on http-8080 Dec 13, 2006 4:07:39 PM org.apache.catalina.startup.Catalina load INFO: Initialization processed in 2532 ms Dec 13, 2006 4:07:40 PM org.apache.catalina.core.StandardService start INFO: Starting service Catalina Dec 13, 2006 4:07:40 PM org.apache.catalina.core.StandardEngine start INFO: Starting Servlet Engine: Apache Tomcat/6.0.2 Dec 13, 2006 4:07:40 PM org.apache.catalina.ha.tcp.SimpleTcpCluster start INFO: Cluster is about to start Dec 13, 2006 4:07:40 PM org.apache.catalina.tribes.transport.ReceiverBase bind INFO: Receiver Server Socket bound to:/127.0.0.1:4000 Dec 13, 2006 4:07:40 PM org.apache.catalina.tribes.membership.McastServiceImpl setupSocket INFO: Setting cluster mcast soTimeout to 500 Dec 13, 2006 4:07:40 PM org.apache.catalina.tribes.membership.McastServiceImpl waitForMembers INFO: Sleeping for 1000 milliseconds to establish cluster membership, start level:4 Dec 13, 2006 4:07:41 PM org.apache.catalina.tribes.membership.McastServiceImpl waitForMembers INFO: Done sleeping, membership established, start level:4 Dec 13, 2006 4:07:41 PM org.apache.catalina.tribes.membership.McastServiceImpl waitForMembers INFO: Sleeping for 1000 milliseconds to establish cluster membership, start level:8 Dec 13, 2006 4:07:42 PM org.apache.catalina.tribes.membership.McastServiceImpl waitForMembers INFO: Done sleeping, membership established, start level:8 Dec 13, 2006 4:07:42 PM org.apache.catalina.core.StandardHost start INFO: XML validation disabled Dec 13, 2006 4:07:42 PM org.apache.catalina.tribes.tipis.AbstractReplicatedMap init INFO: Initializing AbstractReplicatedMap with context name:/test Dec 13, 2006 4:07:43 PM org.apache.catalina.ha.context.ReplicatedContext start SEVERE: Unable to start ReplicatedContext java.lang.ClassCastException: org.apache.naming.resources.ProxyDirContext cannot be cast to java.io.Serializable at org.apache.catalina.tribes.tipis.AbstractReplicatedMap$MapEntry.setValue (AbstractReplicatedMap.java:1060) at org.apache.catalina.tribes.tipis.AbstractReplicatedMap$MapEntry.<init> (AbstractReplicatedMap.java:1005) at org.apache.catalina.tribes.tipis.AbstractReplicatedMap.put (AbstractReplicatedMap.java:859) at org.apache.catalina.core.ApplicationContext.setAttribute (ApplicationContext.java:756) at org.apache.catalina.core.ApplicationContextFacade.setAttribute (ApplicationContextFacade.java:334) at org.apache.catalina.core.StandardContext.start (StandardContext.java:4296) at org.apache.catalina.ha.context.ReplicatedContext.start (ReplicatedContext.java:55) at org.apache.catalina.core.ContainerBase.addChildInternal (ContainerBase.java:760) at org.apache.catalina.core.ContainerBase.addChild (ContainerBase.java:740) at org.apache.catalina.core.StandardHost.addChild(StandardHost.java:525) at org.apache.catalina.startup.HostConfig.deployDescriptor (HostConfig.java:626) at org.apache.catalina.startup.HostConfig.deployDescriptors (HostConfig.java:553) at org.apache.catalina.startup.HostConfig.deployApps (HostConfig.java:488) at org.apache.catalina.startup.HostConfig.start(HostConfig.java:1138) at org.apache.catalina.startup.HostConfig.lifecycleEvent (HostConfig.java:311) at org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent (LifecycleSupport.java:120) at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1022) at org.apache.catalina.core.StandardHost.start(StandardHost.java:719) at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1014) at org.apache.catalina.core.StandardEngine.start (StandardEngine.java:443) at org.apache.catalina.core.StandardService.start (StandardService.java:451) at org.apache.catalina.core.StandardServer.start (StandardServer.java:710) at org.apache.catalina.startup.Catalina.start(Catalina.java:552) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke (NativeMethodAccessorImpl.java:39) at sun.reflect.DelegatingMethodAccessorImpl.invoke (DelegatingMethodAccessorImpl.java:25) at java.lang.reflect.Method.invoke(Method.java:597) at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:288) at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:413) Dec 13, 2006 4:07:43 PM org.apache.catalina.core.ContainerBase addChildInternal SEVERE: ContainerBase.addChild: start: LifecycleException: Failed to start ReplicatedContext: java.lang.ClassCastException: org.apache.naming.resources.ProxyDirContext cannot be cast to java.io.Serializable at org.apache.catalina.ha.context.ReplicatedContext.start (ReplicatedContext.java:58)"	2006-12-13 00:18:02	1165990000	resolved fixed	4f96d21	1174970000	java/org/apache/catalina/core/ApplicationContext.java java/org/apache/catalina/ha/context/ReplicatedContext.java java/org/apache/catalina/tribes/tipis/AbstractReplicatedMap.java	
1007	41675	Bug 41675 Add a debug statement when some necessary header information is missing	"Reference: org.apache.coyote.http11.Http11Processor.java It would be helpful for developers to get informed when some required header information is missing. eg when headers.getValue(""host""); returns null and http11 is true. Couldn't you add a log.debug statement that informs the user about missing header-fields? (For example in Http11Processor.java:1391)"	2007-02-22 00:36:16	1172120000	resolved fixed	7fd4fa8	1174860000	java/org/apache/coyote/http11/Http11Processor.java	
1008	40150	Bug 40150 Incorrect User/Role classnames are silently ignored.	"org.apache.catalina.realm.JAASRealm does not verify any of the class names that are set through setRoleClassNames() and setUserClassNames(). If an incorrect class name (e.g. a typo) is configured in context.xml, this is unnoticed by JAASRealm. The result is that during authentication, when the subject's principals are checked against the configured class names, the principals are not recognised, and therefore not added to the subject. The fact an incorrect configured class name is currently not detected and logged makes it very hard to find the source of the problem. It can be easily fixed by checking the class names in the two methods mentioned above. The class must exist, and it must implement java.security.Principal, which is currently not enforced/checked by the code."	2006-08-01 08:52:32	1154440000	resolved fixed	400d684	1174860000	java/org/apache/catalina/realm/JAASRealm.java	
1009	41790	Bug 41790 JDTCompiler::getContents does not close the reader	"In the class org.apache.jasper.compiler.JDTCompiler: ------------------------------------------------------------------------- public char[] getContents() { char[] result = null; try { InputStreamReader isReader = new InputStreamReader(new FileInputStream(sourceFile), ctxt.getOptions().getJavaEncoding()); Reader reader = new BufferedReader(isReader); if (reader != null) { char[] chars = new char[8192]; StringBuffer buf = new StringBuffer(); int count; while ((count = reader.read(chars, 0, chars.length)) > 0) { buf.append(chars, 0, count); } result = new char[buf.length()]; buf.getChars(0, result.length, result, 0); } } catch (IOException e) { log.error(""Compilation error"", e); } return result; } ------------------------------------------------------------------------- the variable ""reader"" is not closed after use it. if I update jsp files frequently, it will exhaust the system file handler. ""too many files"" errors will come. I test it on Redhat linux, the same problem will occured in tomcat 5 and tomcat 6."	2007-03-07 19:02:57	1173310000	resolved fixed	455b6f8	1173370000	java/org/apache/jasper/compiler/JDTCompiler.java	
1010	41752	Bug 41752 Wrong message on exception in MemoryRealm	"When Digester read tomcat-user.xml file and exception is throw, then is created new LifecycleException. As first parameter of this Exception is message string. This string is hardcoded to ""memoryRealm.readXml"", so I thing that log message will be wrong too! I think that there must be used StringManager. actual implementation: Digester digester = getDigester(); try { synchronized (digester) { digester.push(this); digester.parse(file); } } catch (Exception e) { throw new LifecycleException(""memoryRealm.readXml"", e); } finally { digester.reset(); } fixed: Digester digester = getDigester(); try { synchronized (digester) { digester.push(this); digester.parse(file); } } catch (Exception e) { throw new LifecycleException(sm.getString(""memoryRealm.readXml""), e); } finally { digester.reset(); }"	2007-03-02 16:28:19	1172870000	resolved fixed	e33b67a	1172940000	java/org/apache/catalina/realm/MemoryRealm.java	
1011	41666	Bug 41666 If-Unmodified-Since failure	"The If-Unmodified-Since header doesn't work enoughly. failed case: The If-Unmodified-Since header value: 1000000(milliseconds) The lastModified value of target resource: 1001000(milliseconds) In this case, the response's status code should be SC_PRECONDITION_FAILED, but the result is not so. caused by: In DefaultServlet#checkIfUnmodifiedSince: if ( lastModified > (headerValue + 1000)) { I think it should be: if ( lastModified >= (headerValue + 1000)) {"	2007-02-21 01:44:28	1172040000	resolved fixed	9ac3428	1172940000	java/org/apache/catalina/servlets/DefaultServlet.java	
1012	41739	Bug 41739 The servlet with the value 0 in <load-on-startup> tag must be loaded at first.	"Servlet 2.4 specification says: --- If the value is a positive integer or 0, the container must load and initialize the servlet as the application is deployed. The container must guarantee that servlets marked with lower integers are loaded before servlets marked with higher integers. --- I think the servlet with value 0 in <load-on-startup> tag must be loaded at the first. However, Tomcat loads the servlet at the last."	2007-03-01 06:09:41	1172750000	resolved fixed	01d38a5	1172800000	java/org/apache/catalina/core/StandardContext.java	
1013	41608	Bug 41608 The log level is different at same messages.	"I suggest a little message improvement. The log level is different at same messages. The message ""Servlet.service() for servlet {0} threw exception"" is output in eight places, but the message level is not same. --org.apache.catalina.core.ApplicationDispatcher#invoke ... wrapper.getLogger().error(sm.getString(""applicationDispatcher.serviceException"", wrapper.getName()), e); ... wrapper.getLogger().error(sm.getString(""applicationDispatcher.serviceException"", wrapper.getName()), e); ... wrapper.getLogger().error(sm.getString(""applicationDispatcher.serviceException"", wrapper.getName()), rootCause); ... wrapper.getLogger().error(sm.getString(""applicationDispatcher.serviceException"", wrapper.getName()), e); --org.apache.catalina.core.StandardWrapperValve#invoke container.getLogger().warn(sm.getString(""standardWrapper.serviceException"", wrapper.getName()), e); ... container.getLogger().warn(sm.getString(""standardWrapper.serviceException"", wrapper.getName()), e); ... container.getLogger().error(sm.getString(""standardWrapper.serviceException"", wrapper.getName()), rootCause); ... container.getLogger().error(sm.getString(""standardWrapper.serviceException"", wrapper.getName()), e); Are there any reasons for using getLogger().warn()? I think it would be better that all of them use getLogger().error(...)."	2007-02-13 21:45:29	1171420000	resolved fixed	8ba8334	1171600000	java/org/apache/catalina/core/StandardWrapperValve.java	
1014	41578	Bug 41578 Avoid SimplePool.get/put synchronization in JspFactoryImpl	"Only 1 instance of the JspFactory object (JspFactoryImpl) is created. Consequently there is a single SimplePool of PageContext objects for all JSP requests and so every JSP request must synchronize on the lock inside SimplePool when getting and releasing a PageContext instance. Moreover, the pool has a fixed capacity and after that, the code in JspFactoryImpl will first acquire the lock to see if there are any free objects in the pool, failing which a new PageContext object is created. Instead of a single process-wide pool, a per thread pool of PageContext objects can be used by JspFactoryImpl."	2007-02-09 00:00:43	1171000000	resolved fixed	4612c8a	1171070000	java/org/apache/jasper/runtime/JspFactoryImpl.java	
1015	41558	Bug 41558 Unnecessary synchronization caused by JspFactory.getDefaultFactory while servicing JSPs	"Tomcat version: 6.0.x trunk Every generated JSP has try { _jspxFactory = JspFactory.getDefaultFactory(); response.setContentType(""text/html""); in its _jspService method. The use of JspFactory.getDefaultFactory during request processing should be avoided as it is a *static synchronized* method. I have a diff that addresses this and will attach it to this bug."	2007-02-07 06:03:18	1170850000	resolved fixed	1a8c492	1170890000	java/org/apache/jasper/compiler/Generator.java java/org/apache/jasper/compiler/JspRuntimeContext.java java/org/apache/jasper/runtime/HttpJspBase.java	
1016	41521	Bug 41521 filter-mapping doesn't support * for servlet-name	SRV 6.2.5 of the servlet 2.5 spec introduces support for '*' as the servlet-name in a filter-mapping. TC6 does not currently support that value as specified. I will attach a patch shortly.	2007-02-01 14:18:55	1170360000	resolved fixed	8b0d130	1170890000	java/org/apache/catalina/core/ApplicationFilterFactory.java java/org/apache/catalina/deploy/FilterMap.java	
1017	41466	Bug 41466 NIO Connector: IllegalArgumentException: You can only write using the application write buffer provided by the handler	"Trying to use NIO connector instead of APR connector using Tomcat6 HEAD, I get an IllegalArgumentException while in a call to sendAck. Looking at InternalNioOutputBuffer.sendAck(), it uses ByteBuffer.wrap() to create a new ByteBuffer and uses this ByteBuffer in a call to writeToSocket. There is a check in SecureNioChannel.write() that the ByteBuffer is the one stored in the Commenting the line 372 in SecureNioChannel.java fixes the problem. //if ( src != bufHandler.getWriteBuffer() ) throw new IllegalArgumentException(""You can only write using the application write buffer provided by the handler.""); But I guess that the check is here for a valid reason, and a better fix would very likely consist in fixing the sendAck or in adding an ""or"" condition to the test for the case of sendAck(). GRAVE: Cannot find message associated with key standardWrapper.acknowledgeException java.lang.IllegalArgumentException: You can only write using the application write buffer provided by the handler. at org.apache.tomcat.util.net.SecureNioChannel.write(SecureNioChannel.java:372) at org.apache.tomcat.util.net.NioSelectorPool.write(NioSelectorPool.java:111) at org.apache.coyote.http11.InternalNioOutputBuffer.writeToSocket(InternalNioOutputBuffer.java:434) at org.apache.coyote.http11.InternalNioOutputBuffer.sendAck(InternalNioOutputBuffer.java:418) at org.apache.coyote.http11.Http11NioProcessor.action(Http11NioProcessor.java:1028) at org.apache.coyote.Response.action(Response.java:183) at org.apache.coyote.Response.acknowledge(Response.java:310) at org.apache.catalina.connector.Response.sendAcknowledgement(Response.java:1154) at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:169) at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:175) at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:128) at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:105) at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:109) at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:212) at org.apache.coyote.http11.Http11NioProcessor.process(Http11NioProcessor.java:888) at org.apache.coyote.http11.Http11NioProtocol$Http11ConnectionHandler.process(Http11NioProtocol.java:624) at org.apache.tomcat.util.net.NioEndpoint$Worker.run(NioEndpoint.java:1467) at java.lang.Thread.run(Thread.java:595)"	2007-01-25 09:12:11	1169730000	resolved fixed	fce171f	1170020000	java/org/apache/tomcat/util/net/NioSelectorPool.java	
1018	39572	Bug 39572 fixes to use CompressionFilter in WebSphere app server	"There are a couple of small bugs in the compression filter classes that are triggered by using the filter in WebSphere 5.1 or 6. Here are patches. - CompressionResponseStream should not compress the output stream if the response has been committed (because then it cannot write the Content-Encoding: gzip header, and the browser displays the compressed output as-is) - CompressionServletResponseWrapper causes a NullPointerException if you flush before writing anything"	2006-05-12 22:28:57	1147490000	resolved fixed	f06d41f	1169940000	webapps/examples/WEB-INF/classes/compressionFilters/CompressionFilterTestServlet.java webapps/examples/WEB-INF/classes/compressionFilters/CompressionResponseStream.java webapps/examples/WEB-INF/classes/compressionFilters/CompressionServletResponseWrapper.java	
1019	41265	Bug 41265 JspServlet's checkInterval parameter cannot be set to 0 implicitly	"conf\web.xml's JspServlet init parameters include 'checkInterval', whose value is explained as follows: If development is false and checkInterval is greater than zero, background compilations are enabled. If I add the following parameters one would think the background compilations would be disabled (the value is not greater than zero). <init-param> <param-name>checkInterval</param-name> <param-value>0</param-value> </init-param> <init-param> <param-name>development</param-name> <param-value>false</param-value> </init-param> However, the value is changed to 300 and the following warning is outputted: Dec 30, 2006 7:13:57 PM org.apache.jasper.EmbeddedServletOptions <init> WARNING: Warning: Invalid value for the initParam checkInterval. Will use the default value of ""300"" seconds According to the comment in web.xml ""0"" was a valid value. Either the comment or the validity check is wrong. Or my understanding of them."	2006-12-30 02:34:23	1167460000	resolved fixed	39fe247	1169940000	java/org/apache/jasper/EmbeddedServletOptions.java	
1020	40524	Bug 40524 request.getAuthType() returns different string from HttpServletRequest.CLIENT_CERT_AUTH	using inspect: request.getAuthType() (java.lang.String) CLIENT-CERT HttpServletRequest.CLIENT_CERT_AUTH (java.lang.String) CLIENT_CERT api says they should be the same object (== should work)	2006-09-16 01:49:08	1158390000	resolved fixed	dc33554	1169930000	java/org/apache/catalina/authenticator/Constants.java java/org/apache/catalina/authenticator/SSLAuthenticator.java java/org/apache/catalina/authenticator/SingleSignOn.java java/org/apache/catalina/authenticator/SingleSignOnEntry.java	
1021	41217	Bug 41217 SingleSignOn Cookie does not honor https access: Login Information Disclosure	"When using the SingleSignOn Valve (org.apache.catalina.authenticator.SingleSignOn) via https the Cookie JSESSIONIDSSO is transmitted without the ""secure"" attribute, resulting in it being transmitted to any content that is - by purpose or error - requested via http from the same server. As the content of the SSO-Cookie is confidential (it will lead to automatically logged in sessions in other contexts - https or non-https) this should never happen. Sorry to have no patch. I've not installed the complete source distribution in my development environment, but it seems the points to change are org.apache.catalina.authenticator.AuthenticatorBase.register(...), the code of interest being (from 5.5.30 source distribution) Cookie cookie = new Cookie(Constants.SINGLE_SIGN_ON_COOKIE, ssoId); cookie.setMaxAge(-1); cookie.setPath(""/""); hres.addCookie(cookie); As hres is an org.apache.catalina.HttpRequest, and I've looked through the code to find org.apache.catalina.Request.setSecure() but no ...isSecure() (though this is mentioned in the Javadoc for ...setSecure()) I suppose there needs to be another change to provide isSecure on Request or HttpRequest, but this is difficult to tell only from the editor. If isSecure() was there, there'd be a cookie.setSecure(hres.isSecure()) missing in the statements above..."	2006-12-20 05:13:27	1166610000	resolved fixed	11b9c92	1169930000	java/org/apache/catalina/authenticator/AuthenticatorBase.java	
1022	41327	Bug 41327 Jasper does'nt display the full path of the file in a 404 Not found error page		2007-01-09 00:32:55	1168320000	resolved fixed	3a6225a	1169930000	java/org/apache/jasper/servlet/JspServlet.java	
1023	40820	Bug 40820 Default JSP factory not initialized early enough	"With the latest TC6 code, I'm seeing a problem that did not exist on earlier TC6 drivers. Sorry that I can't put a finger on when this problem arose. I looked into relevant source files (like JspRuntimeContext) but haven't found the source of the problem. Here's the issue (a testcase will be attached). The app is very simple: it installs ServletContextListener for the purpose of adding a custom ELResolver. It accomplishes this via: public void contextInitialized(ServletContextEvent evt) { ServletContext context = evt.getServletContext(); JspApplicationContext jspContext = JspFactory.getDefaultFactory().getJspApplicationContext(context); jspContext.addELResolver(new ChipsELResolver()); } The problem is that JspFactory.getDefaultFactory() is returning null; see below. Oct 4, 2006 5:32:18 PM org.apache.catalina.core.AprLifecycleListener lifecycleEv ent INFO: The Apache Tomcat Native library which allows optimal performance in produ ction environments was not found on the java.library.path: C:\javaFor6.0BuildJDK 15\java\jre\bin;.;C:\javaFor6.0BuildJDK15\java\bin;c:\mantis2.1\mantis\bin;C:\se tupIBASE;C:\Perl\bin\;C:\WINDOWS\system32;C:\WINDOWS;C:\WINDOWS\System32\Wbem;c: \Python22;C:\Program Files\PC-Doctor for Windows\services;c:\cvsnt-2.0.4;c:\ecli pse;w:\;w:\bin;C:\Program Files\QuickTime\QTSystem\;C:\Diskeeper\;C:\CMVC\exe;C: \CMVC\exe\bin;;C:\CMVCDC50;C:\CMVCDC50;C:\CMVCDC50; Oct 4, 2006 5:32:18 PM org.apache.coyote.http11.Http11Protocol init INFO: Initializing Coyote HTTP/1.1 on http-8080 Oct 4, 2006 5:32:19 PM org.apache.catalina.startup.Catalina load INFO: Initialization processed in 1234 ms Oct 4, 2006 5:32:19 PM org.apache.catalina.core.StandardService start INFO: Starting service Catalina Oct 4, 2006 5:32:19 PM org.apache.catalina.core.StandardEngine start INFO: Starting Servlet Engine: Apache Tomcat/6.0.0-dev Oct 4, 2006 5:32:19 PM org.apache.catalina.core.StandardHost start INFO: XML validation disabled Oct 4, 2006 5:32:19 PM org.apache.catalina.startup.HostConfig deployWAR INFO: Deploying web application archive ELResolverTest.war ChipsListener.contextInitialized evt= javax.servlet.ServletContextEvent[source= org.apache.catalina.core.ApplicationContextFacade@3fbe3fbe] ChipsListener.contextInitialized context= org.apache.catalina.core.ApplicationC ontextFacade@3fbe3fbe ChipsListener.contextInitialized JspFactory.getDefaultFactory()= null Oct 4, 2006 5:32:20 PM org.apache.catalina.core.StandardContext start SEVERE: Error listenerStart Oct 4, 2006 5:32:20 PM org.apache.catalina.core.StandardContext start SEVERE: Context [/ELResolverTest] startup failed due to previous errors Oct 4, 2006 5:32:21 PM org.apache.coyote.http11.Http11Protocol start INFO: Starting Coyote HTTP/1.1 on http-8080 Oct 4, 2006 5:32:21 PM org.apache.jk.common.ChannelSocket init INFO: JK: ajp13 listening on /0.0.0.0:8009 Oct 4, 2006 5:32:21 PM org.apache.jk.server.JkMain start INFO: Jk running ID=0 time=0/63 config=null Oct 4, 2006 5:32:21 PM org.apache.catalina.startup.Catalina start INFO: Server startup in 2657 ms This is easily reproducible when you deploy the ELResolverTest.war *before* the server has started (I assume JspFactory.setDefaultFactory() hasn't been invoked at the time the listeners are being installed). If you deploy the WAR *after* the server starts, the problem does not manifest and the app works --- until you stop and restart the server."	2006-10-26 07:52:03	1161860000	resolved fixed	a1b1bed	1167780000	java/org/apache/catalina/core/JasperListener.java	
1024	41074	"Bug 41074 Output of tag ""jsp:plugin"" is not conform to XHTML."	"The jsp comiler outputs all tag required for an object in upper case letters. To be conform with XHTML lower case is required, but all tags are hard coded in the generator."	2006-11-29 05:35:54	1164800000	resolved fixed	5f9c18d	1165550000	java/org/apache/jasper/compiler/Generator.java	
1025	40585	Bug 40585 org.apache.juli.FileHandler does not allow programmatic creation using parametrized constructor	"If org.apache.juli.FileHandler is created programmatically with parametrized constructor public FileHandler(String directory, String prefix, String suffix) , FileHandler ignores custom constructor parameters, creates log handler with default configuration and writes log file to ""${catalina_home}/bin/logs"" with the name ""juli.YYYY-MM-DD.log"" (YYYY, MM and DD are substituted with actual year, month and date) It looks like the problem is in the fact parametrized constructor calls default constructor. Default constructor in turn performs handler configuration from LogManager properties and creates a log file based on this default configuration. This makes custom constructor parameters effectively ignored."	2006-09-22 18:06:20	1158960000	resolved fixed	c6b3f71	1165540000	java/org/apache/juli/FileHandler.java	
1026	41089	"Bug 41089 JspFactoryImpl has SPEC_VERSION = ""2.0"""	"org.apache.jasper.runtime.JspFactoryImpl has private static final String SPEC_VERSION = ""2.0""; Should be: private static final String SPEC_VERSION = ""2.1"";"	2006-11-30 10:12:31	1164900000	resolved fixed	514256e	1164980000	java/org/apache/jasper/compiler/ImplicitTagLibraryInfo.java java/org/apache/jasper/compiler/PageDataImpl.java java/org/apache/jasper/compiler/Validator.java	
1027	41057	Bug 41057 Tomcat leaks memory on every request		2006-11-28 10:07:27	1164730000	resolved fixed	de5c3b7	1164760000	java/org/apache/tomcat/util/buf/StringCache.java	
1028	41008	Bug 41008 POST request ignores command line parameters	"example: <form method=""POST"" action=""test.exe?test1""><input type=""hidden"" value=""test2""><input type=""submit""></form> this code does invoke the test.exe without passing the test1 command line parameter the example works in apache httpd and ms iis fix: CGIServlet.java if (!""GET"".equals(req.getMethod()) && !""POST"".equals(req.getMethod()) && !""HEAD"".equals(req.getMethod())) return;"	2006-11-21 09:20:32	1164120000	resolved fixed	b70962f	1164410000	java/org/apache/catalina/servlets/CGIServlet.java	
1029	40901	Bug 40901 listings page does not escape XML characters	"On Solaris you can have a file or directory name called ""<b>xxx"" or ""<i>yyy"". Using Tomcat's listings feature, you get a directory listing with the file name in bold or italics. I am not familiar with Javascript or cross-site scripting security problems, but I believe Tomcat escapes XML characters like "">"" and ""<"" to prevent client browsers to interpret HTML codes that are not intended to be interpreted as such for the default error page. I think the same should be done for listings, or a warning should be added to the documentation not to use it if you have no control over the file/directory names you list."	2006-11-05 20:38:27	1162780000	resolved fixed	cb2c655	1163980000	java/org/apache/catalina/servlets/DefaultServlet.java	
1030	40929	Bug 40929 Misleading comments in StandardClassLoader	"Sometime during the Tomcat 5 development, the StandardClassLoader in org.apache.catalina.loader package was stripped down, and is now just a URLClassLoader. I work with code that extends the StandardClassLoader (we use the automatic reloading of jar files), and during an upgrade from tomcat 4 to tomcat 5.5 found difficultly trying to figure out what had happened to the code. I ended up having to install SVN and do a svn log to figure out why the code was removed. When the code was stripped down, the comments in the java file (and therefore in the javadoc api) remained identical, so the javadoc api for the class is very misleading. For instance, the comments say that the class implements Reloader, when it in fact does not. The class comments should be updated to reflect the state of the code. I can't see this as being very high priority, but it would likely be an easy to fix for people whom are in the code regularly, and it would make the javadoc much more readable for people that extend the StandardClassLoader for their own purposes."	2006-11-08 14:23:40	1163010000	resolved fixed	6009702	1163980000	java/org/apache/catalina/loader/StandardClassLoader.java	
1031	40860	Bug 40860 Tomcat loses request parameters		2006-11-01 04:29:15	1162370000	resolved fixed	e713e77	1163980000	java/org/apache/catalina/connector/Request.java java/org/apache/tomcat/util/http/Parameters.java	
1032	37509	Bug 37509 ClassLoaderLogManager remove '\n' at the end of logging.properties values	"The method ClassLoaderLogManager.replace(String) that is in charge of replacing system properties at the begining of the property also modify the end of the property due to a call to trim. This implies that Logger/Handler/Formatter that relies on properties endding with some spases (including '\n') will have a different behaviour with JDK LogManger and tomcat ClassLoaderLogManager a modified verstion of this method could be: protected String replace(String str) { // start modification // String result = str.trim(); // commented out int len = str.length(); int st = 0; while ((st < len) && (str.charAt(st) <= ' ')) { st++; } String result = (st > 0) ? str.substring(st) : str; // end modification if (result.startsWith(""${"")) { int pos = result.indexOf('}'); if (pos != -1) { String propName = result.substring(2, pos); String replacement = System.getProperty(propName); if (replacement != null) { result = replacement + result.substring(pos + 1); } } } return result; }"	2005-11-15 18:22:38	1132100000	resolved fixed	a6d6962	1163980000	java/org/apache/juli/ClassLoaderLogManager.java	
1033	40844	Bug 40844 JDBCRealm.getPassword throws NullPointerException	JDBCRealm.getPassword throws NullPointerException I'm using tomcat 5.5.20 with postgresql-8.1-407.jdbc3.jar and postgresql-8.1.4 on Ubuntu Dapper. Authenticating two users simultaneously with HTTP DIGEST causes sometimes the following errors and a 401 Unauthorized reply: 30.10.2006 14:24:54 org.apache.catalina.realm.JDBCRealm getPassword SEVERE: Exception performing authentication org.postgresql.util.PSQLException: ERROR: invalid message format at org.postgresql.core.v3.QueryExecutorImpl.receiveErrorResponse(QueryExecutorImpl.java:1525) at org.postgresql.core.v3.QueryExecutorImpl.processResults(QueryExecutorImpl.java:1309) at org.postgresql.core.v3.QueryExecutorImpl.execute(QueryExecutorImpl.java:188) at org.postgresql.jdbc2.AbstractJdbc2Statement.execute(AbstractJdbc2Statement.java:452) at org.postgresql.jdbc2.AbstractJdbc2Statement.executeWithFlags(AbstractJdbc2Statement.java:354) at org.postgresql.jdbc2.AbstractJdbc2Statement.executeQuery(AbstractJdbc2Statement.java:258) at org.apache.catalina.realm.JDBCRealm.getPassword(JDBCRealm.java:546) at org.apache.catalina.realm.RealmBase.getDigest(RealmBase.java:1156) at org.apache.catalina.realm.RealmBase.authenticate(RealmBase.java:365) at org.apache.catalina.authenticator.DigestAuthenticator.findPrincipal(DigestAuthenticator.java:282) at org.apache.catalina.authenticator.DigestAuthenticator.authenticate(DigestAuthenticator.java:175) at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:490) at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:126) at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:105) at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:107) at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:148) at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:869) at org.apache.coyote.http11.Http11BaseProtocol$Http11ConnectionHandler.processConnection(Http11BaseProtocol.java:664) at org.apache.tomcat.util.net.PoolTcpEndpoint.processSocket(PoolTcpEndpoint.java:527) at org.apache.tomcat.util.net.LeaderFollowerWorkerThread.runIt(LeaderFollowerWorkerThread.java:80) at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:684) at java.lang.Thread.run(Thread.java:595) 30.10.2006 14:24:54 org.apache.catalina.connector.CoyoteAdapter service SEVERE: An exception or error occurred in the container during the request processing java.lang.NullPointerException at org.apache.catalina.realm.JDBCRealm.getPassword(JDBCRealm.java:568) at org.apache.catalina.realm.JDBCRealm.getPrincipal(JDBCRealm.java:594) at org.apache.catalina.realm.RealmBase.authenticate(RealmBase.java:398) at org.apache.catalina.authenticator.DigestAuthenticator.findPrincipal(DigestAuthenticator.java:282) at org.apache.catalina.authenticator.DigestAuthenticator.authenticate(DigestAuthenticator.java:175) at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:490) at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:126) at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:105) at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:107) at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:148) at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:869) at org.apache.coyote.http11.Http11BaseProtocol$Http11ConnectionHandler.processConnection(Http11BaseProtocol.java:664) at org.apache.tomcat.util.net.PoolTcpEndpoint.processSocket(PoolTcpEndpoint.java:527) at org.apache.tomcat.util.net.LeaderFollowerWorkerThread.runIt(LeaderFollowerWorkerThread.java:80) at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:684) at java.lang.Thread.run(Thread.java:595)	2006-10-30 06:25:52	1162210000	resolved fixed	be9d523	1163980000	java/org/apache/catalina/realm/JDBCRealm.java	
1034	40913	Bug 40913 JasperException raised against valid attribute	"In org.apache.jasper.compiler.Validator.checkXmlAttributes(), the validation for deferred values and methods is raising an exception when an rtexprvalue attribute is legitimate. ------Stacktrace------ org.apache.jasper.JasperException: org.apache.jasper.JasperException: /index.jsp(83,0) According to TLD or attribute directive in tag file, attribute items does not accept any expressions org.apache.jasper.servlet.JspServletWrapper.handleJspException (JspServletWrapper.java:565) org.apache.jasper.servlet.JspServletWrapper.service (JspServletWrapper.java:354) org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:320) org.apache.jasper.servlet.JspServlet.service(JspServlet.java:266) javax.servlet.http.HttpServlet.service(HttpServlet.java:803) ------relevant code in checkXmlAttributes()------ if (!deferred && (tldAttrs[j].isDeferredMethod() || tldAttrs [j].isDeferredValue())) { // Only deferred expressions are allowed for this attribute err.jspError(n, ""jsp.error.attribute.custom.non_rt_with_expr"", tldAttrs[j].getName()); } ------testcase------ <c:forEach var=""k"" items=""${colors}""> <li><font color=""${k}"">This line is ${k}</font>. </c:forEach> The TLD for JSTL 1.2 says items can be an rtexprvalue and also a deferred- value. So the above usage is correct. Attaching a testcase WAR. ------summary------ I don't think this code is really necessary; at least, it needs to be relaxed to allow tai.canBeRequestTime() values."	2006-11-06 16:24:05	1162850000	resolved fixed	f7ca96d	1162900000	java/org/apache/jasper/compiler/Validator.java	
1035	34956	Bug 34956 Tomcat should enforce the requirements from servlet 2.4 specification SRV.8.2	"Tomcat should enforce the requirements from servlet 2.4 specification SRV.8.2 SRV.8.2 Using a Request Dispatcher ""To use a request dispatcher, a servlet calls either the include method or forward method of the RequestDispatcher interface. The parameters to these methods can be either the request and response arguments that were passed in via the service method of the Servlet interface, or instances of subclasses of the request and response wrapper classes that have been introduced for version 2.3 of the specification. In the latter case, the wrapper instances must wrap the request or response objects that the container passed into the service method. The Container Provider must ensure that the dispatch of the request to a target servlet occurs in the same thread of the same VM as the original request"" Justification: ============== The absense of this enforcement leads to software beeing developed not following the specification. The software cannot be deployed later on a container which conforms to the above paragraph and hence must be changed before deployment. This somehow contradicts the idea of having a standards based infrastructure."	2005-05-18 14:47:47	1116440000	resolved fixed	22d1ad7	1162680000	java/org/apache/catalina/core/ApplicationDispatcher.java java/org/apache/catalina/core/ApplicationFilterChain.java	
1036	40817	Bug 40817 servlet-cgi throws index out of bounds exception on certain cgi	"First, servlets-cgi.jar needs to exist and the servlet must be mapped: for example: <servlet-mapping> <servlet-name>cgi</servlet-name> <url-pattern>*.pl</url-pattern> </servlet-mapping> Test perl cgi script: #!/usr/bin/perl print ""Content-type: text/plain"", ""\n\n""; print ""Hello world, from Perl\n""; One perl script is placed in www-root (""/test.pl"") and the other in any subfolder (""/test/test.pl"" or ""/cgi-bin/test.pl"", etc.) The cgi script in the subfolder will run fine. The cgi script in the www-root will generate an exception: java.lang.StringIndexOutOfBoundsException: String index out of range: -1 java.lang.String.substring(String.java:1768) java.lang.String.substring(String.java:1735) org.apache.catalina.servlets.CGIServlet$CGIEnvironment.findCGI(CGIServlet.java:948) org.apache.catalina.servlets.CGIServlet$CGIEnvironment.setCGIEnvironment(CGIServlet.java:1015) org.apache.catalina.servlets.CGIServlet$CGIEnvironment.<init>(CGIServlet.java:766) org.apache.catalina.servlets.CGIServlet.doGet(CGIServlet.java:584) javax.servlet.http.HttpServlet.service(HttpServlet.java:689) javax.servlet.http.HttpServlet.service(HttpServlet.java:802) The problem is this line (line 948 in CGIServlet.java): cginame = currentLocation.getParent().substring(webAppRootDir.length())+ File.separator + name; The problem is that webAppRootDir is 1 char longer than currentLocation.getParent() because webAppRootDir ends with a File.separator (in this case, a ""/""). And removing the extra File.separator from webAppRootDir will result in a different String related exception elsewhere. And here's a fix that works: cginame = (currentLocation.getParent() + File.separator).substring(webAppRootDir.length()) + name; (If necessary, the fix can be made more adaptive by checking to see if it really does have a File.separator at the end and if not...add it...otherwise, let it be, etc.) (on a side note, I have one more bug to fix; the ENV_VAR ""SCRIPT_FILENAME"" isn't defined as it should be [required for PHP4/5] but I'll submit a different bug/fix for that.)"	2006-10-25 20:02:52	1161820000	resolved fixed	6d274b4	1162680000	java/org/apache/catalina/servlets/CGIServlet.java	
1037	37458	Bug 37458 Datarace on org.apache.catalina.loader.WebappClassLoader	"In findClassInternal, it is possible that entry.manifest is set to null by another thread right before calling definePackage(packageName, entry.manifest, entry.codeBase)."	2005-11-10 21:34:17	1131680000	resolved fixed	79631bb	1162680000	java/org/apache/catalina/loader/WebappClassLoader.java	
1038	40723	Bug 40723 Wrong and misleading documentation in JDBCAccessLogValve	"In the class JDBCAccessLogValve is an example for an table to hold access log values. In this table is a column ts which is defined as not null. This will only work on MySQL, because this value is never written by the Valve and other databases will complain about a column which is not filled with a value."	2006-10-11 02:50:26	1160550000	resolved fixed	9cb5aff	1161140000	java/org/apache/catalina/valves/JDBCAccessLogValve.java	
1039	40771	Bug 40771 Can't read POST data from within a filter or valve	"I was attempting to create a Filter or Valve that could be placed in front of an Axis web service that would handle security according to the WS-Security specification. That turned out to be a rabbit trail, but I did find and fix a bug that I discovered along the way. I ran into problems reading POST data (the web service request) from the org.apache.catalina.connector.Request object exposed in the Filter/Valve interfaces. This is a chunk of code in a prototype Valve that didn't work: private ByteChunk getPOSTBody(Request request) throws IOException { ByteChunk retval = new ByteChunk(request.getContentLength()); ByteChunk body = new ByteChunk(request.getContentLength()); int bytesRead; do { bytesRead = request.getCoyoteRequest().doRead(body); retval.append(body); } while (bytesRead >= 0) ; //puts the data back into the pipe. request.getCoyoteRequest().action (ActionCode.ACTION_REQ_SET_BODY_REPLAY, retval); return retval; } This code works as designed, however the problem occurs later on when Axis attempted to parse the web service request. I don't remember the exact Axis error, but I was able to track the problem down to a bug in the org.apache.coyote.http11.filters.SavedRequestInputFilter class. The doRead method was not properly implemented to return a -1 when appropriate. Here is my modified version of the doRead method: public int doRead(ByteChunk chunk, org.apache.coyote.Request request) throws IOException { int writeLength = 0; if (chunk.getLimit() > 0 && chunk.getLimit() < input.getLength()) { writeLength = chunk.getLimit(); } else { writeLength = input.getLength(); } if(input.getOffset()>= input.getEnd()) return -1; input.substract(chunk.getBuffer(), 0, writeLength); chunk.setOffset(0); chunk.setEnd(writeLength); return writeLength; } This bug won't show up unless someone tries to use a filter/valve to do something with web services. That's not too likely because that's what we have SOAPHandlers for."	2006-10-16 16:08:36	1161030000	resolved fixed	17eecdb	1161140000	java/org/apache/coyote/http11/filters/SavedRequestInputFilter.java	
1040	39724	Bug 39724 Bug on StandardPipeline.removeValve(Valve valve) for T5.5.16+	I run into this problem with T5 when tring to add/remove/add a valve to the standard engine. -For what I understand an empty pipeline has: basic = StandardEngineValve (For example); first = null; -If you add a valve you will get basic = StandardEngineValve first = myValve (with myValve.next = StandardEngineValve) -If you remove the valve you will get basic =StandardEngineValve first = StandardEngineValve Note that StandardEngineValve is in first too here. -If I try to add a new valve given the actual code in addValve the valve will not be added because (see the **) current = basic and current.getNext() = null; addValve(Valve valve) { // Add this Valve to the set associated with this Pipeline if (first == null) { first = valve; valve.setNext(basic); } else { Valve current = first; while (current != null) { ** if (current.getNext() == basic) { current.setNext(valve); valve.setNext(basic); break; } current = current.getNext(); } } }	2006-06-05 14:01:56	1149530000	resolved fixed	b18c29e	1159840000	java/org/apache/catalina/core/StandardPipeline.java	
1041	29727	Bug 29727 JNDI env-entry not reload when context reloaded	"If environment entries are changed in web.xml, and the application context is restarted, the values in the JNDI context are the old values. If the environment entries are changed via the Tomcat 'admin' interface, then the values provided to the context are correct. The following code is can be used to check the environment: try { InitialContext ic = new InitialContext(); NamingEnumeration enum = ic.listBindings(""java:comp/env""); while (enum.hasMore()) { Binding binding = (Binding) enum.next(); jndi.setProperty(binding.getName(), """" + binding.getObject()); System.out.println(""jndi setting: "" + binding.getName() + ""="" + binding.getObject()); } } catch (NamingException e) { System.err.println(""unable to read JNDI settings, "" + e); } The web.xml fragment looks as follows: <env-entry> <env-entry-name>DatabaseURL</env-entry-name> <env-entry-value>jdbc:hsqldb:hsql://localhost</env-entry-value> <env-entry-type>java.lang.String</env-entry-type> </env-entry>"	2004-06-21 22:56:25	1087870000	resolved fixed	1a5e6e7	1159750000	java/org/apache/catalina/deploy/NamingResources.java	
1042	40625	Bug 40625 CGIServlet eats root cause	"The code below doesn't make sense: <snip> catch (IOException e){ log (""Caught exception "" + e); throw new IOException (e.toString()); } </snip> It should be ""throw e;"". IMHO, It seems no need to log this exception here, so the cache block can be removed."	2006-09-28 05:16:58	1159440000	resolved fixed	bbb8fe1	1159570000	java/org/apache/catalina/servlets/CGIServlet.java	
1043	40518	"Bug 40518 The message key ""requestListenerValve.requestInit"" has not be referred to correctly."	"The bug is: An illegal message is output to the log when the listener application that implements ServletRequestListener interface throws RuntimeException from the requestInitialized method or the requestDestroyed method. message: ""Cannot find message associated with key requestListenerValve.requestInit"" cause: The key exists in the properties file ""org.apache.catalina.valves.LocalStrings.properties"", but the logic refers other properties file ""org.apache.catalina.core.LocalStrings.properties"""	2006-09-15 09:13:40	1158330000	resolved fixed	fda223a	1158810000	java/org/apache/catalina/core/StandardContextValve.java	
1044	34399	Bug 34399 Undeploying fails when context defined in server.xml & server fails to stop	"Steps to reproduce: 1. autodeploy a web application by defining its context in server.xml 2. start the Tomcat server 3. use the Tomcat Manager to undeploy the application You will get the ""OK - Undeployed application at context path /WebApplication"" message, but the application will NOT be undeployed, it will be only stopped. If you try to stop the server after that, it will fail! I have used the shared installation (CATALINA_BASE dir), but I guess this won't work for standalone Tomcat isntallation either."	2005-04-11 16:32:42	1113250000	resolved fixed	9dd8a23	1158810000	java/org/apache/catalina/manager/HTMLManagerServlet.java java/org/apache/catalina/manager/ManagerServlet.java java/org/apache/catalina/startup/HostConfig.java	
1045	34509	Bug 34509 tag names that are xml:Name but not java identifier are not accepted	"According to the JSP 2.0 specification, custom tag prefix and name should be of the type XML:Name. However, for Tomcat 5.5.8, if the name is not a legal java identifier, then a compilation error occurs. For instance, Tomcat won't accept Da~te`T#ag as a legal name for the Tag."	2005-04-19 00:45:34	1113890000	resolved fixed	823101d	1158370000	java/org/apache/jasper/compiler/Generator.java	
1046	33356	Bug 33356 Incorrect parsing of tag attributes	"I get a org.apache.jasper.JasperException: with the error: ""The function string must be used with a prefix when a default namespace is not specified"" when trying to compile the following within a JSP page: <foo:set var=""bar"" value=""this $ is a { silly string (""/> ""foo"" is our own tablib, it seems that Jasper seems to think that the string provided to the value attribute contains some JSP/EL which it does not. If I change the page to be: <c:set var=""bar"" value=""this $ is a { silly string (""/> Then I do not get this error. However I need to use my own taglib. In the foo.tld file, the ""value"" attribute of ""set"" has rtexprvalue=true. If I set this to false then the problem goes away. However I noticed that c.tld in standard.jar also has rtexprvalue=true for the ""value"" attribute of ""set"". Why the difference in behaviour ? We also wish to have rtexprvalue=true."	2005-02-02 14:55:18	1107370000	resolved fixed	b55e9c2	1157860000	java/org/apache/jasper/compiler/ELParser.java	
1047	31804	Bug 31804 setParent() is not called on nested tags in a tag file (.tagx)		2004-10-20 16:26:40	1098300000	resolved fixed	2d6d717	1157840000	java/org/apache/jasper/compiler/Generator.java	
1048	38713	Bug 38713 java.io.IOException: tmpFile.renameTo(classFile) failed when compiling new JSP (upon redeploy)	[http-8080-Processor24 ERROR 26902165 DispatcherServlet.serviceWrapper()] - Could not complete request org.apache.jasper.JasperException: Unable to compile class for JSP at org.apache.jasper.JspCompilationContext.compile(JspCompilationContext.java:565) at org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:293) at org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:291) at org.apache.jasper.servlet.JspServlet.service(JspServlet.java:241) at javax.servlet.http.HttpServlet.service(HttpServlet.java:802) at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:252) at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173) at org.apache.catalina.core.ApplicationDispatcher.invoke(ApplicationDispatcher.java:672) at org.apache.catalina.core.ApplicationDispatcher.processRequest(ApplicationDispatcher.java:463) at org.apache.catalina.core.ApplicationDispatcher.doForward(ApplicationDispatcher.java:398) at org.apache.catalina.core.ApplicationDispatcher.forward(ApplicationDispatcher.java:301) at org.springframework.web.servlet.view.InternalResourceView.renderMergedOutputModel(InternalResourceView.java:97) at org.springframework.web.servlet.view.AbstractView.render(AbstractView.java:250) at org.springframework.web.servlet.DispatcherServlet.render(DispatcherServlet.java:928) at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:705) at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:625) at org.springframework.web.servlet.FrameworkServlet.serviceWrapper(FrameworkServlet.java:386) at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:346) at javax.servlet.http.HttpServlet.service(HttpServlet.java:689) at javax.servlet.http.HttpServlet.service(HttpServlet.java:802) at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:252) at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173) at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:213) at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:178) at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:126) at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:105) at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:107) at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:148) at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:856) at org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnection(Http11Protocol.java:744) at org.apache.tomcat.util.net.PoolTcpEndpoint.processSocket(PoolTcpEndpoint.java:527) at org.apache.tomcat.util.net.LeaderFollowerWorkerThread.runIt(LeaderFollowerWorkerThread.java:80) at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:684) at java.lang.Thread.run(Thread.java:595) [http-8080-Processor24 ERROR 26902165 [wirelessapp].invoke()] - Servlet.service() for servlet wirelessapp threw exception java.io.IOException: tmpFile.renameTo(classFile) failed at org.apache.jasper.compiler.SmapUtil$SDEInstaller.install(SmapUtil.java:245) at org.apache.jasper.compiler.SmapUtil.installSmap(SmapUtil.java:164) at org.apache.jasper.compiler.AntCompiler.generateClass(AntCompiler.java:267) at org.apache.jasper.compiler.Compiler.compile(Compiler.java:288) at org.apache.jasper.compiler.Compiler.compile(Compiler.java:267) at org.apache.jasper.compiler.Compiler.compile(Compiler.java:255) at org.apache.jasper.JspCompilationContext.compile(JspCompilationContext.java:556) at org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:293) at org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:291) at org.apache.jasper.servlet.JspServlet.service(JspServlet.java:241) at javax.servlet.http.HttpServlet.service(HttpServlet.java:802) at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:252) at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173) at org.apache.catalina.core.ApplicationDispatcher.invoke(ApplicationDispatcher.java:672) at org.apache.catalina.core.ApplicationDispatcher.processRequest(ApplicationDispatcher.java:463) at org.apache.catalina.core.ApplicationDispatcher.doForward(ApplicationDispatcher.java:398) at org.apache.catalina.core.ApplicationDispatcher.forward(ApplicationDispatcher.java:301) at org.springframework.web.servlet.view.InternalResourceView.renderMergedOutputModel(InternalResourceView.java:97) at org.springframework.web.servlet.view.AbstractView.render(AbstractView.java:250) at org.springframework.web.servlet.DispatcherServlet.render(DispatcherServlet.java:928) at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:705) at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:625) at org.springframework.web.servlet.FrameworkServlet.serviceWrapper(FrameworkServlet.java:386) at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:346) at javax.servlet.http.HttpServlet.service(HttpServlet.java:689) at javax.servlet.http.HttpServlet.service(HttpServlet.java:802) at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:252) at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173) at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:213) at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:178) at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:126) at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:105) at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:107) at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:148) at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:856) at org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnection(Http11Protocol.java:744) at org.apache.tomcat.util.net.PoolTcpEndpoint.processSocket(PoolTcpEndpoint.java:527) at org.apache.tomcat.util.net.LeaderFollowerWorkerThread.runIt(LeaderFollowerWorkerThread.java:80) at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:684) at java.lang.Thread.run(Thread.java:595)	2006-02-20 08:08:04	1140440000	resolved fixed	c7f0f60	1157190000	java/org/apache/jasper/JspCompilationContext.java java/org/apache/jasper/compiler/Compiler.java java/org/apache/jasper/servlet/JspServletWrapper.java	
1049	40306	"Bug 40306 mod_jk, POST request bodies are not restored on successful login when using mod_jk"	"After the FormAuthenticator intercepts a POST request to a protected resource, the original request is not properly restored upon successful login when using mod_jk. When connectiong to tomcat directly (8080), the POST request is restored as expected. I've tested this with mod_jk 1.2.15 and 1.2.18. It seems the problem is that the orginal request is not saved properly. I (think) I've narrowed down the issue in FormAuthenticator.java. body.toString() was returning null. (The buffer was null) so it looks like the root of the problem is that nothing is read from the input stream. During testing I reverted to the old way of adding the request parameters (saved.addParameter()) to see if they were indeed there and it worked. I also tried, InputStream is = new BufferedInputStream(request.getInputStream()); which didn't work.. from FormAuthenticator.java: protected void saveRequest(Request request, Session session) throws IOException { ... if (""POST"".equalsIgnoreCase(request.getMethod())) { ByteChunk body = new ByteChunk(); body.setLimit(request.getConnector().getMaxSavePostSize()); byte[] buffer = new byte[4096]; int bytesRead; InputStream is = request.getInputStream(); while ( (bytesRead = is.read(buffer) ) >= 0) { body.append(buffer, 0, bytesRead); } saved.setBody(body); } ... }"	2006-08-23 19:48:03	1156380000	resolved fixed	a91b95e	1156740000	java/org/apache/coyote/ajp/AjpAprProcessor.java java/org/apache/jk/core/MsgContext.java	
1050	38676	Bug 38676 permanently reloading tagfile classes without changes to the tagfile	"Scenario: - jsp with a tag in it (tagfile, no taglib) - activate ""reloading"" in web.xml - clean work directory - start tomcat - load jsp Tomcat generates/compiles/load the jsp and the tagfile classes. After ""checkInterval"" seconds the background compile thread ""JspRuntimeContext[\*]"" loads the tagfile classes (and only them) again and again. This produces a lot of work for the garbage collector. (permanently class unloading of tagfile classes) A Breakpoint in the method loadTagFile() in JspServletWrapper.java will show this. Perhaps the reload flag must be set to false after loading the TagFile? JspServletWrapper.java: ... if(reload) { tagHandlerClass = ctxt.load(); reload = false; //perhaps, this solves the problem but i am not shure } ... After restarting the server the problem is not present because no JspServletWrapper is instantiated for the tagfile an therefore the backround compile task does not check the tagfile."	2006-02-16 11:48:57	1140110000	resolved fixed	edc20fa	1155910000	java/org/apache/el/lang/ELSupport.java java/org/apache/jasper/servlet/JspServletWrapper.java	
1051	39592	Bug 39592 SSI does not correctly process HEAD request	"Hello, I think there is a small bug in Tomcat 5.0 and 5.5 (at least I could see it already with many versions of Tomcat). I use SSI org.apache.catalina.ssi.SSIServlet and <param-name>isVirtualWebappRelative</param-name> <param-value>1</param-value> All my pages (*.html) are processed by the SSI <url-pattern>*.html</url-pattern> If there is a normal GET request, SSI compiles a page and everything is just OK. However, for the HEAD request to the same page (there is no need to compile the page) the SSI still tries to do it and generates a number of exceptions (see enclosed). This error is not critical but overloads my catalina.out file. I do not think that it is difficult to fix it. I already reported this error to tomcat-dev, but decided to create a formal ""bug"" report at ASF Bugzilla to see if it was already fixed or not. This is not a big error, but it is annoying. Thanks! With the best regards, Igor Tetko ***** Apr 28, 2006 11:26:45 AM org.apache.catalina.core.ApplicationContext log SEVERE: #include--Couldn't include file: styles.html java.io.IOException: Couldn't find file: /incl/styles.html at org.apache.catalina.ssi.SSIServletExternalResolver.getFileText(SSIServletExternalResolver.java: 537) at org.apache.catalina.ssi.SSIMediator.getFileText(SSIMediator.java:155) at org.apache.catalina.ssi.SSIInclude.process(SSIInclude.java:44) at org.apache.catalina.ssi.SSIProcessor.process(SSIProcessor.java:146) at org.apache.catalina.ssi.SSIServlet.processSSI(SSIServlet.java:221) at org.apache.catalina.ssi.SSIServlet.requestHandler(SSIServlet.java:187) at org.apache.catalina.ssi.SSIServlet.doGet(SSIServlet.java:123) at javax.servlet.http.HttpServlet.doHead(HttpServlet.java:270) at javax.servlet.http.HttpServlet.service(HttpServlet.java:706) at javax.servlet.http.HttpServlet.service(HttpServlet.java:802) at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:252) at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173) at org.apache.catalina.core.ApplicationDispatcher.invoke(ApplicationDispatcher.java:672) at org.apache.catalina.core.ApplicationDispatcher.doInclude(ApplicationDispatcher.java:574) at org.apache.catalina.core.ApplicationDispatcher.include(ApplicationDispatcher.java:499) at org.apache.catalina.ssi.SSIServletExternalResolver.getFileText(SSIServletExternalResolver.java: 519) at org.apache.catalina.ssi.SSIMediator.getFileText(SSIMediator.java:155) at org.apache.catalina.ssi.SSIInclude.process(SSIInclude.java:44) at org.apache.catalina.ssi.SSIProcessor.process(SSIProcessor.java:146) at org.apache.catalina.ssi.SSIServlet.processSSI(SSIServlet.java:221) at org.apache.catalina.ssi.SSIServlet.requestHandler(SSIServlet.java:187) at org.apache.catalina.ssi.SSIServlet.doGet(SSIServlet.java:123) at javax.servlet.http.HttpServlet.doHead(HttpServlet.java:270) at javax.servlet.http.HttpServlet.service(HttpServlet.java:706) at javax.servlet.http.HttpServlet.service(HttpServlet.java:802) at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:252) at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173) at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:213) at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:178) at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:126) at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:105) at org.apache.catalina.valves.FastCommonAccessLogValve.invoke (FastCommonAccessLogValve.java:495) at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:107) at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:148) at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:869) at org.apache.coyote.http11.Http11BaseProtocol$Http11ConnectionHandler.processConnection (Http11BaseProtocol.java:664) at org.apache.tomcat.util.net.PoolTcpEndpoint.processSocket(PoolTcpEndpoint.java:527) at org.apache.tomcat.util.net.LeaderFollowerWorkerThread.runIt (LeaderFollowerWorkerThread.java:80) at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:684) at java.lang.Thread.run(Thread.java:613)"	2006-05-16 17:40:47	1147820000	resolved fixed	0f9844c	1153960000	java/org/apache/catalina/ssi/SSIServletExternalResolver.java	
1052	39689	Bug 39689 Tomcat Server Side Includes (SSI) do not work with single quotes		2006-05-31 07:46:22	1149080000	resolved fixed	8ed77be	1153600000	java/org/apache/catalina/ssi/SSIProcessor.java	
1053	34801	Bug 34801 PATCH: CGIServlet does not terminate child after a timeout		2005-05-08 06:47:30	1115550000	resolved fixed	c30afec	1153530000	java/org/apache/catalina/servlets/CGIServlet.java	
1054	40012	Bug 40012 Legacy EL Support not resolving variables correctly	"Given the following page: <% pageContext.setAttribute(""t"", ""foo""); %> ${t} <% out.print( pageContext.getExpressionEvaluator().evaluate( ""${t}"", String.class, pageContext.getVariableResolver(), null)); %> You will notice that the ${t} prints out fine when in the JSP but does not resolve using the scriplet and prints nothing. For a sanity check, I tested this and it worked in glassfish to ensure I wasn't doing anything odd. I'm trying to find root cause; but haven't found it yet, so I'm logging it in case anyone else has the itch to scratch."	2006-07-11 13:00:29	1152640000	resolved fixed	01a9b59	1152640000	java/org/apache/jasper/el/VariableResolverImpl.java	
1055	39769	Bug 39769 Wrong class loader when the myServlet.destroy() called if myServlet is in the T5 shared directory	"Hi all, My web app needs to have Thread.currentThread().getContextClassLoader() always right. When the application is unload it seem not be the case. My classes are under the T5's shared directory (so all my servlet.getClass().getClassLoader() == the shared classloader i.e.: StandardCalssLoader. My understanding is that when executing the code in my web app Thread.currentThread().getContextClassLoader() should always give the WebappLoader used in the StandardContext. The problem occurs in StandardWrapper.unload() before calling the servlet.destroy() method .... ClassLoader oldCtxClassLoader = Thread.currentThread().getContextClassLoader(); ClassLoader classLoader = instance.getClass().getClassLoader(); PrintStream out = System.out; if (swallowOutput) { SystemLogHandler.startCapture(); } // Call the servlet destroy() method try { instanceSupport.fireInstanceEvent (InstanceEvent.BEFORE_DESTROY_EVENT, instance); Thread.currentThread().setContextClassLoader(classLoader); if( System.getSecurityManager() != null) { SecurityUtil.doAsPrivilege(""destroy"", instance); SecurityUtil.remove(instance); } else { instance.destroy(); } .... In the code, the INSTANCE variable is my servlet and it have been loaded by the SHARED classloader. So the classloader set in the thread is not the right one. It Should be the classloader related to StandardContext.getLoader() This problem occurs when I try to close my T5 dos windows and I suppose will occurs when I will uninstall any webApp from my T5. I notice the problem in T5 5.5.16 but I verified and it's the same code in 5.5.17. So probably the problem is still there Best Regards /David Gagnon"	2006-06-09 20:09:27	1149900000	resolved fixed	276e5ac	1150060000	java/org/apache/catalina/core/StandardWrapper.java	
1056	39699	Bug 39699 simple deploy failed in cluster (distributable flag)	"Hi, i encounter a strange problem with my tomcat cluster and webapps deployment. server.xml -------------------------------- <Server port=""8005"" shutdown=""SHUTDOWN""> <Listener className=""org.apache.catalina.core.AprLifecycleListener"" /> <Listener className=""org.apache.catalina.mbeans.ServerLifecycleListener"" /> <Listener className=""org.apache.catalina.mbeans.GlobalResourcesLifecycleListener"" /> <Listener className=""org.apache.catalina.storeconfig.StoreConfigLifecycleListener""/> <!-- Global JNDI resources --> <GlobalNamingResources> <Environment name=""simpleValue"" type=""java.lang.Integer"" value=""30""/> <Resource name=""UserDatabase"" auth=""Container"" type=""org.apache.catalina.UserDatabase"" description=""User database that can be updated and saved"" factory=""org.apache.catalina.users.MemoryUserDatabaseFactory"" pathname=""conf/tomcat-users.xml"" /> </GlobalNamingResources> <!-- Define the Tomcat Stand-Alone Service --> <Service name=""Catalina""> <!-- Define a non-SSL HTTP/1.1 Connector on port 8080 --> <Connector address=""polen-integ"" port=""8080"" maxHttpHeaderSize=""8192"" maxThreads=""300"" minSpareThreads=""25"" maxSpareThreads=""100"" enableLookups=""false"" acceptCount=""100"" connectionTimeout=""20000"" disableUploadTimeout=""true"" /> <!-- Define an AJP 1.3 Connector on port 8009 --> <Connector port=""8009"" address=""polen-integ.sofinco.fr"" minProcessors=""20"" maxProcessors=""0"" maxThreads=""350"" minSpareThreads=""50"" maxSpareThreads=""100"" enableLookups=""false"" redirectPort=""8080"" protocol=""AJP/1.3"" disableUploadTimeout=""true"" /> <Engine name=""Catalina"" defaultHost=""localhost"" jvmRoute=""uxdev103"" > <Realm className=""org.apache.catalina.realm.UserDatabaseRealm"" resourceName=""UserDatabase""/> <Host name=""localhost"" appBase=""webapps"" unpackWARs=""true"" autoDeploy=""true"" xmlValidation=""false"" xmlNamespaceAware=""false"" > <!-- Cluster Definition --> <Cluster className=""org.apache.catalina.cluster.tcp.SimpleTcpCluster"" doClusterLog=""true"" clusterLogName=""clusterlog"" expireSessionsOnShutdown=""false"" useDirtyFlag=""true"" notifyListenersOnReplication=""true""> <Membership className=""org.apache.catalina.cluster.mcast.McastService"" mcastAddr=""228.0.0.4"" mcastBindAddress=""127.0.0.1"" mcastClusterDomain=""polen-integ"" mcastPort=""45564"" mcastFrequency=""1000"" mcastDropTime=""30000""/> <Receiver className=""org.apache.catalina.cluster.tcp.ReplicationListener"" tcpListenAddress=""polen-integ"" tcpSelectorTimeout=""100"" tcpThreadCount=""6""/> <Sender className=""org.apache.catalina.cluster.tcp.ReplicationTransmitter"" replicationMode=""fastasyncqueue"" doTransmitterProcessingStats=""true"" doProcessingStats=""false"" doWaitAckStats=""false"" waitForAck=""false"" keepAliveMaxRequestCount=""-1""/> <Valve className=""org.apache.catalina.cluster.tcp.ReplicationValve"" filter="".*\.gif;.*\.js;.*\.css;.*\.png;.*\.jpeg;.*\.jpg;.*\.htm;.*\.html;.*\.txt;"" /> <Valve className=""org.apache.catalina.cluster.session.JvmRouteBinderValve"" enabled=""true"" /> <ClusterListener className=""org.apache.catalina.cluster.session.ClusterSessionListener"" /> <ClusterListener className=""org.apache.catalina.cluster.session.JvmRouteSessionIDBinderListener"" /> <Deployer className=""org.apache.catalina.cluster.deploy.FarmWarDeployer"" tempDir=""/home/tomcat/polen-integ/tmp/war-temp/"" deployDir=""${catalina.base}/webapps"" watchDir=""/home/tomcat/polen-integ/tmp/war-listen/"" watchEnabled=""true""/> </Cluster> </Host> </Engine> </Service> </Server> ------------------------ when i am trying to deploy a 'dsitributable' (and only when this flag is enabled) i get the following errors : --------------------------- INFO ContainerBackgroundProcessor[StandardEngine[Catalina]] org.apache.catalina.startup.HostConfig - Deploying web application archive po len.war INFO ContainerBackgroundProcessor[StandardEngine[Catalina]] org.apache.catalina.loader.WebappClassLoader - Illegal access: this web appli cation instance has been stopped already. Could not load java.io.PrintStream. The eventual following stack trace is caused by an error t hrown for debugging purposes as well as to attempt to terminate the thread which caused the illegal access, and has no functional impact. java.lang.IllegalStateException at org.apache.catalina.loader.WebappClassLoader.loadClass(WebappClassLoader.java:1238) at org.apache.catalina.loader.WebappClassLoader.loadClass(WebappClassLoader.java:1198) at java.lang.ClassLoader.loadClassInternal(Unknown Source) at org.apache.log4j.helpers.LogLog.error(LogLog.java:142) at org.apache.log4j.helpers.PatternParser$DatePatternConverter.convert(PatternParser.java:447) at org.apache.log4j.helpers.PatternConverter.format(PatternConverter.java:64) at org.apache.log4j.PatternLayout.format(PatternLayout.java:503) at org.apache.log4j.WriterAppender.subAppend(WriterAppender.java:301) at org.apache.log4j.RollingFileAppender.subAppend(RollingFileAppender.java:234) at org.apache.log4j.WriterAppender.append(WriterAppender.java:159) at org.apache.log4j.AppenderSkeleton.doAppend(AppenderSkeleton.java:230) at org.apache.log4j.helpers.AppenderAttachableImpl.appendLoopOnAppenders(AppenderAttachableImpl.java:65) at org.apache.log4j.Category.callAppenders(Category.java:203) at org.apache.log4j.Category.forcedLog(Category.java:388) at org.apache.log4j.Category.log(Category.java:853) at org.apache.commons.logging.impl.Log4JLogger.info(Log4JLogger.java:133) at org.apache.catalina.cluster.session.DeltaManager.start(DeltaManager.java:976) at org.apache.catalina.core.ContainerBase.setManager(ContainerBase.java:431) at org.apache.catalina.core.StandardContext.start(StandardContext.java:4125) at org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:739) at org.apache.catalina.core.StandardHost.addChild(StandardHost.java:524) at org.apache.catalina.startup.HostConfig.deployWAR(HostConfig.java:809) at org.apache.catalina.startup.HostConfig.deployWARs(HostConfig.java:698) at org.apache.catalina.startup.HostConfig.deployApps(HostConfig.java:472) at org.apache.catalina.startup.HostConfig.check(HostConfig.java:1190) at org.apache.catalina.startup.HostConfig.lifecycleEvent(HostConfig.java:292) at org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:119) at org.apache.catalina.core.ContainerBase.backgroundProcess(ContainerBase.java:1305) at org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.processChildren(ContainerBase.java:1569) at org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.processChildren(ContainerBase.java:1578) at org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.run(ContainerBase.java:1558) at java.lang.Thread.run(Unknown Source) INFO ContainerBackgroundProcessor[StandardEngine[Catalina]] org.apache.catalina.loader.WebappClassLoader - Illegal access: this web applic ation instance has been stopped already. Could not load java.io.PrintStream. The eventual following stack trace is caused by an error th rown for debugging purposes as well as to attempt to terminate the thread which caused the illegal access, and has no functional impact. Java.lang.IllegalStateException at org.apache.catalina.loader.WebappClassLoader.loadClass(WebappClassLoader.java:1238) at org.apache.catalina.loader.WebappClassLoader.loadClass(WebappClassLoader.java:1198) at java.lang.ClassLoader.loadClassInternal(Unknown Source) at org.apache.log4j.helpers.LogLog.error(LogLog.java:142) at org.apache.log4j.helpers.PatternParser$DatePatternConverter.convert(PatternParser.java:447) at org.apache.log4j.helpers.PatternConverter.format(PatternConverter.java:64) at org.apache.log4j.PatternLayout.format(PatternLayout.java:503) at org.apache.log4j.WriterAppender.subAppend(WriterAppender.java:301) at org.apache.log4j.RollingFileAppender.subAppend(RollingFileAppender.java:234) at org.apache.log4j.WriterAppender.append(WriterAppender.java:159) at org.apache.log4j.AppenderSkeleton.doAppend(AppenderSkeleton.java:230) at org.apache.log4j.helpers.AppenderAttachableImpl.appendLoopOnAppenders(AppenderAttachableImpl.java:65) at org.apache.log4j.Category.callAppenders(Category.java:203) at org.apache.log4j.Category.forcedLog(Category.java:388) at org.apache.log4j.Category.log(Category.java:853) at org.apache.commons.logging.impl.Log4JLogger.info(Log4JLogger.java:133) at org.apache.catalina.cluster.session.DeltaManager.start(DeltaManager.java:976) at org.apache.catalina.core.ContainerBase.setManager(ContainerBase.java:431) at org.apache.catalina.core.StandardContext.start(StandardContext.java:4125) at org.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:759) at org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:739) at org.apache.catalina.core.StandardHost.addChild(StandardHost.java:524) at org.apache.catalina.startup.HostConfig.deployWAR(HostConfig.java:809) at org.apache.catalina.startup.HostConfig.deployWARs(HostConfig.java:698) at org.apache.catalina.startup.HostConfig.deployApps(HostConfig.java:472) at org.apache.catalina.startup.HostConfig.check(HostConfig.java:1190) at org.apache.catalina.startup.HostConfig.lifecycleEvent(HostConfig.java:292) at org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:119) at org.apache.catalina.core.ContainerBase.backgroundProcess(ContainerBase.java:1305) at org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.processChildren(ContainerBase.java:1569) at org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.processChildren(ContainerBase.java:1578) at org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.run(ContainerBase.java:1558) at java.lang.Thread.run(Unknown Source) INFO ContainerBackgroundProcessor[StandardEngine[Catalina]] org.apache.catalina.loader.WebappClassLoader - Illegal access: this web applic ation instance has been stopped already. Could not load org.apache.log4j.spi.VectorWriter. The eventual following stack trace is caused by an error thrown for debugging purposes as well as to attempt to terminate the thread which caused the illegal access, and has no functi onal impact. java.lang.IllegalStateException at org.apache.catalina.loader.WebappClassLoader.loadClass(WebappClassLoader.java:1238) at org.apache.catalina.loader.WebappClassLoader.loadClass(WebappClassLoader.java:1198) at java.lang.ClassLoader.loadClassInternal(Unknown Source) at org.apache.log4j.spi.LoggingEvent.<init>(LoggingEvent.java:154) at org.apache.log4j.Category.forcedLog(Category.java:388) at org.apache.log4j.Category.log(Category.java:853) at org.apache.commons.logging.impl.Log4JLogger.error(Log4JLogger.java:193) at org.apache.catalina.cluster.session.DeltaManager.start(DeltaManager.java:990) at org.apache.catalina.core.ContainerBase.setManager(ContainerBase.java:431) at org.apache.catalina.core.StandardContext.start(StandardContext.java:4125) at org.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:759) at org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:739) at org.apache.catalina.core.StandardHost.addChild(StandardHost.java:524) at org.apache.catalina.startup.HostConfig.deployWAR(HostConfig.java:809) at org.apache.catalina.startup.HostConfig.deployWARs(HostConfig.java:698) at org.apache.catalina.startup.HostConfig.deployApps(HostConfig.java:472) at org.apache.catalina.startup.HostConfig.check(HostConfig.java:1190) at org.apache.catalina.startup.HostConfig.lifecycleEvent(HostConfig.java:292) at org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:119) at org.apache.catalina.core.ContainerBase.backgroundProcess(ContainerBase.java:1305) at org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.processChildren(ContainerBase.java:1569) at org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.processChildren(ContainerBase.java:1578) at org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.run(ContainerBase.java:1558) at java.lang.Thread.run(Unknown Source) INFO ContainerBackgroundProcessor[StandardEngine[Catalina]] org.apache.catalina.loader.WebappClassLoader - Illegal access: this web applic ation instance has been stopped already. Could not load org.apache.log4j.spi.VectorWriter. The eventual following stack trace is caused by an error thrown for debugging purposes as well as to attempt to terminate the thread which caused the illegal access, and has no functi onal impact. java.lang.IllegalStateException at org.apache.catalina.loader.WebappClassLoader.loadClass(WebappClassLoader.java:1238) at org.apache.catalina.loader.WebappClassLoader.loadClass(WebappClassLoader.java:1198) at java.lang.ClassLoader.loadClassInternal(Unknown Source) at org.apache.log4j.spi.LoggingEvent.<init>(LoggingEvent.java:154) at org.apache.log4j.Category.forcedLog(Category.java:388) at org.apache.log4j.Category.log(Category.java:853) at org.apache.commons.logging.impl.Log4JLogger.error(Log4JLogger.java:193) at org.apache.catalina.cluster.session.DeltaManager.start(DeltaManager.java:990) at org.apache.catalina.core.ContainerBase.setManager(ContainerBase.java:431) at org.apache.catalina.core.StandardContext.start(StandardContext.java:4125) at org.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:759) at org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:739) at org.apache.catalina.core.StandardHost.addChild(StandardHost.java:524) at org.apache.catalina.startup.HostConfig.deployWAR(HostConfig.java:809) at org.apache.catalina.startup.HostConfig.deployWARs(HostConfig.java:698) at org.apache.catalina.startup.HostConfig.deployApps(HostConfig.java:472) at org.apache.catalina.startup.HostConfig.check(HostConfig.java:1190) at org.apache.catalina.startup.HostConfig.lifecycleEvent(HostConfig.java:292) at org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:119) at org.apache.catalina.core.ContainerBase.backgroundProcess(ContainerBase.java:1305) at org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.processChildren(ContainerBase.java:1569) at org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.processChildren(ContainerBase.java:1578) at org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.run(ContainerBase.java:1558) at java.lang.Thread.run(Unknown Source) ERROR ContainerBackgroundProcessor[StandardEngine[Catalina]] org.apache.commons.modeler.Registry - Null component Catalina:type=JspMonitor ,name=jsp,WebModule=//localhost/polen,J2EEApplication=none,J2EEServer=none ERROR ContainerBackgroundProcessor[StandardEngine[Catalina]] org.apache.catalina.startup.HostConfig - Error deploying web application arc hive polen.war java.lang.NoClassDefFoundError: org/apache/log4j/spi/VectorWriter at org.apache.log4j.spi.LoggingEvent.<init>(LoggingEvent.java:154) at org.apache.log4j.Category.forcedLog(Category.java:388) at org.apache.log4j.Category.log(Category.java:853) at org.apache.commons.logging.impl.Log4JLogger.error(Log4JLogger.java:193) at org.apache.catalina.cluster.session.DeltaManager.start(DeltaManager.java:990) at org.apache.catalina.core.ContainerBase.setManager(ContainerBase.java:431) at org.apache.catalina.core.StandardContext.start(StandardContext.java:4125) at org.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:759) at org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:739) at org.apache.catalina.core.StandardHost.addChild(StandardHost.java:524) at org.apache.catalina.startup.HostConfig.deployWAR(HostConfig.java:809) at org.apache.catalina.startup.HostConfig.deployWARs(HostConfig.java:698) at org.apache.catalina.startup.HostConfig.deployApps(HostConfig.java:472) at org.apache.catalina.startup.HostConfig.check(HostConfig.java:1190) at org.apache.catalina.startup.HostConfig.lifecycleEvent(HostConfig.java:292) at org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:119) at org.apache.catalina.core.ContainerBase.backgroundProcess(ContainerBase.java:1305) at org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.processChildren(ContainerBase.java:1569) at org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.processChildren(ContainerBase.java:1578) at org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.run(ContainerBase.java:1558) at java.lang.Thread.run(Unknown Source) ERROR ContainerBackgroundProcessor[StandardEngine[Catalina]] org.apache.catalina.startup.HostConfig - Error deploying web application arch ive polen.war java.lang.NoClassDefFoundError: org/apache/log4j/spi/VectorWriter at org.apache.log4j.spi.LoggingEvent.<init>(LoggingEvent.java:154) at org.apache.log4j.Category.forcedLog(Category.java:388) at org.apache.log4j.Category.log(Category.java:853) at org.apache.commons.logging.impl.Log4JLogger.error(Log4JLogger.java:193) at org.apache.catalina.cluster.session.DeltaManager.start(DeltaManager.java:990) at org.apache.catalina.core.ContainerBase.setManager(ContainerBase.java:431) at org.apache.catalina.core.StandardContext.start(StandardContext.java:4125) at org.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:759) at org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:739) at org.apache.catalina.core.StandardHost.addChild(StandardHost.java:524) at org.apache.catalina.startup.HostConfig.deployWAR(HostConfig.java:809) at org.apache.catalina.startup.HostConfig.deployWARs(HostConfig.java:698) at org.apache.catalina.startup.HostConfig.deployApps(HostConfig.java:472) at org.apache.catalina.startup.HostConfig.check(HostConfig.java:1190) at org.apache.catalina.startup.HostConfig.lifecycleEvent(HostConfig.java:292) at org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:119) at org.apache.catalina.core.ContainerBase.backgroundProcess(ContainerBase.java:1305) at org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.processChildren(ContainerBase.java:1569) at org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.processChildren(ContainerBase.java:1578) at org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.run(ContainerBase.java:1558) at java.lang.Thread.run(Unknown Source) --------------- i have tried to deployed via web manager application or simple copy of my war in webapps directory... No luck, if i put '<distributable/> flag in application web.xml config file, i encounter this error ; i need to restart manually tomcat instance... After this restart the application is correctly deployed without any error... Of course if i disable cluster in server.xml, no problem..."	2006-06-01 16:28:04	1149190000	resolved fixed	7b870a4	1149780000	java/org/apache/catalina/core/StandardContext.java	
